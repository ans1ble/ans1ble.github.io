第三百二十一节，Django框架，发送邮件


			<div id="cnblogs_post_body" class="blogpost-body"><p><strong>第三百二十一节，Django框架，发送邮件</strong></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>全局配置settings.py</strong></span></p>
<div class="cnblogs_code">
<pre>EMAIL_BACKEND = <span style="color: #800000">'</span><span style="color: #800000">django.core.mail.backends.smtp.EmailBackend</span><span style="color: #800000">'</span>   <span style="color: #008000">#</span><span style="color: #008000">发送邮件引擎</span>
<span style="color: #000000">
EMAIL_USE_TLS </span>= False                               <span style="color: #008000">#</span><span style="color: #008000">是否以https方式</span>
EMAIL_HOST = <span style="color: #800000">'</span><span style="color: #800000">smtp.163.com</span><span style="color: #800000">'</span>                         <span style="color: #008000">#</span><span style="color: #008000">邮件smtp服务器</span>
EMAIL_PORT = 25                                     <span style="color: #008000">#</span><span style="color: #008000">端口</span>
EMAIL_HOST_USER = <span style="color: #800000">'</span><span style="color: #800000">15284816568@163.com</span><span style="color: #800000">'</span>             <span style="color: #008000">#</span><span style="color: #008000">发件人</span>
EMAIL_HOST_PASSWORD = <span style="color: #800000">'</span><span style="color: #800000">adc279818</span><span style="color: #800000">'</span>                   <span style="color: #008000">#</span><span style="color: #008000">发件人密码</span>
DEFAULT_FROM_EMAIL = <span style="color: #800000">'</span><span style="color: #800000">玉秀文化 &lt;15284816568@163.com&gt;</span><span style="color: #800000">'</span>  <span style="color: #008000">#</span><span style="color: #008000">收件人显示的发件人信息</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff">send_mail()</span> 每次发邮件都会建立一个连接，发多封邮件时建立多个连接</strong></span></p>
<div class="cnblogs_code">
<pre>    <span style="color: #0000ff">from</span> django.core.mail <span style="color: #0000ff">import</span><span style="color: #000000"> send_mail

    send_mail(</span><span style="color: #800000">'</span><span style="color: #800000">主题</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">内容</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">玉秀文化 &lt;15284816568@163.com&gt;</span><span style="color: #800000">'</span>,[<span style="color: #800000">'</span><span style="color: #800000">729088188@qq.com</span><span style="color: #800000">'</span>], fail_silently=False)</pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff">send_mass_mail()</span> 是建立单个连接发送多封邮件，所以一次性发送多封邮件时 send_mass_mail 要优于 send_mail。</strong></span></p>
<div class="cnblogs_code">
<pre>    <span style="color: #0000ff">from</span> django.core.mail <span style="color: #0000ff">import</span><span style="color: #000000"> send_mass_mail

    message1 </span>= (<span style="color: #800000">'</span><span style="color: #800000">主题</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">内容</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">玉秀文化 &lt;15284816568@163.com&gt;</span><span style="color: #800000">'</span>, [<span style="color: #800000">'</span><span style="color: #800000">729088188@qq.com</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">244831604@qq.com</span><span style="color: #800000">'</span><span style="color: #000000">])
    message2 </span>= (<span style="color: #800000">'</span><span style="color: #800000">主题</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">内容</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">玉秀文化 &lt;15284816568@163.com&gt;</span><span style="color: #800000">'</span>, [<span style="color: #800000">'</span><span style="color: #800000">729088188@qq.com</span><span style="color: #800000">'</span><span style="color: #000000">])

    a </span>= send_mass_mail((message1,message2), fail_silently=<span style="color: #000000">False)
    </span><span style="color: #0000ff">print</span>(a)</pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>如果我们想在邮件中添加附件，发送 html 格式的内容</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">from</span> django.conf <span style="color: #0000ff">import</span><span style="color: #000000"> settings
</span><span style="color: #0000ff">from</span> django.core.mail <span style="color: #0000ff">import</span><span style="color: #000000"> EmailMultiAlternatives
 
 
from_email </span>=<span style="color: #000000"> settings.DEFAULT_FROM_EMAIL
</span><span style="color: #008000">#</span><span style="color: #008000"> subject 主题 content 内容 to_addr 是一个列表，发送给哪些人</span>
msg =<span style="color: #000000"> EmailMultiAlternatives(subject, content, from_email, [to_addr])
 
msg.content_subtype </span>= <span style="color: #800000">"</span><span style="color: #800000">html</span><span style="color: #800000">"</span>
 
<span style="color: #008000">#</span><span style="color: #008000"> 添加附件（可选）</span>
msg.attach_file(<span style="color: #800000">'</span><span style="color: #800000">./twz.pdf</span><span style="color: #800000">'</span><span style="color: #000000">)
 
</span><span style="color: #008000">#</span><span style="color: #008000"> 发送</span>
msg.send()</pre>
</div>
<p>上面的做法可能有一些风险，除非你确信你的接收者都可以阅读 html 格式的 邮件。</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>为安全起见，你可以弄两个版本，一个纯文本(text/plain)的为默认的，另外再提供一个 html 版本的（好像好多国外发的邮件都是纯文本的）</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">from</span> <span style="color: #800080">__future__</span> <span style="color: #0000ff">import</span><span style="color: #000000"> unicode_literals
 
</span><span style="color: #0000ff">from</span> django.conf <span style="color: #0000ff">import</span><span style="color: #000000"> settings
</span><span style="color: #0000ff">from</span> django.core.mail <span style="color: #0000ff">import</span><span style="color: #000000"> EmailMultiAlternatives
 
subject </span>= <span style="color: #800000">'</span><span style="color: #800000">来自自强学堂的问候</span><span style="color: #800000">'</span><span style="color: #000000">
 
text_content </span>= <span style="color: #800000">'</span><span style="color: #800000">这是一封重要的邮件.</span><span style="color: #800000">'</span><span style="color: #000000">
 
html_content </span>= <span style="color: #800000">'</span><span style="color: #800000">&lt;p&gt;这是一封&lt;strong&gt;重要的&lt;/strong&gt;邮件.&lt;/p&gt;</span><span style="color: #800000">'</span><span style="color: #000000">
 
msg </span>=<span style="color: #000000"> EmailMultiAlternatives(subject, text_content, from_email, [to@youemail.com])
 
msg.attach_alternative(html_content, </span><span style="color: #800000">"</span><span style="color: #800000">text/html</span><span style="color: #800000">"</span><span style="color: #000000">)
 
msg.send()</span></pre>
</div>
<p>&nbsp;</p></div>