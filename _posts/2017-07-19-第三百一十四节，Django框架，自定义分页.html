第三百一十四节，Django框架，自定义分页


			<div id="cnblogs_post_body" class="blogpost-body"><p><strong>第三百一十四节，Django框架，自定义分页</strong></p>
<p>&nbsp;</p>
<p><span style="color: #0000ff"><strong>自定义分页模块</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000">coding:utf-8</span>
<span style="color: #0000ff">from</span> django.utils.safestring <span style="color: #0000ff">import</span><span style="color: #000000"> mark_safe

</span><span style="color: #008000">#</span><span style="color: #008000">封装分页类模块</span>
<span style="color: #0000ff">class</span><span style="color: #000000"> fen_ye_lei:
    </span><span style="color: #0000ff">def</span> <span style="color: #800080">__init__</span><span style="color: #000000">(self,dang_qian_ye,shu_ju,tiao_shu,ye_ma_shu,qian_hou_ye,url):
        </span><span style="color: #800000">"""</span><span style="color: #800000">
        一个参数接收当前页
        第一个参数，接收分页数据列表
        第二个参数，接收每页显示多少条数据
        第三个参数，每页显示多少个页码
        第四个参数，显示当前页码前几个和后几个页码，需要结合每页显示多少个页码计算
        第五个参数，分页连接url后缀，也就是路由映射的后缀
        </span><span style="color: #800000">"""</span>
        <span style="color: #0000ff">try</span>:                                            <span style="color: #008000">#</span><span style="color: #008000">尝试执行</span>
            dang_qian_ye = int(dang_qian_ye)            <span style="color: #008000">#</span><span style="color: #008000">将当前页换成数字类型</span>
        <span style="color: #0000ff">except</span>:                                         <span style="color: #008000">#</span><span style="color: #008000">如果出错</span>
            dang_qian_ye = 1                            <span style="color: #008000">#</span><span style="color: #008000">当前页等于1</span>
        <span style="color: #0000ff">if</span> dang_qian_ye &lt; 1:                            <span style="color: #008000">#</span><span style="color: #008000">判断当前页如果小于1</span>
            dang_qian_ye = 1                            <span style="color: #008000">#</span><span style="color: #008000">当前页等于1</span>
<span style="color: #000000">
        self.dang_qian_ye </span>= dang_qian_ye                <span style="color: #008000">#</span><span style="color: #008000">当前页</span>
        self.shu_ju = shu_ju                            <span style="color: #008000">#</span><span style="color: #008000">接收分页数据列表</span>
        self.tiao_shu = tiao_shu                        <span style="color: #008000">#</span><span style="color: #008000">接收每页显示多少条数据</span>
        self.ye_ma_shu = ye_ma_shu                      <span style="color: #008000">#</span><span style="color: #008000">每页显示多少个页码</span>
        self.qian_hou_ye = qian_hou_ye                  <span style="color: #008000">#</span><span style="color: #008000">显示当前页码前几个和后几个页码，需要结合每页显示多少个页码计算</span>
        self.url = url                                  <span style="color: #008000">#</span><span style="color: #008000">分页连接url后缀，也就是路由映射的后缀</span>


        <span style="color: #008000">#</span><span style="color: #008000"> 计算总页码</span>
        zong_ye_ma, c = divmod(len(self.shu_ju), self.tiao_shu)   <span style="color: #008000">#</span><span style="color: #008000">数据总量除以显示条数，取余，两个变量接收，第一个变量得到相除后的整数，后一个变量得到相除后的余数(小数)</span>
        <span style="color: #0000ff">if</span> c &gt; 0:                                       <span style="color: #008000">#</span><span style="color: #008000">判断余数如果大于0，</span>
            zong_ye_ma += 1                             <span style="color: #008000">#</span><span style="color: #008000">页面数等于整数加1，等于分页总量</span>
        self.zong_ye_ma = zong_ye_ma                    <span style="color: #008000">#</span><span style="color: #008000">接收总页码</span>


    <span style="color: #0000ff">def</span><span style="color: #000000"> shu_ju_fan_wei(self):
        </span><span style="color: #800000">"""</span><span style="color: #800000">
        shu_ju_fan_wei()方法，返回每页获取范围数据
        </span><span style="color: #800000">"""</span>
        <span style="color: #008000">#</span><span style="color: #008000">换算每页获取范围数据</span>
        qi_shi = (self.dang_qian_ye - 1) * self.tiao_shu     <span style="color: #008000">#</span><span style="color: #008000">当前页码获取数据起始位置</span>
        jie_shu = self.dang_qian_ye * self.tiao_shu          <span style="color: #008000">#</span><span style="color: #008000">当前页码获取数据结束位置</span>
        xian_shi = self.shu_ju[qi_shi:jie_shu]               <span style="color: #008000">#</span><span style="color: #008000">通过起始和结束位置以下标方式获取指定范围的列表数据,xian_shi传到html模板显示数据</span>
        <span style="color: #0000ff">return</span><span style="color: #000000"> xian_shi



    </span><span style="color: #0000ff">def</span><span style="color: #000000"> xian_shi_ye_ma(self):
        </span><span style="color: #800000">"""</span><span style="color: #800000">
        xian_shi_ye_ma()方法，返回页码数据
        </span><span style="color: #800000">"""</span>
        <span style="color: #008000">#</span><span style="color: #008000"> 计算每页显示多少个页码</span>
        <span style="color: #008000">#</span><span style="color: #008000"> 假设每页显示11个页码，当前页的前5个和后5个</span>
        <span style="color: #008000">#</span><span style="color: #008000"> 所以需要动态调整循环里的值</span>
        <span style="color: #0000ff">if</span> self.zong_ye_ma &lt; self.ye_ma_shu:                            <span style="color: #008000">#</span><span style="color: #008000"> 判断总页码小于每页显示多少个页码</span>
            s = 1                                                       <span style="color: #008000">#</span><span style="color: #008000"> 起始页码为1</span>
            t = self.zong_ye_ma                                         <span style="color: #008000">#</span><span style="color: #008000"> 结束页码为总页码</span>
        <span style="color: #0000ff">else</span><span style="color: #000000">:
            </span><span style="color: #0000ff">if</span> self.dang_qian_ye &lt;= self.qian_hou_ye + 1:               <span style="color: #008000">#</span><span style="color: #008000"> 判断当前页码小于前后页码数</span>
                s = 1                                                   <span style="color: #008000">#</span><span style="color: #008000"> 起始页码为1</span>
                t = self.ye_ma_shu                                      <span style="color: #008000">#</span><span style="color: #008000"> 结束页码为每页显示多少个页码</span>
            <span style="color: #0000ff">else</span><span style="color: #000000">:
                </span><span style="color: #0000ff">if</span> (self.dang_qian_ye + self.qian_hou_ye) &gt; self.zong_ye_ma:    <span style="color: #008000">#</span><span style="color: #008000"> 判断当前页加前后页码数如果大于总页码数</span>
                    s = self.zong_ye_ma - (self.ye_ma_shu - 1)                  <span style="color: #008000">#</span><span style="color: #008000"> 起始页为总页数减以(每页显示多少个页码减一)</span>
                    t = self.zong_ye_ma                                         <span style="color: #008000">#</span><span style="color: #008000"> 结束页为总页码数</span>
                <span style="color: #0000ff">else</span><span style="color: #000000">:
                    s </span>= self.dang_qian_ye - self.qian_hou_ye                    <span style="color: #008000">#</span><span style="color: #008000"> 起始页为当前页减以前后页码数</span>
                    t = self.dang_qian_ye + self.qian_hou_ye                    <span style="color: #008000">#</span><span style="color: #008000"> 结束页为当前页加前后页码数</span>
<span style="color: #000000">
        ye_ma_lie_biao </span>= []                                                     <span style="color: #008000">#</span><span style="color: #008000"> 创建列表接收页码数据</span>

        <span style="color: #008000">#</span><span style="color: #008000">首页</span>
        sh_temp = <span style="color: #800000">'</span><span style="color: #800000">&lt;li&gt;&lt;a href="%s1"&gt;首页&lt;/a&gt;&lt;/li&gt;</span><span style="color: #800000">'</span> %<span style="color: #000000"> (self.url)
        ye_ma_lie_biao.append(sh_temp)

        </span><span style="color: #008000">#</span><span style="color: #008000">上一页</span>
        <span style="color: #0000ff">if</span> self.dang_qian_ye &lt;= 1<span style="color: #000000">:
            shye </span>= <span style="color: #800000">'</span><span style="color: #800000">&lt;li&gt;&lt;a href="javascript:void(0);"&gt;上一页&lt;/a&gt;&lt;/li&gt;</span><span style="color: #800000">'</span><span style="color: #000000">
            ye_ma_lie_biao.append(shye)
        </span><span style="color: #0000ff">else</span><span style="color: #000000">:
            shye </span>= <span style="color: #800000">'</span><span style="color: #800000">&lt;li&gt;&lt;a href="%s%s"&gt;上一页&lt;/a&gt;&lt;/li&gt;</span><span style="color: #800000">'</span> %(self.url,self.dang_qian_ye-1<span style="color: #000000">)
            ye_ma_lie_biao.append(shye)

        </span><span style="color: #0000ff">for</span> i <span style="color: #0000ff">in</span> range(s, t + 1):                                               <span style="color: #008000">#</span><span style="color: #008000"> 根据分页总量循环次数</span>
            <span style="color: #0000ff">if</span> i == self.dang_qian_ye:                                          <span style="color: #008000">#</span><span style="color: #008000"> 判断循环到的页码等于当前页面</span>
                temp = <span style="color: #800000">'</span><span style="color: #800000">&lt;li class="yem"&gt;&lt;a href="%s%s"&gt;%s&lt;/a&gt;&lt;/li&gt;</span><span style="color: #800000">'</span> % (self.url,i, i)   <span style="color: #008000">#</span><span style="color: #008000"> 格式化当前页码设置样式</span>
            <span style="color: #0000ff">else</span><span style="color: #000000">:
                temp </span>= <span style="color: #800000">'</span><span style="color: #800000">&lt;li&gt;&lt;a href="%s%s"&gt;%s&lt;/a&gt;&lt;/li&gt;</span><span style="color: #800000">'</span> % (self.url,i, i)               <span style="color: #008000">#</span><span style="color: #008000"> 格式化当前页码</span>
            ye_ma_lie_biao.append(temp)                                             <span style="color: #008000">#</span><span style="color: #008000"> 将格式化的页码数据追加到列表</span>

        <span style="color: #008000">#</span><span style="color: #008000">下一页</span>
        <span style="color: #0000ff">if</span> self.dang_qian_ye &gt;=<span style="color: #000000"> self.zong_ye_ma:
            xye </span>= <span style="color: #800000">'</span><span style="color: #800000">&lt;li&gt;&lt;a href="javascript:void(0);"&gt;下一页&lt;/a&gt;&lt;/li&gt;</span><span style="color: #800000">'</span><span style="color: #000000">
            ye_ma_lie_biao.append(xye)
        </span><span style="color: #0000ff">else</span><span style="color: #000000">:
            xye </span>= <span style="color: #800000">'</span><span style="color: #800000">&lt;li&gt;&lt;a href="%s%s"&gt;下一页&lt;/a&gt;&lt;/li&gt;</span><span style="color: #800000">'</span> %(self.url,self.dang_qian_ye+1<span style="color: #000000">)
            ye_ma_lie_biao.append(xye)

        </span><span style="color: #008000">#</span><span style="color: #008000">尾页</span>
        wei_temp = <span style="color: #800000">'</span><span style="color: #800000">&lt;li&gt;&lt;a href="%s%s"&gt;尾页&lt;/a&gt;&lt;/li&gt;</span><span style="color: #800000">'</span> %<span style="color: #000000"> (self.url,self.zong_ye_ma)
        ye_ma_lie_biao.append(wei_temp)

        xian_shi </span>= <span style="color: #800000">"</span><span style="color: #800000">\n</span><span style="color: #800000">"</span>.join(ye_ma_lie_biao)                                        <span style="color: #008000">#</span><span style="color: #008000"> 将页面数据，连接成一个字符串，传输到HTML模板</span>
        <span style="color: #0000ff">return</span> mark_safe(xian_shi)</pre>
</div>
<p><span style="color: #0000ff"><strong>逻辑处理</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">from</span> django.shortcuts <span style="color: #0000ff">import</span><span style="color: #000000"> render,redirect

</span><span style="color: #0000ff">from</span> app1.chajian.fen_ye <span style="color: #0000ff">import</span> fen_ye_lei  <span style="color: #008000">#</span><span style="color: #008000">导入分页模块</span>
<span style="color: #0000ff">from</span> app1.models <span style="color: #0000ff">import</span> *   <span style="color: #008000">#</span><span style="color: #008000">导入数据库模块</span><span style="color: #008000">
#</span><span style="color: #008000">逻辑处理模块</span>
<span style="color: #0000ff">def</span><span style="color: #000000"> special(request,page):
    shuju </span>= shengf.objects.all().values(<span style="color: #800000">'</span><span style="color: #800000">shf</span><span style="color: #800000">'</span>)  <span style="color: #008000">#</span><span style="color: #008000">获取数据库数据</span>
    shuju2 = list(shuju)                        <span style="color: #008000">#</span><span style="color: #008000">将数据转换成列表</span>
    fen_ye = <span style="background-color: #ff99cc">fen_ye_lei(page,shuju2,1,3,1,<span style="color: #800000">'</span><span style="color: #800000">/bugarticles/</span><span style="color: #800000">'</span>)</span>  <span style="color: #008000">#</span><span style="color: #008000">创建分页对象</span>
    fy = <span style="background-color: #ff99cc">fen_ye.xian_shi_ye_ma()</span>                            <span style="color: #008000">#</span><span style="color: #008000">接收分页html</span>
    ff = <span style="background-color: #ff99cc">fen_ye.shu_ju_fan_wei</span>                              <span style="color: #008000">#</span><span style="color: #008000">接收分页范围数据</span>
    <span style="color: #0000ff">if</span> fen_ye.dang_qian_ye &gt; fen_ye.zong_ye_ma:  <span style="color: #008000">#</span><span style="color: #008000"> 判断分页对象里的当前页码如果大于总页码</span>
        zfchdqy = str(fen_ye.zong_ye_ma)  <span style="color: #008000">#</span><span style="color: #008000"> 将总页码转换成字符串</span>
        <span style="color: #0000ff">return</span> redirect(<span style="color: #800000">'</span><span style="color: #800000">/bugarticles/</span><span style="color: #800000">'</span> + zfchdqy)  <span style="color: #008000">#</span><span style="color: #008000"> 跳转到总页码</span>
    <span style="color: #0000ff">else</span><span style="color: #000000">:
        </span><span style="color: #0000ff">return</span> render(request, <span style="color: #800000">'</span><span style="color: #800000">app1/index.html</span><span style="color: #800000">'</span>,locals())</pre>
</div>
<p><span style="color: #0000ff"><strong>html</strong></span></p>
<div class="cnblogs_code">
<pre>&lt;!DOCTYPE html&gt;
&lt;html lang=<span style="color: #800000">"</span><span style="color: #800000">en</span><span style="color: #800000">"</span>&gt;
&lt;head&gt;
    &lt;meta charset=<span style="color: #800000">"</span><span style="color: #800000">UTF-8</span><span style="color: #800000">"</span>&gt;
    &lt;title&gt;Title&lt;/title&gt;
    &lt;link rel=<span style="color: #800000">"</span><span style="color: #800000">stylesheet</span><span style="color: #800000">"</span> type=<span style="color: #800000">"</span><span style="color: #800000">text/css</span><span style="color: #800000">"</span> href=<span style="color: #800000">"</span><span style="color: #800000">/static/css/tou.css</span><span style="color: #800000">"</span>&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div&gt;
&lt;ul <span style="color: #0000ff">class</span>=<span style="color: #800000">"</span><span style="color: #800000">shu</span><span style="color: #800000">"</span>&gt;<span style="color: #000000">
    {</span>% <span style="color: #0000ff">for</span> i <span style="color: #0000ff">in</span> <span style="background-color: #ff99cc">ff</span> %<span style="color: #000000">}
        </span>&lt;li&gt;{{ i.shf }}&lt;/li&gt;<span style="color: #000000">
    {</span>% endfor %<span style="color: #000000">}
</span>&lt;/ul&gt;
&lt;/div&gt;
&lt;ul <span style="color: #0000ff">class</span>=<span style="color: #800000">"</span><span style="color: #800000">fy</span><span style="color: #800000">"</span>&gt;<span style="color: #000000">
{{ <span style="background-color: #ff99cc">fy</span> }}
</span>&lt;/ul&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
</div>
<p>&nbsp;</p></div>