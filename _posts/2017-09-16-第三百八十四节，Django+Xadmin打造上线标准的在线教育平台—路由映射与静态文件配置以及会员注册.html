第三百八十四节，Django+Xadmin打造上线标准的在线教育平台—路由映射与静态文件配置以及会员注册


			<div id="cnblogs_post_body" class="blogpost-body"><p><strong>第三百八十四节，Django+Xadmin打造上线标准的在线教育平台—路由映射与静态文件配置以及会员注册</strong></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong><strong>基于类的路由映射</strong></strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">from</span> django.conf.urls <span style="color: #0000ff">import</span> url, include                   <span style="color: #008000">#</span><span style="color: #008000"> 导入django自在的include逻辑</span>
<span style="color: #0000ff">from</span> django.contrib <span style="color: #0000ff">import</span><span style="color: #000000"> admin
</span><span style="color: #0000ff">from</span> django.views.generic <span style="color: #0000ff">import</span> <span style="background-color: #ff99cc">TemplateView</span>               <span style="color: #008000">#</span><span style="color: #008000"> 导入django自带的TemplateView逻辑</span>

<span style="color: #0000ff">import</span> xadmin                                               <span style="color: #008000">#</span><span style="color: #008000"> 导入xadmin</span>

<span style="color: #0000ff">from</span> app_users.views <span style="color: #0000ff">import</span> deng_lu, zhu_ce, active_code, logout                 <span style="color: #008000">#</span><span style="color: #008000"> 导入登录逻辑处理类</span>
<span style="color: #000000">
urlpatterns </span>=<span style="color: #000000"> [
    url(r</span><span style="color: #800000">'</span><span style="color: #800000">^xadmin/</span><span style="color: #800000">'</span><span style="color: #000000">, xadmin.site.urls),

    url(r</span><span style="color: #800000">'</span><span style="color: #800000">^index.html</span><span style="color: #800000">'</span>, <span style="background-color: #ff99cc">TemplateView.as_view(template_name=<span style="color: #800000">'</span><span style="color: #800000">index.html</span><span style="color: #800000">'</span>)</span>, name=<span style="color: #800000">'</span><span style="color: #800000">index</span><span style="color: #800000">'</span><span style="color: #000000">),

    url(r</span><span style="color: #800000">'</span><span style="color: #800000">^register.html</span><span style="color: #800000">'</span>, zhu_ce.<span style="background-color: #ff99cc">as_view()</span>, name=<span style="color: #800000">'</span><span style="color: #800000">register</span><span style="color: #800000">'</span><span style="color: #000000">),
    url(r</span><span style="color: #800000">'</span><span style="color: #800000">^captcha/</span><span style="color: #800000">'</span>, include(<span style="color: #800000">'</span><span style="color: #800000">captcha.urls</span><span style="color: #800000">'</span>), name=<span style="color: #800000">'</span><span style="color: #800000">captcha</span><span style="color: #800000">'</span><span style="color: #000000">),
    url(r</span><span style="color: #800000">'</span><span style="color: #800000">^active/(?P&lt;active_de&gt;.*)/$</span><span style="color: #800000">'</span>, active_code.<span style="background-color: #ff99cc">as_view()</span>, name=<span style="color: #800000">"</span><span style="color: #800000">user_active</span><span style="color: #800000">"</span><span style="color: #000000">),

    url(r</span><span style="color: #800000">'</span><span style="color: #800000">^login.html</span><span style="color: #800000">'</span>, <span style="background-color: #ff99cc">TemplateView.as_view(template_name=<span style="color: #800000">'</span><span style="color: #800000">login.html</span><span style="color: #800000">'</span>)</span>, name=<span style="color: #800000">'</span><span style="color: #800000">login</span><span style="color: #800000">'</span><span style="color: #000000">),
    url(r</span><span style="color: #800000">'</span><span style="color: #800000">^deng_lu</span><span style="color: #800000">'</span>, deng_lu.<span style="background-color: #ff99cc">as_view()</span>, name=<span style="color: #800000">'</span><span style="color: #800000">deng_lu</span><span style="color: #800000">'</span><span style="color: #000000">),
    url(r</span><span style="color: #800000">'</span><span style="color: #800000">^logout</span><span style="color: #800000">'</span>, logout.<span style="background-color: #ff99cc">as_view()</span>, name=<span style="color: #800000">'</span><span style="color: #800000">deng_lu</span><span style="color: #800000">'</span><span style="color: #000000">),
]</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="background-color: #ffffff; color: #ff0000"><strong>静态文件配置</strong></span></p>
<p><span style="background-color: #ffffff; color: #0000ff"><strong>settings.py</strong></span></p>
<div class="cnblogs_code">
<pre>STATIC_URL = <span style="color: #800000">'</span><span style="color: #800000">/static/</span><span style="color: #800000">'</span>    <span style="color: #008000">#</span><span style="color: #008000"> 设置静态文件前缀名称</span><span style="color: #008000">
#</span><span style="color: #008000">配置静态文件目录</span>
STATICFILES_DIRS =<span style="color: #000000"> [
    os.path.join(BASE_DIR, </span><span style="color: #800000">'</span><span style="color: #800000">static</span><span style="color: #800000">'</span>),   <span style="color: #008000">#</span><span style="color: #008000"> 设置静态文件路径</span>
]</pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #0000ff"><strong>html静态文件引用</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">&lt;!</span><span style="color: #ff00ff">DOCTYPE html</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">html</span><span style="color: #0000ff">&gt;</span><span style="color: #000000; background-color: #ff99cc">
{% load staticfiles %}      {# 启用静态文件引用 #}
</span><span style="color: #0000ff">&lt;</span><span style="color: #800000">head</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">meta </span><span style="color: #ff0000">charset</span><span style="color: #0000ff">="UTF-8"</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">meta </span><span style="color: #ff0000">name</span><span style="color: #0000ff">="renderer"</span><span style="color: #ff0000"> content</span><span style="color: #0000ff">="webkit"</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">meta </span><span style="color: #ff0000">http-equiv</span><span style="color: #0000ff">="X-UA-Compatible"</span><span style="color: #ff0000"> content</span><span style="color: #0000ff">="IE=Edge,chrome=1"</span> <span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">title</span><span style="color: #0000ff">&gt;</span>课程机构列表 - 慕学在线网<span style="color: #0000ff">&lt;/</span><span style="color: #800000">title</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">link </span><span style="color: #ff0000">rel</span><span style="color: #0000ff">="stylesheet"</span><span style="color: #ff0000"> type</span><span style="color: #0000ff">="text/css"</span><span style="color: #ff0000"> href</span><span style="color: #0000ff">="<span style="background-color: #ff99cc">{% static 'css/reset.css' %}</span>"</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">     {# 启用静态文件引用后才可以 #}
    </span><span style="color: #0000ff">&lt;</span><span style="color: #800000">link </span><span style="color: #ff0000">rel</span><span style="color: #0000ff">="stylesheet"</span><span style="color: #ff0000"> type</span><span style="color: #0000ff">="text/css"</span><span style="color: #ff0000"> href</span><span style="color: #0000ff">="<span style="background-color: #ff99cc">{% static 'css/animate.css' %}</span>"</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">link </span><span style="color: #ff0000">rel</span><span style="color: #0000ff">="stylesheet"</span><span style="color: #ff0000"> type</span><span style="color: #0000ff">="text/css"</span><span style="color: #ff0000"> href</span><span style="color: #0000ff">="<span style="background-color: #ff99cc">{% static 'css/style.css' %}</span>"</span><span style="color: #0000ff">&gt;</span>
    
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">script </span><span style="color: #ff0000">src</span><span style="color: #0000ff">="<span style="background-color: #ff99cc">{% static 'js/jquery.min.js' %}</span>"</span><span style="color: #ff0000"> type</span><span style="color: #0000ff">="text/javascript"</span><span style="color: #0000ff">&gt;&lt;/</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">script </span><span style="color: #ff0000">src</span><span style="color: #0000ff">="<span style="background-color: #ff99cc">{% static 'js/jquery-migrate-1.2.1.min.js' %}</span>"</span><span style="color: #ff0000"> type</span><span style="color: #0000ff">="text/javascript"</span><span style="color: #0000ff">&gt;&lt;/</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span>

<span style="color: #0000ff">&lt;/</span><span style="color: #800000">head</span><span style="color: #0000ff">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>会员注册</strong></span></p>
<p><span style="color: #ff0000"><strong>1，首先路由映射好逻辑处理类</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">from</span> django.conf.urls <span style="color: #0000ff">import</span> url, include                   <span style="color: #008000">#</span><span style="color: #008000"> 导入django自在的include逻辑</span>
<span style="color: #0000ff">from</span> django.contrib <span style="color: #0000ff">import</span><span style="color: #000000"> admin
</span><span style="color: #0000ff">from</span> django.views.generic <span style="color: #0000ff">import</span> TemplateView               <span style="color: #008000">#</span><span style="color: #008000"> 导入django自带的TemplateView逻辑</span>

<span style="color: #0000ff">import</span> xadmin                                               <span style="color: #008000">#</span><span style="color: #008000"> 导入xadmin</span>

<span style="color: #0000ff">from</span> app_users.views <span style="color: #0000ff">import</span> deng_lu, zhu_ce, active_code, logout                 <span style="color: #008000">#</span><span style="color: #008000"> 导入登录逻辑处理类</span>
<span style="color: #000000">
urlpatterns </span>=<span style="color: #000000"> [
    url(r</span><span style="color: #800000">'</span><span style="color: #800000">^xadmin/</span><span style="color: #800000">'</span><span style="color: #000000">, xadmin.site.urls),

    url(r</span><span style="color: #800000">'</span><span style="color: #800000">^index.html</span><span style="color: #800000">'</span>, TemplateView.as_view(template_name=<span style="color: #800000">'</span><span style="color: #800000">index.html</span><span style="color: #800000">'</span>), name=<span style="color: #800000">'</span><span style="color: #800000">index</span><span style="color: #800000">'</span><span style="color: #000000">),

    <span style="background-color: #ff99cc">url(r</span></span><span style="background-color: #ff99cc"><span style="color: #800000">'</span><span style="color: #800000">^register.html</span><span style="color: #800000">'</span>, zhu_ce.as_view(), name=<span style="color: #800000">'</span><span style="color: #800000">register</span><span style="color: #800000">'</span></span><span style="color: #000000"><span style="background-color: #ff99cc">),</span>
    url(r</span><span style="color: #800000">'</span><span style="color: #800000">^captcha/</span><span style="color: #800000">'</span>, include(<span style="color: #800000">'</span><span style="color: #800000">captcha.urls</span><span style="color: #800000">'</span>), name=<span style="color: #800000">'</span><span style="color: #800000">captcha</span><span style="color: #800000">'</span><span style="color: #000000">),
    url(r</span><span style="color: #800000">'</span><span style="color: #800000">^active/(?P&lt;active_de&gt;.*)/$</span><span style="color: #800000">'</span>, active_code.as_view(), name=<span style="color: #800000">"</span><span style="color: #800000">user_active</span><span style="color: #800000">"</span><span style="color: #000000">),

    url(r</span><span style="color: #800000">'</span><span style="color: #800000">^login.html</span><span style="color: #800000">'</span>, TemplateView.as_view(template_name=<span style="color: #800000">'</span><span style="color: #800000">login.html</span><span style="color: #800000">'</span>), name=<span style="color: #800000">'</span><span style="color: #800000">login</span><span style="color: #800000">'</span><span style="color: #000000">),
    url(r</span><span style="color: #800000">'</span><span style="color: #800000">^deng_lu</span><span style="color: #800000">'</span>, deng_lu.as_view(), name=<span style="color: #800000">'</span><span style="color: #800000">deng_lu</span><span style="color: #800000">'</span><span style="color: #000000">),
    url(r</span><span style="color: #800000">'</span><span style="color: #800000">^logout</span><span style="color: #800000">'</span>, logout.as_view(), name=<span style="color: #800000">'</span><span style="color: #800000">deng_lu</span><span style="color: #800000">'</span><span style="color: #000000">),
]</span></pre>
</div>
<p>&nbsp;</p>
<p><br><span style="color: #ff0000"><strong>2，编写表单验证forms文件</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">from</span> django <span style="color: #0000ff">import</span> forms                 <span style="color: #008000">#</span><span style="color: #008000"> 导入Django的表单验证模块</span>
<span style="color: #0000ff">from</span> captcha.fields <span style="color: #0000ff">import</span><span style="color: #000000"> CaptchaField


</span><span style="background-color: #ff99cc"><span style="color: #0000ff">class</span><span style="color: #000000"> zhu_ce_forms(forms.Form):
    email </span>=<span style="color: #000000"> forms.EmailField(
        required</span>=<span style="color: #000000">True,
        max_length</span>=40<span style="color: #000000">,
        min_length</span>=2<span style="color: #000000">,
        error_messages</span>=<span style="color: #000000">{
            </span><span style="color: #800000">'</span><span style="color: #800000">required</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">邮箱名不能为空</span><span style="color: #800000">'</span><span style="color: #000000">,
            </span><span style="color: #800000">'</span><span style="color: #800000">max_length</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">邮箱名长度不得超过40个字符</span><span style="color: #800000">'</span><span style="color: #000000">,
            </span><span style="color: #800000">'</span><span style="color: #800000">min_length</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">邮箱名长度不得少于2个字符</span><span style="color: #800000">'</span><span style="color: #000000">,
        }
    )
    password </span>=<span style="color: #000000"> forms.CharField(
        required</span>=<span style="color: #000000">True,
        max_length</span>=20<span style="color: #000000">,
        min_length</span>=2<span style="color: #000000">,
        error_messages</span>=<span style="color: #000000">{
            </span><span style="color: #800000">'</span><span style="color: #800000">required</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">密码不能为空</span><span style="color: #800000">'</span><span style="color: #000000">,
            </span><span style="color: #800000">'</span><span style="color: #800000">max_length</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">密码长度不得超过20个字符</span><span style="color: #800000">'</span><span style="color: #000000">,
            </span><span style="color: #800000">'</span><span style="color: #800000">min_length</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">密码长度不得少于2个字符</span><span style="color: #800000">'</span><span style="color: #000000">,
        }
    )
    captcha </span>=<span style="color: #000000"> CaptchaField(
        required</span>=<span style="color: #000000">True,
        error_messages</span>=<span style="color: #000000">{
            </span><span style="color: #800000">'</span><span style="color: #800000">required</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">验证码不能为空</span><span style="color: #800000">'</span><span style="color: #000000">,
            </span><span style="color: #800000">'</span><span style="color: #800000">invalid</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">验证码不正确</span><span style="color: #800000">'</span><span style="color: #000000">
        }
    )</span></span></pre>
</div>
<p><br><br></p>
<p><br><span style="color: #ff0000"><strong>3，在逻辑处理类里将request.POST也就是用户提交的表单，放到表单类里验证，验证不通过返回提示信息，回填数据，验证通过获取验证通过的表单数据<span style="color: #0000ff">（包括验证码验证，前后将）</span></strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf8 -*-</span>
<span style="color: #0000ff">import</span> io  <span style="color: #008000">#</span><span style="color: #008000"> 导入io模块</span>

<span style="color: #0000ff">from</span> django.shortcuts <span style="color: #0000ff">import</span> render, HttpResponse, redirect                                 <span style="color: #008000">#</span><span style="color: #008000"> 导入django向浏览器返回方法</span>
<span style="color: #0000ff">from</span> django.views.generic.base <span style="color: #0000ff">import</span><span style="color: #000000"> View
</span><span style="color: #0000ff">from</span> django.db.models <span style="color: #0000ff">import</span> F,Q                                                            <span style="color: #008000">#</span><span style="color: #008000"> 导入F和Q</span>
<span style="color: #0000ff">from</span> django.contrib.auth.hashers <span style="color: #0000ff">import</span> <span style="background-color: #ffffff">make_password</span>, check_password                       <span style="color: #008000">#</span><span style="color: #008000"> 导入django密码加密，和密码验证</span>
<span style="color: #0000ff">from</span> django.contrib.auth <span style="color: #0000ff">import</span> login                                                       <span style="color: #008000">#</span><span style="color: #008000"> 调用django的登录函数</span>

<span style="color: #0000ff">from</span> app_users.forms <span style="color: #0000ff">import</span> deng_lu_forms, zhu_ce_forms                                    <span style="color: #008000">#</span><span style="color: #008000"> 导入登录页面表单认证</span>
<span style="color: #0000ff">from</span> app_users.models <span style="color: #0000ff">import</span> Users, Email                                                   <span style="color: #008000">#</span><span style="color: #008000"> 导入数据库操作</span>
<span style="color: #0000ff">from</span> utils.email_send <span style="color: #0000ff">import</span> send_register_email                                            <span style="color: #008000">#</span><span style="color: #008000"> 导入邮件发送</span>


<span style="color: #0000ff">class</span><span style="color: #000000"> zhu_ce(View):
    </span><span style="color: #0000ff">def</span><span style="color: #000000"> get(self, request):
        <span style="background-color: #ff99cc">yanzhm </span></span><span style="background-color: #ff99cc">=<span style="color: #000000"> zhu_ce_forms()
        </span><span style="color: #0000ff">return</span> render(request, <span style="color: #800000">'</span><span style="color: #800000">register.html</span><span style="color: #800000">'</span>, {<span style="color: #800000">'</span><span style="color: #800000">yanzhm</span><span style="color: #800000">'</span><span style="color: #000000">: yanzhm})

  </span></span><span style="background-color: #ff99cc"><span style="color: #0000ff">def</span><span style="color: #000000"> post(self, request):
        f </span>=<span style="color: #000000"> zhu_ce_forms(request.POST)
        </span><span style="color: #0000ff">if</span> f.is_valid():                                <span style="color: #008000">#</span><span style="color: #008000"> 判断认证是否成功</span>
            tong_guo = f.cleaned_data                   <span style="color: #008000">#</span><span style="color: #008000"> 认证成功，接收用户数据</span>
            email = tong_guo[<span style="color: #800000">'</span><span style="color: #800000">email</span><span style="color: #800000">'</span><span style="color: #000000">]
            password </span>= tong_guo[<span style="color: #800000">'</span><span style="color: #800000">password</span><span style="color: #800000">'</span><span style="color: #000000">]</span><span style="color: #0000ff">else</span>:                                           <span style="color: #008000">#</span><span style="color: #008000"> 认证不成功，接收错误信息</span>
            cuo_wu = f.errors                           <span style="color: #008000">#</span><span style="color: #008000"> 接收错误信息</span>
            <span style="color: #0000ff">print</span><span style="color: #000000">(cuo_wu)
            </span><span style="color: #0000ff">return</span> render(request, <span style="color: #800000">'</span><span style="color: #800000">register.html</span><span style="color: #800000">'</span>, {<span style="color: #800000">'</span><span style="color: #800000">cuo_wu</span><span style="color: #800000">'</span>: cuo_wu, <span style="color: #800000">'</span><span style="color: #800000">yanzh</span><span style="color: #800000">'</span>: f})        <span style="color: #008000">#</span><span style="color: #008000"> 将错误信息传到登录页面</span></span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>4，将用户名拿到数据库，查找用户是否存在，用户存在提示信息回填数据，用户不存在说明可以注册，注意用户密码需要加密，可以用django密码加密函数make_password(要加密的密码)，然后将用户信息写入数据库</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf8 -*-</span>
<span style="color: #0000ff">import</span> io  <span style="color: #008000">#</span><span style="color: #008000"> 导入io模块</span>

<span style="color: #0000ff">from</span> django.shortcuts <span style="color: #0000ff">import</span> render, HttpResponse, redirect                                 <span style="color: #008000">#</span><span style="color: #008000"> 导入django向浏览器返回方法</span>
<span style="color: #0000ff">from</span> django.views.generic.base <span style="color: #0000ff">import</span><span style="color: #000000"> View
</span><span style="color: #0000ff">from</span> django.db.models <span style="color: #0000ff">import</span> F,Q                                                            <span style="color: #008000">#</span><span style="color: #008000"> 导入F和Q</span>
<span style="color: #0000ff">from</span> django.contrib.auth.hashers <span style="color: #0000ff">import</span><span style="background-color: #ff99cc"> make_password</span>, check_password                       <span style="color: #008000">#</span><span style="color: #008000"> 导入django密码加密，和密码验证</span>
<span style="color: #0000ff">from</span> django.contrib.auth <span style="color: #0000ff">import</span> login                                                       <span style="color: #008000">#</span><span style="color: #008000"> 调用django的登录函数</span>

<span style="color: #0000ff">from</span> app_users.forms <span style="color: #0000ff">import</span> deng_lu_forms, zhu_ce_forms                                    <span style="color: #008000">#</span><span style="color: #008000"> 导入登录页面表单认证</span>
<span style="color: #0000ff">from</span> app_users.models <span style="color: #0000ff">import</span> Users, Email                                                   <span style="color: #008000">#</span><span style="color: #008000"> 导入数据库操作</span>
<span style="color: #0000ff">from</span> utils.email_send <span style="color: #0000ff">import</span> send_register_email                                            <span style="color: #008000">#</span><span style="color: #008000"> 导入邮件发送</span>


<span style="color: #0000ff">class</span><span style="color: #000000"> zhu_ce(View):
    </span><span style="color: #0000ff">def</span><span style="color: #000000"> get(self, request):
        yanzhm </span>=<span style="color: #000000"> zhu_ce_forms()
        </span><span style="color: #0000ff">return</span> render(request, <span style="color: #800000">'</span><span style="color: #800000">register.html</span><span style="color: #800000">'</span>, {<span style="color: #800000">'</span><span style="color: #800000">yanzhm</span><span style="color: #800000">'</span><span style="color: #000000">: yanzhm})

    </span><span style="color: #0000ff">def</span><span style="color: #000000"> post(self, request):
        f </span>=<span style="color: #000000"> zhu_ce_forms(request.POST)
        </span><span style="color: #0000ff">if</span> f.is_valid():                                <span style="color: #008000">#</span><span style="color: #008000"> 判断认证是否成功</span>
            tong_guo = f.cleaned_data                   <span style="color: #008000">#</span><span style="color: #008000"> 认证成功，接收用户数据</span>
<span style="background-color: #ff99cc">            email = tong_guo[<span style="color: #800000">'</span><span style="color: #800000">email</span><span style="color: #800000">'</span><span style="color: #000000">]
            password </span>= tong_guo[<span style="color: #800000">'</span><span style="color: #800000">password</span><span style="color: #800000">'</span><span style="color: #000000">]
            user </span>= Users.objects.filter(username=<span style="color: #000000">email).values()
            </span><span style="color: #0000ff">if</span> len(user) &gt;= 1<span style="color: #000000">:
                tishi </span>= <span style="color: #800000">'</span><span style="color: #800000">用户已经存在</span><span style="color: #800000">'</span>
                <span style="color: #0000ff">return</span> render(request, <span style="color: #800000">'</span><span style="color: #800000">register.html</span><span style="color: #800000">'</span>, {<span style="color: #800000">'</span><span style="color: #800000">tishi</span><span style="color: #800000">'</span>: tishi, <span style="color: #800000">'</span><span style="color: #800000">yanzh</span><span style="color: #800000">'</span><span style="color: #000000">: f})
            </span><span style="color: #0000ff">else</span><span style="color: #000000">:
                a </span>= {<span style="color: #800000">'</span><span style="color: #800000">username</span><span style="color: #800000">'</span>: email,                                         <span style="color: #008000">#</span><span style="color: #008000"> 将要写入的数据组合成字典，键为字段值为数据</span>
                     <span style="color: #800000">'</span><span style="color: #800000">password</span><span style="color: #800000">'</span><span style="color: #000000">: make_password(password),
                     </span><span style="color: #800000">'</span><span style="color: #800000">is_active</span><span style="color: #800000">'</span><span style="color: #000000">: 0
                     }
                Users.objects.create(</span>**a)                                       <span style="color: #008000">#</span><span style="color: #008000"> 添加到数据库，注意字典变量名称一定要加**</span>
                send_register_email(email)                                      <span style="color: #008000">#</span><span style="color: #008000"> 执行验证邮件发送</span>
                <span style="color: #0000ff">return</span> render(request, <span style="color: #800000">'</span><span style="color: #800000">login.html</span><span style="color: #800000">'</span><span style="color: #000000">)
        </span></span><span style="color: #0000ff">else</span>:                                           <span style="color: #008000">#</span><span style="color: #008000"> 认证不成功，接收错误信息</span>
            cuo_wu = f.errors                           <span style="color: #008000">#</span><span style="color: #008000"> 接收错误信息</span>
            <span style="color: #0000ff">print</span><span style="color: #000000">(cuo_wu)
            </span><span style="color: #0000ff">return</span> render(request, <span style="color: #800000">'</span><span style="color: #800000">register.html</span><span style="color: #800000">'</span>, {<span style="color: #800000">'</span><span style="color: #800000">cuo_wu</span><span style="color: #800000">'</span>: cuo_wu, <span style="color: #800000">'</span><span style="color: #800000">yanzh</span><span style="color: #800000">'</span>: f})        <span style="color: #008000">#</span><span style="color: #008000"> 将错误信息传到登录页面</span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>5，激活用户，自定义一个用户邮件激活函数，</strong></span><br><span style="color: #ff0000"><strong>在数据库专门用一张表来记录激活用户所需要的随机字符和邮箱等信息</strong></span><br><span style="color: #ff0000"><strong>当用户数据写入数据库后，随机生成一个字符</strong></span><br><span style="color: #ff0000"><strong>向用户激活表里写入当前的随机字符，和用户验证邮箱</strong></span><br><span style="color: #ff0000"><strong>然后向用户的邮箱发送一条激活连接，激活连接由域名加随机字符组成，然后提示用户到邮箱激活</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf8 -*-</span>

<span style="color: #0000ff">from</span> random <span style="color: #0000ff">import</span> Random                       <span style="color: #008000">#</span><span style="color: #008000"> 导入随机函数</span>
<span style="color: #0000ff">from</span> django.core.mail <span style="color: #0000ff">import</span> send_mail          <span style="color: #008000">#</span><span style="color: #008000"> 导入django邮件函数</span>

<span style="color: #0000ff">from</span> app_users.models <span style="color: #0000ff">import</span> Email              <span style="color: #008000">#</span><span style="color: #008000"> 导入激活操作数据库表</span>
<span style="color: #0000ff">from</span> MxOnline.settings <span style="color: #0000ff">import</span><span style="color: #000000"> DEFAULT_FROM_EMAIL


</span><span style="color: #0000ff">def</span> random_str(randomlength=8<span style="color: #000000">):
    </span><span style="color: #800000">"""</span><span style="color: #800000">
    循环获取随机字符串，默认8位
    </span><span style="color: #800000">"""</span><span style="color: #000000">
    str </span>= <span style="color: #800000">''</span><span style="color: #000000">
    chars </span>= <span style="color: #800000">'</span><span style="color: #800000">AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz0123456789</span><span style="color: #800000">'</span><span style="color: #000000">
    length </span>= len(chars) - 1<span style="color: #000000">
    random </span>=<span style="color: #000000"> Random()
    </span><span style="color: #0000ff">for</span> i <span style="color: #0000ff">in</span><span style="color: #000000"> range(randomlength):
        str</span>+=<span style="color: #000000">chars[random.randint(0, length)]
    </span><span style="color: #0000ff">return</span><span style="color: #000000"> str


</span><span style="color: #0000ff">def</span> send_register_email(email, send_type=<span style="color: #800000">"</span><span style="color: #800000">register</span><span style="color: #800000">"</span><span style="color: #000000">):
    </span><span style="color: #800000">"""</span><span style="color: #800000">
    发送邮件
    :接收两个参数：
    :第一个验证邮箱，第二个验证类型
    </span><span style="color: #800000">"""</span>
    <span style="color: #800000">"""</span><span style="color: #800000">写入数据库验证信息</span><span style="color: #800000">"""</span><span style="color: #000000">
    email_record </span>= Email()                              <span style="color: #008000">#</span><span style="color: #008000"> 实例化数据库表</span>
    <span style="color: #0000ff">if</span> send_type == <span style="color: #800000">"</span><span style="color: #800000">update_email</span><span style="color: #800000">"</span><span style="color: #000000">:
        code </span>= random_str(4)                            <span style="color: #008000">#</span><span style="color: #008000"> 生成4位随机数</span>
    <span style="color: #0000ff">else</span><span style="color: #000000">:
        code </span>= random_str(16)                           <span style="color: #008000">#</span><span style="color: #008000"> 生成16位随机数</span>
    email_record.code = code                            <span style="color: #008000">#</span><span style="color: #008000"> 数据库写入验证随机数</span>
    email_record.email = email                          <span style="color: #008000">#</span><span style="color: #008000"> 数据库写入验证邮箱</span>
    email_record.send_type = send_type                  <span style="color: #008000">#</span><span style="color: #008000"> 数据库写入验证类型</span>
<span style="color: #000000">    email_record.save()

    </span><span style="color: #800000">"""</span><span style="color: #800000">发送验证邮件</span><span style="color: #800000">"""</span><span style="color: #000000">
    email_title </span>= <span style="color: #800000">""</span>                                    <span style="color: #008000">#</span><span style="color: #008000"> 记录邮件标题</span>
    email_body = <span style="color: #800000">""</span>                                     <span style="color: #008000">#</span><span style="color: #008000"> 记录邮件内容</span>

    <span style="color: #0000ff">if</span> send_type == <span style="color: #800000">"</span><span style="color: #800000">register</span><span style="color: #800000">"</span><span style="color: #000000">:
        email_title </span>= <span style="color: #800000">"</span><span style="color: #800000">慕学在线网注册激活链接</span><span style="color: #800000">"</span><span style="color: #000000">
        email_body </span>= <span style="color: #800000">"</span><span style="color: #800000">请点击下面的链接激活你的账号: http://127.0.0.1:8000/active/{0}</span><span style="color: #800000">"</span><span style="color: #000000">.format(code)

        send_status </span>=<span style="color: #000000"> send_mail(email_title, email_body, DEFAULT_FROM_EMAIL, [email])
        </span><span style="color: #0000ff">if</span><span style="color: #000000"> send_status:
            </span><span style="color: #0000ff">pass</span>
    <span style="color: #0000ff">elif</span> send_type == <span style="color: #800000">"</span><span style="color: #800000">forget</span><span style="color: #800000">"</span><span style="color: #000000">:
        email_title </span>= <span style="color: #800000">"</span><span style="color: #800000">慕学在线网注册密码重置链接</span><span style="color: #800000">"</span><span style="color: #000000">
        email_body </span>= <span style="color: #800000">"</span><span style="color: #800000">请点击下面的链接重置密码: http://127.0.0.1:8000/reset/{0}</span><span style="color: #800000">"</span><span style="color: #000000">.format(code)

        send_status </span>=<span style="color: #000000"> send_mail(email_title, email_body, DEFAULT_FROM_EMAIL, [email])
        </span><span style="color: #0000ff">if</span><span style="color: #000000"> send_status:
            </span><span style="color: #0000ff">pass</span>
    <span style="color: #0000ff">elif</span> send_type == <span style="color: #800000">"</span><span style="color: #800000">update_email</span><span style="color: #800000">"</span><span style="color: #000000">:
        email_title </span>= <span style="color: #800000">"</span><span style="color: #800000">慕学在线邮箱修改验证码</span><span style="color: #800000">"</span><span style="color: #000000">
        email_body </span>= <span style="color: #800000">"</span><span style="color: #800000">你的邮箱验证码为: {0}</span><span style="color: #800000">"</span><span style="color: #000000">.format(code)

        send_status </span>=<span style="color: #000000"> send_mail(email_title, email_body, DEFAULT_FROM_EMAIL, [email])
        </span><span style="color: #0000ff">if</span><span style="color: #000000"> send_status:
            </span><span style="color: #0000ff">pass</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>6.设置激活连接逻辑</strong></span><br><span style="color: #ff0000"><strong>当用户点击激活连接时，获取到激活连接的随机字符，</strong></span><br><span style="color: #ff0000"><strong>将随机字符拿到激活表里去查询是否有这条随机字符，如果有，将当前随机字符的所有信息获取到，通过获取到的信息，将对应用户表里用户状态改为激活状态，返回登录页面，提示以激活请登录</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">from</span> django.conf.urls <span style="color: #0000ff">import</span> url, include                   <span style="color: #008000">#</span><span style="color: #008000"> 导入django自在的include逻辑</span>
<span style="color: #0000ff">from</span> django.contrib <span style="color: #0000ff">import</span><span style="color: #000000"> admin
</span><span style="color: #0000ff">from</span> django.views.generic <span style="color: #0000ff">import</span> TemplateView               <span style="color: #008000">#</span><span style="color: #008000"> 导入django自带的TemplateView逻辑</span>

<span style="color: #0000ff">import</span> xadmin                                               <span style="color: #008000">#</span><span style="color: #008000"> 导入xadmin</span>

<span style="color: #0000ff">from</span> app_users.views <span style="color: #0000ff">import</span> deng_lu, zhu_ce, active_code, logout                 <span style="color: #008000">#</span><span style="color: #008000"> 导入登录逻辑处理类</span>
<span style="color: #000000">
urlpatterns </span>=<span style="color: #000000"> [
    url(r</span><span style="color: #800000">'</span><span style="color: #800000">^xadmin/</span><span style="color: #800000">'</span><span style="color: #000000">, xadmin.site.urls),

    url(r</span><span style="color: #800000">'</span><span style="color: #800000">^index.html</span><span style="color: #800000">'</span>, TemplateView.as_view(template_name=<span style="color: #800000">'</span><span style="color: #800000">index.html</span><span style="color: #800000">'</span>), name=<span style="color: #800000">'</span><span style="color: #800000">index</span><span style="color: #800000">'</span><span style="color: #000000">),

    url(r</span><span style="color: #800000">'</span><span style="color: #800000">^register.html</span><span style="color: #800000">'</span>, zhu_ce.as_view(), name=<span style="color: #800000">'</span><span style="color: #800000">register</span><span style="color: #800000">'</span><span style="color: #000000">),
    url(r</span><span style="color: #800000">'</span><span style="color: #800000">^captcha/</span><span style="color: #800000">'</span>, include(<span style="color: #800000">'</span><span style="color: #800000">captcha.urls</span><span style="color: #800000">'</span>), name=<span style="color: #800000">'</span><span style="color: #800000">captcha</span><span style="color: #800000">'</span><span style="color: #000000">),
    <span style="background-color: #ff99cc">url(r</span></span><span style="background-color: #ff99cc"><span style="color: #800000">'</span><span style="color: #800000">^active/(?P&lt;active_de&gt;.*)/$</span><span style="color: #800000">'</span>, active_code.as_view(), name=<span style="color: #800000">"</span><span style="color: #800000">user_active</span><span style="color: #800000">"</span></span><span style="color: #000000"><span style="background-color: #ff99cc">),</span>

    url(r</span><span style="color: #800000">'</span><span style="color: #800000">^login.html</span><span style="color: #800000">'</span>, TemplateView.as_view(template_name=<span style="color: #800000">'</span><span style="color: #800000">login.html</span><span style="color: #800000">'</span>), name=<span style="color: #800000">'</span><span style="color: #800000">login</span><span style="color: #800000">'</span><span style="color: #000000">),
    url(r</span><span style="color: #800000">'</span><span style="color: #800000">^deng_lu</span><span style="color: #800000">'</span>, deng_lu.as_view(), name=<span style="color: #800000">'</span><span style="color: #800000">deng_lu</span><span style="color: #800000">'</span><span style="color: #000000">),
    url(r</span><span style="color: #800000">'</span><span style="color: #800000">^logout</span><span style="color: #800000">'</span>, logout.as_view(), name=<span style="color: #800000">'</span><span style="color: #800000">deng_lu</span><span style="color: #800000">'</span><span style="color: #000000">),
]</span></pre>
</div>
<p><span style="background-color: #ffffff; color: #ff0000"><strong>激活逻辑处理</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">class</span><span style="color: #000000"> active_code(View):
    </span><span style="color: #0000ff">def</span><span style="color: #000000"> get(self, request, active_de):
        yanzh_email </span>= Email.objects.filter(code=<span style="color: #000000">active_de)
        </span><span style="color: #0000ff">if</span><span style="color: #000000"> yanzh_email:
            </span><span style="color: #0000ff">for</span> record <span style="color: #0000ff">in</span><span style="color: #000000"> yanzh_email:
                email </span>=<span style="color: #000000"> record.email
                <span style="background-color: #ff99cc">Users.objects.filter(username</span></span><span style="background-color: #ff99cc">=email).update(is_active=</span><span style="color: #000000"><span style="background-color: #ff99cc">True)</span>
                Email.objects.filter(code</span>=<span style="color: #000000">active_de).delete()
        </span><span style="color: #0000ff">return</span> render(request, <span style="color: #800000">'</span><span style="color: #800000">login.html</span><span style="color: #800000">'</span>)</pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>找回密码等更能也是这个原理</strong></span></p></div>