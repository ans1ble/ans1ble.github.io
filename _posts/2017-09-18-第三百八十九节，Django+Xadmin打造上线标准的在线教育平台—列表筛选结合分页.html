第三百八十九节，Django+Xadmin打造上线标准的在线教育平台—列表筛选结合分页


			<div id="cnblogs_post_body" class="blogpost-body"><p><strong>第三百八十九节，Django+Xadmin打造上线标准的在线教育平台—列表筛选结合分页</strong></p>
<p><strong>根据用户的<strong>筛选条件来结合分页</strong></strong></p>
<p><strong><strong><img src="https://images2017.cnblogs.com/blog/955761/201709/955761-20170918115142603-437839867.png" alt=""></strong></strong></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; font-size: 14pt"><strong>实现原理就是，当用户点击一个筛选条件时，通过get请求方式传参将筛选的id或者值，传入逻辑处理就行数据库条件查询，将查询条件值在返回html页面判断是否是选中样式，最后将所有需要关联的筛选请求加上彼此逻辑处理传回来的查询条件值</strong></span></p>
<p><span style="color: #ff0000"><strong>html请求传参</strong></span></p>
<p><span style="color: #ff0000"><strong><img src="https://images2017.cnblogs.com/blog/955761/201709/955761-20170918120802696-326359768.png" alt=""></strong></span></p>
<p><span style="color: #ff0000"><strong>黄色背景为请求传参</strong></span></p>
<p><span style="color: #ff0000"><strong>红色背景为逻辑处理传过来的查询条件判断样式</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">&lt;</span><span style="color: #800000">div </span><span style="color: #ff0000">class</span><span style="color: #0000ff">="wp butler_list_box list"</span><span style="color: #0000ff">&gt;</span>
            <span style="color: #0000ff">&lt;</span><span style="color: #800000">div </span><span style="color: #ff0000">class</span><span style="color: #0000ff">='left'</span><span style="color: #0000ff">&gt;</span>
                <span style="color: #0000ff">&lt;</span><span style="color: #800000">div </span><span style="color: #ff0000">class</span><span style="color: #0000ff">="listoptions"</span><span style="color: #0000ff">&gt;</span>
                    <span style="color: #0000ff">&lt;</span><span style="color: #800000">ul</span><span style="color: #0000ff">&gt;</span>
                        <span style="color: #0000ff">&lt;</span><span style="color: #800000">li</span><span style="color: #0000ff">&gt;</span>
                            <span style="color: #0000ff">&lt;</span><span style="color: #800000">h2</span><span style="color: #0000ff">&gt;</span>机构类别<span style="color: #0000ff">&lt;/</span><span style="color: #800000">h2</span><span style="color: #0000ff">&gt;</span>
                            <span style="color: #0000ff">&lt;</span><span style="color: #800000">div </span><span style="color: #ff0000">class</span><span style="color: #0000ff">="cont"</span><span style="color: #0000ff">&gt;</span>
                                <span style="color: #0000ff">&lt;</span><span style="color: #800000">a </span><span style="color: #ff0000">href</span><span style="color: #0000ff">="<span style="background-color: #ffff00">?leib=&amp;chsh={{ chsh_id }}</span>"</span><span style="color: #0000ff">&gt;&lt;</span><span style="color: #800000">span </span><span style="color: #ff0000">class</span><span style="color: #0000ff">="<span style="background-color: #ff99cc">{% ifequal lei_bie '' %}active2{% endifequal %}</span>"</span><span style="color: #0000ff">&gt;</span>全部<span style="color: #0000ff">&lt;/</span><span style="color: #800000">span</span><span style="color: #0000ff">&gt;&lt;/</span><span style="color: #800000">a</span><span style="color: #0000ff">&gt;</span>

                                <span style="color: #0000ff">&lt;</span><span style="color: #800000">a </span><span style="color: #ff0000">href</span><span style="color: #0000ff">="<span style="background-color: #ffff00">?leib=pxjg&amp;chsh={{ chsh_id }}</span>"</span><span style="color: #0000ff">&gt;&lt;</span><span style="color: #800000">span </span><span style="color: #ff0000">class</span><span style="color: #0000ff">="<span style="background-color: #ff99cc">{% ifequal lei_bie 'pxjg' %}active2{% endifequal %}</span>"</span><span style="color: #0000ff">&gt;</span>培训机构<span style="color: #0000ff">&lt;/</span><span style="color: #800000">span</span><span style="color: #0000ff">&gt;&lt;/</span><span style="color: #800000">a</span><span style="color: #0000ff">&gt;</span>

                                <span style="color: #0000ff">&lt;</span><span style="color: #800000">a </span><span style="color: #ff0000">href</span><span style="color: #0000ff">="<span style="background-color: #ffff00">?leib=gx&amp;chsh={{ chsh_id }}</span>"</span><span style="color: #0000ff">&gt;&lt;</span><span style="color: #800000">span </span><span style="color: #ff0000">class</span><span style="color: #0000ff">="<span style="background-color: #ff99cc">{% ifequal lei_bie 'gx' %}active2{% endifequal %}</span>"</span><span style="color: #0000ff">&gt;</span>高校<span style="color: #0000ff">&lt;/</span><span style="color: #800000">span</span><span style="color: #0000ff">&gt;&lt;/</span><span style="color: #800000">a</span><span style="color: #0000ff">&gt;</span>

                                <span style="color: #0000ff">&lt;</span><span style="color: #800000">a </span><span style="color: #ff0000">href</span><span style="color: #0000ff">="<span style="background-color: #ffff00">?leib=gr&amp;chsh={{ chsh_id }}</span>"</span><span style="color: #0000ff">&gt;&lt;</span><span style="color: #800000">span </span><span style="color: #ff0000">class</span><span style="color: #0000ff">="<span style="background-color: #ff99cc">{% ifequal lei_bie 'gr' %}active2{% endifequal %}</span>"</span><span style="color: #0000ff">&gt;</span>个人<span style="color: #0000ff">&lt;/</span><span style="color: #800000">span</span><span style="color: #0000ff">&gt;&lt;/</span><span style="color: #800000">a</span><span style="color: #0000ff">&gt;</span>

                            <span style="color: #0000ff">&lt;/</span><span style="color: #800000">div</span><span style="color: #0000ff">&gt;</span>
                        <span style="color: #0000ff">&lt;/</span><span style="color: #800000">li</span><span style="color: #0000ff">&gt;</span>
                        <span style="color: #0000ff">&lt;</span><span style="color: #800000">li</span><span style="color: #0000ff">&gt;</span>
                            <span style="color: #0000ff">&lt;</span><span style="color: #800000">h2</span><span style="color: #0000ff">&gt;</span>所在地区<span style="color: #0000ff">&lt;/</span><span style="color: #800000">h2</span><span style="color: #0000ff">&gt;</span>
                            <span style="color: #0000ff">&lt;</span><span style="color: #800000">div </span><span style="color: #ff0000">class</span><span style="color: #0000ff">="more"</span><span style="color: #0000ff">&gt;</span>更多<span style="color: #0000ff">&lt;/</span><span style="color: #800000">div</span><span style="color: #0000ff">&gt;</span>
                            <span style="color: #0000ff">&lt;</span><span style="color: #800000">div </span><span style="color: #ff0000">class</span><span style="color: #0000ff">="cont"</span><span style="color: #0000ff">&gt;</span>
                                <span style="color: #0000ff">&lt;</span><span style="color: #800000">a </span><span style="color: #ff0000">href</span><span style="color: #0000ff">="<span style="background-color: #ffff00">?chsh=&amp;leib={{ lei_bie }}</span>"</span><span style="color: #0000ff">&gt;&lt;</span><span style="color: #800000">span </span><span style="color: #ff0000">class</span><span style="color: #0000ff">="<span style="background-color: #ff99cc">{% ifequal chsh_id '' %}active2{% endifequal %}</span>"</span><span style="color: #0000ff">&gt;</span>全部<span style="color: #0000ff">&lt;/</span><span style="color: #800000">span</span><span style="color: #0000ff">&gt;&lt;/</span><span style="color: #800000">a</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">
                                {# 循环城市 #}
                                {% for ch in cheng_shi %}
                                    </span><span style="color: #0000ff">&lt;</span><span style="color: #800000">a </span><span style="color: #ff0000">href</span><span style="color: #0000ff">="<span style="background-color: #ffff00">?chsh={{ ch.id }}&amp;leib={{ lei_bie }}</span>"</span><span style="color: #0000ff">&gt;&lt;</span><span style="color: #800000">span </span><span style="color: #ff0000">class</span><span style="color: #0000ff">="<span style="background-color: #ff99cc">{% ifequal chsh_id ch.id|stringformat:'i' %}active2{% endifequal %}</span>"</span><span style="color: #0000ff">&gt;</span>{{ ch.name }}<span style="color: #0000ff">&lt;/</span><span style="color: #800000">span</span><span style="color: #0000ff">&gt;&lt;/</span><span style="color: #800000">a</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">
                                {% endfor %}
                            </span><span style="color: #0000ff">&lt;/</span><span style="color: #800000">div</span><span style="color: #0000ff">&gt;</span>
                        <span style="color: #0000ff">&lt;/</span><span style="color: #800000">li</span><span style="color: #0000ff">&gt;</span>
                    <span style="color: #0000ff">&lt;/</span><span style="color: #800000">ul</span><span style="color: #0000ff">&gt;</span>
                <span style="color: #0000ff">&lt;/</span><span style="color: #800000">div</span><span style="color: #0000ff">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>逻辑处理</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">from</span> django.shortcuts <span style="color: #0000ff">import</span> render, HttpResponse, redirect                                 <span style="color: #008000">#</span><span style="color: #008000"> 导入django向浏览器返回方法</span>
<span style="color: #0000ff">from</span> django.views.generic.base <span style="color: #0000ff">import</span><span style="color: #000000"> View
</span><span style="color: #0000ff">from</span> django.db.models <span style="color: #0000ff">import</span><span style="color: #000000"> F,Q
</span><span style="color: #0000ff">from</span> pure_pagination <span style="color: #0000ff">import</span><span style="color: #000000"> Paginator, EmptyPage, PageNotAnInteger

</span><span style="color: #0000ff">from</span> app_organization.models <span style="color: #0000ff">import</span> CityDict, CourseOrg                       <span style="color: #008000">#</span><span style="color: #008000"> 数据库表</span>


<span style="color: #0000ff">class</span><span style="color: #000000"> org_list(View):
    </span><span style="color: #0000ff">def</span><span style="color: #000000"> get(self, request):

        </span><span style="color: #008000">#</span><span style="color: #008000"> 课程机构</span>
        <span style="background-color: #ffff00">ji_gou = CourseOrg.objects.all()                <span style="color: #008000">#</span><span style="color: #008000"> 获取数据库的所有数据</span></span>

        <span style="color: #008000">#</span><span style="color: #008000"> 城市帅选</span>
        <span style="background-color: #ffff00">cheng_shi =</span><span style="color: #000000"><span style="background-color: #ffff00"> CityDict.objects.all()</span>
<span style="background-color: #ff99cc">        chsh_id </span></span><span style="background-color: #ffff00">= request.GET.get(<span style="color: #800000">'</span><span style="color: #800000">chsh</span><span style="color: #800000">'</span>, <span style="color: #800000">''</span>)           <span style="color: #008000">#</span><span style="color: #008000"> 获取用户点击了城市传过来的城市id</span>
        <span style="color: #0000ff">if</span><span style="color: #000000"> chsh_id:
            ji_gou </span>= ji_gou.filter(city_id=chsh_id)     <span style="color: #008000">#</span><span style="color: #008000"> 帅选出指定城市的数据</span></span>

        <span style="color: #008000">#</span><span style="color: #008000"> 类别帅选</span>
<span style="background-color: #ffff00"><span style="background-color: #ff99cc">        lei_bie</span> = request.GET.get(<span style="color: #800000">'</span><span style="color: #800000">leib</span><span style="color: #800000">'</span>, <span style="color: #800000">''</span>)           <span style="color: #008000">#</span><span style="color: #008000"> 获取用户点击了城市传过来的城市id</span>
        <span style="color: #0000ff">if</span><span style="color: #000000"> lei_bie:
            ji_gou </span>= ji_gou.filter(category=lei_bie)     <span style="color: #008000">#</span><span style="color: #008000"> 帅选出指定城市的数据</span>
<span style="color: #000000; background-color: #ff99cc">
        ji_gou_shu </span>= ji_gou.count()                   <span style="color: #008000">#</span><span style="color: #008000"> 统计获取到的数量</span></span>

        <span style="color: #008000">#</span><span style="color: #008000"> 分页功能</span>
        <span style="color: #0000ff">try</span><span style="color: #000000">:
            page </span>= request.GET.get(<span style="color: #800000">'</span><span style="color: #800000">page</span><span style="color: #800000">'</span>, 1)           <span style="color: #008000">#</span><span style="color: #008000"> 获取当前页码,如果没有默认1</span>
        <span style="color: #0000ff">except</span> PageNotAnInteger:                        <span style="color: #008000">#</span><span style="color: #008000"> 如果获取页码出错，默认1</span>
            page = 1<span style="color: #000000">

        p </span>= Paginator(ji_gou, 4, request=request)       <span style="color: #008000">#</span><span style="color: #008000"> 执行分页函数，参数1数据库的数据，参数2显示多少条数据，参数3request</span>
<span style="color: #000000">
        people </span>= p.page(page)                           <span style="color: #008000">#</span><span style="color: #008000"> 返回一个，包含了分页数据和分页导航的对象</span>

        <span style="color: #0000ff">return</span> render(request, <span style="color: #800000">'</span><span style="color: #800000">org_list.html</span><span style="color: #800000">'</span><span style="color: #000000">, {
            </span><span style="color: #800000">'</span><span style="color: #800000">cheng_shi</span><span style="color: #800000">'</span>: cheng_shi,                 <span style="color: #008000">#</span><span style="color: #008000"> 城市数据</span>
            <span style="color: #800000">'</span><span style="color: #800000">people</span><span style="color: #800000">'</span>: people,                       <span style="color: #008000">#</span><span style="color: #008000"> 将分页对象传到html页面</span>
 <span style="background-color: #ff99cc">           <span style="color: #800000">'</span><span style="color: #800000">ji_gou_shu</span><span style="color: #800000">'</span>: ji_gou_shu,               <span style="color: #008000">#</span><span style="color: #008000"> 机构数量</span>
            <span style="color: #800000">'</span><span style="color: #800000">chsh_id</span><span style="color: #800000">'</span>: chsh_id,                     <span style="color: #008000">#</span><span style="color: #008000"> 城市帅选ID</span>
            <span style="color: #800000">'</span><span style="color: #800000">lei_bie</span><span style="color: #800000">'</span>: lei_bie                      <span style="color: #008000">#</span><span style="color: #008000"> 类别</span></span>
<span style="color: #000000">        })

    </span><span style="color: #0000ff">def</span><span style="color: #000000"> post(self, request):
        </span><span style="color: #0000ff">pass</span></pre>
</div>
<p>&nbsp;</p></div>