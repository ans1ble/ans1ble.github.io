第四百一十六节，Tensorflow简介与安装


			<div id="cnblogs_post_body" class="blogpost-body"><p>第四百一十六节，Tensorflow简介与安装</p>
<div class="cell text_cell unselected rendered">
<div class="inner_cell">
<div class="text_cell_render rendered_html">
<p>TensorFlow是什么</p>
<p>Tensorflow是一个Google开发的第二代机器学习系统，克服了第一代系统DistBelief仅能开发神经网络算法、难以配置、依赖Google内部硬件等局限性，应用更加广泛，并且提高了灵活性和可移植性，速度和扩展性也有了大幅提高。字面上理解，TensorFlow就是以张量（Tensor）在计算图（Graph）上流动（Flow）的方式的实现和执行机器学习算法的框架。具有以下特点：</p>
<ul>
<li>灵活性。TensorFlow不是一个严格的“神经网络”库。只要可以将计算表示成数据流图，就可以使用TensorFlow，比如科学计算中的偏微分求解等。（实际上其官网的介绍中对TF的定位就是基于数据流图的科学计算库，而非仅仅是机器学习库）</li>
<li>可移植性。同一份代码几乎不经过修改既可以部署到有任意数量CPU、GPU或TPU（Tensor Processing Unit，Google专门为机器学习开发的处理器）的PC、服务器或移动设备上。</li>
<li>自动求微分。同Theano一样，TensorFlow也支持自动求微分，用户不需要再通过反向传播求解梯度。</li>
<li>多语言支持。TensorFlow官方支持Python、C++、Go和Java接口，用户可以在硬件配置较好的机器中用Python进行实验，在资源较紧张或需要低延迟的环境中用C++进行部署。</li>
<li>性能。虽然TensorFlow最开始发布时仅支持单机，在性能评测上并不出色，但是凭借Google强大的开发实力，TensorFlow性能已经追上了其他框架</li>
</ul>
</div>
</div>
</div>
<div class="cell text_cell unselected rendered">
<div class="inner_cell">
<div class="input_area">
<div class="CodeMirror cm-s-default CodeMirror-wrap">
<div class="CodeMirror-scroll">
<div class="CodeMirror-sizer">
<div class="CodeMirror-lines">
<div class="CodeMirror-code">
<pre class=" CodeMirror-line "><span>Google第一代分布式机器学习框架DistBelief在内部大规模使用后没有选择开源，而第二代TensorFlow于2015年11月在GitHub上开源，并在持续快速开发迭代中。TensorFlow最早由Google Brain的工程师开发，设计初衷是加速机器学习的研究，并快速地将研究原型转化为产品。Google选择开源TensorFlow的原因很简单：第一是希望借助社区的力量，大家一起完善TensorFlow。第二是回馈社区，Google希望让这个优秀的工具得到更多的应用，提高学术界和工业界使用机器学习的效率。</span></pre>
<pre class=" CodeMirror-line "><span>自从2015年11月开源以来，TensorFlow迅速在众多的机器学习框架中脱颖而出，在Github上获得了最多的Star</span></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="text_cell_render rendered_html">
<p>Google第一代分布式机器学习框架DistBelief在内部大规模使用后没有选择开源，而第二代TensorFlow于2015年11月在GitHub上开源，并在持续快速开发迭代中。TensorFlow最早由Google Brain的工程师开发，设计初衷是加速机器学习的研究，并快速地将研究原型转化为产品。Google选择开源TensorFlow的原因很简单：第一是希望借助社区的力量，大家一起完善TensorFlow。第二是回馈社区，Google希望让这个优秀的工具得到更多的应用，提高学术界和工业界使用机器学习的效率。</p>
<p>自从2015年11月开源以来，TensorFlow迅速在众多的机器学习框架中脱颖而出，在Github上获得了最多的Star.</p>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>安装 pip install tensorflow</p>
<p>安装时会安装以下依赖</p>
<p>absl-py-0.4.1 <br>astor-0.7.1 gast-0.2.0 <br>grpcio-1.14.2 <br>markdown-2.6.11 <br>numpy-1.14.5 <br>protobuf-3.6.1 <br>setuptools-39.1.0 <br>six-1.11.0 <br>tensorboard-1.10.0 <br>termcolor-1.1.0 <br>werkzeug-0.14.1</p>
<p>&nbsp;</p>
<p><span style="background-color: #ffffff; color: #ff0000"><strong>设置变量</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">import</span><span style="color: #000000"> tensorflow as tf

</span><span style="color: #008000">#</span><span style="color: #008000"> python创建变量</span>
a = 3

<span style="color: #008000">#</span><span style="color: #008000"> tensorflow创建一个变量Variable</span><span style="color: #008000">
#</span><span style="color: #008000"> 创建横向量</span>
w = tf.Variable([[0.5, 1.0<span style="color: #000000">]])
</span><span style="color: #008000">#</span><span style="color: #008000"> 创建竖向量</span>
x = tf.Variable([[4.0], [1.0<span style="color: #000000">]])

</span><span style="color: #008000">#</span><span style="color: #008000"> 横向量乘以竖向量matmul</span>
y =<span style="color: #000000"> tf.matmul(w, x)

</span><span style="color: #008000">#</span><span style="color: #008000"> 全局变量初始化global_variables_initializer</span>
init_op =<span style="color: #000000"> tf.global_variables_initializer()
with tf.Session() as sess:
    </span><span style="color: #008000">#</span><span style="color: #008000"> 执行计算run</span>
<span style="color: #000000">    sess.run(init_op)
    </span><span style="color: #008000">#</span><span style="color: #008000"> 打印结果eval</span></pre>
</div>
<pre>[[ 2.]]
<br>注意：如果PyCharm提示以下信息，加两行代码即可<br><span style="color: #ff0000">2018-09-10 21:02:19.937491: I T:\src\github\tensorflow\tensorflow\core\platform\cpu_feature_guard.cc:141] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2</span></pre>
<p>&nbsp;import os<br>os.environ['TF_CPP_MIN_LOG_LEVEL'] = '2'<br>#默认为0：输出所有log信息<br>#设置为1：进一步屏蔽INFO信息<br>#设置为2：进一步屏蔽WARNING信息</p>
<p>#设置为3：进一步屏蔽ERROR信息</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">import</span><span style="color: #000000"> tensorflow as tf
</span><span style="background-color: #ffff00"><span style="color: #0000ff">import</span><span style="color: #000000"> os
os.environ[</span><span style="color: #800000">'</span><span style="color: #800000">TF_CPP_MIN_LOG_LEVEL</span><span style="color: #800000">'</span>] = <span style="color: #800000">'</span><span style="color: #800000">2</span><span style="color: #800000">'</span></span>

<span style="color: #008000">#</span><span style="color: #008000"> python创建变量</span>
a = 3

<span style="color: #008000">#</span><span style="color: #008000"> tensorflow创建一个变量Variable</span><span style="color: #008000">
#</span><span style="color: #008000"> 创建横向量</span>
w = tf.Variable([[0.5, 1.0<span style="color: #000000">]])
</span><span style="color: #008000">#</span><span style="color: #008000"> 创建竖向量</span>
x = tf.Variable([[4.0], [1.0<span style="color: #000000">]])

</span><span style="color: #008000">#</span><span style="color: #008000"> 横向量乘以竖向量matmul</span>
y =<span style="color: #000000"> tf.matmul(w, x)

</span><span style="color: #008000">#</span><span style="color: #008000"> 全局变量初始化global_variables_initializer</span>
init_op =<span style="color: #000000"> tf.global_variables_initializer()
with tf.Session() as sess:
    </span><span style="color: #008000">#</span><span style="color: #008000"> 执行计算run</span>
<span style="color: #000000">    sess.run(init_op)
    </span><span style="color: #008000">#</span><span style="color: #008000"> 打印结果eval</span>
    <span style="color: #0000ff">print</span>(y.eval())</pre>
</div>
<p>&nbsp;</p>
<p>tensorflow很多操作跟numpy有些类似的</p>
<ul>
<li>
<p>tf.zeros([3, 4], int32) ==&gt; [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]]</p>
</li>
<li>
<p>tf.zeros_like(tensor) ==&gt; [[0, 0, 0], [0, 0, 0]]</p>
</li>
<li>
<p>tf.ones([2, 3], int32) ==&gt; [[1, 1, 1], [1, 1, 1]]</p>
</li>
<li>
<p>tf.ones_like(tensor) ==&gt; [[1, 1, 1], [1, 1, 1]]</p>
</li>
<li>
<p>tensor = tf.constant([1, 2, 3, 4, 5, 6, 7]) =&gt; [1 2 3 4 5 6 7]</p>
</li>
<li>
<p>tensor = tf.constant(-1.0, shape=[2, 3]) =&gt; [[-1. -1. -1.] [-1. -1. -1.]]</p>
</li>
<li>
<p>tf.linspace(10.0, 12.0, 3, name="linspace") =&gt; [ 10.0 11.0 12.0]</p>
</li>
<li>
<p>tf.range(start, limit, delta) ==&gt; [3, 6, 9, 12, 15]</p>
</li>
</ul>
<p><span style="color: #ff0000"><strong>&nbsp;</strong></span></p>
<p><span style="color: #ff0000"><strong>随机</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">import</span><span style="color: #000000"> tensorflow as tf
</span><span style="color: #0000ff">import</span><span style="color: #000000"> os
os.environ[</span><span style="color: #800000">'</span><span style="color: #800000">TF_CPP_MIN_LOG_LEVEL</span><span style="color: #800000">'</span>] = <span style="color: #800000">'</span><span style="color: #800000">2</span><span style="color: #800000">'</span>

<span style="color: #008000">#</span><span style="color: #008000"> 生成的值服从具有指定平均值和标准偏差的正态分布</span>
norm = tf.random_normal([2, 3], mean=-1, stddev=4<span style="color: #000000">)

</span><span style="color: #008000">#</span><span style="color: #008000"> 洗牌</span>
c = tf.constant([[1, 2], [3, 4], [5, 6<span style="color: #000000">]])
shuff </span>=<span style="color: #000000"> tf.random_shuffle(c)

</span><span style="color: #008000">#</span><span style="color: #008000"> 每一次执行结果都会不同</span>
sess =<span style="color: #000000"> tf.Session()
</span><span style="color: #0000ff">print</span><span style="color: #000000">(sess.run(norm))
</span><span style="color: #0000ff">print</span>(sess.run(shuff))</pre>
</div>
<pre>[[-5.58110332  0.84881377  7.51961231]
 [ 3.27404118 -7.22483826  7.70631599]]
[[5 6]
 [1 2]
 [3 4]]</pre>
<p>&nbsp;</p>
<p><strong><span style="color: #ff0000">循环加1</span></strong></p>
<p>&nbsp;</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">import</span><span style="color: #000000"> tensorflow as tf
</span><span style="color: #0000ff">import</span><span style="color: #000000"> os
os.environ[</span><span style="color: #800000">'</span><span style="color: #800000">TF_CPP_MIN_LOG_LEVEL</span><span style="color: #800000">'</span>] = <span style="color: #800000">'</span><span style="color: #800000">2</span><span style="color: #800000">'</span><span style="color: #000000">


state </span>=<span style="color: #000000"> tf.Variable(0)

</span><span style="color: #008000">#</span><span style="color: #008000"> 每初始化一次加1</span><span style="color: #008000">
#</span><span style="color: #008000"> add加</span>
new_value = tf.add(state, tf.constant(1<span style="color: #000000">))
</span><span style="color: #008000">#</span><span style="color: #008000"> assign重新赋值</span>
update =<span style="color: #000000"> tf.assign(state, new_value)

with tf.Session() as sess:
    </span><span style="color: #008000">#</span><span style="color: #008000"> 初始化</span>
<span style="color: #000000">    sess.run(tf.global_variables_initializer())
    </span><span style="color: #0000ff">print</span><span style="color: #000000">(sess.run(state))
    </span><span style="color: #008000">#</span><span style="color: #008000"> 循环3次</span>
    <span style="color: #0000ff">for</span> _ <span style="color: #0000ff">in</span> range(3<span style="color: #000000">):
        sess.run(update)
        </span><span style="color: #0000ff">print</span>(sess.run(state))</pre>
</div>
<p>&nbsp;</p>
<pre>0
1
2
3<br>
</pre>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>加减乘除</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">import</span><span style="color: #000000"> tensorflow as tf
</span><span style="color: #0000ff">import</span><span style="color: #000000"> os

os.environ[</span><span style="color: #800000">'</span><span style="color: #800000">TF_CPP_MIN_LOG_LEVEL</span><span style="color: #800000">'</span>] = <span style="color: #800000">'</span><span style="color: #800000">2</span><span style="color: #800000">'</span><span style="color: #000000">

a </span>= tf.constant(5.0<span style="color: #000000">)
b </span>= tf.constant(10.0<span style="color: #000000">)

ts1 </span>= tf.constant(8.0<span style="color: #000000">)
ts2 </span>= tf.constant(9.0<span style="color: #000000">)

x </span>= tf.add(a, b, name=<span style="color: #800000">"</span><span style="color: #800000">add</span><span style="color: #800000">"</span><span style="color: #000000">)
y </span>= tf.div(a, b, name=<span style="color: #800000">"</span><span style="color: #800000">divide</span><span style="color: #800000">"</span><span style="color: #000000">)

</span><span style="color: #008000">#</span><span style="color: #008000"> （1）加法+</span>
ts_add1 = tf.add(ts1, ts2, name=<span style="color: #000000">None)
ts_add2 </span>= ts1 + ts2  <span style="color: #008000">#</span><span style="color: #008000"> 二者等价</span><span style="color: #008000">
#</span><span style="color: #008000"> （2）减法-</span>
ts_sub1 = tf.subtract(ts1, ts2, name=<span style="color: #000000">None)
ts_sub2 </span>= ts1 - ts2  <span style="color: #008000">#</span><span style="color: #008000"> 二者等价</span><span style="color: #008000">
#</span><span style="color: #008000"> （3）乘法*</span>
ts_mul1 = tf.multiply(ts1, ts2, name=<span style="color: #000000">None)
ts_mul2 </span>= ts1 *<span style="color: #000000"> ts2
</span><span style="color: #008000">#</span><span style="color: #008000"> （4）除法/</span>
ts_div1 = tf.divide(ts1, ts2, name=<span style="color: #000000">None)
ts_div2 </span>= tf.div(ts1, ts2, name=None)  <span style="color: #008000">#</span><span style="color: #008000"> div 支持 broadcasting(即shape可不同)</span>
ts_div3 = ts1 /<span style="color: #000000"> ts2


with tf.Session() as sess:
    </span><span style="color: #0000ff">print</span>(<span style="color: #800000">"</span><span style="color: #800000">a =</span><span style="color: #800000">"</span><span style="color: #000000">, sess.run(a))
    </span><span style="color: #0000ff">print</span>(<span style="color: #800000">"</span><span style="color: #800000">b =</span><span style="color: #800000">"</span><span style="color: #000000">, sess.run(b))
    </span><span style="color: #0000ff">print</span>(<span style="color: #800000">"</span><span style="color: #800000">a + b =</span><span style="color: #800000">"</span><span style="color: #000000">, sess.run(x))
    </span><span style="color: #0000ff">print</span>(<span style="color: #800000">"</span><span style="color: #800000">a/b =</span><span style="color: #800000">"</span><span style="color: #000000">, sess.run(y))
    </span><span style="color: #0000ff">print</span>(<span style="color: #800000">"</span><span style="color: #800000">ts_sub1</span><span style="color: #800000">"</span>, sess.run(ts_sub1))</pre>
</div>
<p>a = 5.0<br>b = 10.0<br>a + b = 15.0<br>a/b = 0.5<br>ts_sub1 -1.0</p>
<p>&nbsp;</p>
<p><strong><span style="color: #ff0000">挖坑</span></strong></p>
<p>&nbsp;</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">import</span><span style="color: #000000"> tensorflow as tf
</span><span style="color: #0000ff">import</span><span style="color: #000000"> os

os.environ[</span><span style="color: #800000">'</span><span style="color: #800000">TF_CPP_MIN_LOG_LEVEL</span><span style="color: #800000">'</span>] = <span style="color: #800000">'</span><span style="color: #800000">2</span><span style="color: #800000">'</span>

<span style="color: #008000">#</span><span style="color: #008000"> 理解为挖一个32的坑</span>
input1 =<span style="color: #000000"> tf.placeholder(tf.float32)
input2 </span>=<span style="color: #000000"> tf.placeholder(tf.float32)

</span><span style="color: #008000">#</span><span style="color: #008000"> 两个坑相乘</span>
output =<span style="color: #000000"> tf.multiply(input1, input2)

with tf.Session() as sess:
    </span><span style="color: #008000">#</span><span style="color: #008000"> 分别向两个坑填数据feed_dict</span>
    <span style="color: #0000ff">print</span>(sess.run([output], feed_dict={input1: [7.], input2: [2.]}))</pre>
</div>
<p>&nbsp;</p>
<pre>[array([ 14.], dtype=float32)]</pre>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><a href="http://www.jxiou.com/" target="_blank">叫卖录音网</a><br data-filtered="filtered"><a href="http://www.jxiou.com/lu_yin_wang_zhan.html" target="_blank">录音网站</a></p></div>