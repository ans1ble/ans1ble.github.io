第三百九十一节，Django+Xadmin打造上线标准的在线教育平台—404，403，500页面配置


			<div id="cnblogs_post_body" class="blogpost-body"><p><strong>第三百九十一节，Django+Xadmin打造上线标准的在线教育平台—404，403，500页面配置</strong></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>路由映射</strong></span><br><strong>在全局也就是根目录里的<span style="color: #ff0000">urls.py</span>里配置404路由映射</strong></p>
<p><strong>注意：不是写在urlpatterns列表里，而是独立写</strong></p>
<p><span style="color: #ff0000"><strong>handler404 = '404逻辑函数'</strong></span><br><strong>函数需要从app路径开始</strong></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000"> 全局404页面配置</span>
handler404 = <span style="color: #800000">'</span><span style="color: #800000">app_users.views.<span style="background-color: #ff99cc">pzhi404</span></span><span style="color: #800000">'</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>逻辑函数</strong></span></p>
<p><span style="color: #0000ff"><strong>可以写在任意一个app的views.py文件里</strong></span></p>
<p><span style="color: #ff0000"><strong>render_to_response('设置要显示的404页面', {})</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">def</span><span style="color: #000000"><span style="background-color: #ff99cc"> pzhi404</span>(request):
    </span><span style="background-color: #ff99cc"><span style="color: #0000ff">from</span> django.shortcuts <span style="color: #0000ff">import</span></span><span style="color: #000000"><span style="background-color: #ff99cc"> render_to_response</span>
    response </span>= <span style="background-color: #ff99cc">render_to_response(<span style="color: #800000">'</span><span style="color: #800000">404.html</span><span style="color: #800000">'</span></span><span style="color: #000000"><span style="background-color: #ff99cc">, {})</span>
    response.status_code </span>= 404　　<span style="color: #008080"># 状态码404</span>
    <span style="color: #0000ff">return</span> <span style="background-color: #ff99cc">response</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>404html里静态文件配置</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">&lt;!</span><span style="color: #ff00ff">DOCTYPE html</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">html</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">
{% load staticfiles %} {# 启用静态文件引用#}
</span><span style="color: #0000ff">&lt;</span><span style="color: #800000">head</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">meta </span><span style="color: #ff0000">charset</span><span style="color: #0000ff">="UTF-8"</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">title</span><span style="color: #0000ff">&gt;</span>404<span style="color: #0000ff">&lt;/</span><span style="color: #800000">title</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">link </span><span style="color: #ff0000">rel</span><span style="color: #0000ff">="stylesheet"</span><span style="color: #ff0000"> type</span><span style="color: #0000ff">="text/css"</span><span style="color: #ff0000"> href</span><span style="color: #0000ff">="<span style="background-color: #ff99cc">{% static 'css/reset.css'%}</span>"</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">link </span><span style="color: #ff0000">rel</span><span style="color: #0000ff">="stylesheet"</span><span style="color: #ff0000"> type</span><span style="color: #0000ff">="text/css"</span><span style="color: #ff0000"> href</span><span style="color: #0000ff">="<span style="background-color: #ff99cc">{% static 'css/animate.css'%}</span>"</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">link </span><span style="color: #ff0000">rel</span><span style="color: #0000ff">="stylesheet"</span><span style="color: #ff0000"> type</span><span style="color: #0000ff">="text/css"</span><span style="color: #ff0000"> href</span><span style="color: #0000ff">="<span style="background-color: #ff99cc">{% static 'css/style.css'%}</span>"</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">script </span><span style="color: #ff0000">type</span><span style="color: #0000ff">="text/javascript"</span><span style="color: #ff0000"> src</span><span style="color: #0000ff">="<span style="background-color: #ff99cc">{% static 'js/jquery.min.js'%}</span>"</span><span style="color: #0000ff">&gt;&lt;/</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">head</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">body </span><span style="color: #ff0000">class</span><span style="color: #0000ff">="bg404 errorpage"</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">section</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">div </span><span style="color: #ff0000">class</span><span style="color: #0000ff">="wp"</span><span style="color: #0000ff">&gt;</span>
        <span style="color: #0000ff">&lt;</span><span style="color: #800000">div </span><span style="color: #ff0000">class</span><span style="color: #0000ff">="cont"</span><span style="color: #0000ff">&gt;</span>
            <span style="color: #0000ff">&lt;</span><span style="color: #800000">img </span><span style="color: #ff0000">src</span><span style="color: #0000ff">="<span style="background-color: #ff99cc">{% static 'images/pic404.png'%}</span>"</span><span style="color: #0000ff">/&gt;</span>
            <span style="color: #0000ff">&lt;</span><span style="color: #800000">br</span><span style="color: #0000ff">/&gt;&lt;</span><span style="color: #800000">br</span><span style="color: #0000ff">/&gt;&lt;</span><span style="color: #800000">br</span><span style="color: #0000ff">/&gt;&lt;</span><span style="color: #800000">br</span><span style="color: #0000ff">/&gt;</span>
            <span style="color: #0000ff">&lt;</span><span style="color: #800000">p</span><span style="color: #0000ff">&gt;</span>wow~这个页面被外星人抢走了~<span style="color: #0000ff">&lt;/</span><span style="color: #800000">p</span><span style="color: #0000ff">&gt;</span>
            <span style="color: #0000ff">&lt;</span><span style="color: #800000">br</span><span style="color: #0000ff">/&gt;</span>
            <span style="color: #0000ff">&lt;</span><span style="color: #800000">span</span><span style="color: #0000ff">&gt;</span>Wow~ this page was the alien took ~<span style="color: #0000ff">&lt;/</span><span style="color: #800000">span</span><span style="color: #0000ff">&gt;</span>
        <span style="color: #0000ff">&lt;/</span><span style="color: #800000">div</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;/</span><span style="color: #800000">div</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">section</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">body</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">html</span><span style="color: #0000ff">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>配置settings.py文件</strong></span></p>
<p><span style="color: #ff0000"><strong>注意：如果要设置404页面显示，就必须在<strong>settings.py文件关闭调试模式</strong></strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000"> SECURITY WARNING: don't run with debug turned on in production!</span>
DEBUG = <span style="background-color: #ff99cc">False</span>                                <span style="color: #008000">#</span><span style="color: #008000"> 将调试模式关闭,关闭后访问页面出错不会显示错误(大黄页)</span>
ALLOWED_HOSTS = [<span style="background-color: #ff99cc"><span style="color: #800000">'</span><span style="color: #800000">*</span><span style="color: #800000">'</span></span>]                        <span style="color: #008000">#</span><span style="color: #008000"> 当关闭调试模式时，必须设置允许访问的ip，*代表所有以访问</span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>当关闭了调试模式时，就必须给静态文件做url路由映射</strong></span></p>
<p><span style="color: #ff0000"><strong>settings.py</strong></span></p>
<div class="cnblogs_code">
<pre>STATIC_URL = <span style="color: #800000">'</span><span style="color: #800000">/static/</span><span style="color: #800000">'</span>    <span style="color: #008000">#</span><span style="color: #008000"> 设置静态文件前缀名称</span><span style="color: #008000">
#</span><span style="color: #008000"> 配置静态文件目录</span>
STATICFILES_DIRS =<span style="color: #000000"> [
    os.path.join(BASE_DIR, </span><span style="color: #800000">'</span><span style="color: #800000">static</span><span style="color: #800000">'</span>),   <span style="color: #008000">#</span><span style="color: #008000"> 设置静态文件路径</span>
<span style="color: #000000">]
</span><span style="color: #008000">#</span><span style="color: #008000"> 配置静态文件访问路径</span>
<span style="background-color: #ff99cc">STATIC_ROOT = os.path.join(BASE_DIR, <span style="color: #800000">'</span><span style="color: #800000">static</span><span style="color: #800000">'</span>)    <span style="color: #008000">#</span><span style="color: #008000"> 设置上传文件路径</span></span></pre>
</div>
<p><span style="color: #ff0000"><strong>urls.py</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">from</span> django.conf.urls <span style="color: #0000ff">import</span> url, include                   <span style="color: #008000">#</span><span style="color: #008000"> 导入django自在的include逻辑</span>
<span style="color: #0000ff">from</span> django.contrib <span style="color: #0000ff">import</span><span style="color: #000000"> admin
</span><span style="color: #0000ff">from</span> django.views.generic <span style="color: #0000ff">import</span> TemplateView               <span style="color: #008000">#</span><span style="color: #008000"> 导入django自带的TemplateView逻辑</span>
<span style="color: #0000ff">from</span> django.views.static <span style="color: #0000ff">import</span> serve                       <span style="color: #008000">#</span><span style="color: #008000"> 导入django自带的serve静态资源逻辑</span>
<span style="color: #0000ff">import</span> xadmin                                               <span style="color: #008000">#</span><span style="color: #008000"> 导入xadmin</span>

<span style="color: #0000ff">from</span> app_users.views <span style="color: #0000ff">import</span> deng_lu, zhu_ce, active_code, logout                       <span style="color: #008000">#</span><span style="color: #008000"> 导入登录逻辑处理类</span>
<span style="color: #0000ff">from</span> app_organization.views <span style="color: #0000ff">import</span> org_list, course_comment,usercenter_info,touxiang   <span style="color: #008000">#</span><span style="color: #008000"> 导入授课机构逻辑</span>
<span style="color: #0000ff">from</span> MxOnline.settings <span style="color: #0000ff">import</span><span style="color: #000000"> MEDIA_ROOT, <span style="background-color: #ff99cc">STATIC_ROOT</span>


urlpatterns </span>=<span style="color: #000000"> [
    url(r</span><span style="color: #800000">'</span><span style="color: #800000">^xadmin/</span><span style="color: #800000">'</span><span style="color: #000000">, xadmin.site.urls),

    url(r</span><span style="color: #800000">'</span><span style="color: #800000">^index.html</span><span style="color: #800000">'</span>, TemplateView.as_view(template_name=<span style="color: #800000">'</span><span style="color: #800000">index.html</span><span style="color: #800000">'</span>), name=<span style="color: #800000">'</span><span style="color: #800000">index</span><span style="color: #800000">'</span><span style="color: #000000">),

    </span><span style="color: #008000">#</span><span style="color: #008000"> 注册</span>
    url(r<span style="color: #800000">'</span><span style="color: #800000">^register.html</span><span style="color: #800000">'</span>, zhu_ce.as_view(), name=<span style="color: #800000">'</span><span style="color: #800000">register</span><span style="color: #800000">'</span><span style="color: #000000">),
    url(r</span><span style="color: #800000">'</span><span style="color: #800000">^captcha/</span><span style="color: #800000">'</span>, include(<span style="color: #800000">'</span><span style="color: #800000">captcha.urls</span><span style="color: #800000">'</span>), name=<span style="color: #800000">'</span><span style="color: #800000">captcha</span><span style="color: #800000">'</span><span style="color: #000000">),
    url(r</span><span style="color: #800000">'</span><span style="color: #800000">^active/(?P&lt;active_de&gt;.*)/$</span><span style="color: #800000">'</span>, active_code.as_view(), name=<span style="color: #800000">"</span><span style="color: #800000">user_active</span><span style="color: #800000">"</span><span style="color: #000000">),

    </span><span style="color: #008000">#</span><span style="color: #008000"> 登录</span>
    url(r<span style="color: #800000">'</span><span style="color: #800000">^login.html</span><span style="color: #800000">'</span>, TemplateView.as_view(template_name=<span style="color: #800000">'</span><span style="color: #800000">login.html</span><span style="color: #800000">'</span>), name=<span style="color: #800000">'</span><span style="color: #800000">login</span><span style="color: #800000">'</span><span style="color: #000000">),
    url(r</span><span style="color: #800000">'</span><span style="color: #800000">^deng_lu</span><span style="color: #800000">'</span>, deng_lu.as_view(), name=<span style="color: #800000">'</span><span style="color: #800000">deng_lu</span><span style="color: #800000">'</span><span style="color: #000000">),
    url(r</span><span style="color: #800000">'</span><span style="color: #800000">^logout</span><span style="color: #800000">'</span>, logout.as_view(), name=<span style="color: #800000">'</span><span style="color: #800000">deng_lu</span><span style="color: #800000">'</span><span style="color: #000000">),

    </span><span style="color: #008000">#</span><span style="color: #008000"> 授课机构</span>
    url(r<span style="color: #800000">'</span><span style="color: #800000">^org_list.html</span><span style="color: #800000">'</span>, org_list.as_view(), name=<span style="color: #800000">'</span><span style="color: #800000">org_list</span><span style="color: #800000">'</span><span style="color: #000000">),

    </span><span style="color: #008000">#</span><span style="color: #008000"> 专门处理静态资源请求映射，也就是media上传文件夹里的请求映射</span>
    url(r<span style="color: #800000">'</span><span style="color: #800000">media/(?P&lt;path&gt;.*)$</span><span style="color: #800000">'</span>, serve, {<span style="color: #800000">'</span><span style="color: #800000">document_root</span><span style="color: #800000">'</span><span style="color: #000000">: MEDIA_ROOT}),
    
    </span><span style="color: #008000">#</span><span style="color: #008000"> 配置静态文件访问</span>
    <span style="background-color: #ff99cc">url(r<span style="color: #800000">'</span><span style="color: #800000">static/(?P&lt;path&gt;.*)$</span><span style="color: #800000">'</span>, serve, {<span style="color: #800000">'</span><span style="color: #800000">document_root</span><span style="color: #800000">'</span></span><span style="color: #000000"><span style="background-color: #ff99cc">: STATIC_ROOT}),</span>

    url(r</span><span style="color: #800000">'</span><span style="color: #800000">course_comment.html</span><span style="color: #800000">'</span>, course_comment.as_view(), name=<span style="color: #800000">'</span><span style="color: #800000">course_comment</span><span style="color: #800000">'</span><span style="color: #000000">),
    url(r</span><span style="color: #800000">'</span><span style="color: #800000">usercenter_info.html</span><span style="color: #800000">'</span>, usercenter_info.as_view(), name=<span style="color: #800000">'</span><span style="color: #800000">usercenter_info</span><span style="color: #800000">'</span><span style="color: #000000">),

    </span><span style="color: #008000">#</span><span style="color: #008000"> 上传头像</span>
    url(r<span style="color: #800000">'</span><span style="color: #800000">touxiang/</span><span style="color: #800000">'</span>, touxiang.as_view(), name=<span style="color: #800000">'</span><span style="color: #800000">touxiang</span><span style="color: #800000">'</span><span style="color: #000000">)
]


</span><span style="color: #008000">#</span><span style="color: #008000"> 全局404页面配置</span>
<span style="background-color: #ff99cc">handler404 = <span style="color: #800000">'</span><span style="color: #800000">app_users.views.pzhi404</span><span style="color: #800000">'</span></span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>其他如500页面配置同理</strong></span></p>
<p><span style="color: #ff0000"><strong>url映射</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000"> 全局404页面配置</span>
handler404 = <span style="color: #800000">'</span><span style="color: #800000; background-color: #ff99cc">app_users.views.pzhi404</span><span style="color: #800000">'</span>
<span style="color: #008000">#</span><span style="color: #008000"> 全局500页面配置</span>
handler500 = <span style="color: #800000">'</span><span style="color: #800000; background-color: #ff99cc">app_users.views.pzhi500</span><span style="color: #800000">'</span></pre>
</div>
<p><span style="color: #ff0000"><strong>逻辑</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">def</span><span style="color: #000000"> pzhi404(request):
    </span><span style="color: #0000ff">from</span> django.shortcuts <span style="color: #0000ff">import</span><span style="color: #000000"> render_to_response
    response </span>= render_to_response(<span style="background-color: #ff99cc"><span style="color: #800000">'</span><span style="color: #800000">404.html</span><span style="color: #800000">'</span></span><span style="color: #000000">, {})
    response.status_code </span>= <span style="background-color: #ff99cc">404</span>
    <span style="color: #0000ff">return</span><span style="color: #000000"> response


</span><span style="color: #0000ff">def</span><span style="color: #000000"> pzhi500(request):
    </span><span style="color: #0000ff">from</span> django.shortcuts <span style="color: #0000ff">import</span><span style="color: #000000"> render_to_response
    response </span>= render_to_response(<span style="background-color: #ff99cc"><span style="color: #800000">'</span><span style="color: #800000">500.html</span><span style="color: #800000">'</span></span><span style="color: #000000">, {})
    response.status_code </span>= <span style="background-color: #ff99cc">500</span>
    <span style="color: #0000ff">return</span> response</pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>效果</strong></span></p>
<p><span style="color: #ff0000"><strong><img src="https://images2017.cnblogs.com/blog/955761/201709/955761-20170922123147228-146011785.png" alt=""></strong></span></p>
<p>&nbsp;</p></div>