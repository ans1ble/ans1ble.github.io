第五十二节，单例模式


			<div id="cnblogs_post_body" class="blogpost-body"><p><span style="color: #ff0000;"><strong>单列模式就是一个类只创建一个对象即可完成需要的功能，每创建一个对象，内存里就会多一个对象，单列模式就是相同的数据到一个对象里去获取，减少占用内存空间</strong></span></p>
<p><span style="color: #0000ff;"><strong>需要创建多个对象，每个对象里封装了不同数据时，不适应单列模式</strong></span></p>
<p><span style="color: #0000ff;"><strong>不适合单列模式</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000;">#</span><span style="color: #008000;">!/usr/bin/env python</span><span style="color: #008000;">
#</span><span style="color: #008000;"> -*- coding:utf8 -*-</span>
<span style="color: #0000ff;">class</span><span style="color: #000000;"> a:
    </span><span style="color: #0000ff;">def</span> <span style="color: #800080;">__init__</span>(self, k, v):<span style="color: #008000;">#</span><span style="color: #008000;">接收对象传值，并把接收到的值封装成对象普通字段</span>
        self.k1 = k <span style="color: #008000;">#</span><span style="color: #008000;">封装普通字段</span>
        self.v1 = v <span style="color: #008000;">#</span><span style="color: #008000;">封装普通字段</span>
    <span style="color: #0000ff;">def</span><span style="color: #000000;"> f1(self):
        </span><span style="color: #0000ff;">pass</span><span style="color: #000000;">
b </span>= a(<span style="color: #800000;">"</span><span style="color: #800000;">小明</span><span style="color: #800000;">"</span>,<span style="color: #800000;">"</span><span style="color: #800000;">20岁</span><span style="color: #800000;">"</span>)<span style="color: #008000;">#</span><span style="color: #008000;">创建对象并且传值</span>
<span style="color: #0000ff;">print</span><span style="color: #000000;">(b.k1,b.v1)
c </span>= a(<span style="color: #800000;">"</span><span style="color: #800000;">小张</span><span style="color: #800000;">"</span>,<span style="color: #800000;">"</span><span style="color: #800000;">25岁</span><span style="color: #800000;">"</span>)<span style="color: #008000;">#</span><span style="color: #008000;">创建对象并且传值</span>
<span style="color: #0000ff;">print</span><span style="color: #000000;">(c.k1,c.v1)
e </span>= a(<span style="color: #800000;">"</span><span style="color: #800000;">小赵</span><span style="color: #800000;">"</span>,<span style="color: #800000;">"</span><span style="color: #800000;">25岁</span><span style="color: #800000;">"</span>)<span style="color: #008000;">#</span><span style="color: #008000;">创建对象并且传值</span>
<span style="color: #0000ff;">print</span><span style="color: #000000;">(e.k1,e.v1)
</span><span style="color: #008000;">#</span><span style="color: #008000;"> 输出</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 小明 20岁</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 小张 25岁</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 小赵 25岁</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000;"><strong>单列模式适应场景，当所有对象中封装的普通字段都相同时就适合用单列模式</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000;">#</span><span style="color: #008000;">!/usr/bin/env python</span><span style="color: #008000;">
#</span><span style="color: #008000;"> -*- coding:utf8 -*-</span>
<span style="color: #0000ff;">class</span><span style="color: #000000;"> a:
    </span><span style="color: #0000ff;">def</span> <span style="color: #800080;">__init__</span>(self, k):<span style="color: #008000;">#</span><span style="color: #008000;">接收对象传值，并把接收到的值封装成对象普通字段</span>
        self.k1 = k <span style="color: #008000;">#</span><span style="color: #008000;">封装普通字段</span>
    <span style="color: #0000ff;">def</span><span style="color: #000000;"> f1(self):
        </span><span style="color: #0000ff;">print</span>(self.k1,<span style="color: #800000;">"</span><span style="color: #800000;">的体重</span><span style="color: #800000;">"</span><span style="color: #000000;">)
    </span><span style="color: #0000ff;">def</span><span style="color: #000000;"> f2(self):
        </span><span style="color: #0000ff;">print</span>(self.k1,<span style="color: #800000;">"</span><span style="color: #800000;">的身高</span><span style="color: #800000;">"</span><span style="color: #000000;">)
    </span><span style="color: #0000ff;">def</span><span style="color: #000000;"> f3(self):
        </span><span style="color: #0000ff;">print</span>(self.k1,<span style="color: #800000;">"</span><span style="color: #800000;">的年龄</span><span style="color: #800000;">"</span><span style="color: #000000;">)
b </span>= a(<span style="color: #800000;">"</span><span style="color: #800000;">小明</span><span style="color: #800000;">"</span>)<span style="color: #008000;">#</span><span style="color: #008000;">创建对象并且传值</span>
b.f1() <span style="color: #008000;">#</span><span style="color: #008000;">执行f1方法</span>
b.f2() <span style="color: #008000;">#</span><span style="color: #008000;">执行f2方法</span>
b.f3() <span style="color: #008000;">#</span><span style="color: #008000;">执行f3方法</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 输出</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 小明 的体重</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 小明 的身高</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 小明 的年龄</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000;"><strong>单列模式数据库连接池原理1</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000;">#</span><span style="color: #008000;">!/usr/bin/env python</span><span style="color: #008000;">
#</span><span style="color: #008000;"> -*- coding:utf8 -*-</span>
<span style="color: #800000;">"""</span><span style="color: #800000;">单列模式数据库连接池原理</span><span style="color: #800000;">"""</span>
<span style="color: #0000ff;">class</span><span style="color: #000000;"> Sqlpool:
    </span><span style="color: #0000ff;">def</span> <span style="color: #800080;">__init__</span><span style="color: #000000;">(self):
        self.ip </span>= <span style="color: #800000;">"</span><span style="color: #800000;">192.168.1.1</span><span style="color: #800000;">"</span><span style="color: #000000;">
        self.port </span>= 3306<span style="color: #000000;">
        self.pwd </span>= <span style="color: #800000;">"</span><span style="color: #800000;">1234488</span><span style="color: #800000;">"</span><span style="color: #000000;">
        self.username </span>= <span style="color: #800000;">"</span><span style="color: #800000;">xxxxxx</span><span style="color: #800000;">"</span>
        <span style="color: #008000;">#</span><span style="color: #008000;">去链接数据库</span>
        self.lj = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10] <span style="color: #008000;">#</span><span style="color: #008000;">假如创建了9个链接数据库的线</span>
    <span style="color: #0000ff;">def</span><span style="color: #000000;"> hqlj(self):
        </span><span style="color: #008000;">#</span><span style="color: #008000;">获取链接</span>
        <span style="color: #0000ff;">import</span> random <span style="color: #008000;">#</span><span style="color: #008000;">导入随机模块</span>
        r = random.randrange(1,11) <span style="color: #008000;">#</span><span style="color: #008000;">创建一个1到10的随机数</span>
        <span style="color: #0000ff;">return</span> r <span style="color: #008000;">#</span><span style="color: #008000;">返回随机数</span>
a = Sqlpool() <span style="color: #008000;">#</span><span style="color: #008000;">创建对象</span>
<span style="color: #0000ff;">for</span> i <span style="color: #0000ff;">in</span> range(10): <span style="color: #008000;">#</span><span style="color: #008000;">创建10个循环，假如有10个人访问，每个人随机链接一条线</span>
    <span style="color: #0000ff;">print</span>(<span style="color: #800000;">"</span><span style="color: #800000;">去连接池</span><span style="color: #800000;">"</span>,a,<span style="color: #800000;">"</span><span style="color: #800000;">中获取一个链接</span><span style="color: #800000;">"</span><span style="color: #000000;">)
    b </span>=<span style="color: #000000;"> a.hqlj()
    </span><span style="color: #0000ff;">print</span>(<span style="color: #800000;">"</span><span style="color: #800000;">获取到的链接是：</span><span style="color: #800000;">"</span><span style="color: #000000;">,b)
</span><span style="color: #008000;">#</span><span style="color: #008000;"> 输出</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 去连接池 &lt;__main__.Sqlpool object at 0x0000005F74ED7780&gt; 中获取一个链接</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 获取到的链接是： 6</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 去连接池 &lt;__main__.Sqlpool object at 0x0000005F74ED7780&gt; 中获取一个链接</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 获取到的链接是： 5</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 去连接池 &lt;__main__.Sqlpool object at 0x0000005F74ED7780&gt; 中获取一个链接</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 获取到的链接是： 6</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 去连接池 &lt;__main__.Sqlpool object at 0x0000005F74ED7780&gt; 中获取一个链接</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 获取到的链接是： 3</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 去连接池 &lt;__main__.Sqlpool object at 0x0000005F74ED7780&gt; 中获取一个链接</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 获取到的链接是： 9</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 去连接池 &lt;__main__.Sqlpool object at 0x0000005F74ED7780&gt; 中获取一个链接</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 获取到的链接是： 1</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 去连接池 &lt;__main__.Sqlpool object at 0x0000005F74ED7780&gt; 中获取一个链接</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 获取到的链接是： 1</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 去连接池 &lt;__main__.Sqlpool object at 0x0000005F74ED7780&gt; 中获取一个链接</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 获取到的链接是： 5</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 去连接池 &lt;__main__.Sqlpool object at 0x0000005F74ED7780&gt; 中获取一个链接</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 获取到的链接是： 9</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 去连接池 &lt;__main__.Sqlpool object at 0x0000005F74ED7780&gt; 中获取一个链接</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 获取到的链接是： 7</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000;"><strong>单列模式数据库连接池原理2【推荐】</strong></span></p>
<p><span style="color: #ff0000;"><strong>通过静态方法+静态字段实现单列模式</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000;">#</span><span style="color: #008000;">!/usr/bin/env python</span><span style="color: #008000;">
#</span><span style="color: #008000;"> -*- coding:utf8 -*-</span>
<span style="color: #800000;">"""</span><span style="color: #800000;">单列模式数据库连接池原理</span><span style="color: #800000;">"""</span>
<span style="color: #0000ff;">class</span><span style="color: #000000;"> Sqlpool:
    </span><span style="color: #800080;">__danl</span> = None <span style="color: #008000;">#</span><span style="color: #008000;">创建一个静态字段</span>
    <span style="color: #0000ff;">def</span> <span style="color: #800080;">__init__</span><span style="color: #000000;">(self):
        </span><span style="color: #008000;">#</span><span style="color: #008000;">封装数据库链接需要的信息</span>
        self.ip = <span style="color: #800000;">"</span><span style="color: #800000;">192.168.1.1</span><span style="color: #800000;">"</span><span style="color: #000000;">
        self.port </span>= 3306<span style="color: #000000;">
        self.pwd </span>= <span style="color: #800000;">"</span><span style="color: #800000;">1234488</span><span style="color: #800000;">"</span><span style="color: #000000;">
        self.username </span>= <span style="color: #800000;">"</span><span style="color: #800000;">xxxxxx</span><span style="color: #800000;">"</span>
        <span style="color: #008000;">#</span><span style="color: #008000;">去链接数据库</span>
        self.lj = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10] <span style="color: #008000;">#</span><span style="color: #008000;">假如创建了9个链接数据库的线</span>
    @staticmethod <span style="color: #008000;">#</span><span style="color: #008000;">创建一个静态方法</span>
    <span style="color: #0000ff;">def</span><span style="color: #000000;"> duix():
        </span><span style="color: #0000ff;">if</span> Sqlpool.<span style="color: #800080;">__danl</span>: <span style="color: #008000;">#</span><span style="color: #008000;">判断静态字段是否有值</span>
            <span style="color: #0000ff;">return</span> Sqlpool.<span style="color: #800080;">__danl</span> <span style="color: #008000;">#</span><span style="color: #008000;">如果有值返回静态字段的值</span>
        <span style="color: #0000ff;">else</span><span style="color: #000000;">:
            Sqlpool.</span><span style="color: #800080;">__danl</span> = Sqlpool() <span style="color: #008000;">#</span><span style="color: #008000;">如果没有值创建一个类对象赋值给静态字段</span>
            <span style="color: #0000ff;">return</span> Sqlpool.<span style="color: #800080;">__danl</span> <span style="color: #008000;">#</span><span style="color: #008000;">赋值给静态字段后返回静态字段的值</span>

<span style="color: #008000;">#</span><span style="color: #008000;">这样，无论创建多少个访问，对象时，都是一个对象，这样不会占用内存</span>
a = Sqlpool.duix() <span style="color: #008000;">#</span><span style="color: #008000;">创建一个访问对象</span>
<span style="color: #0000ff;">print</span>(<span style="color: #800000;">"</span><span style="color: #800000;">打印对象地址</span><span style="color: #800000;">"</span><span style="color: #000000;">, a)
b </span>= Sqlpool.duix() <span style="color: #008000;">#</span><span style="color: #008000;">创建二个访问对象</span>
<span style="color: #0000ff;">print</span>(<span style="color: #800000;">"</span><span style="color: #800000;">打印对象地址</span><span style="color: #800000;">"</span><span style="color: #000000;">, b)
c </span>= Sqlpool.duix() <span style="color: #008000;">#</span><span style="color: #008000;">创建三个访问对象</span>
<span style="color: #0000ff;">print</span>(<span style="color: #800000;">"</span><span style="color: #800000;">打印对象地址</span><span style="color: #800000;">"</span><span style="color: #000000;">, c)

</span><span style="color: #008000;">#</span><span style="color: #008000;"> 输出</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 打印对象地址 &lt;__main__.Sqlpool object at 0x000000DCF56177B8&gt;</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 打印对象地址 &lt;__main__.Sqlpool object at 0x000000DCF56177B8&gt;</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 打印对象地址 &lt;__main__.Sqlpool object at 0x000000DCF56177B8&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000;"><strong>单列模式总结：列模式就是相同的数据到一个对象里去获取，减少占用内存空间</strong></span></p></div>