第三百六十四节，Python分布式爬虫打造搜索引擎Scrapy精讲—elasticsearch(搜索引擎)的mapping映射管理


			<div id="cnblogs_post_body" class="blogpost-body"><p><strong>第三百六十四节，Python分布式爬虫打造搜索引擎Scrapy精讲—elasticsearch(搜索引擎)的mapping映射管理</strong></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>1、映射(mapping)介绍</strong></span></p>
<p><strong><span style="color: #0000ff">映射</span>：创建索引的时候，可以预先定义字段的类型以及相关属性</strong><br><strong>elasticsearch会根据json源数据的基础类型猜测你想要的字段映射，将输入的数据转换成可搜索的索引项，mapping就是我们自己定义的字段数据类型，同时告诉elasticsearch如何索引数据以及是否可以被搜索</strong></p>
<p><br><strong><span style="color: #0000ff">作用</span>：会让索引建立的更加细致和完善</strong></p>
<p><br><strong><span style="color: #0000ff">类型</span>：静态映射和动态映射</strong></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>2、内置映射类型(也就是数据类型)</strong></span></p>
<p><strong><span style="color: #0000ff">string类型：</span>text,keyword两种</strong><br><strong>	　　<span style="color: #0000ff">text类型：</span>会进行分词，抽取词干，建立倒排索引</strong><br><strong>	　　<span style="color: #0000ff">keyword类型</span>：就是一个普通字符串，只能完全匹配才能搜索到</strong></p>
<p><strong><span style="color: #0000ff">数字类型</span>：long,integer,short,byte,double,float</strong></p>
<p><strong><span style="color: #0000ff">日期类型</span>：date</strong></p>
<p><strong><span style="color: #0000ff">bool(布尔)类型</span>：boolean</strong></p>
<p><strong><span style="color: #0000ff">binary(二进制)类型</span>：binary</strong></p>
<p><strong><span style="color: #0000ff">复杂类型：</span>object,nested</strong></p>
<p><strong><span style="color: #0000ff">geo(地区)类型</span>：geo-point,geo-shape</strong></p>
<p><strong><span style="color: #0000ff">专业类型</span>：ip,competion</strong></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>3、属性介绍</strong></span><br><span style="color: #0000ff"><strong>store属性</strong></span><br><span style="color: #0000ff"><strong>index属性</strong></span><br><span style="color: #0000ff"><strong>null_value属性</strong></span><br><span style="color: #0000ff"><strong>analyzer属性</strong></span><br><span style="color: #0000ff"><strong>include_in_all属性</strong></span><br><span style="color: #0000ff"><strong>format属性</strong></span></p>
<p><span style="color: #0000ff"><strong><img src="https://images2017.cnblogs.com/blog/955761/201708/955761-20170830230320780-2140907145.png" alt=""></strong></span></p>
<p><strong>&nbsp;更多属性：<span style="color: #0000ff">https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-boost.html</span></strong></p>
<p>&nbsp;<img src="https://images2017.cnblogs.com/blog/955761/201708/955761-20170830232454108-1759995898.png" alt=""></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>4、创建索引(相当于创建数据库)、创建表、创建字段-设置字段类型，添加数据</strong></span></p>
<p><span style="color: #0000ff"><strong>说明：</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">创建索引(设置字段类型)</span>
PUT jobbole                         <span style="color: #008000">#</span><span style="color: #008000">创建索引设置索引名称</span>
<span style="color: #000000">{
  </span><span style="color: #800000">"</span><span style="color: #800000">mappings</span><span style="color: #800000">"</span>: {                     <span style="color: #008000">#</span><span style="color: #008000">设置mappings映射字段类型</span>
    <span style="color: #800000">"</span><span style="color: #800000">job</span><span style="color: #800000">"</span>: {                        <span style="color: #008000">#</span><span style="color: #008000">表名称</span>
      <span style="color: #800000">"</span><span style="color: #800000">properties</span><span style="color: #800000">"</span>: {               <span style="color: #008000">#</span><span style="color: #008000">设置字段类型</span>
<span style="background-color: #ff99cc">        <span style="color: #800000">"</span><span style="color: #800000">title</span><span style="color: #800000">"</span>:{                   <span style="color: #008000">#</span><span style="color: #008000">title字段</span>
          <span style="color: #800000">"</span><span style="color: #800000">type</span><span style="color: #800000">"</span>: <span style="color: #800000">"</span><span style="color: #800000">text</span><span style="color: #800000">"</span>            <span style="color: #008000">#</span><span style="color: #008000">text类型，text类型可以分词，建立倒排索引</span>
<span style="color: #000000">        },
        </span></span><span style="color: #800000">"</span><span style="color: #800000">salary_min</span><span style="color: #800000">"</span>:{              <span style="color: #008000">#</span><span style="color: #008000">salary_min字段</span>
          <span style="color: #800000">"</span><span style="color: #800000">type</span><span style="color: #800000">"</span>: <span style="color: #800000">"</span><span style="color: #800000">integer</span><span style="color: #800000">"</span>         <span style="color: #008000">#</span><span style="color: #008000">integer数字类型</span>
<span style="color: #000000">        },
        </span><span style="color: #800000">"</span><span style="color: #800000">city</span><span style="color: #800000">"</span>:{                    <span style="color: #008000">#</span><span style="color: #008000">city字段</span>
          <span style="color: #800000">"</span><span style="color: #800000">type</span><span style="color: #800000">"</span>: <span style="color: #800000">"</span><span style="color: #800000">keyword</span><span style="color: #800000">"</span>         <span style="color: #008000">#</span><span style="color: #008000">keyword普通字符串类型</span>
<span style="color: #000000">        },
        </span><span style="color: #800000">"</span><span style="color: #800000">company</span><span style="color: #800000">"</span>:{                 <span style="color: #008000">#</span><span style="color: #008000">company字段，是嵌套字段</span>
          <span style="color: #800000">"</span><span style="color: #800000">properties</span><span style="color: #800000">"</span>:{            <span style="color: #008000">#</span><span style="color: #008000">设置嵌套字段类型</span>
            <span style="color: #800000">"</span><span style="color: #800000">name</span><span style="color: #800000">"</span>:{                <span style="color: #008000">#</span><span style="color: #008000">name字段</span>
              <span style="color: #800000">"</span><span style="color: #800000">type</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">text</span><span style="color: #800000">"</span>         <span style="color: #008000">#</span><span style="color: #008000">text类型</span>
<span style="color: #000000">            },
            </span><span style="color: #800000">"</span><span style="color: #800000">company_addr</span><span style="color: #800000">"</span>:{        <span style="color: #008000">#</span><span style="color: #008000">company_addr字段</span>
              <span style="color: #800000">"</span><span style="color: #800000">type</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">text</span><span style="color: #800000">"</span>         <span style="color: #008000">#</span><span style="color: #008000">text类型</span>
<span style="color: #000000">            },
            </span><span style="color: #800000">"</span><span style="color: #800000">employee_count</span><span style="color: #800000">"</span>:{      <span style="color: #008000">#</span><span style="color: #008000">employee_count字段</span>
              <span style="color: #800000">"</span><span style="color: #800000">type</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">integer</span><span style="color: #800000">"</span>      <span style="color: #008000">#</span><span style="color: #008000">integer数字类型</span>
<span style="color: #000000">            }
          }
        },
        </span><span style="color: #800000">"</span><span style="color: #800000">publish_date</span><span style="color: #800000">"</span>:{            <span style="color: #008000">#</span><span style="color: #008000">publish_date字段</span>
          <span style="color: #800000">"</span><span style="color: #800000">type</span><span style="color: #800000">"</span>: <span style="color: #800000">"</span><span style="color: #800000">date</span><span style="color: #800000">"</span>,           <span style="color: #008000">#</span><span style="color: #008000">date时间类型</span>
          <span style="color: #800000">"</span><span style="color: #800000">format</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">yyyy-MM-dd</span><span style="color: #800000">"</span>     <span style="color: #008000">#</span><span style="color: #008000">yyyy-MM-dd格式化时间样式</span>
<span style="color: #000000">        },
        </span><span style="color: #800000">"</span><span style="color: #800000">comments</span><span style="color: #800000">"</span>:{                <span style="color: #008000">#</span><span style="color: #008000">comments字段</span>
          <span style="color: #800000">"</span><span style="color: #800000">type</span><span style="color: #800000">"</span>: <span style="color: #800000">"</span><span style="color: #800000">integer</span><span style="color: #800000">"</span>         <span style="color: #008000">#</span><span style="color: #008000">integer数字类型</span>
<span style="color: #000000">        }
      }
    }
  }
}


</span><span style="color: #008000">#</span><span style="color: #008000">保存文档(相当于数据库的写入数据)</span>
PUT jobbole/job/1                       <span style="color: #008000">#</span><span style="color: #008000">索引名称/表/id</span>
<span style="color: #000000">{
  </span><span style="color: #800000">"</span><span style="color: #800000">title</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">python分布式爬虫开发</span><span style="color: #800000">"</span>,       <span style="color: #008000">#</span><span style="color: #008000">字段名称：字段值</span>
  <span style="color: #800000">"</span><span style="color: #800000">salary_min</span><span style="color: #800000">"</span>:15000,                   <span style="color: #008000">#</span><span style="color: #008000">字段名称：字段值</span>
  <span style="color: #800000">"</span><span style="color: #800000">city</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">北京</span><span style="color: #800000">"</span>,                        <span style="color: #008000">#</span><span style="color: #008000">字段名称：字段值</span>
  <span style="color: #800000">"</span><span style="color: #800000">company</span><span style="color: #800000">"</span>:{                           <span style="color: #008000">#</span><span style="color: #008000">嵌套字段</span>
    <span style="color: #800000">"</span><span style="color: #800000">name</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">百度</span><span style="color: #800000">"</span>,                      <span style="color: #008000">#</span><span style="color: #008000">字段名称：字段值</span>
    <span style="color: #800000">"</span><span style="color: #800000">company_addr</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">北京市软件园</span><span style="color: #800000">"</span>,      <span style="color: #008000">#</span><span style="color: #008000">字段名称：字段值</span>
    <span style="color: #800000">"</span><span style="color: #800000">employee_count</span><span style="color: #800000">"</span>:50                 <span style="color: #008000">#</span><span style="color: #008000">字段名称：字段值</span>
<span style="color: #000000">  },
  </span><span style="color: #800000">"</span><span style="color: #800000">publish_date</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">2017-4-16</span><span style="color: #800000">"</span>,           <span style="color: #008000">#</span><span style="color: #008000">字段名称：字段值</span>
  <span style="color: #800000">"</span><span style="color: #800000">comments</span><span style="color: #800000">"</span>:15                         <span style="color: #008000">#</span><span style="color: #008000">字段名称：字段值</span>
}</pre>
</div>
<p><span style="color: #0000ff"><strong>代码：</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">创建索引(设置字段类型)</span>
<span style="color: #000000">PUT jobbole
{
  </span><span style="color: #800000">"</span><span style="color: #800000">mappings</span><span style="color: #800000">"</span><span style="color: #000000">: {
    </span><span style="color: #800000">"</span><span style="color: #800000">job</span><span style="color: #800000">"</span><span style="color: #000000">: {
      </span><span style="color: #800000">"</span><span style="color: #800000">properties</span><span style="color: #800000">"</span><span style="color: #000000">: {
        </span><span style="color: #800000">"</span><span style="color: #800000">title</span><span style="color: #800000">"</span><span style="color: #000000">:{
          </span><span style="color: #800000">"</span><span style="color: #800000">type</span><span style="color: #800000">"</span>: <span style="color: #800000">"</span><span style="color: #800000">text</span><span style="color: #800000">"</span><span style="color: #000000">
        },
        </span><span style="color: #800000">"</span><span style="color: #800000">salary_min</span><span style="color: #800000">"</span><span style="color: #000000">:{
          </span><span style="color: #800000">"</span><span style="color: #800000">type</span><span style="color: #800000">"</span>: <span style="color: #800000">"</span><span style="color: #800000">integer</span><span style="color: #800000">"</span><span style="color: #000000">
        },
        </span><span style="color: #800000">"</span><span style="color: #800000">city</span><span style="color: #800000">"</span><span style="color: #000000">:{
          </span><span style="color: #800000">"</span><span style="color: #800000">type</span><span style="color: #800000">"</span>: <span style="color: #800000">"</span><span style="color: #800000">keyword</span><span style="color: #800000">"</span><span style="color: #000000">
        },
        </span><span style="color: #800000">"</span><span style="color: #800000">company</span><span style="color: #800000">"</span><span style="color: #000000">:{
          </span><span style="color: #800000">"</span><span style="color: #800000">properties</span><span style="color: #800000">"</span><span style="color: #000000">:{
            </span><span style="color: #800000">"</span><span style="color: #800000">name</span><span style="color: #800000">"</span><span style="color: #000000">:{
              </span><span style="color: #800000">"</span><span style="color: #800000">type</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">text</span><span style="color: #800000">"</span><span style="color: #000000">
            },
            </span><span style="color: #800000">"</span><span style="color: #800000">company_addr</span><span style="color: #800000">"</span><span style="color: #000000">:{
              </span><span style="color: #800000">"</span><span style="color: #800000">type</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">text</span><span style="color: #800000">"</span><span style="color: #000000">
            },
            </span><span style="color: #800000">"</span><span style="color: #800000">employee_count</span><span style="color: #800000">"</span><span style="color: #000000">:{
              </span><span style="color: #800000">"</span><span style="color: #800000">type</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">integer</span><span style="color: #800000">"</span><span style="color: #000000">
            }
          }
        },
        </span><span style="color: #800000">"</span><span style="color: #800000">publish_date</span><span style="color: #800000">"</span><span style="color: #000000">:{
          </span><span style="color: #800000">"</span><span style="color: #800000">type</span><span style="color: #800000">"</span>: <span style="color: #800000">"</span><span style="color: #800000">date</span><span style="color: #800000">"</span><span style="color: #000000">,
          </span><span style="color: #800000">"</span><span style="color: #800000">format</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">yyyy-MM-dd</span><span style="color: #800000">"</span><span style="color: #000000">
        },
        </span><span style="color: #800000">"</span><span style="color: #800000">comments</span><span style="color: #800000">"</span><span style="color: #000000">:{
          </span><span style="color: #800000">"</span><span style="color: #800000">type</span><span style="color: #800000">"</span>: <span style="color: #800000">"</span><span style="color: #800000">integer</span><span style="color: #800000">"</span><span style="color: #000000">
        }
      }
    }
  }
}


</span><span style="color: #008000">#</span><span style="color: #008000">保存文档(相当于数据库的写入数据)</span>
PUT jobbole/job/1<span style="color: #000000">
{
  </span><span style="background-color: #ff99cc"><span style="color: #800000">"</span><span style="color: #800000">title</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">python分布式爬虫开发</span><span style="color: #800000">"</span><span style="color: #000000">,
  </span></span><span style="color: #800000">"</span><span style="color: #800000">salary_min</span><span style="color: #800000">"</span>:15000<span style="color: #000000">,
  </span><span style="color: #800000">"</span><span style="color: #800000">city</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">北京</span><span style="color: #800000">"</span><span style="color: #000000">,
  </span><span style="color: #800000">"</span><span style="color: #800000">company</span><span style="color: #800000">"</span><span style="color: #000000">:{
    </span><span style="color: #800000">"</span><span style="color: #800000">name</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">百度</span><span style="color: #800000">"</span><span style="color: #000000">,
    </span><span style="color: #800000">"</span><span style="color: #800000">company_addr</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">北京市软件园</span><span style="color: #800000">"</span><span style="color: #000000">,
    </span><span style="color: #800000">"</span><span style="color: #800000">employee_count</span><span style="color: #800000">"</span>:50<span style="color: #000000">
  },
  </span><span style="color: #800000">"</span><span style="color: #800000">publish_date</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">2017-4-16</span><span style="color: #800000">"</span><span style="color: #000000">,
  </span><span style="color: #800000">"</span><span style="color: #800000">comments</span><span style="color: #800000">"</span>:15<span style="color: #000000">
}</span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>5、获取索引下的mappings映射字段类型</strong></span></p>
<p>&nbsp;</p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">获取一个索引下的所有表的mappings映射字段类型</span>
GET jobbole/<span style="color: #000000">_mapping
</span><span style="color: #008000">#</span><span style="color: #008000">获取一个索引下的指定表的mappings映射字段类型</span>
GET jobbole/_mapping/job</pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;<img src="https://images2017.cnblogs.com/blog/955761/201708/955761-20170831195620796-1697587400.png" alt=""></p>
<p><span style="color: #ff0000"><strong>&nbsp;【重点】在创建索引时一旦给字段设置了类型后就不可修改了，如果必须要修改就的重新创建索引，所以在创建索引时就必须确定好字段类型</strong></span></p></div>