第三百三十九节，Python分布式爬虫打造搜索引擎Scrapy精讲—Scrapy启动文件的配置—xpath表达式


			<div id="cnblogs_post_body" class="blogpost-body"><p><strong>第三百三十九节，Python分布式爬虫打造搜索引擎Scrapy精讲—<strong>Scrapy启动文件的配置—xpath表达式</strong></strong></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong><strong>我们自定义一个main.py来作为启动文件</strong></strong></span></p>
<p><span style="color: #0000ff"><strong><strong><strong><strong>main.py</strong></strong></strong></strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf8 -*-</span>

<span style="color: #0000ff">from</span> scrapy.cmdline <span style="color: #0000ff">import</span> <span style="background-color: #ff99cc">execute</span>  <span style="color: #008000">#</span><span style="color: #008000">导入执行scrapy命令方法</span>
<span style="color: #0000ff">import</span><span style="color: #000000"> sys
</span><span style="color: #0000ff">import</span><span style="color: #000000"> os

sys.path.append(<span style="background-color: #ff99cc">os.path.join(os.getcwd())</span>) </span><span style="color: #008000">#</span><span style="color: #008000">给Python解释器，添加模块新路径 ,将main.py文件所在目录添加到Python解释器</span>
<span style="color: #000000">
execute([</span><span style="color: #800000">'</span><span style="color: #800000">scrapy</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">crawl</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">pach</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">--nolog</span><span style="color: #800000">'</span>])  <span style="color: #008000">#</span><span style="color: #008000">执行scrapy命令</span></pre>
</div>
<p><span style="color: #0000ff"><strong>爬虫文件</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000"> -*- coding: utf-8 -*-</span>
<span style="color: #0000ff">import</span><span style="color: #000000"> scrapy
</span><span style="color: #0000ff">from</span> scrapy.http <span style="color: #0000ff">import</span><span style="color: #000000"> Request
</span><span style="color: #0000ff">import</span><span style="color: #000000"> urllib.response
</span><span style="color: #0000ff">from</span> lxml <span style="color: #0000ff">import</span><span style="color: #000000"> etree
</span><span style="color: #0000ff">import</span><span style="color: #000000"> re


</span><span style="color: #0000ff">class</span><span style="color: #000000"> PachSpider(scrapy.Spider):
    name </span>= <span style="color: #800000">'</span><span style="color: #800000">pach</span><span style="color: #800000">'</span><span style="color: #000000">
    allowed_domains </span>= [<span style="color: #800000">'</span><span style="color: #800000">blog.jobbole.com</span><span style="color: #800000">'</span><span style="color: #000000">]
    start_urls </span>= [<span style="color: #800000">'</span><span style="color: #800000">http://blog.jobbole.com/all-posts/</span><span style="color: #800000">'</span><span style="color: #000000">]


    </span><span style="color: #0000ff">def</span><span style="color: #000000"> parse(self, response):
        </span><span style="color: #0000ff">pass</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>xpath表达式</strong></span></p>
<p><span style="color: #ff0000"><strong>1、</strong></span></p>
<p><span style="color: #ff0000"><strong><img src="https://images2017.cnblogs.com/blog/955761/201708/955761-20170803120016272-1533976200.png" alt=""></strong></span></p>
<p><span style="color: #ff0000"><strong>2、</strong></span></p>
<p><img src="https://images2017.cnblogs.com/blog/955761/201708/955761-20170803120841428-1257016406.png" alt=""></p>
<p><span style="color: #ff0000"><strong>3、</strong></span></p>
<p><span style="color: #ff0000"><strong><img src="https://images2017.cnblogs.com/blog/955761/201708/955761-20170803121051147-1343415166.png" alt=""></strong></span></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>基本使用</strong></span></p>
<p><strong><span style="color: #ff0000"><span style="color: #0000ff">allowed_domains</span>设置爬虫起始域名</span></strong><br><strong><span style="color: #ff0000"><span style="color: #0000ff">start_urls</span>设置爬虫起始url地址</span></strong><br><strong><span style="color: #ff0000"><span style="color: #0000ff">parse(response)</span>默认爬虫回调函数，response返回的是爬虫获取到的html信息对象，里面封装了一些关于htnl信息的方法和属性</span></strong></p>
<p><br><span style="color: #ff0000; background-color: #ffff00"><strong>responsehtml信息对象下的方法和属性</strong></span><br><strong><span style="color: #ff0000"><span style="color: #0000ff">response.url</span>获取抓取的rul</span></strong><br><strong><span style="color: #ff0000"><span style="color: #0000ff">response.body</span>获取网页内容</span></strong><br><strong><span style="color: #ff0000"><span style="color: #0000ff">response.body_as_unicode()</span>获取网站内容unicode编码</span></strong><br><strong><span style="color: #ff0000"><span style="color: #0000ff">xpath()</span>方法，用xpath表达式过滤节点</span></strong><br><strong><span style="color: #ff0000"><span style="color: #0000ff">extract()</span>方法，获取过滤后的数据，返回列表</span></strong></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000"> -*- coding: utf-8 -*-</span>
<span style="color: #0000ff">import</span><span style="color: #000000"> scrapy

</span><span style="color: #0000ff">class</span><span style="color: #000000"> PachSpider(scrapy.Spider):
    name </span>= <span style="color: #800000">'</span><span style="color: #800000">pach</span><span style="color: #800000">'</span><span style="color: #000000; background-color: #ff99cc">
    allowed_domains </span>= [<span style="color: #800000">'</span><span style="color: #800000">blog.jobbole.com</span><span style="color: #800000">'</span><span style="color: #000000">]
    <span style="background-color: #ff99cc">start_urls </span></span>= [<span style="color: #800000">'</span><span style="color: #800000">http://blog.jobbole.com/all-posts/</span><span style="color: #800000">'</span><span style="color: #000000">]

    </span><span style="color: #0000ff">def</span><span style="color: #000000"><span style="background-color: #ff99cc"> parse(self, response)</span>:
        leir </span>= response.<span style="background-color: #ff99cc">xpath(<span style="color: #800000">'</span><span style="color: #800000">//a[@class="archive-title"]/text()</span><span style="color: #800000">'</span>)</span>.<span style="background-color: #ff99cc">extract()</span>  <span style="color: #008000">#</span><span style="color: #008000">获取指定标题</span>
        leir2 = response.xpath(<span style="color: #800000">'</span><span style="color: #800000">//a[@class="archive-title"]/@href </span><span style="color: #800000">'</span>).extract() <span style="color: #008000">#</span><span style="color: #008000">获取指定url</span>

<span style="background-color: #ff99cc">        <span style="color: #0000ff">print</span>(response.url)    <span style="color: #008000">#</span><span style="color: #008000">获取抓取的rul</span>
        <span style="color: #0000ff">print</span>(response.body)   <span style="color: #008000">#</span><span style="color: #008000">获取网页内容</span>
        <span style="color: #0000ff">print</span>(response.body_as_unicode())  <span style="color: #008000">#</span><span style="color: #008000">获取网站内容unicode编码</span></span>

        <span style="color: #0000ff">for</span> i <span style="color: #0000ff">in</span><span style="color: #000000"> leir:
            </span><span style="color: #0000ff">print</span><span style="color: #000000">(i)
        </span><span style="color: #0000ff">for</span> i <span style="color: #0000ff">in</span><span style="color: #000000"> leir2:
            </span><span style="color: #0000ff">print</span>(i)</pre>
</div>
<p>&nbsp;<img src="https://images2017.cnblogs.com/blog/955761/201708/955761-20170803141348944-1296536082.png" alt=""></p></div>