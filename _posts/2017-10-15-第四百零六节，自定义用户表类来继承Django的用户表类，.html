第四百零六节，自定义用户表类来继承Django的用户表类，


			<div id="cnblogs_post_body" class="blogpost-body"><p><strong>第四百零六节，自定义用户表类来继承Django的用户表类，</strong></p>
<p><span style="color: #ff0000"><strong>models.py</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">from</span> django.db <span style="color: #0000ff">import</span><span style="color: #000000"> models

</span><span style="color: #008000">#</span><span style="color: #008000"> Create your models here.</span>
<span style="color: #0000ff">from</span> django.db <span style="color: #0000ff">import</span><span style="color: #000000"> models
</span><span style="background-color: #ff99cc"><span style="color: #0000ff">from</span> django.contrib.auth.models <span style="color: #0000ff">import</span> AbstractUser</span>    <span style="color: #008000">#</span><span style="color: #008000"> django自带的用户表类</span>


<span style="color: #0000ff">class</span> Userpro(<span style="background-color: #ff99cc">AbstractUser</span>):            <span style="color: #008000">#</span><span style="color: #008000"> 继承django自带的用户表类</span>
    nick_name = models.CharField(max_length=50,verbose_name=<span style="color: #800000">'</span><span style="color: #800000">昵称</span><span style="color: #800000">'</span>,default=<span style="color: #800000">'</span><span style="color: #800000">11</span><span style="color: #800000">'</span><span style="color: #000000">)

    </span><span style="color: #0000ff">class</span><span style="color: #000000"> Meta:
        verbose_name </span>= <span style="color: #800000">'</span><span style="color: #800000">用户表</span><span style="color: #800000">'</span><span style="color: #000000">
        verbose_name_plural </span>=<span style="color: #000000"> verbose_name

    </span><span style="color: #0000ff">def</span> <span style="color: #800080">__str__</span><span style="color: #000000">(self):
        </span><span style="color: #0000ff">return</span> self.username</pre>
</div>
<p><span style="color: #ff0000"><strong>settings.py</strong></span></p>
<div class="cnblogs_code">
<pre>AUTH_USER_MODEL = <span style="color: #800000">'</span><span style="color: #800000">app1.Userpro</span><span style="color: #800000">'</span>   <span style="color: #008000">#</span><span style="color: #008000"> 设置用户表类名称，从app,类名称</span></pre>
</div>
<p>&nbsp;</p>
<p><strong>makemigrations&nbsp;&nbsp;然后在输入 &nbsp;&nbsp;migrate &nbsp;&nbsp;来生成表</strong></p>
<p><strong><img src="https://images2017.cnblogs.com/blog/955761/201710/955761-20171015203318918-555352572.png" alt=""></strong></p>
<p>&nbsp;</p>
<p><strong>用户登录和验证</strong></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf8 -*-</span>
<span style="color: #0000ff">from</span> django.shortcuts <span style="color: #0000ff">import</span><span style="color: #000000"> render
</span><span style="color: #0000ff">from</span> django.contrib.auth <span style="color: #0000ff">import</span> authenticate,login   <span style="color: #008000">#</span><span style="color: #008000"> django自带用户认证方法</span>

<span style="color: #0000ff">def</span><span style="color: #000000"> loging(request):
    </span><span style="color: #0000ff">if</span> request.method == <span style="color: #800000">'</span><span style="color: #800000">post</span><span style="color: #800000">'</span><span style="color: #000000">:
        user </span>= authenticate(username=<span style="color: #800000">'</span><span style="color: #800000">用户名</span><span style="color: #800000">'</span>, password=<span style="color: #800000">'</span><span style="color: #800000">密码</span><span style="color: #800000">'</span>)  <span style="color: #008000">#</span><span style="color: #008000"> 只用于验证用户名和密码是否正确</span>
        <span style="color: #008000">#</span><span style="color: #008000"> 验证成功返回，用户对象，失败返回None</span>
        <span style="color: #0000ff">if</span> user <span style="color: #0000ff">is</span> <span style="color: #0000ff">not</span><span style="color: #000000"> None:
            login(request,user)      </span><span style="color: #008000">#</span><span style="color: #008000"> login用于登录，第一个参数request，第二个参数接收验证返回的用户对象</span>
            <span style="color: #0000ff">return</span> render(request,<span style="color: #800000">'</span><span style="color: #800000">1.html</span><span style="color: #800000">'</span><span style="color: #000000">)

</span><span style="color: #008000">#</span><span style="color: #008000"> login，会将用户登录状态从request注入到HTML页面，所以，在HTML页面可以判断到</span><span style="color: #008000">
#</span><span style="color: #008000"> { % if request.user.is_authenticated %}</span><span style="color: #008000">
#</span><span style="color: #008000"> ...</span><span style="color: #008000">
#</span><span style="color: #008000"> 判断用户是否登录...</span><span style="color: #008000">
#
#</span><span style="color: #008000"> { % endif %}</span></pre>
</div>
<p>&nbsp;</p>
<p><strong>如果要求允许用户表里的两个字段中的任意一个字段值都可以登录，就需要逻辑处理页面需要重写authenticate</strong></p>
<p><img src="https://images2017.cnblogs.com/blog/955761/201710/955761-20171015213016793-1333522571.png" alt=""></p>
<p><strong>2，配置信息</strong></p>
<p><strong><img src="https://images2017.cnblogs.com/blog/955761/201710/955761-20171015212213215-385649369.png" alt=""></strong></p>
<p>&nbsp;</p></div>