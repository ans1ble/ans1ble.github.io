第二百八十九节，MySQL数据库-ORM之sqlalchemy模块操作数据库


			<div id="cnblogs_post_body" class="blogpost-body"><p><strong>MySQL数据库-ORM之sqlalchemy模块操作数据库</strong></p>
<p><strong><strong>sqlalchemy第三方模块</strong></strong></p>
<p>&nbsp;</p>
<p><strong><span style="color: #ff0000">sqlalchemy</span></strong><br><span style="color: #ff0000"><strong>sqlalchemy是Python编程语言下的一款ORM框架，该框架建立在数据库API之上，使用关系对象映射进行数据库操作，简言之便是：将对象转换成SQL，然后使用数据API执行SQL并获取执行结果。</strong></span></p>
<p><img src="https://images2015.cnblogs.com/blog/955761/201706/955761-20170619172709960-896984567.png" alt=""></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>SQLAlchemy本身无法操作数据库，其必须以pymsql等第三方插件，Dialect用于和数据API进行交流，根据配置文件的不同调用不同的数据库API，从而实现对数据库的操作，</strong></span></p>
<p><span style="color: #ff0000"><strong>如：下面是不同的<strong>第三方插件数据库链接插件pymysql是我们前面说过的</strong></strong></span></p>
<div class="cnblogs_code">
<pre><span style="background-color: #99ccff">MySQL-<span style="color: #000000">Python
    mysql</span>+mysqldb://&lt;user&gt;:&lt;password&gt;@&lt;host&gt;[:&lt;port&gt;]/&lt;dbname&gt;</span><span style="background-color: #ccffff"><span style="color: #000000">
  
pymysql
    mysql</span>+pymysql://&lt;username&gt;:&lt;password&gt;@&lt;host&gt;/&lt;dbname&gt;[?&lt;options&gt;</span><span style="color: #000000"><span style="background-color: #ccffff">]</span>
  
<span style="background-color: #ccffcc">MySQL</span></span><span style="background-color: #ccffcc">-<span style="color: #000000">Connector
    mysql</span>+mysqlconnector://&lt;user&gt;:&lt;password&gt;@&lt;host&gt;[:&lt;port&gt;]/&lt;dbname&gt;</span><span style="background-color: #ffff99"><span style="color: #000000">
  
cx_Oracle
    oracle</span>+cx_oracle://user:<span style="color: #0000ff">pass</span>@host:port/dbname[?key=value&amp;key=value...]</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong><strong>一、底层处理</strong></strong></span></p>
<p><span style="color: #ff0000"><strong>使用 Engine/ConnectionPooling/Dialect 进行数据库操作，Engine使用ConnectionPooling连接数据库，然后再通过Dialect执行SQL语句。</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf-8 -*-</span>
<span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> create_engine
 
 
engine </span>= create_engine(<span style="color: #800000">"</span><span style="color: #800000">mysql+pymysql://root:123@127.0.0.1:3306/t1</span><span style="color: #800000">"</span>, max_overflow=5<span style="color: #000000">)
 
</span><span style="color: #008000">#</span><span style="color: #008000"> 执行SQL</span><span style="color: #008000">
#</span><span style="color: #008000"> cur = engine.execute(</span><span style="color: #008000">
#</span><span style="color: #008000">     "INSERT INTO hosts (host, color_id) VALUES ('1.1.1.22', 3)"</span><span style="color: #008000">
#</span><span style="color: #008000"> )</span>
 
<span style="color: #008000">#</span><span style="color: #008000"> 新插入行自增ID</span><span style="color: #008000">
#</span><span style="color: #008000"> cur.lastrowid</span>
 
<span style="color: #008000">#</span><span style="color: #008000"> 执行SQL</span><span style="color: #008000">
#</span><span style="color: #008000"> cur = engine.execute(</span><span style="color: #008000">
#</span><span style="color: #008000">     "INSERT INTO hosts (host, color_id) VALUES(%s, %s)",[('1.1.1.22', 3),('1.1.1.221', 3),]</span><span style="color: #008000">
#</span><span style="color: #008000"> )</span>
 
 
<span style="color: #008000">#</span><span style="color: #008000"> 执行SQL</span><span style="color: #008000">
#</span><span style="color: #008000"> cur = engine.execute(</span><span style="color: #008000">
#</span><span style="color: #008000">     "INSERT INTO hosts (host, color_id) VALUES (%(host)s, %(color_id)s)",</span><span style="color: #008000">
#</span><span style="color: #008000">     host='1.1.1.99', color_id=3</span><span style="color: #008000">
#</span><span style="color: #008000"> )</span>
 
<span style="color: #008000">#</span><span style="color: #008000"> 执行SQL</span><span style="color: #008000">
#</span><span style="color: #008000"> cur = engine.execute('select * from hosts')</span><span style="color: #008000">
#</span><span style="color: #008000"> 获取第一行数据</span><span style="color: #008000">
#</span><span style="color: #008000"> cur.fetchone()</span><span style="color: #008000">
#</span><span style="color: #008000"> 获取第n行数据</span><span style="color: #008000">
#</span><span style="color: #008000"> cur.fetchmany(3)</span><span style="color: #008000">
#</span><span style="color: #008000"> 获取所有数据</span><span style="color: #008000">
#</span><span style="color: #008000"> cur.fetchall()</span></pre>
</div>
<p><span style="color: #ff0000"><strong>注意：以上都是底层实现，因为我们操作的是上层，所以底层了解一下即可</strong></span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>&nbsp;</strong></span></p>
<p><span style="color: #ff0000"><strong>ORM:</strong></span></p>
<p><span style="color: #ff0000"><strong>ORM框架的作用就是把数据库表的一行记录与一个对象互相做自动转换。 正确使用ORM的前提是了解关系数据库的原理。 ORM就是把数据库表的行与相应的对象建立关联，互相转换。 由于关系数据库的多个表还可以用外键实现一对多、多对多等关联，相应地， ORM框架也可以提供两个对象之间的一对多、多对多等功能。</strong></span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<hr>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>&nbsp;1、创建表</strong></span></p>
<p><span style="color: #ff0000"><strong>create_engine方法参数(<span style="color: #0000ff">'使用数据库+数据库链接模块://数据库用户名:密码@ip地址:端口/要连接的数据库名称?charset=utf8'</span>,echo=True表示是否查看生成的sql语句,</strong></span><span style="color: #0000ff"><strong>max_overflow=5</strong></span><strong style="color: #ff0000; line-height: 1.5">)</strong></p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff">max_overflow=5</span> 表示最大连接数</strong></span></p>
<p><span style="color: #ff0000"><strong>declarative_base()创建一个SQLORM基类</strong></span><br><span style="color: #ff0000"><strong>Column()设置字段属性</strong></span><br><span style="color: #ff0000"><strong>create_all()向数据库创建指定表</strong></span></p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>创建表数据类型</strong></span></p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>整数型：<span style="color: #0000ff">TINYINT，SMALLINT，INT，BIGINT</span></strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">Boolean()</span>对应<span style="color: #0000ff">TINYINT</span></strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">Integer()</span>对应<span style="color: #0000ff">INT</span></strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">SMALLINT()</span>对应<span style="color: #0000ff">SMALLINT</span></strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">BIGINT()</span>对应<span style="color: #0000ff">BIGINT</span></strong></span></p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>浮点型：<span style="color: #0000ff">FLOAT，DOUBLE，DECIMAL(M,D)</span></strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">DECIMAL()</span>对应<span style="color: #0000ff">DECIMAL</span></strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">Float()</span>对应<span style="color: #0000ff">FLOAT</span></strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">REAL()</span>对应<span style="color: #0000ff">DOUBLE</span></strong></span></p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>字符型：<span style="color: #0000ff">CHAR，VARCHAR</span></strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">String(40)</span>对应<span style="color: #0000ff">VARCHAR</span></strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">CHAR()</span>对应<span style="color: #0000ff">CHAR</span></strong></span></p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>日期型：<span style="color: #0000ff">DATETIME，DATE，TIMESTAMP</span></strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">DATETIME()</span>对应<span style="color: #0000ff">DATETIME</span></strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">DATE()</span>对应<span style="color: #0000ff">DATE</span></strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">TIMESTAMP()</span>对应<span style="color: #0000ff">TIMESTAMP</span></strong></span></p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>备注型：<span style="color: #0000ff">TINYTEXT，TEXT，</span></strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">Text()</span>对应<span style="color: #0000ff">TEXT</span></strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">UnicodeText(10)</span>对应<span style="color: #0000ff">TINYTEXT</span></strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf-8 -*-</span>

<span style="color: #0000ff">import</span><span style="color: #000000"> sqlalchemy
</span><span style="color: #0000ff">from</span> sqlalchemy.ext.declarative <span style="color: #0000ff">import</span><span style="color: #000000"> declarative_base
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> Column, Integer, String, ForeignKey, UniqueConstraint, Index
</span><span style="color: #0000ff">from</span> sqlalchemy.orm <span style="color: #0000ff">import</span><span style="color: #000000"> sessionmaker, relationship
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> create_engine


</span><span style="color: #008000">#</span><span style="color: #008000">create_engine方法，创建数据库链接，</span><span style="color: #008000">
#</span><span style="color: #008000">create_engine方法参数('使用数据库+数据库链接模块://数据库用户名:密码@ip地址:端口/要连接的数据库名称',echo=True表示是否查看生成的sql语句)</span>
engine = create_engine(<span style="color: #800000">'</span><span style="color: #800000">mysql+pymysql://root:279819@127.0.0.1:3306/<span style="background-color: #ff99cc">cshi</span></span><span style="color: #800000">'</span>, echo=<span style="color: #000000">True)

Base </span>= declarative_base()   <span style="color: #008000">#</span><span style="color: #008000">创建一个SQLORM基类</span>

<span style="color: #0000ff">class</span> User(Base):           <span style="color: #008000">#</span><span style="color: #008000">自定义类，功能生成一张表，参数必须继承SQLORM基类</span>
    <span style="color: #800080">__tablename__</span> = <span style="color: #800000">'</span><span style="color: #800000; background-color: #ff99cc">users</span><span style="color: #800000">'</span> <span style="color: #008000">#</span><span style="color: #008000">表名称</span>

    <span style="color: #008000">#</span><span style="color: #008000">创建字段</span>
    <span style="color: #008000">#</span><span style="color: #008000">字段名称 = Column(字段属性...)</span>
    <span style="background-color: #ffff99">id = Column(Integer, primary_key=True, autoincrement=<span style="color: #000000">True)
    name </span>= Column(String(40<span style="color: #000000">))
    fullname </span>= Column(String(40<span style="color: #000000">))
    password </span>= Column(String(40</span><span style="color: #000000"><span style="background-color: #ffff99">))</span>


<span style="background-color: #ffff99">Base.metadata.create_all(engine)  </span></span><span style="color: #008000">#</span><span style="color: #008000">向数据库创建指定表</span></pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201706/955761-20170619190708710-1158542965.png" alt=""></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>创建一张表，并且创建索引</strong></span></p>
<p><span style="color: #ff0000"><strong>primary_key=True给当前字段创建主键索引</strong></span><br><span style="color: #ff0000"><strong>index=True给当前字段创建普通索引</strong></span><br><span style="color: #ff0000"><strong>unique=True给当前字段创建唯一索引</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf-8 -*-</span>

<span style="color: #0000ff">import</span><span style="color: #000000"> sqlalchemy
</span><span style="color: #0000ff">from</span> sqlalchemy.ext.declarative <span style="color: #0000ff">import</span><span style="color: #000000"> declarative_base
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> Column, Integer, String, ForeignKey, UniqueConstraint, Index
</span><span style="color: #0000ff">from</span> sqlalchemy.orm <span style="color: #0000ff">import</span><span style="color: #000000"> sessionmaker, relationship
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> create_engine


</span><span style="color: #008000">#</span><span style="color: #008000">create_engine方法，创建数据库链接，</span><span style="color: #008000">
#</span><span style="color: #008000">create_engine方法参数('使用数据库+数据库链接模块://数据库用户名:密码@ip地址:端口/要连接的数据库名称',echo=True表示是否查看生成的sql语句)</span>
engine = create_engine(<span style="color: #800000">'</span><span style="color: #800000">mysql+pymysql://root:279819@127.0.0.1:3306/<span style="background-color: #ff99cc">cshi</span></span><span style="color: #800000">'</span>, echo=<span style="color: #000000">True)

Base </span>= declarative_base()   <span style="color: #008000">#</span><span style="color: #008000">创建一个SQLORM基类</span>

<span style="color: #0000ff">class</span> User(Base):           <span style="color: #008000">#</span><span style="color: #008000">自定义类，功能生成一张表，参数必须继承SQLORM基类</span>
    <span style="color: #800080">__tablename__</span> = <span style="background-color: #ff99cc"><span style="color: #800000">'</span><span style="color: #800000">users</span><span style="color: #800000">'</span></span> <span style="color: #008000">#</span><span style="color: #008000">表名称</span>

    <span style="color: #008000">#</span><span style="color: #008000">创建字段</span>
    <span style="color: #008000">#</span><span style="color: #008000">字段名称 = Column(字段属性...)</span>
    id = Column(Integer, <span style="background-color: #ffff00">primary_key=True</span>, autoincrement=True)  <span style="color: #008000">#</span><span style="color: #008000">primary_key=True给当前字段创建主键索引</span>
    name = Column(String(40),<span style="background-color: #ffff00">index=True</span>)        <span style="color: #008000">#</span><span style="color: #008000">index=True给当前字段创建普通索引</span>
    fullname = Column(String(40),<span style="background-color: #ffff00">unique=True</span>)   <span style="color: #008000">#</span><span style="color: #008000">unique=True给当前字段创建唯一索引</span>
    password = Column(String(40<span style="color: #000000">))


<span style="background-color: #ffff00">Base.metadata.create_all(engine)  </span></span><span style="color: #008000">#</span><span style="color: #008000">向数据库创建指定表</span></pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201706/955761-20170619220148976-529606443.png" alt=""></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>创建一张表，并且创建组合索引</strong></span></p>
<p><span style="color: #ff0000"><strong>UniqueConstraint('字段','字段',name='索引名称')创建唯一组合索引</strong></span><br><span style="color: #ff0000"><strong>Index('索引名称','字段','字段')创建普通组合索引</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf-8 -*-</span>

<span style="color: #0000ff">import</span><span style="color: #000000"> sqlalchemy
</span><span style="color: #0000ff">from</span> sqlalchemy.ext.declarative <span style="color: #0000ff">import</span><span style="color: #000000"> declarative_base
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> Column, Integer, String, ForeignKey, UniqueConstraint, Index
</span><span style="color: #0000ff">from</span> sqlalchemy.orm <span style="color: #0000ff">import</span><span style="color: #000000"> sessionmaker, relationship
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> create_engine


</span><span style="color: #008000">#</span><span style="color: #008000">create_engine方法，创建数据库链接，</span><span style="color: #008000">
#</span><span style="color: #008000">create_engine方法参数('使用数据库+数据库链接模块://数据库用户名:密码@ip地址:端口/要连接的数据库名称',echo=True表示是否查看生成的sql语句)</span>
engine = create_engine(<span style="color: #800000">'</span><span style="color: #800000">mysql+pymysql://root:279819@127.0.0.1:3306/<span style="background-color: #ff99cc">cshi</span></span><span style="color: #800000">'</span>, echo=<span style="color: #000000">True)

Base </span>= declarative_base()   <span style="color: #008000">#</span><span style="color: #008000">创建一个SQLORM基类</span>

<span style="color: #0000ff">class</span> User(Base):           <span style="color: #008000">#</span><span style="color: #008000">自定义类，功能生成一张表，参数必须继承SQLORM基类</span>
    <span style="color: #800080">__tablename__</span> = <span style="background-color: #ff99cc"><span style="color: #800000">'</span><span style="color: #800000">users</span><span style="color: #800000">'</span></span> <span style="color: #008000">#</span><span style="color: #008000">表名称</span>

    <span style="color: #008000">#</span><span style="color: #008000">创建字段</span>
    <span style="color: #008000">#</span><span style="color: #008000">字段名称 = Column(字段属性...)</span>
    id = Column(Integer, primary_key=True, autoincrement=True)  <span style="color: #008000">#</span><span style="color: #008000">primary_key=True给当前字段创建主键索引</span>
    name = Column(String(40<span style="color: #000000">))
    fullname </span>= Column(String(40<span style="color: #000000">))
    password </span>= Column(String(40<span style="color: #000000">))

    </span><span style="background-color: #ffff99"><span style="color: #800080">__table_args__</span> =<span style="color: #000000"> (
        UniqueConstraint(</span><span style="color: #800000">'</span><span style="color: #800000">id</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">name</span><span style="color: #800000">'</span>, name=<span style="color: #800000">'</span><span style="color: #800000">uix_id_name</span><span style="color: #800000">'</span>),     <span style="color: #008000">#</span><span style="color: #008000">UniqueConstraint('字段','字段',name='索引名称')创建唯一组合索引</span>
        Index(<span style="color: #800000">'</span><span style="color: #800000">ix_id_name</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">name</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">password</span><span style="color: #800000">'</span>),                <span style="color: #008000">#</span><span style="color: #008000">Index('索引名称','字段','字段')创建普通组合索引</span>
</span><span style="color: #000000"><span style="background-color: #ffff99">    )</span>


Base.metadata.create_all(engine)  </span><span style="color: #008000">#</span><span style="color: #008000">向数据库创建指定表</span></pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201706/955761-20170619232449476-1518637654.png" alt=""></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff99"><strong>创建两张表，并且创建外键链表，一对多</strong></span></p>
<p><span style="color: #ff0000"><strong>ForeignKey("连接表名称.连接表主键字段")外键链表一对多</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf-8 -*-</span>

<span style="color: #0000ff">import</span><span style="color: #000000"> sqlalchemy
</span><span style="color: #0000ff">from</span> sqlalchemy.ext.declarative <span style="color: #0000ff">import</span><span style="color: #000000"> declarative_base
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> Column, Integer, String, ForeignKey, UniqueConstraint, Index
</span><span style="color: #0000ff">from</span> sqlalchemy.orm <span style="color: #0000ff">import</span><span style="color: #000000"> sessionmaker, relationship
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> create_engine


</span><span style="color: #008000">#</span><span style="color: #008000">create_engine方法，创建数据库链接，</span><span style="color: #008000">
#</span><span style="color: #008000">create_engine方法参数('使用数据库+数据库链接模块://数据库用户名:密码@ip地址:端口/要连接的数据库名称',echo=True表示是否查看生成的sql语句)</span>
engine = create_engine(<span style="color: #800000">'</span><span style="color: #800000">mysql+pymysql://root:279819@127.0.0.1:3306/<span style="background-color: #ff99cc">cshi</span></span><span style="color: #800000">'</span>, echo=<span style="color: #000000">True)

Base </span>= declarative_base()   <span style="color: #008000">#</span><span style="color: #008000">创建一个SQLORM基类</span>


<span style="background-color: #ffff99"><span style="color: #0000ff">class</span> Favor(Base):          <span style="color: #008000">#</span><span style="color: #008000"><span style="background-color: #ff99cc">创建连接表</span>，自定义类，功能生成一张表，参数必须继承SQLORM基类</span>
    <span style="color: #800080">__tablename__</span> = <span style="color: #800000">'</span><span style="color: #800000; background-color: #ff99cc">favor</span><span style="color: #800000">'</span> <span style="color: #008000">#</span><span style="color: #008000">表名称</span>
    id = Column(Integer, primary_key=True, autoincrement=True)  <span style="color: #008000">#</span><span style="color: #008000">设置主键，自增</span>
    caption = Column(String(50), default=<span style="color: #800000">'</span><span style="color: #800000">red</span><span style="color: #800000">'</span>, unique=True)    <span style="color: #008000">#</span><span style="color: #008000">设置字段默认值，设置字段唯一索引</span></span>


<span style="background-color: #ccffcc"><span style="color: #0000ff">class</span> User(Base):           <span style="color: #008000">#</span><span style="color: #008000"><span style="background-color: #ff99cc">创建外键表</span>，自定义类，功能生成一张表，参数必须继承SQLORM基类</span>
    <span style="color: #800080">__tablename__</span> = <span style="color: #800000">'</span><span style="color: #800000; background-color: #ff99cc">users</span><span style="color: #800000">'</span> <span style="color: #008000">#</span><span style="color: #008000">表名称</span>

    <span style="color: #008000">#</span><span style="color: #008000">创建字段</span>
    <span style="color: #008000">#</span><span style="color: #008000">字段名称 = Column(字段属性...)</span>
    id = Column(Integer, primary_key=True, autoincrement=True)  <span style="color: #008000">#</span><span style="color: #008000">设置主键，自增</span>
    name = Column(String(40<span style="color: #000000">))
    password </span>= Column(String(40<span style="color: #000000">))
    fullname </span>= Column(Integer,<span style="background-color: #ff99cc">ForeignKey(<span style="color: #800000">"</span><span style="color: #800000">favor.id</span><span style="color: #800000">"</span>)</span>)           <span style="color: #008000">#</span><span style="color: #008000">ForeignKey("连接表名称.连接表主键字段")外键链表一对多</span></span>
<span style="color: #000000">

Base.metadata.create_all(engine)  </span><span style="color: #008000">#</span><span style="color: #008000">向数据库创建指定表</span></pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201706/955761-20170619234705898-375149270.png" alt=""></p>
<p><img src="https://images2015.cnblogs.com/blog/955761/201706/955761-20170619234713179-1421205519.png" alt=""></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>创建三张表，并且创建外键链表，多对多</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf-8 -*-</span>

<span style="color: #0000ff">import</span><span style="color: #000000"> sqlalchemy
</span><span style="color: #0000ff">from</span> sqlalchemy.ext.declarative <span style="color: #0000ff">import</span><span style="color: #000000"> declarative_base
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> Column, Integer, String, ForeignKey, UniqueConstraint, Index
</span><span style="color: #0000ff">from</span> sqlalchemy.orm <span style="color: #0000ff">import</span><span style="color: #000000"> sessionmaker, relationship
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> create_engine


</span><span style="color: #008000">#</span><span style="color: #008000">create_engine方法，创建数据库链接，</span><span style="color: #008000">
#</span><span style="color: #008000">create_engine方法参数('使用数据库+数据库链接模块://数据库用户名:密码@ip地址:端口/要连接的数据库名称',echo=True表示是否查看生成的sql语句)</span>
engine = create_engine(<span style="color: #800000">'</span><span style="color: #800000">mysql+pymysql://root:279819@127.0.0.1:3306/<span style="background-color: #ff99cc">cshi</span></span><span style="color: #800000">'</span>, echo=<span style="color: #000000">True)

Base </span>= declarative_base()   <span style="color: #008000">#</span><span style="color: #008000">创建一个SQLORM基类</span>


<span style="color: #008000">#</span><span style="color: #008000"> 多对多</span>
<span style="background-color: #ffff99"><span style="color: #0000ff">class</span> Group(Base):      <span style="color: #008000">#</span><span style="color: #008000">创建连接表</span>
    <span style="color: #800080">__tablename__</span> = <span style="color: #800000">'</span><span style="color: #800000; background-color: #ff99cc">group</span><span style="color: #800000">'</span> <span style="color: #008000">#</span><span style="color: #008000">表名称</span>
    id = Column(Integer, primary_key=True, autoincrement=True)  <span style="color: #008000">#</span><span style="color: #008000">主键，自增</span>
    name = Column(String(64), unique=True, nullable=False)      <span style="color: #008000">#</span><span style="color: #008000">唯一索引，不能为空</span>
    port = Column(Integer, default=22)                          <span style="color: #008000">#</span><span style="color: #008000">默认值22</span></span>


<span style="background-color: #ccffcc"><span style="color: #0000ff">class</span> Server(Base):     <span style="color: #008000">#</span><span style="color: #008000">创建连接表</span>
    <span style="color: #800080">__tablename__</span> = <span style="color: #800000">'</span><span style="color: #800000; background-color: #ff99cc">server</span><span style="color: #800000">'</span> <span style="color: #008000">#</span><span style="color: #008000">表名称</span>
<span style="color: #000000">
    id </span>= Column(Integer, primary_key=True, autoincrement=True) <span style="color: #008000">#</span><span style="color: #008000">主键，自增</span>
    hostname = Column(String(64), unique=True, nullable=False) <span style="color: #008000">#</span><span style="color: #008000">唯一索引，不能为空</span></span>


<span style="background-color: #ccffff"><span style="color: #0000ff">class</span> ServerToGroup(Base):  <span style="color: #008000">#</span><span style="color: #008000">创建关系表</span>
    <span style="color: #800080">__tablename__</span> = <span style="color: #800000">'</span><span style="color: #800000; background-color: #ff99cc">servertogroup</span><span style="color: #800000">'</span> <span style="color: #008000">#</span><span style="color: #008000">表名称</span>
    nid = Column(Integer, primary_key=True, autoincrement=True) <span style="color: #008000">#</span><span style="color: #008000">主键，自增</span>
    server_id = Column(Integer, ForeignKey(<span style="color: #800000">'</span><span style="color: #800000">server.id</span><span style="color: #800000">'</span>))        <span style="color: #008000">#</span><span style="color: #008000">外键server表的主键</span>
    group_id = Column(Integer, ForeignKey(<span style="color: #800000">'</span><span style="color: #800000">group.id</span><span style="color: #800000">'</span>))          <span style="color: #008000">#</span><span style="color: #008000">外键group表的主键</span></span>
<span style="color: #000000">

Base.metadata.create_all(engine)  </span><span style="color: #008000">#</span><span style="color: #008000">向数据库创建指定表</span></pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201706/955761-20170620010218116-1190908402.png" alt=""></p>
<p><span style="color: #ff0000"><strong>创建表字段属性【重点】</strong></span></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff">primary_key=True</span>主键索引</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">autoincrement=True</span>自增字段</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">index=True</span>给当前字段创建普通索引</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">unique=True</span>给当前字段创建唯一索引</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">UniqueConstraint('字段','字段',name='索引名称')</span>创建唯一组合索引</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">Index('索引名称','字段','字段')</span>创建普通组合索引</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">default='abc'</span>设置字段默认值，不怎么可靠</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">ForeignKey("连接表名称.连接表主键字段")</span>设置外键链表</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">nullable=False</span>类容不能为空</strong></span><br><span style="color: #ff0000"><strong>注：设置外检的另一种方式 <span style="color: #0000ff">ForeignKeyConstraint(['other_id'], ['othertable.other_id'])</span></strong></span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<hr>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>2、删除表</strong></span></p>
<p><span style="color: #ff0000"><strong>drop_all(SQLORM基类)向数据库删除指定表</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf-8 -*-</span>

<span style="color: #0000ff">import</span><span style="color: #000000"> sqlalchemy
</span><span style="color: #0000ff">from</span> sqlalchemy.ext.declarative <span style="color: #0000ff">import</span><span style="color: #000000"> declarative_base
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> Column, Integer, String, ForeignKey, UniqueConstraint, Index
</span><span style="color: #0000ff">from</span> sqlalchemy.orm <span style="color: #0000ff">import</span><span style="color: #000000"> sessionmaker, relationship
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> create_engine


</span><span style="color: #008000">#</span><span style="color: #008000">create_engine方法，创建数据库链接，</span><span style="color: #008000">
#</span><span style="color: #008000">create_engine方法参数('使用数据库+数据库链接模块://数据库用户名:密码@ip地址:端口/要连接的数据库名称',echo=True表示是否查看生成的sql语句)</span>
engine = create_engine(<span style="color: #800000">'</span><span style="color: #800000">mysql+pymysql://root:279819@127.0.0.1:3306/<span style="background-color: #ff99cc">cshi</span></span><span style="color: #800000">'</span>, echo=<span style="color: #000000">True)

Base </span>= declarative_base()   <span style="color: #008000">#</span><span style="color: #008000">创建一个SQLORM基类</span>

<span style="color: #0000ff">class</span> User(Base):           <span style="color: #008000">#</span><span style="color: #008000">自定义类，功能生成一张表，参数必须继承SQLORM基类</span>
    <span style="color: #800080">__tablename__</span> = <span style="background-color: #ff99cc"><span style="color: #800000">'</span><span style="color: #800000">jif</span><span style="color: #800000">'</span></span> <span style="color: #008000">#</span><span style="color: #008000">表名称</span>

    <span style="color: #008000">#</span><span style="color: #008000">创建字段</span>
    <span style="color: #008000">#</span><span style="color: #008000">字段名称 = Column(字段属性...)</span>
    id = Column(Integer, primary_key=True, autoincrement=<span style="color: #000000">True)
    name </span>= Column(String(40<span style="color: #000000">))
    fullname </span>= Column(String(40<span style="color: #000000">))
    password </span>= Column(String(40<span style="color: #000000">))


</span><span style="color: #008000">#</span><span style="color: #008000">Base.metadata.create_all(engine)  #向数据库创建指定表</span>
<span style="background-color: #ffff00">Base.metadata.drop_all(engine)</span>  <span style="color: #008000">#</span><span style="color: #008000">向数据库删除指定表</span></pre>
</div>
<p>&nbsp;</p>
<hr>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>3、向表添加<strong>一条</strong>数据</strong></span></p>
<p><span style="color: #ff0000"><strong>sessionmaker()创建sessionmaker类</strong></span><br><span style="color: #ff0000"><strong>add()将创建的数据添加到sessionmaker类</strong></span><br><span style="color: #ff0000"><strong>commit()向数据库提交写入添加到sessionmaker类的数据，<span style="color: #0000ff">注意:只要是向数据库添加或者删除都需要<strong>commit()提交</strong></span></strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf-8 -*-</span>

<span style="color: #0000ff">import</span><span style="color: #000000"> sqlalchemy
</span><span style="color: #0000ff">from</span> sqlalchemy.ext.declarative <span style="color: #0000ff">import</span><span style="color: #000000"> declarative_base
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> Column, Integer, String, ForeignKey, UniqueConstraint, Index
</span><span style="color: #0000ff">from</span> sqlalchemy.orm <span style="color: #0000ff">import</span><span style="color: #000000"> sessionmaker, relationship
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> create_engine


</span><span style="color: #008000">#</span><span style="color: #008000">create_engine方法，创建数据库链接，</span><span style="color: #008000">
#</span><span style="color: #008000">create_engine方法参数('使用数据库+数据库链接模块://数据库用户名:密码@ip地址:端口/要连接的数据库名称',echo=True表示是否查看生成的sql语句)</span>
engine = create_engine(<span style="color: #800000">'</span><span style="color: #800000">mysql+pymysql://root:279819@127.0.0.1:3306/<span style="background-color: #ff99cc">cshi</span></span><span style="color: #800000">'</span>, echo=<span style="color: #000000">True)

Base </span>= declarative_base()   <span style="color: #008000">#</span><span style="color: #008000">创建一个SQLORM基类</span>

<span style="color: #0000ff">class</span> User(Base):           <span style="color: #008000">#</span><span style="color: #008000">自定义类，功能生成一张表，参数必须继承SQLORM基类</span>
    <span style="color: #800080">__tablename__</span> = <span style="color: #800000">'</span><span style="background-color: #ff99cc"><span style="color: #800000">users</span><span style="color: #800000">'</span></span> <span style="color: #008000">#</span><span style="color: #008000">表名称</span>

    <span style="color: #008000">#</span><span style="color: #008000">创建字段</span>
    <span style="color: #008000">#</span><span style="color: #008000">字段名称 = Column(字段属性...)</span>
    id = Column(Integer, primary_key=True, autoincrement=<span style="color: #000000">True)
    name </span>= Column(String(40<span style="color: #000000">))
    fullname </span>= Column(String(40<span style="color: #000000">))
    password </span>= Column(String(40<span style="color: #000000">))

Base.metadata.create_all(engine)  </span><span style="color: #008000">#</span><span style="color: #008000">向数据库创建指定表，如果表存在忽略创建</span>
<span style="background-color: #ffff99"><span style="color: #000000">
ed_user </span>= User(name=<span style="color: #800000">'</span><span style="color: #800000">xiaoyu</span><span style="color: #800000">'</span>, fullname=<span style="color: #800000">'</span><span style="color: #800000">Xiaoyu Liu</span><span style="color: #800000">'</span>, password=<span style="color: #800000">'</span><span style="color: #800000">123</span><span style="color: #800000">'</span>)</span> <span style="color: #008000">#</span><span style="color: #008000">执行自定义类，创建一行数据</span>

<span style="color: #008000">#</span><span style="color: #008000">创建sessionmaker类，sessionmaker(bind=数据库链接变量)</span>
<span style="background-color: #ffff99">MySession = sessionmaker(bind=<span style="color: #000000">engine)
session </span>= MySession()   <span style="color: #008000">#</span><span style="color: #008000">执行sessionmaker类</span>
session.add(ed_user)    <span style="color: #008000">#</span><span style="color: #008000">执行sessionmaker类下的add方法，add(创建数据变量)，将创建的数据添加到sessionmaker类</span>
<span style="color: #000000">
session.commit()        </span><span style="color: #008000">#</span><span style="color: #008000">向数据库提交数据</span></span></pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201706/955761-20170619203455585-1655573434.png" alt=""></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>4、向表添加<strong>多条</strong>数据</strong></span></p>
<p><span style="color: #ff0000; background-color: #ffffff"><strong>add_all()添加多条数据，参数是一个列表，列表元素是自定义类创建数据</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf-8 -*-</span>

<span style="color: #0000ff">import</span><span style="color: #000000"> sqlalchemy
</span><span style="color: #0000ff">from</span> sqlalchemy.ext.declarative <span style="color: #0000ff">import</span><span style="color: #000000"> declarative_base
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> Column, Integer, String, ForeignKey, UniqueConstraint, Index
</span><span style="color: #0000ff">from</span> sqlalchemy.orm <span style="color: #0000ff">import</span><span style="color: #000000"> sessionmaker, relationship
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> create_engine


</span><span style="color: #008000">#</span><span style="color: #008000">create_engine方法，创建数据库链接，</span><span style="color: #008000">
#</span><span style="color: #008000">create_engine方法参数('使用数据库+数据库链接模块://数据库用户名:密码@ip地址:端口/要连接的数据库名称',echo=True表示是否查看生成的sql语句)</span>
engine = create_engine(<span style="color: #800000">'</span><span style="color: #800000">mysql+pymysql://root:279819@127.0.0.1:3306/<span style="background-color: #ff99cc">cshi</span></span><span style="color: #800000">'</span>, echo=<span style="color: #000000">True)

Base </span>= declarative_base()   <span style="color: #008000">#</span><span style="color: #008000">创建一个SQLORM基类</span>

<span style="color: #0000ff">class</span> User(Base):           <span style="color: #008000">#</span><span style="color: #008000">自定义类，功能生成一张表，参数必须继承SQLORM基类</span>
    <span style="color: #800080">__tablename__</span> = <span style="color: #800000">'</span><span style="color: #800000; background-color: #ff99cc">users</span><span style="color: #800000">'</span> <span style="color: #008000">#</span><span style="color: #008000">表名称</span>

    <span style="color: #008000">#</span><span style="color: #008000">创建字段</span>
    <span style="color: #008000">#</span><span style="color: #008000">字段名称 = Column(字段属性...)</span>
    id = Column(Integer, primary_key=True, autoincrement=<span style="color: #000000">True)
    name </span>= Column(String(40<span style="color: #000000">))
    fullname </span>= Column(String(40<span style="color: #000000">))
    password </span>= Column(String(40<span style="color: #000000">))

Base.metadata.create_all(engine)  </span><span style="color: #008000">#</span><span style="color: #008000">向数据库创建指定表，如果表存在忽略创建</span>



<span style="color: #008000">#</span><span style="color: #008000">创建sessionmaker类，sessionmaker(bind=数据库链接变量)</span>
MySession = sessionmaker(bind=<span style="color: #000000">engine)
session </span>= MySession()   <span style="color: #008000">#</span><span style="color: #008000">执行sessionmaker类</span>
<span style="background-color: #ff99cc"><span style="color: #000000">
session.add_all([
    User(name</span>=<span style="color: #800000">'</span><span style="color: #800000">alex</span><span style="color: #800000">'</span>, fullname=<span style="color: #800000">'</span><span style="color: #800000">Alex Li</span><span style="color: #800000">'</span>, password=<span style="color: #800000">'</span><span style="color: #800000">456</span><span style="color: #800000">'</span><span style="color: #000000">),
    User(name</span>=<span style="color: #800000">'</span><span style="color: #800000">alex</span><span style="color: #800000">'</span>, fullname=<span style="color: #800000">'</span><span style="color: #800000">Alex old</span><span style="color: #800000">'</span>, password=<span style="color: #800000">'</span><span style="color: #800000">789</span><span style="color: #800000">'</span><span style="color: #000000">),
    User(name</span>=<span style="color: #800000">'</span><span style="color: #800000">peiqi</span><span style="color: #800000">'</span>, fullname=<span style="color: #800000">'</span><span style="color: #800000">Peiqi Wu</span><span style="color: #800000">'</span>, password=<span style="color: #800000">'</span><span style="color: #800000">sxsxsx</span><span style="color: #800000">'</span></span><span style="color: #000000"><span style="background-color: #ff99cc">)])
</span>

<span style="background-color: #ff99cc">session.commit()        </span></span><span style="background-color: #ff99cc"><span style="color: #008000">#</span><span style="color: #008000">向数据库提交数据</span></span></pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201706/955761-20170619203359960-2124181906.png" alt=""></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>向外键表添加数据并且设置外键值</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf-8 -*-</span>

<span style="color: #0000ff">import</span><span style="color: #000000"> sqlalchemy
</span><span style="color: #0000ff">from</span> sqlalchemy.ext.declarative <span style="color: #0000ff">import</span><span style="color: #000000"> declarative_base
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> Column, Integer, String, ForeignKey, UniqueConstraint, Index
</span><span style="color: #0000ff">from</span> sqlalchemy.orm <span style="color: #0000ff">import</span><span style="color: #000000"> sessionmaker, relationship
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> create_engine


</span><span style="color: #008000">#</span><span style="color: #008000">create_engine方法，创建数据库链接，</span><span style="color: #008000">
#</span><span style="color: #008000">create_engine方法参数('使用数据库+数据库链接模块://数据库用户名:密码@ip地址:端口/要连接的数据库名称',echo=True表示是否查看生成的sql语句)</span>
engine = create_engine(<span style="color: #800000">'</span><span style="color: #800000">mysql+pymysql://root:279819@127.0.0.1:3306/<span style="background-color: #ff99cc">cshi</span>?charset=utf8</span><span style="color: #800000">'</span><span style="color: #000000">)

Base </span>= declarative_base()   <span style="color: #008000">#</span><span style="color: #008000">创建一个SQLORM基类</span>

<span style="color: #0000ff">class</span> Favor(Base):          <span style="color: #008000">#</span><span style="color: #008000">创建连接表，自定义类，功能生成一张表，参数必须继承SQLORM基类</span>
    <span style="color: #800080">__tablename__</span> = <span style="color: #800000">'</span><span style="color: #800000; background-color: #ff99cc">favor</span><span style="color: #800000">'</span> <span style="color: #008000">#</span><span style="color: #008000">表名称</span>
    id = Column(Integer, primary_key=True, autoincrement=True)  <span style="color: #008000">#</span><span style="color: #008000">设置主键，自增</span>
    caption = Column(String(50), default=<span style="color: #800000">'</span><span style="color: #800000">red</span><span style="color: #800000">'</span>, unique=True)    <span style="color: #008000">#</span><span style="color: #008000">设置字段默认值，设置字段唯一索引</span>

<span style="color: #0000ff">class</span> User(Base):           <span style="color: #008000">#</span><span style="color: #008000">创建外键表，自定义类，功能生成一张表，参数必须继承SQLORM基类</span>
    <span style="color: #800080">__tablename__</span> = <span style="color: #800000">'</span><span style="color: #800000; background-color: #ff99cc">users</span><span style="color: #800000">'</span> <span style="color: #008000">#</span><span style="color: #008000">表名称</span>

    <span style="color: #008000">#</span><span style="color: #008000">创建字段</span>
    <span style="color: #008000">#</span><span style="color: #008000">字段名称 = Column(字段属性...)</span>
    id = Column(Integer, primary_key=True, autoincrement=True)  <span style="color: #008000">#</span><span style="color: #008000">设置主键，自增</span>
    name = Column(String(40<span style="color: #000000">))
    password </span>= Column(String(40<span style="color: #000000">))
    fullname </span>= Column(Integer,ForeignKey(<span style="color: #800000">"</span><span style="color: #800000">favor.id</span><span style="color: #800000">"</span>))           <span style="color: #008000">#</span><span style="color: #008000">ForeignKey("连接表名称.连接表主键字段")外键链表一对多</span>
<span style="color: #000000">

Base.metadata.create_all(engine)  </span><span style="color: #008000">#</span><span style="color: #008000">向数据库创建指定表</span>

<span style="color: #008000">#</span><span style="color: #008000">创建sessionmaker类，sessionmaker(bind=数据库链接变量)</span>
MySession = sessionmaker(bind=<span style="color: #000000">engine)
session </span>= MySession()   <span style="color: #008000">#</span><span style="color: #008000">执行sessionmaker类</span>
<span style="background-color: #ffff99"><span style="color: #000000">
session.add_all([
    User(name</span>=<span style="color: #800000">'</span><span style="color: #800000">林贵秀1</span><span style="color: #800000">'</span>,password=<span style="color: #800000">'</span><span style="color: #800000">123456</span><span style="color: #800000">'</span>,<span style="background-color: #ff99cc">fullname=1</span>), <span style="color: #008000">#</span><span style="color: #008000">fullname=1添加数据设置外键字段值为连接表的主键id</span>
    User(name=<span style="color: #800000">'</span><span style="color: #800000">林贵秀2</span><span style="color: #800000">'</span>,password=<span style="color: #800000">'</span><span style="color: #800000">123456</span><span style="color: #800000">'</span>,<span style="background-color: #ff99cc">fullname=2</span>), <span style="color: #008000">#</span><span style="color: #008000">fullname=1添加数据设置外键字段值为连接表的主键id</span>
    User(name=<span style="color: #800000">'</span><span style="color: #800000">林贵秀3</span><span style="color: #800000">'</span>,password=<span style="color: #800000">'</span><span style="color: #800000">123456</span><span style="color: #800000">'</span>,<span style="background-color: #ff99cc">fullname=3</span>)  <span style="color: #008000">#</span><span style="color: #008000">fullname=1添加数据设置外键字段值为连接表的主键id</span>
</span><span style="color: #000000"><span style="background-color: #ffff99">])</span>


session.commit()        </span><span style="color: #008000">#</span><span style="color: #008000">向数据库提交数据</span></pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201706/955761-20170620164126070-524173165.png" alt=""></p>
<p>&nbsp;</p>
<hr>
<p><span style="color: #ff0000"><strong>&nbsp;5、删除数据</strong></span></p>
<p><span style="color: #ff0000"><strong>delete()删除指定表数据</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf-8 -*-</span>

<span style="color: #0000ff">import</span><span style="color: #000000"> sqlalchemy
</span><span style="color: #0000ff">from</span> sqlalchemy.ext.declarative <span style="color: #0000ff">import</span><span style="color: #000000"> declarative_base
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> Column, Integer, String, ForeignKey, UniqueConstraint, Index
</span><span style="color: #0000ff">from</span> sqlalchemy.orm <span style="color: #0000ff">import</span><span style="color: #000000"> sessionmaker, relationship
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> create_engine


</span><span style="color: #008000">#</span><span style="color: #008000">create_engine方法，创建数据库链接，</span><span style="color: #008000">
#</span><span style="color: #008000">create_engine方法参数('使用数据库+数据库链接模块://数据库用户名:密码@ip地址:端口/要连接的数据库名称',echo=True表示是否查看生成的sql语句)</span>
engine = create_engine(<span style="color: #800000">'</span><span style="color: #800000">mysql+pymysql://root:279819@127.0.0.1:3306/<span style="background-color: #ff99cc">cshi</span>?charset=utf8</span><span style="color: #800000">'</span><span style="color: #000000">)

Base </span>= declarative_base()   <span style="color: #008000">#</span><span style="color: #008000">创建一个SQLORM基类</span>

<span style="color: #0000ff">class</span> Favor(Base):          <span style="color: #008000">#</span><span style="color: #008000">创建连接表，自定义类，功能生成一张表，参数必须继承SQLORM基类</span>
    <span style="color: #800080">__tablename__</span> = <span style="color: #800000">'</span><span style="color: #800000; background-color: #ff99cc">favor</span><span style="color: #800000">'</span> <span style="color: #008000">#</span><span style="color: #008000">表名称</span>
    id = Column(Integer, primary_key=True, autoincrement=True)  <span style="color: #008000">#</span><span style="color: #008000">设置主键，自增</span>
    caption = Column(String(50), default=<span style="color: #800000">'</span><span style="color: #800000">red</span><span style="color: #800000">'</span>, unique=True)    <span style="color: #008000">#</span><span style="color: #008000">设置字段默认值，设置字段唯一索引</span>

<span style="color: #0000ff">class</span> User(Base):           <span style="color: #008000">#</span><span style="color: #008000">创建外键表，自定义类，功能生成一张表，参数必须继承SQLORM基类</span>
    <span style="color: #800080">__tablename__</span> = <span style="color: #800000">'</span><span style="color: #800000; background-color: #ff99cc">users</span><span style="color: #800000">'</span> <span style="color: #008000">#</span><span style="color: #008000">表名称</span>

    <span style="color: #008000">#</span><span style="color: #008000">创建字段</span>
    <span style="color: #008000">#</span><span style="color: #008000">字段名称 = Column(字段属性...)</span>
    id = Column(Integer, primary_key=True, autoincrement=True)  <span style="color: #008000">#</span><span style="color: #008000">设置主键，自增</span>
    name = Column(String(40<span style="color: #000000">))
    password </span>= Column(String(40<span style="color: #000000">))
    fullname </span>= Column(Integer,ForeignKey(<span style="color: #800000">"</span><span style="color: #800000">favor.id</span><span style="color: #800000">"</span>))           <span style="color: #008000">#</span><span style="color: #008000">ForeignKey("连接表名称.连接表主键字段")外键链表一对多</span>
<span style="color: #000000">

Base.metadata.create_all(engine)  </span><span style="color: #008000">#</span><span style="color: #008000">向数据库创建指定表</span>

<span style="color: #008000">#</span><span style="color: #008000">创建sessionmaker类，sessionmaker(bind=数据库链接变量)</span>
MySession = sessionmaker(bind=<span style="color: #000000">engine)
session </span>= MySession()   <span style="color: #008000">#</span><span style="color: #008000">执行sessionmaker类</span>
<span style="background-color: #ffff99"><span style="color: #000000">
session.query(User).filter(User.id </span>&gt; 2).delete()  <span style="color: #008000">#</span><span style="color: #008000">删除User类对应表的id大于2的数据</span></span>
<span style="color: #000000">

session.commit()        </span><span style="color: #008000">#</span><span style="color: #008000">向数据库提交数据</span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<hr>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>6、修改数据</strong></span></p>
<p><span style="color: #ff0000"><strong>synchronize_session参数详解</strong></span><br><span style="color: #ff0000"><strong>synchronize_session用于query<span style="color: #0000ff">在进行删除或者修改数据操作时，对session的同步策略。</span></strong></span></p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff">False</span> - 不对session进行同步，直接进行<strong>删除或者修改</strong>操作。</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">'fetch'</span> - 在删除或者修改数据操作之前，先发一条sql到数据库获取符合条件的记录。</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">'evaluate'</span> - 在删除或者修改数据操作之前，用query中的条件直接对session的identity_map中的objects进行eval操作，将符合条件的记录下来。</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf-8 -*-</span>

<span style="color: #0000ff">import</span><span style="color: #000000"> sqlalchemy
</span><span style="color: #0000ff">from</span> sqlalchemy.ext.declarative <span style="color: #0000ff">import</span><span style="color: #000000"> declarative_base
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> Column, Integer, String, ForeignKey, UniqueConstraint, Index
</span><span style="color: #0000ff">from</span> sqlalchemy.orm <span style="color: #0000ff">import</span><span style="color: #000000"> sessionmaker, relationship
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> create_engine


</span><span style="color: #008000">#</span><span style="color: #008000">create_engine方法，创建数据库链接，</span><span style="color: #008000">
#</span><span style="color: #008000">create_engine方法参数('使用数据库+数据库链接模块://数据库用户名:密码@ip地址:端口/要连接的数据库名称',echo=True表示是否查看生成的sql语句)</span>
engine = create_engine(<span style="color: #800000">'</span><span style="color: #800000">mysql+pymysql://root:279819@127.0.0.1:3306/<span style="background-color: #ff99cc">cshi</span>?charset=utf8</span><span style="color: #800000">'</span><span style="color: #000000">)

Base </span>= declarative_base()   <span style="color: #008000">#</span><span style="color: #008000">创建一个SQLORM基类</span>

<span style="color: #0000ff">class</span> Favor(Base):          <span style="color: #008000">#</span><span style="color: #008000">创建连接表，自定义类，功能生成一张表，参数必须继承SQLORM基类</span>
    <span style="color: #800080">__tablename__</span> = <span style="color: #800000">'</span><span style="color: #800000; background-color: #ff99cc">favor</span><span style="color: #800000">'</span> <span style="color: #008000">#</span><span style="color: #008000">表名称</span>
    id = Column(Integer, primary_key=True, autoincrement=True)  <span style="color: #008000">#</span><span style="color: #008000">设置主键，自增</span>
    caption = Column(String(50), default=<span style="color: #800000">'</span><span style="color: #800000">red</span><span style="color: #800000">'</span>, unique=True)    <span style="color: #008000">#</span><span style="color: #008000">设置字段默认值，设置字段唯一索引</span>

<span style="color: #0000ff">class</span> User(Base):           <span style="color: #008000">#</span><span style="color: #008000">创建外键表，自定义类，功能生成一张表，参数必须继承SQLORM基类</span>
    <span style="color: #800080">__tablename__</span> = <span style="color: #800000">'</span><span style="color: #800000; background-color: #ff99cc">users</span><span style="color: #800000">'</span> <span style="color: #008000">#</span><span style="color: #008000">表名称</span>

    <span style="color: #008000">#</span><span style="color: #008000">创建字段</span>
    <span style="color: #008000">#</span><span style="color: #008000">字段名称 = Column(字段属性...)</span>
    id = Column(Integer, primary_key=True, autoincrement=True)  <span style="color: #008000">#</span><span style="color: #008000">设置主键，自增</span>
    name = Column(String(40<span style="color: #000000">))
    password </span>= Column(String(40<span style="color: #000000">))
    fullname </span>= Column(Integer,ForeignKey(<span style="color: #800000">"</span><span style="color: #800000">favor.id</span><span style="color: #800000">"</span>))           <span style="color: #008000">#</span><span style="color: #008000">ForeignKey("连接表名称.连接表主键字段")外键链表一对多</span>
    shu =<span style="color: #000000"> Column(Integer)


Base.metadata.create_all(engine)  </span><span style="color: #008000">#</span><span style="color: #008000">向数据库创建指定表</span>

<span style="color: #008000">#</span><span style="color: #008000">创建sessionmaker类，sessionmaker(bind=数据库链接变量)</span>
MySession = sessionmaker(bind=<span style="color: #000000">engine)
session </span>= MySession()   <span style="color: #008000">#</span><span style="color: #008000">执行sessionmaker类</span>
<span style="background-color: #ffff99"><span style="color: #000000">
session.query(User).filter(User.id </span>== 2).update({<span style="color: #800000">"</span><span style="color: #800000">name</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">099</span><span style="color: #800000">"</span>})   <span style="color: #008000">#</span><span style="color: #008000">将User类对应的表里id等于2的数据，name字段的值修改为"099"</span>
session.query(User).filter(User.id == 13).update({User.name: User.name + <span style="color: #800000">"</span><span style="color: #800000">,会员</span><span style="color: #800000">"</span>}, synchronize_session=False) <span style="color: #008000">#</span><span style="color: #008000">在原有值后面追加值，不对session进行同步</span>
session.query(User).filter(User.id == 19).update({<span style="color: #800000">"</span><span style="color: #800000">name</span><span style="color: #800000">"</span>: User.name + 1}, synchronize_session=<span style="color: #800000">"</span><span style="color: #800000">evaluate</span><span style="color: #800000">"</span>)  <span style="color: #008000">#</span><span style="color: #008000">将指定字段的值加1，注意：字段必须为数字类型</span></span>
<span style="color: #000000">

session.commit()        </span><span style="color: #008000">#</span><span style="color: #008000">向数据库提交数据</span></pre>
</div>
<p>&nbsp;</p>
<hr>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>7、查询</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf-8 -*-</span>

<span style="color: #0000ff">import</span><span style="color: #000000"> sqlalchemy
</span><span style="color: #0000ff">from</span> sqlalchemy.ext.declarative <span style="color: #0000ff">import</span><span style="color: #000000"> declarative_base
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> Column, Integer, String, ForeignKey, UniqueConstraint, Index
</span><span style="color: #0000ff">from</span> sqlalchemy.orm <span style="color: #0000ff">import</span><span style="color: #000000"> sessionmaker, relationship
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> create_engine

</span><span style="color: #008000">#</span><span style="color: #008000">create_engine方法，创建数据库链接，</span><span style="color: #008000">
#</span><span style="color: #008000">create_engine方法参数('使用数据库+数据库链接模块://数据库用户名:密码@ip地址:端口/要连接的数据库名称',echo=True表示是否查看生成的sql语句)</span>
engine = create_engine(<span style="color: #800000">'</span><span style="color: #800000">mysql+pymysql://root:279819@127.0.0.1:3306/cshi</span><span style="color: #800000">'</span><span style="color: #000000">)

Base </span>= declarative_base()   <span style="color: #008000">#</span><span style="color: #008000">创建一个SQLORM基类</span>

<span style="color: #0000ff">class</span> User(Base):           <span style="color: #008000">#</span><span style="color: #008000">自定义类，功能生成一张表，参数必须继承SQLORM基类</span>
    <span style="color: #800080">__tablename__</span> = <span style="color: #800000">'</span><span style="color: #800000">users</span><span style="color: #800000">'</span> <span style="color: #008000">#</span><span style="color: #008000">表名称</span>

    <span style="color: #008000">#</span><span style="color: #008000">创建字段</span>
    <span style="color: #008000">#</span><span style="color: #008000">字段名称 = Column(字段属性...)</span>
    id = Column(Integer, primary_key=True, autoincrement=<span style="color: #000000">True)
    name </span>= Column(String(40<span style="color: #000000">))
    fullname </span>= Column(String(40<span style="color: #000000">))
    password </span>= Column(String(40<span style="color: #000000">))


Base.metadata.create_all(engine)  </span><span style="color: #008000">#</span><span style="color: #008000">向数据库创建指定表，如果表存在忽略创建</span>

<span style="color: #008000">#</span><span style="color: #008000">创建sessionmaker类，sessionmaker(bind=数据库链接变量)</span>
MySession = sessionmaker(bind=<span style="color: #000000">engine)
session </span>= MySession()   <span style="color: #008000">#</span><span style="color: #008000">执行sessionmaker类</span>

<span style="background-color: #ffff00"><span style="color: #0000ff">print</span>(session.query(User))          <span style="color: #008000">#</span><span style="color: #008000">session.query(操作表类名称)，执行对指定表的查询语句，得到表的所有字段集合</span>
<span style="color: #0000ff">print</span>(session.query(User).all())    <span style="color: #008000">#</span><span style="color: #008000">session.query(操作表类名称).all(),得到列表形式表的所有字段集合对象</span>
<span style="color: #0000ff">print</span>(session.query(User.id, User.name, User.fullname, User.password).all())  <span style="color: #008000">#</span><span style="color: #008000">查询指定表里的指定字段</span>
<span style="color: #0000ff">print</span>(session.query(User.id, User.name, User.fullname, User.password).order_by(User.id.desc()).all())  <span style="color: #008000">#</span><span style="color: #008000">查询指定表里的指定字段，以id排序desc()降序，asc()升序</span>
<span style="color: #0000ff">for</span> row <span style="color: #0000ff">in</span> session.query(User).order_by(User.id.desc()):  <span style="color: #008000">#</span><span style="color: #008000">以id排序desc()降序循环表里的内容</span>
    <span style="color: #0000ff">print</span>(row.id, row.name, row.fullname, row.password)</span></pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201706/955761-20170620140435913-1780987930.png" alt=""></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>&nbsp;__repr__将表返回对象的数据转化为解释器可读取的数据，默认返回的数据对象</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">class</span> UserInfo(Base):                                               <span style="color: #008000">#</span><span style="color: #008000">定义一个类操作数据库userinfo表</span>
    <span style="color: #800080">__tablename__</span> = <span style="color: #800000">'</span><span style="color: #800000">userinfo</span><span style="color: #800000">'</span><span style="color: #000000">

    nid </span>= Column(Integer, primary_key=True, autoincrement=<span style="color: #000000">True)
    username </span>= Column(String(32<span style="color: #000000">))
    password </span>= Column(String(32<span style="color: #000000">))
    email </span>= Column(String(32<span style="color: #000000">))
    ctime </span>=<span style="color: #000000"> Column(TIMESTAMP)

    </span><span style="color: #800080">__table_args__</span> = (                                              <span style="color: #008000">#</span><span style="color: #008000">创建索引</span>
        Index(<span style="color: #800000">'</span><span style="color: #800000">ix_user_pwd</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">username</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">password</span><span style="color: #800000">'</span>),               <span style="color: #008000">#</span><span style="color: #008000">创建普通组合索引</span>
        Index(<span style="color: #800000">'</span><span style="color: #800000">ix_email_pwd</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">email</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">password</span><span style="color: #800000">'</span>),                 <span style="color: #008000">#</span><span style="color: #008000">创建普通组合索引</span>
<span style="color: #000000">    )

    </span><span style="color: #0000ff">def</span> <span style="color: #800080; background-color: #ffff99">__repr__</span>(self):                                             <span style="color: #008000">#</span><span style="color: #008000">将表返回的数据转化为解释器可读取的数据，默认返回的数据对象</span>
        <span style="color: #0000ff">return</span> <span style="color: #800000">"</span><span style="color: #800000">%s-%s-%s</span><span style="color: #800000">"</span> %(self.nid, self.username, self.email)    <span style="color: #008000">#</span><span style="color: #008000">转换的字段字符串格式化</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>relationship()表关联</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">class</span> News(Base):                                                   <span style="color: #008000">#</span><span style="color: #008000">定义一个类操作数据库news表</span>

    <span style="color: #800080">__tablename__</span> = <span style="color: #800000">'</span><span style="color: #800000">news</span><span style="color: #800000">'</span><span style="color: #000000">

    nid </span>= Column(Integer, primary_key=True, autoincrement=<span style="color: #000000">True)
    user_info_id </span>= Column(Integer, ForeignKey(<span style="color: #800000">"</span><span style="color: #800000">userinfo.nid</span><span style="color: #800000">"</span><span style="color: #000000">))
    news_type_id </span>= Column(Integer, ForeignKey(<span style="color: #800000">"</span><span style="color: #800000">newstype.nid</span><span style="color: #800000">"</span><span style="color: #000000">))
    ctime </span>=<span style="color: #000000"> Column(TIMESTAMP)
    title </span>= Column(String(32<span style="color: #000000">))
    url </span>= Column(String(128<span style="color: #000000">))
    content </span>= Column(String(150<span style="color: #000000">))
    favor_count </span>= Column(Integer, default=<span style="color: #000000">0)

    comment_count </span>= Column(Integer, default=<span style="color: #000000">0)

    </span><span style="color: #008000">#</span><span style="color: #008000">#与生成表结构无关，仅用于查询方便</span>
    f = <span style="background-color: #ffff99">relationship(<span style="color: #800000">'</span><span style="color: #800000">Favor</span><span style="color: #800000">'</span>,backref=<span style="color: #800000">'</span><span style="color: #800000">n</span><span style="color: #800000">'</span>)</span>                           <span style="color: #008000">#</span><span style="color: #008000">表示在Favor建一个n字段关联news表的id</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>查询说明</strong></span></p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff">query(要取的字段)</span>查询数据库数据</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">all()</span>显示数据，返回列表加元祖，查询多条数据使用</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">first()</span>显示数据，返回元祖，查询一条数据使用</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">filter(多条件)</span>过滤数据</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">filter_by(a=xxx)</span>过滤数据，只能使用条件等于</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">from_statement(sql语句)</span>过滤数据</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">order_by(排序字段.desc())</span>排序，desc()降序，asc()升序</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf-8 -*-</span>

<span style="color: #0000ff">import</span><span style="color: #000000"> sqlalchemy
</span><span style="color: #0000ff">from</span> sqlalchemy.ext.declarative <span style="color: #0000ff">import</span><span style="color: #000000"> declarative_base
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> Column, Integer, String, ForeignKey, UniqueConstraint, Index,text
</span><span style="color: #0000ff">from</span> sqlalchemy.orm <span style="color: #0000ff">import</span><span style="color: #000000"> sessionmaker, relationship
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> create_engine


</span><span style="color: #008000">#</span><span style="color: #008000">create_engine方法，创建数据库链接，</span><span style="color: #008000">
#</span><span style="color: #008000">create_engine方法参数('使用数据库+数据库链接模块://数据库用户名:密码@ip地址:端口/要连接的数据库名称',echo=True表示是否查看生成的sql语句)</span>
engine = create_engine(<span style="color: #800000">'</span><span style="color: #800000">mysql+pymysql://root:279819@127.0.0.1:3306/<span style="background-color: #ff99cc">cshi</span>?charset=utf8</span><span style="color: #800000">'</span>,echo=<span style="color: #000000">True)

Base </span>= declarative_base()   <span style="color: #008000">#</span><span style="color: #008000">创建一个SQLORM基类</span>

<span style="color: #0000ff">class</span> Favor(Base):          <span style="color: #008000">#</span><span style="color: #008000">创建连接表，自定义类，功能生成一张表，参数必须继承SQLORM基类</span>
    <span style="color: #800080">__tablename__</span> = <span style="color: #800000">'</span><span style="color: #800000">favor</span><span style="color: #800000">'</span> <span style="color: #008000">#</span><span style="color: #008000">表名称</span>
    id = Column(Integer, primary_key=True, autoincrement=True)  <span style="color: #008000">#</span><span style="color: #008000">设置主键，自增</span>
    caption = Column(String(50), default=<span style="color: #800000">'</span><span style="color: #800000">red</span><span style="color: #800000">'</span>, unique=True)    <span style="color: #008000">#</span><span style="color: #008000">设置字段默认值，设置字段唯一索引</span>

<span style="color: #0000ff">class</span> User(Base):           <span style="color: #008000">#</span><span style="color: #008000">创建外键表，自定义类，功能生成一张表，参数必须继承SQLORM基类</span>
    <span style="color: #800080">__tablename__</span> = <span style="color: #800000">'</span><span style="color: #800000; background-color: #ff99cc">users</span><span style="color: #800000">'</span> <span style="color: #008000">#</span><span style="color: #008000">表名称</span>

    <span style="color: #008000">#</span><span style="color: #008000">创建字段</span>
    <span style="color: #008000">#</span><span style="color: #008000">字段名称 = Column(字段属性...)</span>
    id = Column(Integer, primary_key=True, autoincrement=True)  <span style="color: #008000">#</span><span style="color: #008000">设置主键，自增</span>
    name = Column(String(40<span style="color: #000000">))
    password </span>= Column(String(40<span style="color: #000000">))
    fullname </span>= Column(Integer,ForeignKey(<span style="color: #800000">"</span><span style="color: #800000">favor.id</span><span style="color: #800000">"</span>))           <span style="color: #008000">#</span><span style="color: #008000">ForeignKey("连接表名称.连接表主键字段")外键链表一对多</span>
<span style="color: #000000">

Base.metadata.create_all(engine)  </span><span style="color: #008000">#</span><span style="color: #008000">向数据库创建指定表</span>

<span style="color: #008000">#</span><span style="color: #008000">创建sessionmaker类，sessionmaker(bind=数据库链接变量)</span>
MySession = sessionmaker(bind=<span style="color: #000000">engine)
session </span>= MySession()   <span style="color: #008000">#</span><span style="color: #008000">执行sessionmaker类</span>
<span style="background-color: #ffff99"><span style="color: #000000">

ret </span>= session.<span style="background-color: #ff99cc">query</span>(User.id,User.name, User.password,User.fullname).<span style="background-color: #ff99cc">all()</span>  <span style="color: #008000">#</span><span style="color: #008000">指定表里的所有字段</span>
<span style="color: #0000ff">print</span><span style="color: #000000">(ret)

ret </span>= session.query(User.id,User.name, User.password,User.fullname).<span style="background-color: #ff99cc">filter_by</span>(id = 13).all()  <span style="color: #008000">#</span><span style="color: #008000">查询表里的id字段等于指定值的数据,返回列表加元祖</span>
<span style="color: #0000ff">print</span><span style="color: #000000">(ret)

ret </span>= session.query(User.id,User.name, User.password,User.fullname).filter_by(id=15).<span style="background-color: #ff99cc">first()</span>  <span style="color: #008000">#</span><span style="color: #008000">查询表里的id字段等于指定值的数据，返回元祖</span>
<span style="color: #0000ff">print</span><span style="color: #000000">(ret)

ret </span>= session.query(User.id,User.name, User.password,User.fullname).<span style="background-color: #ff99cc">filter</span>(User.id &gt; 15).<span style="background-color: #ff99cc">order_by</span>(User.id.desc()).all()  <span style="color: #008000">#</span><span style="color: #008000">查找表里id大于15的数据，以id排序desc()降序</span>
<span style="color: #0000ff">print</span><span style="color: #000000">(ret)


ret </span>= session.query(User.id,User.name, User.password,User.fullname).<span style="background-color: #ff99cc">from_statement</span>(text(<span style="color: #800000">"</span><span style="color: #800000">SELECT * FROM users where name = '林贵秀2'</span><span style="color: #800000">"</span>)).all() <span style="color: #008000">#</span><span style="color: #008000">查询表里ame = '林贵秀2'的数据</span>
<span style="color: #0000ff">print</span>(ret)</span></pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201706/955761-20170620193901585-472104256.png" alt=""></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>查询条件</strong></span></p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff">between(1, 16)</span>之间</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">in_([1,3,4])</span>里为1,3,4的</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">~</span>取反，非的意思</strong></span></p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff">from sqlalchemy import and_, or_</span> &nbsp;#注意：在条件里如果要使用and_(并且)，or_(或者),必须先引入这两个方法</strong></span></p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff">and_</span>(并且)，</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">or_</span>(或者)</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf-8 -*-</span>

<span style="color: #0000ff">import</span><span style="color: #000000"> sqlalchemy
</span><span style="color: #0000ff">from</span> sqlalchemy.ext.declarative <span style="color: #0000ff">import</span><span style="color: #000000"> declarative_base
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> Column, Integer, String, ForeignKey, UniqueConstraint, Index,text
</span><span style="color: #0000ff">from</span> sqlalchemy.orm <span style="color: #0000ff">import</span><span style="color: #000000"> sessionmaker, relationship
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> create_engine


</span><span style="color: #008000">#</span><span style="color: #008000">create_engine方法，创建数据库链接，</span><span style="color: #008000">
#</span><span style="color: #008000">create_engine方法参数('使用数据库+数据库链接模块://数据库用户名:密码@ip地址:端口/要连接的数据库名称',echo=True表示是否查看生成的sql语句)</span>
engine = create_engine(<span style="color: #800000">'</span><span style="color: #800000">mysql+pymysql://root:279819@127.0.0.1:3306/cshi?charset=utf8</span><span style="color: #800000">'</span><span style="color: #000000">)

Base </span>= declarative_base()   <span style="color: #008000">#</span><span style="color: #008000">创建一个SQLORM基类</span>

<span style="color: #0000ff">class</span> Favor(Base):          <span style="color: #008000">#</span><span style="color: #008000">创建连接表，自定义类，功能生成一张表，参数必须继承SQLORM基类</span>
    <span style="color: #800080">__tablename__</span> = <span style="color: #800000">'</span><span style="color: #800000">favor</span><span style="color: #800000">'</span> <span style="color: #008000">#</span><span style="color: #008000">表名称</span>
    id = Column(Integer, primary_key=True, autoincrement=True)  <span style="color: #008000">#</span><span style="color: #008000">设置主键，自增</span>
    caption = Column(String(50), default=<span style="color: #800000">'</span><span style="color: #800000">red</span><span style="color: #800000">'</span>, unique=True)    <span style="color: #008000">#</span><span style="color: #008000">设置字段默认值，设置字段唯一索引</span>

<span style="color: #0000ff">class</span> User(Base):           <span style="color: #008000">#</span><span style="color: #008000">创建外键表，自定义类，功能生成一张表，参数必须继承SQLORM基类</span>
    <span style="color: #800080">__tablename__</span> = <span style="color: #800000">'</span><span style="color: #800000">users</span><span style="color: #800000">'</span> <span style="color: #008000">#</span><span style="color: #008000">表名称</span>

    <span style="color: #008000">#</span><span style="color: #008000">创建字段</span>
    <span style="color: #008000">#</span><span style="color: #008000">字段名称 = Column(字段属性...)</span>
    id = Column(Integer, primary_key=True, autoincrement=True)  <span style="color: #008000">#</span><span style="color: #008000">设置主键，自增</span>
    name = Column(String(40<span style="color: #000000">))
    password </span>= Column(String(40<span style="color: #000000">))
    fullname </span>= Column(Integer,ForeignKey(<span style="color: #800000">"</span><span style="color: #800000">favor.id</span><span style="color: #800000">"</span>))           <span style="color: #008000">#</span><span style="color: #008000">ForeignKey("连接表名称.连接表主键字段")外键链表一对多</span>
<span style="color: #000000">

Base.metadata.create_all(engine)  </span><span style="color: #008000">#</span><span style="color: #008000">向数据库创建指定表</span>

<span style="color: #008000">#</span><span style="color: #008000">创建sessionmaker类，sessionmaker(bind=数据库链接变量)</span>
MySession = sessionmaker(bind=<span style="color: #000000">engine)
session </span>= MySession()   <span style="color: #008000">#</span><span style="color: #008000">执行sessionmaker类</span>
<span style="background-color: #ffff99"><span style="color: #000000">

ret </span>= session.query(User.id, User.name, User.password, User.fullname).filter_by(name=<span style="color: #800000">'</span><span style="color: #800000">林贵秀2</span><span style="color: #800000">'</span>).all()    <span style="color: #008000">#</span><span style="color: #008000">查询表里name字段等于林贵秀2的数据</span>
<span style="color: #0000ff">print</span><span style="color: #000000">(ret)

ret </span>= session.query(User.id, User.name, User.password, User.fullname).filter(User.id &gt; 20, User.name == <span style="color: #800000">'</span><span style="color: #800000">林贵秀1</span><span style="color: #800000">'</span>).all()   <span style="color: #008000">#</span><span style="color: #008000">查询表里id大于20，name等于林贵秀1的数据</span>
<span style="color: #0000ff">print</span><span style="color: #000000">(ret)

ret </span>= session.query(User.id, User.name, User.password, User.fullname).filter(User.id.<span style="background-color: #ff99cc">between(1, 16)</span>, User.name == <span style="color: #800000">'</span><span style="color: #800000">林贵秀1</span><span style="color: #800000">'</span>).all() <span style="color: #008000">#</span><span style="color: #008000">查询表里id为1至16之间，name等于林贵秀1的数据</span>
<span style="color: #0000ff">print</span><span style="color: #000000">(ret)

ret </span>= session.query(User.id, User.name, User.password, User.fullname).filter(User.id.<span style="background-color: #ff99cc">in_([1,3,4])</span>).all()    <span style="color: #008000">#</span><span style="color: #008000">查询表里id为1,3,4的数据</span>
<span style="color: #0000ff">print</span><span style="color: #000000">(ret)

ret </span>= session.query(User.id, User.name, User.password, User.fullname).filter(<span style="background-color: #ff99cc">~</span>User.id.in_([1,3,4])).all()   <span style="color: #008000">#</span><span style="color: #008000">查询表里id不为1,3,4的数据</span>
<span style="color: #0000ff">print</span><span style="color: #000000">(ret)

ret </span>= session.query(User.id, User.name, User.password, User.fullname).filter(User.id.in_(session.query(User.id).filter_by(name=<span style="color: #800000">'</span><span style="color: #800000">林贵秀1</span><span style="color: #800000">'</span>))).all()  <span style="color: #008000">#</span><span style="color: #008000">查找一张表里的id作为参数，再次查找数据</span>
<span style="color: #0000ff">print</span><span style="color: #000000">(ret)


</span><span style="background-color: #ffffff"><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span> and_, or_  </span><span style="color: #008000">#</span><span style="color: #008000">注意：在条件里如果要使用and_(并且)，or_(或者),必须先引入这两个方法</span>
<span style="color: #000000">

ret </span>= session.query(User.id, User.name, User.password, User.fullname).filter(<span style="background-color: #ff99cc">and_(User.id &gt; 3, User.name == <span style="color: #800000">'</span><span style="color: #800000">林贵秀1</span><span style="color: #800000">'</span>)</span>).all()  <span style="color: #008000">#</span><span style="color: #008000">查找表里id大于3，并且name等于林贵秀1的数据</span>
<span style="color: #0000ff">print</span><span style="color: #000000">(ret)

ret </span>= session.query(User.id, User.name, User.password, User.fullname).filter(<span style="background-color: #ff99cc">or_(User.id &lt; 3, User.name == <span style="color: #800000">'</span><span style="color: #800000">林贵秀1</span><span style="color: #800000">'</span>)</span>).all()   <span style="color: #008000">#</span><span style="color: #008000">查找表里id小于3或者name等于林贵秀1的数据</span>
<span style="color: #0000ff">print</span><span style="color: #000000">(ret)

ret </span>=<span style="color: #000000"> session.query(User.id, User.name, User.password, User.fullname).filter(
    or_(
        User.id </span>&lt; 2,    <span style="color: #008000">#</span><span style="color: #008000">id小于2</span>
        and_(User.name == <span style="color: #800000">'</span><span style="color: #800000">林贵秀1</span><span style="color: #800000">'</span>, User.id &gt; 3), <span style="color: #008000">#</span><span style="color: #008000">name等于林贵秀1并且id大于3</span>
        User.password != <span style="color: #800000">""</span> <span style="color: #008000">#</span><span style="color: #008000">password不为空</span>
<span style="color: #000000">    )).all()

</span><span style="color: #0000ff">print</span>(ret)</span></pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201706/955761-20170620212624132-214941670.png" alt=""></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>查询通配符</strong></span></p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff">like()</span>通配符</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">e%</span>  开头的所有（%表示多个字符串,表示查询开头为e后面可以是多个字符的数据）</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">%e%</span> 表示查询中间为e前后可以是多个字符的数据</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">e_ </span>开头的所有（_表示一个字符,表示查询开头为e后面可以是一个字符的数据）</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">_e_</span> 表示查询中间为e前后可以是一个字符的数据</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf-8 -*-</span>

<span style="color: #0000ff">import</span><span style="color: #000000"> sqlalchemy
</span><span style="color: #0000ff">from</span> sqlalchemy.ext.declarative <span style="color: #0000ff">import</span><span style="color: #000000"> declarative_base
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> Column, Integer, String, ForeignKey, UniqueConstraint, Index,text
</span><span style="color: #0000ff">from</span> sqlalchemy.orm <span style="color: #0000ff">import</span><span style="color: #000000"> sessionmaker, relationship
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> create_engine


</span><span style="color: #008000">#</span><span style="color: #008000">create_engine方法，创建数据库链接，</span><span style="color: #008000">
#</span><span style="color: #008000">create_engine方法参数('使用数据库+数据库链接模块://数据库用户名:密码@ip地址:端口/要连接的数据库名称',echo=True表示是否查看生成的sql语句)</span>
engine = create_engine(<span style="color: #800000">'</span><span style="color: #800000">mysql+pymysql://root:279819@127.0.0.1:3306/<span style="background-color: #ff99cc">cshi</span>?charset=utf8</span><span style="color: #800000">'</span><span style="color: #000000">)

Base </span>= declarative_base()   <span style="color: #008000">#</span><span style="color: #008000">创建一个SQLORM基类</span>

<span style="color: #0000ff">class</span> Favor(Base):          <span style="color: #008000">#</span><span style="color: #008000">创建连接表，自定义类，功能生成一张表，参数必须继承SQLORM基类</span>
    <span style="color: #800080">__tablename__</span> = <span style="color: #800000">'</span><span style="color: #800000">favor</span><span style="color: #800000">'</span> <span style="color: #008000">#</span><span style="color: #008000">表名称</span>
    id = Column(Integer, primary_key=True, autoincrement=True)  <span style="color: #008000">#</span><span style="color: #008000">设置主键，自增</span>
    caption = Column(String(50), default=<span style="color: #800000">'</span><span style="color: #800000">red</span><span style="color: #800000">'</span>, unique=True)    <span style="color: #008000">#</span><span style="color: #008000">设置字段默认值，设置字段唯一索引</span>

<span style="color: #0000ff">class</span> User(Base):           <span style="color: #008000">#</span><span style="color: #008000">创建外键表，自定义类，功能生成一张表，参数必须继承SQLORM基类</span>
    <span style="color: #800080">__tablename__</span> = <span style="color: #800000">'</span><span style="color: #800000; background-color: #ff99cc">users</span><span style="color: #800000">'</span> <span style="color: #008000">#</span><span style="color: #008000">表名称</span>

    <span style="color: #008000">#</span><span style="color: #008000">创建字段</span>
    <span style="color: #008000">#</span><span style="color: #008000">字段名称 = Column(字段属性...)</span>
    id = Column(Integer, primary_key=True, autoincrement=True)  <span style="color: #008000">#</span><span style="color: #008000">设置主键，自增</span>
    name = Column(String(40<span style="color: #000000">))
    password </span>= Column(String(40<span style="color: #000000">))
    fullname </span>= Column(Integer,ForeignKey(<span style="color: #800000">"</span><span style="color: #800000">favor.id</span><span style="color: #800000">"</span>))           <span style="color: #008000">#</span><span style="color: #008000">ForeignKey("连接表名称.连接表主键字段")外键链表一对多</span>
<span style="color: #000000">

Base.metadata.create_all(engine)  </span><span style="color: #008000">#</span><span style="color: #008000">向数据库创建指定表</span>

<span style="color: #008000">#</span><span style="color: #008000">创建sessionmaker类，sessionmaker(bind=数据库链接变量)</span>
MySession = sessionmaker(bind=<span style="color: #000000">engine)
session </span>= MySession()   <span style="color: #008000">#</span><span style="color: #008000">执行sessionmaker类</span>

<span style="color: #008000">#</span><span style="color: #008000"> 通配符</span>
<span style="color: #800000">"""</span><span style="color: #800000">
e%  开头的所有（%表示多个字符串,表示查询开头为e后面可以是多个字符的数据）
%e% 表示查询中间为e前后可以是多个字符的数据
e_  e开头的所有（_表示一个字符,表示查询开头为e后面可以是一个字符的数据）
_e_ 表示查询中间为e前后可以是一个字符的数据
</span><span style="color: #800000">"""</span><span style="background-color: #ffff99"><span style="color: #000000">
ret </span>= session.query(User.id, User.name, User.password, User.fullname).filter(User.name.<span style="background-color: #ff99cc">like(<span style="color: #800000">'</span><span style="color: #800000">林贵秀%</span><span style="color: #800000">'</span>)</span>).all()  <span style="color: #008000">#</span><span style="color: #008000">查找表里name字段开头为林贵秀后面可以是多个字符的数据</span>
<span style="color: #0000ff">print</span><span style="color: #000000">(ret)

ret </span>= session.query(User.id, User.name, User.password, User.fullname).filter(~User.name.<span style="background-color: #ff99cc">like(<span style="color: #800000">'</span><span style="color: #800000">林贵秀%</span><span style="color: #800000">'</span>)</span>).all() <span style="color: #008000">#</span><span style="color: #008000">查找表里name字段开头不为林贵秀后面可以是多个字符的数据</span>
<span style="color: #0000ff">print</span>(ret)</span></pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201706/955761-20170620220651460-1687447733.png" alt=""></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>查询限制</strong></span></p>
<p><span style="color: #ff0000"><strong><strong>限制一般做分页</strong></strong></span></p>
<p><span style="color: #ff0000"><strong>[13:18]从第13行开始到18行结束，也就是取5行</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf-8 -*-</span>

<span style="color: #0000ff">import</span><span style="color: #000000"> sqlalchemy
</span><span style="color: #0000ff">from</span> sqlalchemy.ext.declarative <span style="color: #0000ff">import</span><span style="color: #000000"> declarative_base
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> Column, Integer, String, ForeignKey, UniqueConstraint, Index,text
</span><span style="color: #0000ff">from</span> sqlalchemy.orm <span style="color: #0000ff">import</span><span style="color: #000000"> sessionmaker, relationship
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> create_engine


</span><span style="color: #008000">#</span><span style="color: #008000">create_engine方法，创建数据库链接，</span><span style="color: #008000">
#</span><span style="color: #008000">create_engine方法参数('使用数据库+数据库链接模块://数据库用户名:密码@ip地址:端口/要连接的数据库名称',echo=True表示是否查看生成的sql语句)</span>
engine = create_engine(<span style="color: #800000">'</span><span style="color: #800000">mysql+pymysql://root:279819@127.0.0.1:3306/<span style="background-color: #ff99cc">cshi</span>?charset=utf8</span><span style="color: #800000">'</span><span style="color: #000000">)

Base </span>= declarative_base()   <span style="color: #008000">#</span><span style="color: #008000">创建一个SQLORM基类</span>

<span style="color: #0000ff">class</span> Favor(Base):          <span style="color: #008000">#</span><span style="color: #008000">创建连接表，自定义类，功能生成一张表，参数必须继承SQLORM基类</span>
    <span style="color: #800080">__tablename__</span> = <span style="color: #800000">'</span><span style="color: #800000">favor</span><span style="color: #800000">'</span> <span style="color: #008000">#</span><span style="color: #008000">表名称</span>
    id = Column(Integer, primary_key=True, autoincrement=True)  <span style="color: #008000">#</span><span style="color: #008000">设置主键，自增</span>
    caption = Column(String(50), default=<span style="color: #800000">'</span><span style="color: #800000">red</span><span style="color: #800000">'</span>, unique=True)    <span style="color: #008000">#</span><span style="color: #008000">设置字段默认值，设置字段唯一索引</span>

<span style="color: #0000ff">class</span> User(Base):           <span style="color: #008000">#</span><span style="color: #008000">创建外键表，自定义类，功能生成一张表，参数必须继承SQLORM基类</span>
    <span style="color: #800080">__tablename__</span> = <span style="color: #800000">'</span><span style="color: #800000; background-color: #ff99cc">users</span><span style="color: #800000">'</span> <span style="color: #008000">#</span><span style="color: #008000">表名称</span>

    <span style="color: #008000">#</span><span style="color: #008000">创建字段</span>
    <span style="color: #008000">#</span><span style="color: #008000">字段名称 = Column(字段属性...)</span>
    id = Column(Integer, primary_key=True, autoincrement=True)  <span style="color: #008000">#</span><span style="color: #008000">设置主键，自增</span>
    name = Column(String(40<span style="color: #000000">))
    password </span>= Column(String(40<span style="color: #000000">))
    fullname </span>= Column(Integer,ForeignKey(<span style="color: #800000">"</span><span style="color: #800000">favor.id</span><span style="color: #800000">"</span>))           <span style="color: #008000">#</span><span style="color: #008000">ForeignKey("连接表名称.连接表主键字段")外键链表一对多</span>
<span style="color: #000000">

Base.metadata.create_all(engine)  </span><span style="color: #008000">#</span><span style="color: #008000">向数据库创建指定表</span>

<span style="color: #008000">#</span><span style="color: #008000">创建sessionmaker类，sessionmaker(bind=数据库链接变量)</span>
MySession = sessionmaker(bind=<span style="color: #000000">engine)
session </span>= MySession()   <span style="color: #008000">#</span><span style="color: #008000">执行sessionmaker类</span>

<span style="color: #008000">#</span><span style="color: #008000"> 限制</span>
<span style="background-color: #ffff99">ret = session.query(User.id, User.name, User.password, User.fullname)<span style="background-color: #ff99cc">[13:18]</span></span>    <span style="color: #008000">#</span><span style="color: #008000">从第13行开始到18行结束，也就是取5行</span>
<span style="color: #0000ff">print</span>(ret)</pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201706/955761-20170621094513116-1386765666.png" alt=""></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>查询排序</strong></span></p>
<p><span style="color: #ff0000"><strong><strong>一般默认是从第一列id排序的</strong></strong></span></p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff">order_by(排序字段.asc())</span>排序,desc()降序，asc()升序</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf-8 -*-</span>

<span style="color: #0000ff">import</span><span style="color: #000000"> sqlalchemy
</span><span style="color: #0000ff">from</span> sqlalchemy.ext.declarative <span style="color: #0000ff">import</span><span style="color: #000000"> declarative_base
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> Column, Integer, String, ForeignKey, UniqueConstraint, Index,text
</span><span style="color: #0000ff">from</span> sqlalchemy.orm <span style="color: #0000ff">import</span><span style="color: #000000"> sessionmaker, relationship
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> create_engine


</span><span style="color: #008000">#</span><span style="color: #008000">create_engine方法，创建数据库链接，</span><span style="color: #008000">
#</span><span style="color: #008000">create_engine方法参数('使用数据库+数据库链接模块://数据库用户名:密码@ip地址:端口/要连接的数据库名称',echo=True表示是否查看生成的sql语句)</span>
engine = create_engine(<span style="color: #800000">'</span><span style="color: #800000">mysql+pymysql://root:279819@127.0.0.1:3306/cshi?charset=utf8</span><span style="color: #800000">'</span><span style="color: #000000">)

Base </span>= declarative_base()   <span style="color: #008000">#</span><span style="color: #008000">创建一个SQLORM基类</span>

<span style="color: #0000ff">class</span> Favor(Base):          <span style="color: #008000">#</span><span style="color: #008000">创建连接表，自定义类，功能生成一张表，参数必须继承SQLORM基类</span>
    <span style="color: #800080">__tablename__</span> = <span style="color: #800000">'</span><span style="color: #800000">favor</span><span style="color: #800000">'</span> <span style="color: #008000">#</span><span style="color: #008000">表名称</span>
    id = Column(Integer, primary_key=True, autoincrement=True)  <span style="color: #008000">#</span><span style="color: #008000">设置主键，自增</span>
    caption = Column(String(50), default=<span style="color: #800000">'</span><span style="color: #800000">red</span><span style="color: #800000">'</span>, unique=True)    <span style="color: #008000">#</span><span style="color: #008000">设置字段默认值，设置字段唯一索引</span>

<span style="color: #0000ff">class</span> User(Base):           <span style="color: #008000">#</span><span style="color: #008000">创建外键表，自定义类，功能生成一张表，参数必须继承SQLORM基类</span>
    <span style="color: #800080">__tablename__</span> = <span style="color: #800000">'</span><span style="color: #800000">users</span><span style="color: #800000">'</span> <span style="color: #008000">#</span><span style="color: #008000">表名称</span>

    <span style="color: #008000">#</span><span style="color: #008000">创建字段</span>
    <span style="color: #008000">#</span><span style="color: #008000">字段名称 = Column(字段属性...)</span>
    id = Column(Integer, primary_key=True, autoincrement=True)  <span style="color: #008000">#</span><span style="color: #008000">设置主键，自增</span>
    name = Column(String(40<span style="color: #000000">))
    password </span>= Column(String(40<span style="color: #000000">))
    fullname </span>= Column(Integer,ForeignKey(<span style="color: #800000">"</span><span style="color: #800000">favor.id</span><span style="color: #800000">"</span>))           <span style="color: #008000">#</span><span style="color: #008000">ForeignKey("连接表名称.连接表主键字段")外键链表一对多</span>
<span style="color: #000000">

Base.metadata.create_all(engine)  </span><span style="color: #008000">#</span><span style="color: #008000">向数据库创建指定表</span>

<span style="color: #008000">#</span><span style="color: #008000">创建sessionmaker类，sessionmaker(bind=数据库链接变量)</span>
MySession = sessionmaker(bind=<span style="color: #000000">engine)
session </span>= MySession()   <span style="color: #008000">#</span><span style="color: #008000">执行sessionmaker类</span>

<span style="color: #008000">#</span><span style="color: #008000"> 排序</span>
<span style="background-color: #ffff99">ret = session.query(User.id, User.name, User.password, User.fullname).<span style="background-color: #ff99cc">order_by(User.id.desc())</span>.all()    <span style="color: #008000">#</span><span style="color: #008000">根据 “列” 从大到小排列</span>
<span style="color: #0000ff">print</span><span style="color: #000000">(ret)

ret </span>= session.query(User.id, User.name, User.password, User.fullname).<span style="background-color: #ff99cc">order_by(User.id.asc())</span>.all()     <span style="color: #008000">#</span><span style="color: #008000">根据 “列” 从小到大排列</span>
<span style="color: #0000ff">print</span><span style="color: #000000">(ret)

ret </span>= session.query(User.id, User.name, User.password, User.fullname).<span style="background-color: #ff99cc">order_by(User.id.desc(), User.name.asc())</span>.all()   <span style="color: #008000">#</span><span style="color: #008000">根据 “列1” 从大到小排列，如果排序列1数据有相同，则按列2从小到大排序</span></span>
<span style="color: #0000ff">print</span>(ret)</pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201706/955761-20170621095811976-196678309.png" alt=""></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>查询分组</strong></span></p>
<p><span style="color: #ff0000"><strong><strong>分组一般就是一个分组列记录每条数据所属什么类型如：普通会员、超级会员、黄金会员</strong></strong></span></p>
<p><span style="color: #ff0000"><strong><strong><strong>注意：group by 必须在where之后，order by之前</strong></strong></strong></span></p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff">from sqlalchemy.sql import func</span> 注意：分组必须sqlalchemy.sql模块里的func方法</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">group_by(分组字段)</span>分组</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">func.count()</span>统计所属当前分组的数据列数</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">func.max()</span>显示当前组里指定列最大的数据</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">func.min()</span>显示当前组里指定列最小的数据</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">func.sum()</span>显示当前组指定列相加的和</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">func.avg()</span>显示当前组指定列的平均数</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">having</span>(条件)帅选统计</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf-8 -*-</span>

<span style="color: #0000ff">import</span><span style="color: #000000"> sqlalchemy
</span><span style="color: #0000ff">from</span> sqlalchemy.ext.declarative <span style="color: #0000ff">import</span><span style="color: #000000"> declarative_base
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> Column, Integer, String, ForeignKey, UniqueConstraint, Index,text
</span><span style="color: #0000ff">from</span> sqlalchemy.orm <span style="color: #0000ff">import</span><span style="color: #000000"> sessionmaker, relationship
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> create_engine


</span><span style="color: #008000">#</span><span style="color: #008000">create_engine方法，创建数据库链接，</span><span style="color: #008000">
#</span><span style="color: #008000">create_engine方法参数('使用数据库+数据库链接模块://数据库用户名:密码@ip地址:端口/要连接的数据库名称',echo=True表示是否查看生成的sql语句)</span>
engine = create_engine(<span style="color: #800000">'</span><span style="color: #800000">mysql+pymysql://root:279819@127.0.0.1:3306/<span style="background-color: #ff99cc">cshi</span>?charset=utf8</span><span style="color: #800000">'</span><span style="color: #000000">)

Base </span>= declarative_base()   <span style="color: #008000">#</span><span style="color: #008000">创建一个SQLORM基类</span>

<span style="color: #0000ff">class</span> Favor(Base):          <span style="color: #008000">#</span><span style="color: #008000">创建连接表，自定义类，功能生成一张表，参数必须继承SQLORM基类</span>
    <span style="color: #800080">__tablename__</span> = <span style="color: #800000">'</span><span style="color: #800000">favor</span><span style="color: #800000">'</span> <span style="color: #008000">#</span><span style="color: #008000">表名称</span>
    id = Column(Integer, primary_key=True, autoincrement=True)  <span style="color: #008000">#</span><span style="color: #008000">设置主键，自增</span>
    caption = Column(String(50), default=<span style="color: #800000">'</span><span style="color: #800000">red</span><span style="color: #800000">'</span>, unique=True)    <span style="color: #008000">#</span><span style="color: #008000">设置字段默认值，设置字段唯一索引</span>

<span style="color: #0000ff">class</span> User(Base):           <span style="color: #008000">#</span><span style="color: #008000">创建外键表，自定义类，功能生成一张表，参数必须继承SQLORM基类</span>
    <span style="color: #800080">__tablename__</span> = <span style="color: #800000">'</span><span style="color: #800000; background-color: #ff99cc">users</span><span style="color: #800000">'</span> <span style="color: #008000">#</span><span style="color: #008000">表名称</span>

    <span style="color: #008000">#</span><span style="color: #008000">创建字段</span>
    <span style="color: #008000">#</span><span style="color: #008000">字段名称 = Column(字段属性...)</span>
    id = Column(Integer, primary_key=True, autoincrement=True)  <span style="color: #008000">#</span><span style="color: #008000">设置主键，自增</span>
    name = Column(String(40<span style="color: #000000">))
    password </span>= Column(String(40<span style="color: #000000">))
    fullname </span>= Column(Integer,ForeignKey(<span style="color: #800000">"</span><span style="color: #800000">favor.id</span><span style="color: #800000">"</span>))           <span style="color: #008000">#</span><span style="color: #008000">ForeignKey("连接表名称.连接表主键字段")外键链表一对多</span>
    fzu = Column(String(40<span style="color: #000000">))


Base.metadata.create_all(engine)  </span><span style="color: #008000">#</span><span style="color: #008000">向数据库创建指定表</span>

<span style="color: #008000">#</span><span style="color: #008000">创建sessionmaker类，sessionmaker(bind=数据库链接变量)</span>
MySession = sessionmaker(bind=<span style="color: #000000">engine)
session </span>= MySession()   <span style="color: #008000">#</span><span style="color: #008000">执行sessionmaker类</span>

<span style="background-color: #ffff99"><span style="color: #008000">#</span><span style="color: #008000"> 分组</span>
<span style="background-color: #ffffff"><span style="color: #0000ff">from</span> sqlalchemy.sql <span style="color: #0000ff">import</span></span><span style="color: #000000"><span style="background-color: #ffffff"> func</span>

ret </span>= session.query(User.fzu).<span style="background-color: #ff99cc">group_by(User.fzu)</span>.all()  <span style="color: #008000">#</span><span style="color: #008000">查看分组类容</span>
<span style="color: #0000ff">print</span><span style="color: #000000">(ret)

</span><span style="color: #008000">#</span><span style="color: #008000">查看分组所有统计信息</span>
ret =<span style="color: #000000"> session.query(
    User.fzu,               </span><span style="color: #008000">#</span><span style="color: #008000">显示当前分组</span>
    <span style="background-color: #ff99cc">func.count(User.fzu)</span>,   <span style="color: #008000">#</span><span style="color: #008000">统计所属当前分组的数据,统计当前分组的列数</span>
    <span style="background-color: #ff99cc">func.max(User.id)</span>,      <span style="color: #008000">#</span><span style="color: #008000">显示当前组里指定列最大的数据</span>
    <span style="background-color: #ff99cc">func.min(User.id)</span>,      <span style="color: #008000">#</span><span style="color: #008000">显示当前组里指定列最小的数据</span>
    <span style="background-color: #ff99cc">func.sum(User.id)</span>,      <span style="color: #008000">#</span><span style="color: #008000">显示当前组指定列相加的和</span>
    <span style="background-color: #ff99cc">func.avg(User.id)</span>       <span style="color: #008000">#</span><span style="color: #008000">显示当前组指定列的平均数</span>
).group_by(User.fzu).all()  <span style="color: #008000">#</span><span style="color: #008000">查看分组所有统计信息</span>
<span style="color: #0000ff">print</span><span style="color: #000000">(ret)

</span><span style="color: #008000">#</span><span style="color: #008000">查看分组指定统计值大于3的信息</span>
ret =<span style="color: #000000"> session.query(
    User.fzu,               </span><span style="color: #008000">#</span><span style="color: #008000">显示当前分组</span>
    func.count(User.fzu),   <span style="color: #008000">#</span><span style="color: #008000">统计所属当前分组的数据,统计当前分组的列数</span>
    func.max(User.id),      <span style="color: #008000">#</span><span style="color: #008000">显示当前组里指定列最大的数据</span>
    func.min(User.id),      <span style="color: #008000">#</span><span style="color: #008000">显示当前组里指定列最小的数据</span>
    func.sum(User.id),      <span style="color: #008000">#</span><span style="color: #008000">显示当前组指定列相加的和</span>
    func.avg(User.id)       <span style="color: #008000">#</span><span style="color: #008000">显示当前组指定列的平均数</span>
).group_by(User.fzu).<span style="background-color: #ff99cc">having(func.min(User.id) &gt; 3)</span>.all()    <span style="color: #008000">#</span><span style="color: #008000">查看分组指定统计值大于3的信息</span>
<span style="color: #0000ff">print</span>(ret)</span></pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201706/955761-20170621120454679-1153561585.png" alt=""></p>
<p>&nbsp;</p>
<p><strong style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot;, sans-serif; font-size: 12px; line-height: normal; white-space: pre-wrap; background-color: #ffff66"><strong style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot;, sans-serif; font-size: 12px; line-height: normal; white-space: pre-wrap; background-color: #ffff66">&nbsp;</strong></strong></p>
<p><span style="color: #ff0000"><strong style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot;, sans-serif; font-size: 12px; line-height: normal; white-space: pre-wrap; background-color: #ffff66"><strong style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot;, sans-serif; font-size: 12px; line-height: normal; white-space: pre-wrap; background-color: #ffff66">外键链表查询</strong></strong></span></p>
<p><span style="color: #ff0000"><strong>外键链表数据类型必须一致</strong></span><br><span style="color: #ff0000"><strong>a表里创建外键连接b表的主键，首先检查a表里要设置外键的字段、和b表里的主键字段数据类型是否一致，两者数据类型必须一致，不然无法建立索引【重点】</strong></span></p>
<p><span style="color: #ff0000"><strong>外键链表约束</strong></span><br><span style="color: #ff0000"><strong>a表和b表链表后，两表之间建立了链表关系，a表受b表约束，也就是当a表添加或者修改一条数据时、这条数据的外键字段值如果是b表主键字段不存在的，将无法添加，会报错【重点】</strong></span></p>
<p><span style="color: #ff0000"><strong>外键连表查询</strong></span><br><span style="color: #0000ff"><strong>query(外键表, 连接表).filter(外键表.外键字段 == 连接表.主键字段)</strong></span></p>
<p><span style="color: #ff0000"><strong>join()外键连表查询【推荐】</strong></span><br><span style="color: #0000ff"><strong>query(外键表, 连接表).join(连接表)</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf-8 -*-</span>

<span style="color: #0000ff">import</span><span style="color: #000000"> sqlalchemy
</span><span style="color: #0000ff">from</span> sqlalchemy.ext.declarative <span style="color: #0000ff">import</span><span style="color: #000000"> declarative_base
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> Column, Integer, String, ForeignKey, UniqueConstraint, Index,text
</span><span style="color: #0000ff">from</span> sqlalchemy.orm <span style="color: #0000ff">import</span><span style="color: #000000"> sessionmaker, relationship
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> create_engine


</span><span style="color: #008000">#</span><span style="color: #008000">create_engine方法，创建数据库链接，</span><span style="color: #008000">
#</span><span style="color: #008000">create_engine方法参数('使用数据库+数据库链接模块://数据库用户名:密码@ip地址:端口/要连接的数据库名称',echo=True表示是否查看生成的sql语句)</span>
engine = create_engine(<span style="color: #800000">'</span><span style="color: #800000">mysql+pymysql://root:279819@127.0.0.1:3306/<span style="background-color: #ff99cc">cshi</span>?charset=utf8</span><span style="color: #800000">'</span>,echo=<span style="color: #000000">True)

Base </span>= declarative_base()   <span style="color: #008000">#</span><span style="color: #008000">创建一个SQLORM基类</span>

<span style="color: #0000ff">class</span> Favor(Base):          <span style="color: #008000">#</span><span style="color: #008000">创建连接表，自定义类，功能生成一张表，参数必须继承SQLORM基类</span>
    <span style="color: #800080">__tablename__</span> = <span style="color: #800000">'</span><span style="color: #800000">favor</span><span style="color: #800000">'</span> <span style="color: #008000">#</span><span style="color: #008000">表名称</span>
    id = Column(Integer, primary_key=True, autoincrement=True)  <span style="color: #008000">#</span><span style="color: #008000">设置主键，自增</span>
    caption = Column(String(50), default=<span style="color: #800000">'</span><span style="color: #800000">red</span><span style="color: #800000">'</span>, unique=True)    <span style="color: #008000">#</span><span style="color: #008000">设置字段默认值，设置字段唯一索引</span>

<span style="color: #0000ff">class</span> User(Base):           <span style="color: #008000">#</span><span style="color: #008000">创建外键表，自定义类，功能生成一张表，参数必须继承SQLORM基类</span>
    <span style="color: #800080">__tablename__</span> = <span style="color: #800000">'</span><span style="color: #800000; background-color: #ff99cc">users</span><span style="color: #800000">'</span> <span style="color: #008000">#</span><span style="color: #008000">表名称</span>

    <span style="color: #008000">#</span><span style="color: #008000">创建字段</span>
    <span style="color: #008000">#</span><span style="color: #008000">字段名称 = Column(字段属性...)</span>
    id = Column(Integer, primary_key=True, autoincrement=True)  <span style="color: #008000">#</span><span style="color: #008000">设置主键，自增</span>
    name = Column(String(40<span style="color: #000000">))
    password </span>= Column(String(40<span style="color: #000000">))
    fullname </span>= Column(Integer,ForeignKey(<span style="color: #800000">"</span><span style="color: #800000">favor.id</span><span style="color: #800000">"</span>))           <span style="color: #008000">#</span><span style="color: #008000">ForeignKey("连接表名称.连接表主键字段")外键链表一对多</span>
    fzu = Column(String(40<span style="color: #000000">))


Base.metadata.create_all(engine)  </span><span style="color: #008000">#</span><span style="color: #008000">向数据库创建指定表</span>

<span style="color: #008000">#</span><span style="color: #008000">创建sessionmaker类，sessionmaker(bind=数据库链接变量)</span>
MySession = sessionmaker(bind=<span style="color: #000000">engine)
session </span>= MySession()   <span style="color: #008000">#</span><span style="color: #008000">执行sessionmaker类</span>

<span style="color: #008000">#</span><span style="color: #008000"> 外键连表查询</span><span style="color: #008000">
#</span><span style="color: #008000"> query(外键表, 连接表).filter(外键表.外键字段 == 连接表.主键字段)，</span>
<span style="background-color: #ffff99">ret = session.query(User.id, User.name, User.password, User.fullname, Favor.id, Favor.caption).<span style="background-color: #ff99cc">filter(User.fullname ==</span><span style="color: #000000"><span style="background-color: #ff99cc"> Favor.id)</span>.all()
</span><span style="color: #0000ff">print</span>(ret)</span>  <span style="color: #008000">#</span><span style="color: #008000">查看外键表和连接表组合后的信息</span>

<span style="color: #008000">#</span><span style="color: #008000"> join()外键连表查询</span><span style="color: #008000">
#</span><span style="color: #008000"> query(外键表, 连接表).join(连接表)，只显示有关联的数据[推荐]</span>
<span style="background-color: #ffff99">ret =<span style="color: #000000"> session.query(User.id, User.name, User.password, User.fullname,Favor.id, Favor.caption).<span style="background-color: #ff99cc">join(Favor)</span>.all()
</span><span style="color: #0000ff">print</span>(ret) </span>   <span style="color: #008000">#</span><span style="color: #008000">查看join()外键连表后的信息</span></pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201706/955761-20170621142449945-1213005680.png" alt=""></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>查询组合</strong></span></p>
<p><span style="color: #ff0000"><strong>组合就是将两张表数据显示出来，注意两张表显示的列数量要是一样的</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">union()</span>组合表，对两个结果集进行并集操作，不包括重复行，同时进行默认规则的排序；</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">union_all()</span>组合表，对两个结果集进行并集操作，包括重复行，不进行排序；</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf-8 -*-</span>

<span style="color: #0000ff">import</span><span style="color: #000000"> sqlalchemy
</span><span style="color: #0000ff">from</span> sqlalchemy.ext.declarative <span style="color: #0000ff">import</span><span style="color: #000000"> declarative_base
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> Column, Integer, String, ForeignKey, UniqueConstraint, Index,text
</span><span style="color: #0000ff">from</span> sqlalchemy.orm <span style="color: #0000ff">import</span><span style="color: #000000"> sessionmaker, relationship
</span><span style="color: #0000ff">from</span> sqlalchemy <span style="color: #0000ff">import</span><span style="color: #000000"> create_engine


</span><span style="color: #008000">#</span><span style="color: #008000">create_engine方法，创建数据库链接，</span><span style="color: #008000">
#</span><span style="color: #008000">create_engine方法参数('使用数据库+数据库链接模块://数据库用户名:密码@ip地址:端口/要连接的数据库名称',echo=True表示是否查看生成的sql语句)</span>
engine = create_engine(<span style="color: #800000">'</span><span style="color: #800000">mysql+pymysql://root:279819@127.0.0.1:3306/<span style="background-color: #ff99cc">cshi</span>?charset=utf8</span><span style="color: #800000">'</span>,echo=<span style="color: #000000">True)

Base </span>= declarative_base()   <span style="color: #008000">#</span><span style="color: #008000">创建一个SQLORM基类</span>

<span style="color: #0000ff">class</span> Favor(Base):          <span style="color: #008000">#</span><span style="color: #008000">创建连接表，自定义类，功能生成一张表，参数必须继承SQLORM基类</span>
    <span style="color: #800080">__tablename__</span> = <span style="background-color: #ff99cc"><span style="color: #800000">'</span><span style="color: #800000">favor</span><span style="color: #800000">'</span></span> <span style="color: #008000">#</span><span style="color: #008000">表名称</span>
    id = Column(Integer, primary_key=True, autoincrement=True)  <span style="color: #008000">#</span><span style="color: #008000">设置主键，自增</span>
    caption = Column(String(50), default=<span style="color: #800000">'</span><span style="color: #800000">red</span><span style="color: #800000">'</span>, unique=True)    <span style="color: #008000">#</span><span style="color: #008000">设置字段默认值，设置字段唯一索引</span>

<span style="color: #0000ff">class</span> User(Base):           <span style="color: #008000">#</span><span style="color: #008000">创建外键表，自定义类，功能生成一张表，参数必须继承SQLORM基类</span>
    <span style="color: #800080">__tablename__</span> = <span style="color: #800000">'</span><span style="color: #800000; background-color: #ff99cc">users</span><span style="color: #800000">'</span> <span style="color: #008000">#</span><span style="color: #008000">表名称</span>

    <span style="color: #008000">#</span><span style="color: #008000">创建字段</span>
    <span style="color: #008000">#</span><span style="color: #008000">字段名称 = Column(字段属性...)</span>
    id = Column(Integer, primary_key=True, autoincrement=True)  <span style="color: #008000">#</span><span style="color: #008000">设置主键，自增</span>
    name = Column(String(40<span style="color: #000000">))
    password </span>= Column(String(40<span style="color: #000000">))
    fullname </span>= Column(Integer,ForeignKey(<span style="color: #800000">"</span><span style="color: #800000">favor.id</span><span style="color: #800000">"</span>))           <span style="color: #008000">#</span><span style="color: #008000">ForeignKey("连接表名称.连接表主键字段")外键链表一对多</span>
    fzu = Column(String(40<span style="color: #000000">))


Base.metadata.create_all(engine)  </span><span style="color: #008000">#</span><span style="color: #008000">向数据库创建指定表</span>

<span style="color: #008000">#</span><span style="color: #008000">创建sessionmaker类，sessionmaker(bind=数据库链接变量)</span>
MySession = sessionmaker(bind=<span style="color: #000000">engine)
session </span>= MySession()   <span style="color: #008000">#</span><span style="color: #008000">执行sessionmaker类</span>

<span style="color: #008000">#</span><span style="color: #008000"> 组合</span>
<span style="background-color: #ffff99">q1 = session.query(User.id, User.name).filter(User.id &gt; 1<span style="color: #000000">)
q2 </span>= session.query(Favor.id, Favor.caption).filter(Favor.id &gt; 1<span style="color: #000000">)
ret </span>=<span style="color: #000000"> q1.<span style="background-color: #ff99cc">union(q2)</span>.all()
</span><span style="color: #0000ff">print</span>(ret)</span>  <span style="color: #008000">#</span><span style="color: #008000">将表1和表2组合后查看</span>
<span style="background-color: #ffff99"><span style="color: #000000">
q1 </span>= session.query(User.id, User.name).filter(User.id &gt; 1<span style="color: #000000">)
q2 </span>= session.query(Favor.id, Favor.caption).filter(Favor.id &gt; 1<span style="color: #000000">)
ret </span>=<span style="color: #000000"> q1.<span style="background-color: #ff99cc">union_all(q2)</span>.all()
</span><span style="color: #0000ff">print</span>(ret)</span>  <span style="color: #008000">#</span><span style="color: #008000">将表1里id大于1的数据和，表2里id大于1的数据组合查看</span></pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201706/955761-20170621150138195-1282617648.png" alt=""></p>
<p>&nbsp;</p></div>