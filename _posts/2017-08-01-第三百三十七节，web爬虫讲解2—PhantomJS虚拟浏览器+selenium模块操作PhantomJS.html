第三百三十七节，web爬虫讲解2—PhantomJS虚拟浏览器+selenium模块操作PhantomJS


			<div id="cnblogs_post_body" class="blogpost-body"><p><strong>第三百三十七节，web爬虫讲解2—PhantomJS虚拟浏览器+selenium模块操作PhantomJS</strong></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>PhantomJS虚拟浏览器</strong></span></p>
<p><strong>phantomjs 是一个基于js的webkit内核无头浏览器 也就是没有显示界面的浏览器，利用这个软件，可以获取到网址js加载的任何信息，也就是可以获取浏览器异步加载的信息</strong></p>
<p><span style="color: #0000ff"><strong>下载网址：http://phantomjs.org/download.html &nbsp;下载对应系统版本</strong></span></p>
<p><span style="color: #0000ff"><strong><img src="https://images2017.cnblogs.com/blog/955761/201708/955761-20170801231442911-1004243698.png" alt=""></strong></span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>下载后解压<strong>PhantomJS</strong>文件，将解压文件夹，剪切到python安装文件夹</strong></span></p>
<p><img src="https://images2017.cnblogs.com/blog/955761/201708/955761-20170801232213630-174686419.png" alt=""></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>然后将PhantomJS文件夹里的bin文件夹添加系统环境变量</strong></span></p>
<p><img src="https://images2017.cnblogs.com/blog/955761/201708/955761-20170801232547630-1801949362.png" alt=""></p>
<p>&nbsp;</p>
<p><span style="background-color: #ffffff; color: #ff0000"><strong>cdm 输入命令：PhantomJS &nbsp;出现以下信息说明安装成功</strong></span></p>
<p><span style="background-color: #ffffff; color: #ff0000"><strong><img src="https://images2017.cnblogs.com/blog/955761/201708/955761-20170801233206490-525701304.png" alt=""></strong></span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>selenium模块是一个python操作<strong>PhantomJS软件的一个模块</strong></strong></span></p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong><strong><strong>selenium模块<strong><strong>PhantomJS软件</strong></strong></strong></strong></strong></span></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff">webdriver.PhantomJS()</span>实例化PhantomJS浏览器对象</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">get('url')</span>访问网站</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">find_element_by_xpath('xpath表达式')</span>通过xpath表达式找对应元素</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">clear()</span>清空输入框里的内容</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">send_keys('内容')</span>将内容写入输入框</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">click()</span>点击事件</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">get_screenshot_as_file('截图保存路径名称')</span>将网页截图，保存到此目录</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">page_source</span>获取网页htnl源码</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">quit()</span>关闭PhantomJS浏览器</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf8 -*-</span>
<span style="color: #0000ff">from</span> selenium <span style="color: #0000ff">import</span> webdriver  <span style="color: #008000">#</span><span style="color: #008000">导入selenium模块来操作PhantomJS</span>
<span style="color: #0000ff">import</span><span style="color: #000000"> os
</span><span style="color: #0000ff">import</span><span style="color: #000000"> time
</span><span style="color: #0000ff">import</span><span style="color: #000000"> re

llqdx </span>= <span style="background-color: #ff99cc">webdriver.PhantomJS()</span>  <span style="color: #008000">#</span><span style="color: #008000">实例化PhantomJS浏览器对象</span>
llqdx.<span style="background-color: #ff99cc">get(<span style="color: #800000">"</span><span style="color: #800000">https://www.baidu.com/</span><span style="color: #800000">"</span>)</span> <span style="color: #008000">#</span><span style="color: #008000">访问网址</span>

<span style="color: #008000">#</span><span style="color: #008000"> time.sleep(3)   #等待3秒</span><span style="color: #008000">
#</span><span style="color: #008000"> llqdx.get_screenshot_as_file('H:/py/17/img/123.jpg')  #将网页截图保存到此目录</span>

<span style="color: #008000">#</span><span style="color: #008000">模拟用户操作</span>
llqdx.<span style="background-color: #ff99cc">find_element_by_xpath(<span style="color: #800000">'</span><span style="color: #800000">//*[@id="kw"]</span><span style="color: #800000">'</span>)</span>.<span style="background-color: #ff99cc">clear()</span>                    <span style="color: #008000">#</span><span style="color: #008000">通过xpath表达式找到输入框，clear()清空输入框里的内容</span>
llqdx.find_element_by_xpath(<span style="color: #800000">'</span><span style="color: #800000">//*[@id="kw"]</span><span style="color: #800000">'</span>).<span style="background-color: #ff99cc">send_keys(<span style="color: #800000">'</span><span style="color: #800000">叫卖录音网</span><span style="color: #800000">'</span>)</span>     <span style="color: #008000">#</span><span style="color: #008000">通过xpath表达式找到输入框，send_keys()将内容写入输入框</span>
llqdx.find_element_by_xpath(<span style="color: #800000">'</span><span style="color: #800000">//*[@id="su"]</span><span style="color: #800000">'</span>).<span style="background-color: #ff99cc">click()</span>                    <span style="color: #008000">#</span><span style="color: #008000">通过xpath表达式找到搜索按钮,click()点击事件</span>
<span style="color: #000000">
time.sleep(</span>3)   <span style="color: #008000">#</span><span style="color: #008000">等待3秒</span>
llqdx.<span style="background-color: #ff99cc">get_screenshot_as_file(<span style="color: #800000">'</span><span style="color: #800000">H:/py/17/img/123.jpg</span><span style="color: #800000">'</span>)</span>  <span style="color: #008000">#</span><span style="color: #008000">将网页截图，保存到此目录</span>
<span style="color: #000000">
neir </span>= llqdx.<span style="background-color: #ff99cc">page_source</span>   <span style="color: #008000">#</span><span style="color: #008000">获取网页内容</span>
<span style="color: #0000ff">print</span><span style="color: #000000">(neir)
llqdx.quit()    </span><span style="color: #008000">#</span><span style="color: #008000">关闭浏览器</span>
<span style="color: #000000">
pat </span>= <span style="color: #800000">"</span><span style="color: #800000">&lt;title&gt;(.*?)&lt;/title&gt;</span><span style="color: #800000">"</span><span style="color: #000000">
title </span>= re.compile(pat).findall(neir)  <span style="color: #008000">#</span><span style="color: #008000">正则匹配网页标题</span>
<span style="color: #0000ff">print</span>(title)</pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong><strong>PhantomJS浏览器伪装，和滚动滚动条加载数据</strong></strong></span></p>
<p><span style="color: #ff0000"><strong><strong>有些网站是动态加载数据的，需要滚动条滚动加载数据</strong></strong></span></p>
<p><span style="color: #ff0000"><strong><strong><img src="https://images2017.cnblogs.com/blog/955761/201708/955761-20170802174734240-769398206.png" alt=""></strong></strong></span></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong><strong>实现代码</strong></strong></span></p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff">DesiredCapabilities</span> 伪装浏览器对象</strong></span><br><span style="color: #ff0000"><strong><span style="color: #0000ff">execute_script()</span>执行js代码</strong></span></p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff">current_url</span>获取当前的url</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf8 -*-</span>
<span style="color: #0000ff">from</span> selenium <span style="color: #0000ff">import</span> webdriver  <span style="color: #008000">#</span><span style="color: #008000">导入selenium模块来操作PhantomJS</span>
<span style="background-color: #ff99cc"><span style="color: #0000ff">from</span> selenium.webdriver.common.desired_capabilities <span style="color: #0000ff">import</span> <span style="background-color: #ffff00">DesiredCapabilities</span>   <span style="color: #008000">#</span><span style="color: #008000">导入浏览器伪装模块</span></span>
<span style="color: #0000ff">import</span><span style="color: #000000"> os
</span><span style="color: #0000ff">import</span><span style="color: #000000"> time
</span><span style="color: #0000ff">import</span><span style="color: #000000"> re

<span style="background-color: #ffff00">dcap </span></span><span style="background-color: #ff99cc">=<span style="color: #000000"> dict(<span style="background-color: #ffff00">DesiredCapabilities.PHANTOMJS</span>)
<span style="background-color: #ffff00">dcap</span>[</span><span style="background-color: #ffff00"><span style="color: #800000">'</span><span style="color: #800000">phantomjs.page.settings.userAgent</span></span><span style="color: #800000">'</span>] = (<span style="color: #800000">'</span><span style="color: #800000; background-color: #ffff00">Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.221 Safari/537.36 SE 2.X MetaSr 1.0</span><span style="color: #800000">'</span><span style="color: #000000">)
</span><span style="color: #0000ff">print</span><span style="color: #000000">(dcap)
llqdx </span>= webdriver.PhantomJS(<span style="background-color: #ffff00">desired_capabilities=dcap</span>)  <span style="color: #008000">#</span><span style="color: #008000">实例化PhantomJS浏览器对象</span></span>
<span style="color: #000000">
llqdx.get(</span><span style="color: #800000">"</span><span style="color: #800000">https://www.jd.com/</span><span style="color: #800000">"</span>) <span style="color: #008000">#</span><span style="color: #008000">访问网址</span>

<span style="color: #008000">#</span><span style="color: #008000">模拟用户操作</span>
<span style="background-color: #ff99cc"><span style="color: #0000ff">for</span> j <span style="color: #0000ff">in</span> range(20<span style="color: #000000">):
    js3 </span>= <span style="color: #800000">'</span><span style="color: #800000">window.scrollTo(</span><span style="color: #800000">'</span>+str(j*1280)+<span style="color: #800000">'</span><span style="color: #800000">,</span><span style="color: #800000">'</span>+str((j+1)*1280)+<span style="color: #800000">'</span><span style="color: #800000">)</span><span style="color: #800000">'</span><span style="color: #000000">
    llqdx.execute_script(js3)  </span><span style="color: #008000">#</span><span style="color: #008000">执行js语言滚动滚动条</span>
    time.sleep(1</span><span style="color: #000000"><span style="background-color: #ff99cc">)
</span>

llqdx.get_screenshot_as_file(</span><span style="color: #800000">'</span><span style="color: #800000">H:/py/17/img/123.jpg</span><span style="color: #800000">'</span>)  <span style="color: #008000">#</span><span style="color: #008000">将网页截图，保存到此目录</span>
<span style="color: #000000">
url </span>=<span style="color: #000000"> llqdx.<span style="background-color: #ff99cc">current_url
</span></span><span style="color: #0000ff">print</span><span style="color: #000000">(url)

neir </span>= llqdx.page_source   <span style="color: #008000">#</span><span style="color: #008000">获取网页内容</span>
<span style="color: #0000ff">print</span><span style="color: #000000">(neir)
llqdx.quit()    </span><span style="color: #008000">#</span><span style="color: #008000">关闭浏览器</span>
<span style="color: #000000">
pat </span>= <span style="color: #800000">"</span><span style="color: #800000">&lt;title&gt;(.*?)&lt;/title&gt;</span><span style="color: #800000">"</span><span style="color: #000000">
title </span>= re.compile(pat).findall(neir)  <span style="color: #008000">#</span><span style="color: #008000">正则匹配网页标题</span>
<span style="color: #0000ff">print</span>(title)</pre>
</div>
<p><img src="https://images2017.cnblogs.com/blog/955761/201708/955761-20170802175104443-1055543072.png" alt=""></p>
<p>&nbsp;</p></div>