第三百零六节，Django框架,models.py模块，数据库操作——创建表、数据类型、索引、admin后台，补充Django目录说明以及全局配置文件配置


			<div id="cnblogs_post_body" class="blogpost-body"><p><strong>Django框架,models.py模块，数据库操作——创建表、数据类型、索引、admin后台，补充Django目录说明以及全局配置文件配置</strong></p>
<p><strong><img src="https://images2015.cnblogs.com/blog/955761/201707/955761-20170709195819509-1644743724.png" alt=""></strong></p>
<p>&nbsp;</p>
<p><img src="https://images2015.cnblogs.com/blog/955761/201707/955761-20170709195905103-752342081.png" alt=""></p>
<p>&nbsp;</p>
<h4><span style="color: #ff0000; background-color: #ffff00">&nbsp;数据库配置 &nbsp;</span></h4>
<p><strong><span style="color: #ff0000">django默认支持<span style="color: #0000ff">sqlite</span>，<span style="color: #0000ff">mysql</span>, <span style="color: #0000ff">oracle</span>,<span style="color: #0000ff">postgresql</span>数据库。</span></strong></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>1，django默认使用sqlite的数据库，默认自带sqlite的数据库驱动</strong></span></p>
<p>&nbsp;</p>
<p><strong>&nbsp;　　引擎名称：django.db.backends.sqlite3</strong></p>
<p><strong>　　在全局配置文件settings.py可以看到确认配置<strong>使用<strong><strong>的</strong></strong>sqlite数据库</strong></strong></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000"> Database</span><span style="color: #008000">
#</span><span style="color: #008000"> https://docs.djangoproject.com/en/1.10/ref/settings/#databases</span><span style="color: #008000">
#</span><span style="color: #008000"> 默认配置使用的sqlite数据库</span>
DATABASES =<span style="color: #000000"> {
    </span><span style="color: #800000">'</span><span style="color: #800000">default</span><span style="color: #800000">'</span><span style="color: #000000">: {
        </span><span style="color: #800000">'</span><span style="color: #800000">ENGINE</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">django.db.backends.sqlite3</span><span style="color: #800000">'</span>,                 <span style="color: #008000">#</span><span style="color: #008000">配置数据库引擎名称</span>
        <span style="color: #800000">'</span><span style="color: #800000">NAME</span><span style="color: #800000">'</span>: os.path.join(BASE_DIR, <span style="color: #800000">'</span><span style="color: #800000">db.sqlite3</span><span style="color: #800000">'</span>),           <span style="color: #008000">#</span><span style="color: #008000">生成数据库到当前的项目文件夹里</span>
<span style="color: #000000">    }
}</span></pre>
</div>
<p><strong><strong><img src="https://images2015.cnblogs.com/blog/955761/201707/955761-20170709214250322-782819237.png" alt=""></strong></strong></p>
<p>&nbsp;</p>
<p><span style="color: #000000"><strong>所以我们首次运行程序时会在目录生成db.sqlite3数据库</strong></span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="background-color: #ffff00"><strong><span style="color: #ff0000">2，MySQL数据库【重点】</span></strong></span></p>
<p><strong>mysql驱动程序</strong></p>
<p><strong>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MySQLdb(mysql python)</strong></p>
<p><strong>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mysqlclient</strong></p>
<p><strong>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MySQL</strong></p>
<p><strong>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PyMySQL(纯python的mysql驱动程序)</strong></p>
<p><span style="color: #ff0000"><strong>在django的项目中会默认使用sqlite数据库，如果要使用<strong>MySQL数据库需要重新配置<strong>MySQL数据库信息，将<strong>sqlite数据库注释掉</strong></strong></strong></strong></span></p>
<p><span style="color: #ff0000"><strong><strong><strong><strong>在<span style="color: #0000ff"><strong>settings.py</strong></span>配置<strong>MySQL数据库信息</strong></strong></strong></strong></strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">MySQL数据库</span>
DATABASES =<span style="color: #000000"> {
    </span><span style="color: #800000">'</span><span style="color: #800000">default</span><span style="color: #800000">'</span><span style="color: #000000">: {
        </span><span style="color: #800000">'</span><span style="color: #800000">ENGINE</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">django.db.backends.mysql</span><span style="color: #800000">'</span>,       <span style="color: #008000">#</span><span style="color: #008000">配置数据库引擎名称</span>
        <span style="color: #800000">'</span><span style="color: #800000">NAME</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">jxiou</span><span style="color: #800000">'</span>,                            <span style="color: #008000">#</span><span style="color: #008000">数据库名称</span>
        <span style="color: #800000">'</span><span style="color: #800000">USER</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">root</span><span style="color: #800000">'</span>,                             <span style="color: #008000">#</span><span style="color: #008000">数据库用户名</span>
        <span style="color: #800000">'</span><span style="color: #800000">PASSWORD</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">279819</span><span style="color: #800000">'</span>,                       <span style="color: #008000">#</span><span style="color: #008000">数据库密码</span>
        <span style="color: #800000">'</span><span style="color: #800000">HOST</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">127.0.0.1</span><span style="color: #800000">'</span>,                        <span style="color: #008000">#</span><span style="color: #008000">数据库链接地址</span>
        <span style="color: #800000">'</span><span style="color: #800000">PORT</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">3306</span><span style="color: #800000">'</span>,                             <span style="color: #008000">#</span><span style="color: #008000">数据库端口</span>
<span style="color: #000000">    }
}</span></pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201707/955761-20170710092234868-332058295.png" alt=""></p>
<p>&nbsp;</p>
<p><strong>注意：NAME即数据库的名字，在mysql连接前该数据库必须已经创建，而上面的sqlite数据库下的db.sqlite3则是项目自动创建</strong></p>
<p><strong>USER和PASSWORD分别是数据库的用户名和密码。</strong></p>
<p><strong>设置完后，再启动我们的Django项目前，需要激活我们的mysql。</strong></p>
<p><strong>然后，启动项目，<span style="color: #ff0000">会报错：no module named MySQLdb</span></strong></p>
<p><strong>这是因为django默认你导入的驱动是<span style="color: #ff0000">MySQLdb</span>，可是<span style="color: #ff0000">MySQLdb对于py3有很大问题</span>，所以我们需要的驱动是<span style="color: #ff0000">PyMySQL</span></strong></p>
<p><strong>所以，我们只需要找到项目里的全局配置里的<span style="color: #0000ff">__init__,py<span style="color: #000000">配置数据库驱动</span></span><br></strong></p>
<p><strong>在里面写入：</strong></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">import</span><span style="color: #000000"> pymysql

pymysql.install_as_MySQLdb()</span></pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201707/955761-20170710102102900-1602541038.png" alt=""></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #000000"><strong>此时django框架连接MySQL数据库配置好了</strong></span></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>给PyCharm安装MySQL数据库管理插件</strong></span></p>
<p><img src="https://images2015.cnblogs.com/blog/955761/201707/955761-20170710122612837-1729529223.png" alt=""></p>
<p>配置数据库信息</p>
<p><img src="https://images2015.cnblogs.com/blog/955761/201707/955761-20170710122921243-1567320497.png" alt=""></p>
<p>下载数据库管理插件</p>
<p><img src="https://images2015.cnblogs.com/blog/955761/201707/955761-20170710123030165-623163917.png" alt=""></p>
<p><img src="https://images2015.cnblogs.com/blog/955761/201707/955761-20170710123138509-401642096.png" alt=""></p>
<p><img src="https://images2015.cnblogs.com/blog/955761/201707/955761-20170710123213181-450710364.png" alt=""></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>django创建数据库表</strong></span></p>
<p><span style="color: #ff0000"><strong>在操作数据库表之前，首先检查一下全局配置文件settings.py里的数据库表操作配置里是否配置了应用路径，如果没有需要加入应用路径</strong></span></p>
<div class="cnblogs_code">
<pre>INSTALLED_APPS =<span style="color: #000000"> [
    </span><span style="color: #800000">'</span><span style="color: #800000">django.contrib.admin</span><span style="color: #800000">'</span><span style="color: #000000">,
    </span><span style="color: #800000">'</span><span style="color: #800000">django.contrib.auth</span><span style="color: #800000">'</span><span style="color: #000000">,
    </span><span style="color: #800000">'</span><span style="color: #800000">django.contrib.contenttypes</span><span style="color: #800000">'</span><span style="color: #000000">,
    </span><span style="color: #800000">'</span><span style="color: #800000">django.contrib.sessions</span><span style="color: #800000">'</span><span style="color: #000000">,
    </span><span style="color: #800000">'</span><span style="color: #800000">django.contrib.messages</span><span style="color: #800000">'</span><span style="color: #000000">,
    </span><span style="color: #800000">'</span><span style="color: #800000">django.contrib.staticfiles</span><span style="color: #800000">'</span><span style="color: #000000">,
    </span><span style="background-color: #ff99cc"><span style="color: #800000">'</span><span style="color: #800000">app1</span><span style="color: #800000">'</span></span><span style="color: #000000">,
]</span></pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201707/955761-20170710170400337-1294120471.png" alt=""></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>配置好了我们开始创建表</strong></span></p>
<p><span style="color: #ff0000"><strong>对数据库表的操作都是由<span style="color: #0000ff">django下db模块的<span style="color: #ff0000">models</span>对象来操作的，所以需要导入这个对象</span></strong></span></p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff">注意：一张表对应一个类</span></strong></span></p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff">首先要创建一个类来操作一张表，而这个类必须继承<span style="color: #ff0000">models.Model</span>对象</span></strong></span></p>
<p><span style="color: #ff0000"><strong>注意创建表之前，必须要先创建好数据库</strong></span></p>
<p>&nbsp;</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">from</span> <span style="color: #800080">__future__</span> <span style="color: #0000ff">import</span><span style="color: #000000"> unicode_literals

</span><span style="color: #0000ff">from</span> django.db <span style="color: #0000ff">import</span> models        <span style="color: #008000">#</span><span style="color: #008000">导入models对象</span>

<span style="color: #0000ff">class</span> userinfo(models.Model):       <span style="color: #008000">#</span><span style="color: #008000">创建类必须继承models.Model，类名将是在数据库里的表名称</span>
    <span style="color: #008000">#</span><span style="color: #008000">不设置主键id将自动创建</span>
    anem = models.CharField(<span style="color: #800000">"</span><span style="color: #800000">用户名</span><span style="color: #800000">"</span>,max_length=50)       <span style="color: #008000">#</span><span style="color: #008000">设置一个anem名称的字符串字段,最大长度50位，在django后台显示名称为：用户名</span>
    address = models.CharField(<span style="color: #800000">"</span><span style="color: #800000">地址</span><span style="color: #800000">"</span>, max_length=50<span style="color: #000000">)
    city </span>= models.CharField(<span style="color: #800000">'</span><span style="color: #800000">城市</span><span style="color: #800000">'</span>, max_length=60<span style="color: #000000">)
    country </span>= models.CharField(max_length=50<span style="color: #000000">)

    </span><span style="color: #0000ff">class</span><span style="color: #000000"> Meta:
        verbose_name </span>= <span style="color: #800000">'</span><span style="color: #800000">用户表</span><span style="color: #800000">'</span>                           <span style="color: #008000">#</span><span style="color: #008000">设置表名称在django后台显示的中文名称</span>
        verbose_name_plural =<span style="color: #000000"> verbose_name

    </span><span style="color: #0000ff">def</span> <span style="color: #800080">__str__</span>(self):                                   <span style="color: #008000">#</span><span style="color: #008000">设置在django后台显示字段名称</span>
        <span style="color: #0000ff">return</span> self.anem</pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>设置好操作表的类后，我们需要生成表，生成表需要在PyCharm的终端输入命令，先输入&nbsp;<span style="color: #0000ff">makemigrations</span> &nbsp;然后在输入 &nbsp;&nbsp;<span style="color: #0000ff">migrate &nbsp; <span style="color: #ff0000">来生成表</span></span></strong></span></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong><img src="https://images2015.cnblogs.com/blog/955761/201707/955761-20170711102026368-779196364.png" alt=""></strong></span></p>
<p><span style="color: #ff0000"><strong><img src="https://images2015.cnblogs.com/blog/955761/201707/955761-20170711102037697-2057634074.png" alt=""></strong></span></p>
<p><span style="color: #ff0000"><strong>此时表就生成了</strong></span></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>注意：我们已经生成了需要的表，也包含我们自定义的userinfo表，此时数据库里的<span style="color: #0000ff">django_migrations表</span>记录了，我们生成表时的信息，</strong></span></p>
<p><span style="color: #ff0000"><strong>如果我们将我们的<strong>userinfo表，删除后，在执行命令重建我们的<strong><span style="color: #0000ff">userinfo表</span>，将无法生成，因为<strong><span style="color: #0000ff">django_migrations表</span>记录了你已经生成了</strong></strong></strong></strong></span></p>
<p><span style="color: #ff0000"><strong><strong><strong><strong>解决方法：</strong></strong></strong></strong></span></p>
<p><span style="color: #ff0000"><strong><strong><strong><strong>现将项目里<strong><strong><strong><strong><span style="color: #0000ff">migrations目录</span>下的缓存删除</strong></strong></strong></strong></strong></strong></strong></strong></span></p>
<p><span style="color: #ff0000"><strong><img src="https://images2015.cnblogs.com/blog/955761/201707/955761-20170711102921900-942189502.png" alt=""></strong></span></p>
<p><span style="color: #ff0000"><strong>在重新执行命令，<strong><span style="color: #0000ff">makemigrations</span>&nbsp;&nbsp;然后在输入 &nbsp;&nbsp;<span style="color: #0000ff">migrate</span> &nbsp;&nbsp;来生成表，会提示你已经生成了这个表</strong></strong></span></p>
<p><span style="color: #ff0000"><strong><strong><img src="https://images2015.cnblogs.com/blog/955761/201707/955761-20170711103214415-830873593.png" alt=""></strong></strong></span></p>
<p><span style="color: #ff0000"><strong><strong>我们打开<strong><strong><strong><strong><span style="color: #0000ff">django_migrations表</span>里找到，与现在<strong><strong><strong><strong><strong><strong><strong><strong><span style="color: #0000ff">migrations目录</span>下缓存名称相同的记录</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></span></p>
<p><span style="color: #ff0000"><strong><strong><img src="https://images2015.cnblogs.com/blog/955761/201707/955761-20170711103548759-1127892425.png" alt=""></strong></strong></span></p>
<p><span style="color: #ff0000"><strong><strong>我们把<strong><strong><strong><strong><strong><strong><span style="color: #0000ff">django_migrations表</span>里的这条记录，删除后，就可以再次生成了</strong></strong></strong></strong></strong></strong></strong></strong></span></p>
<p><span style="color: #ff0000"><strong><strong><strong><strong><strong><strong><strong><strong>重点：注意只删除<strong><strong><strong><strong><strong><strong><span style="color: #0000ff">django_migrations表</span>里，与现在<strong><strong><strong><strong><strong><strong><strong><strong><span style="color: #0000ff">migrations目录</span>下缓存名称相同的记录，否则将出问题</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>配置django的admin数据库管理后台</strong></span></p>
<p><span><strong>首先配置数据库后台路由映射</strong></span></p>
<div class="cnblogs_code">
<pre>from django.conf.urls import<span> url
from django.contrib import<span> admin
from app1 import<span> views

urlpatterns =<span> [
    <span style="background-color: #ff99cc">url(r'admin/', admin.site.urls),</span>   #路由映射admin数据库管理
    url(r'articles/', views.special)     #路由映射第三个参数，额外传参，字典方式，逻辑处理函数以参数方式接收字典键
]</span></span></span></span></pre>
</div>
<p><strong>然后在PyCharm终端输入命令<span style="color: #0000ff">&nbsp;Python manage.py createsuperuser</span></strong></p>
<p><strong>1、设置用户名</strong></p>
<p><strong>2、设置邮箱</strong></p>
<p><strong>3、设置密码，8位以上，不能纯数字</strong></p>
<p><strong>4、确认密码</strong></p>
<p><strong><img src="https://images2015.cnblogs.com/blog/955761/201707/955761-20170710183316181-1871518023.png" alt=""></strong></p>
<p><strong>然后用刚才设置的用户名和密码登录</strong></p>
<p><strong><img src="https://images2015.cnblogs.com/blog/955761/201707/955761-20170710183700728-1119795449.png" alt=""></strong></p>
<p><strong>只能看到刚才创建的用户登录数据，数据库数据需要在项目的admin.py里注册才能看到</strong></p>
<p><strong>admin.site.register(参数是数据库操作表的类)，注册数据库到admin数据库管理，参数是models.py里操作数据库表的类</strong></p>
<div class="cnblogs_code">
<pre>from django.contrib import<span> admin
from app1.models import *<span><span style="background-color: #ff99cc">

admin.site.register(userinfo)</span> #注册数据库到admin数据库管理，参数是models.py里操作数据库表的类</span></span></pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201707/955761-20170710185344431-1875529835.png" alt=""></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>此时，可以看到admin管理页面已经出现了我们刚才创建的，用户表，显示的是中文，而且字段，也是中文，因为我们在用户表类里设置了admin显示中文的名称</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">from</span> <span style="color: #800080">__future__</span> <span style="color: #0000ff">import</span><span style="color: #000000"> unicode_literals

</span><span style="color: #0000ff">from</span> django.db <span style="color: #0000ff">import</span> models        <span style="color: #008000">#</span><span style="color: #008000">导入models对象</span>

<span style="color: #0000ff">class</span> userinfo(models.Model):       <span style="color: #008000">#</span><span style="color: #008000">创建类必须继承models.Model，类名将是在数据库里的表名称</span>
    <span style="color: #008000">#</span><span style="color: #008000">不设置主键id将自动创建</span>
    anem = models.CharField(<span style="background-color: #ff99cc"><span style="color: #800000">"</span><span style="color: #800000">用户名</span><span style="color: #800000">"</span></span>,max_length=50)       <span style="color: #008000">#</span><span style="color: #008000">设置一个anem名称的字符串字段,最大长度50位，在django后台显示名称为：用户名</span>
    address = models.CharField(<span style="background-color: #ff99cc"><span style="color: #800000">"</span><span style="color: #800000">地址</span><span style="color: #800000">"</span></span>, max_length=50<span style="color: #000000">)
    city </span>= models.CharField(<span style="color: #800000">'</span><span style="color: #800000">城市</span><span style="color: #800000">'</span>, max_length=60<span style="color: #000000">)
    country </span>= models.CharField(max_length=50<span style="color: #000000">)

    </span><span style="color: #0000ff">class</span><span style="color: #000000"> Meta:
        <span style="background-color: #ff99cc">verbose_name </span></span><span style="background-color: #ff99cc">= <span style="color: #800000">'</span><span style="color: #800000">用户表</span><span style="color: #800000">'</span>                           <span style="color: #008000">#</span><span style="color: #008000">设置表名称在django后台显示的中文名称</span>
        verbose_name_plural =<span style="color: #000000"> verbose_name

    </span></span><span style="color: #0000ff">def</span> <span style="color: #800080">__str__</span>(self):                                   <span style="color: #008000">#</span><span style="color: #008000">设置在django后台显示字段名称</span>
        <span style="color: #0000ff">return</span> self.anem</pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201707/955761-20170711105516790-1663334621.png" alt=""></p>
<p><span style="color: #ff0000"><strong>我们创建一条数据看看</strong></span></p>
<p><span style="color: #ff0000"><strong><img src="https://images2015.cnblogs.com/blog/955761/201707/955761-20170711105919322-808502176.png" alt=""></strong></span></p>
<p><span style="color: #ff0000"><strong>此时我们看到只显示了一个字段</strong></span></p>
<p><span style="color: #ff0000"><strong><img src="https://images2015.cnblogs.com/blog/955761/201707/955761-20170711110104712-2060046994.png" alt=""></strong></span></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>此时，我们需要配置admin显示所有字段</strong></span></p>
<p><span style="color: #ff0000"><strong>方法：找到项目应用里的<span style="color: #0000ff">admin.py文件，<span style="color: #ff0000">在注册表到admin哪里添加一个类，类继承admin.ModelAdmin类</span></span></strong></span></p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff"><span style="color: #ff0000">配置好相应字段后，将类同表一起注册到admin</span></span></strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">from</span> django.contrib <span style="color: #0000ff">import</span><span style="color: #000000"> admin
</span><span style="color: #0000ff">from</span> app1.models <span style="color: #0000ff">import</span> *

<span style="color: #008000">#</span><span style="color: #008000">配置userinfo表在admin的显示信息</span>
<span style="background-color: #ff99cc"><span style="color: #0000ff">class</span><span style="color: #000000"> userinfoAdmin(admin.ModelAdmin):
    </span><span style="color: #008000">#</span><span style="color: #008000"> 配置显示字段,</span>
    list_display = (<span style="color: #800000">'</span><span style="color: #800000">anem</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">address</span><span style="color: #800000">'</span>,<span style="color: #800000">'</span><span style="color: #800000">city</span><span style="color: #800000">'</span>,<span style="color: #800000">'</span><span style="color: #800000">country</span><span style="color: #800000">'</span><span style="color: #000000">)
    </span><span style="color: #008000">#</span><span style="color: #008000"> 配置查询字段</span>
    search_fields = (<span style="color: #800000">'</span><span style="color: #800000">anem</span><span style="color: #800000">'</span>,<span style="color: #800000">'</span><span style="color: #800000">city</span><span style="color: #800000">'</span><span style="color: #000000">)
    </span><span style="color: #008000">#</span><span style="color: #008000"> 配置排序字段</span>
    ordering = (<span style="color: #800000">'</span><span style="color: #800000">-id</span><span style="color: #800000">'</span><span style="color: #000000">,)
    </span><span style="color: #008000">#</span><span style="color: #008000"> 配置右边是否有过滤条件字段</span>
    list_filter = (<span style="color: #800000">'</span><span style="color: #800000">address</span><span style="color: #800000">'</span></span><span style="color: #000000"><span style="background-color: #ff99cc">,)</span>
admin.site.register(userinfo,<span style="background-color: #ff99cc">userinfoAdmin</span>) </span><span style="color: #008000">#</span><span style="color: #008000">注册数据库到admin数据库管理，参数是models.py里操作数据库表的类</span></pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201707/955761-20170711111916150-834503106.png" alt=""></p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff"><span style="color: #ff0000">&nbsp;</span></span></strong></span></p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff"><span style="color: #ff0000">下面介绍表的数据类型，以及参数</span></span></strong></span></p>
<p>&nbsp;</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">from</span> <span style="color: #800080">__future__</span> <span style="color: #0000ff">import</span><span style="color: #000000"> unicode_literals

</span><span style="color: #0000ff">from</span> django.db <span style="color: #0000ff">import</span> models        <span style="color: #008000">#</span><span style="color: #008000">导入models对象</span>

<span style="color: #0000ff">class</span> userinfo(models.Model):       <span style="color: #008000">#</span><span style="color: #008000">创建类必须继承models.Model，类名将是在数据库里的表名称</span>
    <span style="color: #008000">#</span><span style="color: #008000">不设置主键id将自动创建</span>
    anem = models.<span style="background-color: #ff99cc">CharField</span>(<span style="color: #800000">"</span><span style="color: #800000">用户名</span><span style="color: #800000">"</span>,max_length=50)       <span style="color: #008000">#</span><span style="color: #008000">设置一个anem名称的字符串字段,最大长度50位，在django后台显示名称为：用户名</span>
    address = models.<span style="background-color: #ff99cc">CharField</span>(<span style="color: #800000">"</span><span style="color: #800000">地址</span><span style="color: #800000">"</span>, max_length=50<span style="color: #000000">)
    city </span>= models.<span style="background-color: #ff99cc">CharField</span>(<span style="color: #800000">'</span><span style="color: #800000">城市</span><span style="color: #800000">'</span>, max_length=60<span style="color: #000000">)
    country </span>= models.<span style="background-color: #ff99cc">CharField</span>(<span style="color: #800000">'</span><span style="color: #800000">性别</span><span style="color: #800000">'</span>,max_length=50<span style="color: #000000">)

    </span><span style="color: #0000ff">class</span><span style="color: #000000"> Meta:
        verbose_name </span>= <span style="color: #800000">'</span><span style="color: #800000">用户表</span><span style="color: #800000">'</span>                           <span style="color: #008000">#</span><span style="color: #008000">设置表名称在django后台显示的中文名称</span>
        verbose_name_plural =<span style="color: #000000"> verbose_name

    </span><span style="color: #0000ff">def</span> <span style="color: #800080">__str__</span>(self):                                   <span style="color: #008000">#</span><span style="color: #008000">设置在django后台显示字段名称</span>
        <span style="color: #0000ff">return</span> self.anem</pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>上面我们只用到了<span style="color: #0000ff">CharField()</span>，也就是<span style="color: #0000ff">varchar</span>字符串类型，参数也只用到</strong></span><span style="color: #ff0000"><strong><span style="color: #0000ff">max_length=50</span>，最大长度50位</strong></span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><span style="color: #ff0000"><strong>models对象的数据类型</strong></span></span></p>
<div class="cnblogs_code">
<pre><span style="color: #000000">AutoField(Field)
        </span>- int自增列，必须填入参数 primary_key=<span style="color: #000000">True

    BigAutoField(AutoField)
        </span>- bigint自增列，必须填入参数 primary_key=<span style="color: #000000">True

        注：当model中如果没有自增列，则自动会创建一个列名为id的列
        </span><span style="color: #0000ff">from</span> django.db <span style="color: #0000ff">import</span><span style="color: #000000"> models

        </span><span style="color: #0000ff">class</span><span style="color: #000000"> UserInfo(models.Model):
            </span><span style="color: #008000">#</span><span style="color: #008000"> 自动创建一个列名为id的且为自增的整数列</span>
            username = models.CharField(max_length=32<span style="color: #000000">)

        </span><span style="color: #0000ff">class</span><span style="color: #000000"> Group(models.Model):
            </span><span style="color: #008000">#</span><span style="color: #008000"> 自定义自增列</span>
            nid = models.AutoField(primary_key=<span style="color: #000000">True)
            name </span>= models.CharField(max_length=32<span style="color: #000000">)

    SmallIntegerField(IntegerField):
        </span>- 小整数 -32768 ～ 32767<span style="color: #000000">

    PositiveSmallIntegerField(PositiveIntegerRelDbTypeMixin, IntegerField)
        </span>- 正小整数 0 ～ 32767<span style="color: #000000">
    IntegerField(Field)
        </span>- 整数列(有符号的) -2147483648 ～ 2147483647<span style="color: #000000">

    PositiveIntegerField(PositiveIntegerRelDbTypeMixin, IntegerField)
        </span>- 正整数 0 ～ 2147483647<span style="color: #000000">

    BigIntegerField(IntegerField):
        </span>- 长整型(有符号的) -9223372036854775808 ～ 9223372036854775807<span style="color: #000000">

    自定义无符号整数字段

        </span><span style="color: #0000ff">class</span><span style="color: #000000"> UnsignedIntegerField(models.IntegerField):
            </span><span style="color: #0000ff">def</span><span style="color: #000000"> db_type(self, connection):
                </span><span style="color: #0000ff">return</span> <span style="color: #800000">'</span><span style="color: #800000">integer UNSIGNED</span><span style="color: #800000">'</span><span style="color: #000000">

        PS: 返回值为字段在数据库中的属性，Django字段默认的值为：
            </span><span style="color: #800000">'</span><span style="color: #800000">AutoField</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">integer AUTO_INCREMENT</span><span style="color: #800000">'</span><span style="color: #000000">,
            </span><span style="color: #800000">'</span><span style="color: #800000">BigAutoField</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">bigint AUTO_INCREMENT</span><span style="color: #800000">'</span><span style="color: #000000">,
            </span><span style="color: #800000">'</span><span style="color: #800000">BinaryField</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">longblob</span><span style="color: #800000">'</span><span style="color: #000000">,
            </span><span style="color: #800000">'</span><span style="color: #800000">BooleanField</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">bool</span><span style="color: #800000">'</span><span style="color: #000000">,
            </span><span style="color: #800000">'</span><span style="color: #800000">CharField</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">varchar(%(max_length)s)</span><span style="color: #800000">'</span><span style="color: #000000">,
            </span><span style="color: #800000">'</span><span style="color: #800000">CommaSeparatedIntegerField</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">varchar(%(max_length)s)</span><span style="color: #800000">'</span><span style="color: #000000">,
            </span><span style="color: #800000">'</span><span style="color: #800000">DateField</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">date</span><span style="color: #800000">'</span><span style="color: #000000">,
            </span><span style="color: #800000">'</span><span style="color: #800000">DateTimeField</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">datetime</span><span style="color: #800000">'</span><span style="color: #000000">,
            </span><span style="color: #800000">'</span><span style="color: #800000">DecimalField</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">numeric(%(max_digits)s, %(decimal_places)s)</span><span style="color: #800000">'</span><span style="color: #000000">,
            </span><span style="color: #800000">'</span><span style="color: #800000">DurationField</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">bigint</span><span style="color: #800000">'</span><span style="color: #000000">,
            </span><span style="color: #800000">'</span><span style="color: #800000">FileField</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">varchar(%(max_length)s)</span><span style="color: #800000">'</span><span style="color: #000000">,
            </span><span style="color: #800000">'</span><span style="color: #800000">FilePathField</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">varchar(%(max_length)s)</span><span style="color: #800000">'</span><span style="color: #000000">,
            </span><span style="color: #800000">'</span><span style="color: #800000">FloatField</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">double precision</span><span style="color: #800000">'</span><span style="color: #000000">,
            </span><span style="color: #800000">'</span><span style="color: #800000">IntegerField</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">integer</span><span style="color: #800000">'</span><span style="color: #000000">,
            </span><span style="color: #800000">'</span><span style="color: #800000">BigIntegerField</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">bigint</span><span style="color: #800000">'</span><span style="color: #000000">,
            </span><span style="color: #800000">'</span><span style="color: #800000">IPAddressField</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">char(15)</span><span style="color: #800000">'</span><span style="color: #000000">,
            </span><span style="color: #800000">'</span><span style="color: #800000">GenericIPAddressField</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">char(39)</span><span style="color: #800000">'</span><span style="color: #000000">,
            </span><span style="color: #800000">'</span><span style="color: #800000">NullBooleanField</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">bool</span><span style="color: #800000">'</span><span style="color: #000000">,
            </span><span style="color: #800000">'</span><span style="color: #800000">OneToOneField</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">integer</span><span style="color: #800000">'</span><span style="color: #000000">,
            </span><span style="color: #800000">'</span><span style="color: #800000">PositiveIntegerField</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">integer UNSIGNED</span><span style="color: #800000">'</span><span style="color: #000000">,
            </span><span style="color: #800000">'</span><span style="color: #800000">PositiveSmallIntegerField</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">smallint UNSIGNED</span><span style="color: #800000">'</span><span style="color: #000000">,
            </span><span style="color: #800000">'</span><span style="color: #800000">SlugField</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">varchar(%(max_length)s)</span><span style="color: #800000">'</span><span style="color: #000000">,
            </span><span style="color: #800000">'</span><span style="color: #800000">SmallIntegerField</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">smallint</span><span style="color: #800000">'</span><span style="color: #000000">,
            </span><span style="color: #800000">'</span><span style="color: #800000">TextField</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">longtext</span><span style="color: #800000">'</span><span style="color: #000000">,
            </span><span style="color: #800000">'</span><span style="color: #800000">TimeField</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">time</span><span style="color: #800000">'</span><span style="color: #000000">,
            </span><span style="color: #800000">'</span><span style="color: #800000">UUIDField</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">char(32)</span><span style="color: #800000">'</span><span style="color: #000000">,

    BooleanField(Field)
        </span>-<span style="color: #000000"> 布尔值类型

    NullBooleanField(Field):
        </span>-<span style="color: #000000"> 可以为空的布尔值

    CharField(Field)
        </span>-<span style="color: #000000"> 字符类型
        </span>-<span style="color: #000000"> 必须提供max_length参数， max_length表示字符长度

    TextField(Field)
        </span>-<span style="color: #000000"> 文本类型

    EmailField(CharField)：
        </span>-<span style="color: #000000"> 字符串类型，Django Admin以及ModelForm中提供验证机制

    IPAddressField(Field)
        </span>-<span style="color: #000000"> 字符串类型，Django Admin以及ModelForm中提供验证 IPV4 机制

    GenericIPAddressField(Field)
        </span>-<span style="color: #000000"> 字符串类型，Django Admin以及ModelForm中提供验证 Ipv4和Ipv6
        </span>-<span style="color: #000000"> 参数：
            protocol，用于指定Ipv4或Ipv6， </span><span style="color: #800000">'</span><span style="color: #800000">both</span><span style="color: #800000">'</span>,<span style="color: #800000">"</span><span style="color: #800000">ipv4</span><span style="color: #800000">"</span>,<span style="color: #800000">"</span><span style="color: #800000">ipv6</span><span style="color: #800000">"</span><span style="color: #000000">
            unpack_ipv4， 如果指定为True，则输入::ffff:</span>192.0.2.1时候，可解析为192.0.2.1，开启刺功能，需要protocol=<span style="color: #800000">"</span><span style="color: #800000">both</span><span style="color: #800000">"</span><span style="color: #000000">

    URLField(CharField)
        </span>-<span style="color: #000000"> 字符串类型，Django Admin以及ModelForm中提供验证 URL

    SlugField(CharField)
        </span>-<span style="color: #000000"> 字符串类型，Django Admin以及ModelForm中提供验证支持 字母、数字、下划线、连接符（减号）

    CommaSeparatedIntegerField(CharField)
        </span>-<span style="color: #000000"> 字符串类型，格式必须为逗号分割的数字

    UUIDField(Field)
        </span>-<span style="color: #000000"> 字符串类型，Django Admin以及ModelForm中提供对UUID格式的验证

    FilePathField(Field)
        </span>-<span style="color: #000000"> 字符串，Django Admin以及ModelForm中提供读取文件夹下文件的功能
        </span>-<span style="color: #000000"> 参数：
                path,                      文件夹路径
                match</span>=<span style="color: #000000">None,                正则匹配
                recursive</span>=<span style="color: #000000">False,           递归下面的文件夹
                allow_files</span>=<span style="color: #000000">True,          允许文件
                allow_folders</span>=<span style="color: #000000">False,       允许文件夹

    FileField(Field)
        </span>-<span style="color: #000000"> 字符串，路径保存在数据库，文件上传到指定目录
        </span>-<span style="color: #000000"> 参数：
            upload_to </span>= <span style="color: #800000">""</span><span style="color: #000000">      上传文件的保存路径
            storage </span>=<span style="color: #000000"> None      存储组件，默认django.core.files.storage.FileSystemStorage

    ImageField(FileField)
        </span>-<span style="color: #000000"> 字符串，路径保存在数据库，文件上传到指定目录
        </span>-<span style="color: #000000"> 参数：
            upload_to </span>= <span style="color: #800000">""</span><span style="color: #000000">      上传文件的保存路径
            storage </span>=<span style="color: #000000"> None      存储组件，默认django.core.files.storage.FileSystemStorage
            width_field</span>=<span style="color: #000000">None,   上传图片的高度保存的数据库字段名（字符串）
            height_field</span>=<span style="color: #000000">None   上传图片的宽度保存的数据库字段名（字符串）

    DateTimeField(DateField)
        </span>- 日期+时间格式 YYYY-MM-<span style="color: #000000">DD HH:MM[:ss[.uuuuuu]][TZ]

    DateField(DateTimeCheckMixin, Field)
        </span>- 日期格式      YYYY-MM-<span style="color: #000000">DD

    TimeField(DateTimeCheckMixin, Field)
        </span>-<span style="color: #000000"> 时间格式      HH:MM[:ss[.uuuuuu]]

    DurationField(Field)
        </span>-<span style="color: #000000"> 长整数，时间间隔，数据库中按照bigint存储，ORM中获取的值为datetime.timedelta类型

    FloatField(Field)
        </span>-<span style="color: #000000"> 浮点型

    DecimalField(Field)
        </span>-<span style="color: #000000"> 10进制小数
        </span>-<span style="color: #000000"> 参数：
            max_digits，小数总长度
            decimal_places，小数位长度

    BinaryField(Field)
        </span>- 二进制类型</pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>数据类型参数</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #000000">　　 null                数据库中字段是否可以为空
    db_column           数据库中字段的列名
    db_tablespace
    default             数据库中字段的默认值
    primary_key         数据库中字段是否为主键<br></span></pre>
<p>　　　auto_now 和 auto_now_add<br>　　　　auto_now 会自动创建时间字段，无论添加或者修改，都是系统当前时间<br>　　　　auto_now_add 会自动创建时间字段，永远是创建时的时间</p>
<pre><span style="color: #000000">
    db_index            数据库中字段是否可以建立索引
    <span style="background-color: #ff99cc">unique              数据库中字段是否可以建立唯一索引</span>
    unique_for_date     数据库中字段【日期】部分是否可以建立唯一索引
    unique_for_month    数据库中字段【月】部分是否可以建立唯一索引
    unique_for_year     数据库中字段【年】部分是否可以建立唯一索引

    verbose_name        Admin中显示的字段名称
    blank               Admin中是否允许用户输入为空
    editable            Admin中是否可以编辑
    help_text           Admin中该字段的提示信息
    choices             Admin中显示选择框的内容，用不变动的数据放在内存中从而避免跨表操作
                        如：gf </span>= models.IntegerField(choices=[(0, <span style="color: #800000">'</span><span style="color: #800000">何穗</span><span style="color: #800000">'</span>),(1, <span style="color: #800000">'</span><span style="color: #800000">大表姐</span><span style="color: #800000">'</span>),],default=1<span style="color: #000000">)

    error_messages      自定义错误信息（字典类型），从而定制想要显示的错误信息；
                        字典健：null, blank, invalid, invalid_choice, unique, </span><span style="color: #0000ff">and</span><span style="color: #000000"> unique_for_date
                        如：{</span><span style="color: #800000">'</span><span style="color: #800000">null</span><span style="color: #800000">'</span>: <span style="color: #800000">"</span><span style="color: #800000">不能为空.</span><span style="color: #800000">"</span>, <span style="color: #800000">'</span><span style="color: #800000">invalid</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">格式错误</span><span style="color: #800000">'</span><span style="color: #000000">}

    validators          自定义错误验证（列表类型），从而定制想要的验证规则
                        </span><span style="color: #0000ff">from</span> django.core.validators <span style="color: #0000ff">import</span><span style="color: #000000"> RegexValidator
                        </span><span style="color: #0000ff">from</span> django.core.validators <span style="color: #0000ff">import</span><span style="color: #000000"> EmailValidator,URLValidator,DecimalValidator,\
                        MaxLengthValidator,MinLengthValidator,MaxValueValidator,MinValueValidator
                        如：
                            test </span>=<span style="color: #000000"> models.CharField(
                                max_length</span>=32<span style="color: #000000">,
                                error_messages</span>=<span style="color: #000000">{
                                    </span><span style="color: #800000">'</span><span style="color: #800000">c1</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">优先错信息1</span><span style="color: #800000">'</span><span style="color: #000000">,
                                    </span><span style="color: #800000">'</span><span style="color: #800000">c2</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">优先错信息2</span><span style="color: #800000">'</span><span style="color: #000000">,
                                    </span><span style="color: #800000">'</span><span style="color: #800000">c3</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">优先错信息3</span><span style="color: #800000">'</span><span style="color: #000000">,
                                },
                                validators</span>=<span style="color: #000000">[
                                    RegexValidator(regex</span>=<span style="color: #800000">'</span><span style="color: #800000">root_\d+</span><span style="color: #800000">'</span>, message=<span style="color: #800000">'</span><span style="color: #800000">错误了</span><span style="color: #800000">'</span>, code=<span style="color: #800000">'</span><span style="color: #800000">c1</span><span style="color: #800000">'</span><span style="color: #000000">),
                                    RegexValidator(regex</span>=<span style="color: #800000">'</span><span style="color: #800000">root_112233\d+</span><span style="color: #800000">'</span>, message=<span style="color: #800000">'</span><span style="color: #800000">又错误了</span><span style="color: #800000">'</span>, code=<span style="color: #800000">'</span><span style="color: #800000">c2</span><span style="color: #800000">'</span><span style="color: #000000">),
                                    EmailValidator(message</span>=<span style="color: #800000">'</span><span style="color: #800000">又错误了</span><span style="color: #800000">'</span>, code=<span style="color: #800000">'</span><span style="color: #800000">c3</span><span style="color: #800000">'</span><span style="color: #000000">), ]
                            )</span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>创建表索引</strong></span></p>
<p><span style="color: #ff0000"><strong>普通索引，和联合普通索引</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">from</span> <span style="color: #800080">__future__</span> <span style="color: #0000ff">import</span><span style="color: #000000"> unicode_literals

</span><span style="color: #0000ff">from</span> django.db <span style="color: #0000ff">import</span> models        <span style="color: #008000">#</span><span style="color: #008000">导入models对象</span>

<span style="color: #0000ff">class</span><span style="color: #000000"> yhubiao(models.Model):
    id </span>= models.AutoField(<span style="color: #800000">'</span><span style="color: #800000">id</span><span style="color: #800000">'</span>,primary_key=<span style="color: #000000">True)
    anem </span>= models.CharField(<span style="color: #800000">"</span><span style="color: #800000">用户名</span><span style="color: #800000">"</span>,max_length=50<span style="color: #000000">)
    mim </span>= models.CharField(<span style="color: #800000">"</span><span style="color: #800000">地址</span><span style="color: #800000">"</span>, max_length=50<span style="color: #000000">)
    country </span>= models.CharField(<span style="color: #800000">'</span><span style="color: #800000">性别</span><span style="color: #800000">'</span>,max_length=50<span style="color: #000000">)

    </span><span style="color: #0000ff">class</span><span style="color: #000000"> Meta:
        </span><span style="color: #008000">#</span><span style="color: #008000"> 联合索引</span>
       <span style="background-color: #ff99cc"> index_together =<span style="color: #000000"> [
            (</span><span style="color: #800000">"</span><span style="color: #800000">anem</span><span style="color: #800000">"</span>, <span style="color: #800000">"</span><span style="color: #800000">mim</span><span style="color: #800000">"</span>),        <span style="color: #008000">#</span><span style="color: #008000">一个字段是普通索引，两个字段是联合普通索引</span>
</span><span style="color: #000000"><span style="background-color: #ff99cc">        ]</span>

        verbose_name </span>= <span style="color: #800000">'</span><span style="color: #800000">用户表</span><span style="color: #800000">'</span><span style="color: #000000">
        verbose_name_plural </span>=<span style="color: #000000"> verbose_name

    </span><span style="color: #0000ff">def</span> <span style="color: #800080">__str__</span><span style="color: #000000">(self):
        </span><span style="color: #0000ff">return</span> self.anem</pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>唯一索引和联合唯一索引</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">from</span> <span style="color: #800080">__future__</span> <span style="color: #0000ff">import</span><span style="color: #000000"> unicode_literals

</span><span style="color: #0000ff">from</span> django.db <span style="color: #0000ff">import</span> models        <span style="color: #008000">#</span><span style="color: #008000">导入models对象</span>

<span style="color: #0000ff">class</span><span style="color: #000000"> yhubiao(models.Model):
    id </span>= models.AutoField(<span style="color: #800000">'</span><span style="color: #800000">id</span><span style="color: #800000">'</span>,primary_key=<span style="color: #000000">True)
    anem </span>= models.CharField(<span style="color: #800000">"</span><span style="color: #800000">用户名</span><span style="color: #800000">"</span>,max_length=50<span style="color: #000000">)
    mim </span>= models.CharField(<span style="color: #800000">"</span><span style="color: #800000">地址</span><span style="color: #800000">"</span>, max_length=50<span style="color: #000000">)
    country </span>= models.CharField(<span style="color: #800000">'</span><span style="color: #800000">性别</span><span style="color: #800000">'</span>,max_length=50<span style="color: #000000">)

    </span><span style="color: #0000ff">class</span><span style="color: #000000"> Meta:
        </span><span style="color: #008000">#</span><span style="color: #008000"> 联合唯一索引</span>
       <span style="background-color: #ff99cc"> unique_together = ((<span style="color: #800000">"</span><span style="color: #800000">mim</span><span style="color: #800000">"</span>, <span style="color: #800000">"</span><span style="color: #800000">anem</span><span style="color: #800000">"</span>),) </span>       <span style="color: #008000">#</span><span style="color: #008000">一个字段是唯一索引，两个字段是联合唯一索引</span>
<span style="color: #000000">
        verbose_name </span>= <span style="color: #800000">'</span><span style="color: #800000">用户表</span><span style="color: #800000">'</span><span style="color: #000000">
        verbose_name_plural </span>=<span style="color: #000000"> verbose_name

    </span><span style="color: #0000ff">def</span> <span style="color: #800080">__str__</span><span style="color: #000000">(self):
        </span><span style="color: #0000ff">return</span> self.anem</pre>
</div>
<p><span style="color: #ff0000"><strong>触发验证</strong></span></p>
<div class="cnblogs_code">
<pre>1<span style="color: #000000">.触发Model中的验证和错误提示有两种方式：
        a. Django Admin中的错误信息会优先根据Admiin内部的ModelForm错误信息提示，如果都成功，才来检查Model的字段并显示指定错误信息
        b. 调用Model对象的 clean_fields 方法，如：
            </span><span style="color: #008000">#</span><span style="color: #008000"> models.py</span>
            <span style="color: #0000ff">class</span><span style="color: #000000"> UserInfo(models.Model):
                nid </span>= models.AutoField(primary_key=<span style="color: #000000">True)
                username </span>= models.CharField(max_length=32<span style="color: #000000">)

                email </span>= models.EmailField(error_messages={<span style="color: #800000">'</span><span style="color: #800000">invalid</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">格式错了.</span><span style="color: #800000">'</span><span style="color: #000000">})

            </span><span style="color: #008000">#</span><span style="color: #008000"> views.py</span>
            <span style="color: #0000ff">def</span><span style="color: #000000"> index(request):
                obj </span>= models.UserInfo(username=<span style="color: #800000">'</span><span style="color: #800000">11234</span><span style="color: #800000">'</span>, email=<span style="color: #800000">'</span><span style="color: #800000">uu</span><span style="color: #800000">'</span><span style="color: #000000">)
                </span><span style="color: #0000ff">try</span><span style="color: #000000">:
                    </span><span style="color: #0000ff">print</span><span style="color: #000000">(obj.clean_fields())
                </span><span style="color: #0000ff">except</span><span style="color: #000000"> Exception as e:
                    </span><span style="color: #0000ff">print</span><span style="color: #000000">(e)
                </span><span style="color: #0000ff">return</span> HttpResponse(<span style="color: #800000">'</span><span style="color: #800000">ok</span><span style="color: #800000">'</span><span style="color: #000000">)

           </span><span style="color: #008000">#</span><span style="color: #008000"> Model的clean方法是一个钩子，可用于定制操作，如：上述的异常处理。</span>

    2<span style="color: #000000">.Admin中修改错误提示
        </span><span style="color: #008000">#</span><span style="color: #008000"> admin.py</span>
        <span style="color: #0000ff">from</span> django.contrib <span style="color: #0000ff">import</span><span style="color: #000000"> admin
        </span><span style="color: #0000ff">from</span> model_club <span style="color: #0000ff">import</span><span style="color: #000000"> models
        </span><span style="color: #0000ff">from</span> django <span style="color: #0000ff">import</span><span style="color: #000000"> forms


        </span><span style="color: #0000ff">class</span><span style="color: #000000"> UserInfoForm(forms.ModelForm):
            username </span>= forms.CharField(error_messages={<span style="color: #800000">'</span><span style="color: #800000">required</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">用户名不能为空.</span><span style="color: #800000">'</span><span style="color: #000000">})
            email </span>= forms.EmailField(error_messages={<span style="color: #800000">'</span><span style="color: #800000">invalid</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">邮箱格式错误.</span><span style="color: #800000">'</span><span style="color: #000000">})
            age </span>= forms.IntegerField(initial=1, error_messages={<span style="color: #800000">'</span><span style="color: #800000">required</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">请输入数值.</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">invalid</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">年龄必须为数值.</span><span style="color: #800000">'</span><span style="color: #000000">})

            </span><span style="color: #0000ff">class</span><span style="color: #000000"> Meta:
                model </span>=<span style="color: #000000"> models.UserInfo
                </span><span style="color: #008000">#</span><span style="color: #008000"> fields = ('username',)</span>
                fields = <span style="color: #800000">"</span><span style="color: #800000">__all__</span><span style="color: #800000">"</span>


        <span style="color: #0000ff">class</span><span style="color: #000000"> UserInfoAdmin(admin.ModelAdmin):
            form </span>=<span style="color: #000000"> UserInfoForm


        admin.site.register(models.UserInfo, UserInfoAdmin)</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>&nbsp;补充Django目录说明以及全局配置文件</strong></span></p>
<p><span style="color: #ff0000">&nbsp;<strong>Django目录说明</strong></span></p>
<p><img src="https://images2015.cnblogs.com/blog/955761/201707/955761-20170711220955181-1129209645.png" alt="">&nbsp;</p>
<p><span style="color: #ff0000"><strong>全局配置文件配置</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #800000">"""</span><span style="color: #800000">
Django settings for Xiangmu project.

Generated by 'django-admin startproject' using Django 1.10.

For more information on this file, see
https://docs.djangoproject.com/en/1.10/topics/settings/

For the full list of settings and their values, see
https://docs.djangoproject.com/en/1.10/ref/settings/
</span><span style="color: #800000">"""</span>

<span style="color: #0000ff">import</span><span style="color: #000000"> os

</span><span style="color: #008000">#</span><span style="color: #008000"> Build paths inside the project like this: os.path.join(BASE_DIR, ...)</span>
BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(<span style="color: #800080">__file__</span><span style="color: #000000">)))


</span><span style="color: #008000">#</span><span style="color: #008000"> Quick-start development settings - unsuitable for production</span><span style="color: #008000">
#</span><span style="color: #008000"> See https://docs.djangoproject.com/en/1.10/howto/deployment/checklist/</span>

<span style="color: #008000">#</span><span style="color: #008000"> SECURITY WARNING: keep the secret key used in production secret!</span>
SECRET_KEY = <span style="color: #800000">'</span><span style="color: #800000">!eco91o+^k9q#^j79@oymxltu-%osux)dpet_qv9kp88e)2o*7</span><span style="color: #800000">'</span>

<span style="color: #008000">#</span><span style="color: #008000"> SECURITY WARNING: don't run with debug turned on in production!</span>
DEBUG =<span style="color: #000000"> True

ALLOWED_HOSTS </span>=<span style="color: #000000"> []


</span><span style="color: #008000">#</span><span style="color: #008000"> Application definition</span><span style="color: #008000">
#</span><span style="color: #008000"> 注册APP，也就是注册应用项目，只有注册了的应用才能操作数据库</span>
INSTALLED_APPS =<span style="color: #000000"> [
    </span><span style="color: #800000">'</span><span style="color: #800000">django.contrib.admin</span><span style="color: #800000">'</span><span style="color: #000000">,
    </span><span style="color: #800000">'</span><span style="color: #800000">django.contrib.auth</span><span style="color: #800000">'</span><span style="color: #000000">,
    </span><span style="color: #800000">'</span><span style="color: #800000">django.contrib.contenttypes</span><span style="color: #800000">'</span><span style="color: #000000">,
    </span><span style="color: #800000">'</span><span style="color: #800000">django.contrib.sessions</span><span style="color: #800000">'</span><span style="color: #000000">,
    </span><span style="color: #800000">'</span><span style="color: #800000">django.contrib.messages</span><span style="color: #800000">'</span><span style="color: #000000">,
    </span><span style="color: #800000">'</span><span style="color: #800000">django.contrib.staticfiles</span><span style="color: #800000">'</span><span style="color: #000000">,
    </span><span style="color: #800000">'</span><span style="color: #800000">app1</span><span style="color: #800000">'</span><span style="color: #000000">,
]

MIDDLEWARE </span>=<span style="color: #000000"> [
    </span><span style="color: #800000">'</span><span style="color: #800000">django.middleware.security.SecurityMiddleware</span><span style="color: #800000">'</span><span style="color: #000000">,
    </span><span style="color: #800000">'</span><span style="color: #800000">django.contrib.sessions.middleware.SessionMiddleware</span><span style="color: #800000">'</span><span style="color: #000000">,
    </span><span style="color: #800000">'</span><span style="color: #800000">django.middleware.common.CommonMiddleware</span><span style="color: #800000">'</span><span style="color: #000000">,
    </span><span style="color: #008000">#</span><span style="color: #008000"> 'django.middleware.csrf.CsrfViewMiddleware',</span>
    <span style="color: #800000">'</span><span style="color: #800000">django.contrib.auth.middleware.AuthenticationMiddleware</span><span style="color: #800000">'</span><span style="color: #000000">,
    </span><span style="color: #800000">'</span><span style="color: #800000">django.contrib.messages.middleware.MessageMiddleware</span><span style="color: #800000">'</span><span style="color: #000000">,
    </span><span style="color: #800000">'</span><span style="color: #800000">django.middleware.clickjacking.XFrameOptionsMiddleware</span><span style="color: #800000">'</span><span style="color: #000000">,
]

ROOT_URLCONF </span>= <span style="color: #800000">'</span><span style="color: #800000">Xiangmu.urls</span><span style="color: #800000">'</span>

<span style="color: #008000">#</span><span style="color: #008000">配置模板</span>
TEMPLATES =<span style="color: #000000"> [
    {
        </span><span style="color: #800000">'</span><span style="color: #800000">BACKEND</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">django.template.backends.django.DjangoTemplates</span><span style="color: #800000">'</span><span style="color: #000000">,
        </span><span style="color: #800000">'</span><span style="color: #800000">DIRS</span><span style="color: #800000">'</span>: [os.path.join(BASE_DIR, <span style="color: #800000">'</span><span style="color: #800000">templates</span><span style="color: #800000">'</span>)]           <span style="color: #008000">#</span><span style="color: #008000">配置模板文件路径，也就是html路径</span>
<span style="color: #000000">        ,
        </span><span style="color: #800000">'</span><span style="color: #800000">APP_DIRS</span><span style="color: #800000">'</span><span style="color: #000000">: True,
        </span><span style="color: #800000">'</span><span style="color: #800000">OPTIONS</span><span style="color: #800000">'</span><span style="color: #000000">: {
            </span><span style="color: #800000">'</span><span style="color: #800000">context_processors</span><span style="color: #800000">'</span><span style="color: #000000">: [
                </span><span style="color: #800000">'</span><span style="color: #800000">django.template.context_processors.debug</span><span style="color: #800000">'</span><span style="color: #000000">,
                </span><span style="color: #800000">'</span><span style="color: #800000">django.template.context_processors.request</span><span style="color: #800000">'</span><span style="color: #000000">,
                </span><span style="color: #800000">'</span><span style="color: #800000">django.contrib.auth.context_processors.auth</span><span style="color: #800000">'</span><span style="color: #000000">,
                </span><span style="color: #800000">'</span><span style="color: #800000">django.contrib.messages.context_processors.messages</span><span style="color: #800000">'</span><span style="color: #000000">,
            ],
        },
    },
]

WSGI_APPLICATION </span>= <span style="color: #800000">'</span><span style="color: #800000">Xiangmu.wsgi.application</span><span style="color: #800000">'</span>


<span style="color: #008000">#</span><span style="color: #008000"> Database</span><span style="color: #008000">
#</span><span style="color: #008000"> https://docs.djangoproject.com/en/1.10/ref/settings/#databases</span><span style="color: #008000">
#</span><span style="color: #008000"> 默认配置使用的sqlite数据库</span><span style="color: #008000">
#</span><span style="color: #008000"> DATABASES = {</span><span style="color: #008000">
#</span><span style="color: #008000">     'default': {</span><span style="color: #008000">
#</span><span style="color: #008000">         'ENGINE': 'django.db.backends.sqlite3',                 #配置数据库引擎名称</span><span style="color: #008000">
#</span><span style="color: #008000">         'NAME': os.path.join(BASE_DIR, 'db.sqlite3'),           #生成数据库到当前的项目文件夹里</span><span style="color: #008000">
#</span><span style="color: #008000">     }</span><span style="color: #008000">
#</span><span style="color: #008000"> }</span>

<span style="color: #008000">#</span><span style="color: #008000">MySQL数据库</span>
DATABASES =<span style="color: #000000"> {
    </span><span style="color: #800000">'</span><span style="color: #800000">default</span><span style="color: #800000">'</span><span style="color: #000000">: {
        </span><span style="color: #800000">'</span><span style="color: #800000">ENGINE</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">django.db.backends.mysql</span><span style="color: #800000">'</span>,       <span style="color: #008000">#</span><span style="color: #008000">配置数据库引擎名称</span>
        <span style="color: #800000">'</span><span style="color: #800000">NAME</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">jxiou</span><span style="color: #800000">'</span>,                            <span style="color: #008000">#</span><span style="color: #008000">数据库名称</span>
        <span style="color: #800000">'</span><span style="color: #800000">USER</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">root</span><span style="color: #800000">'</span>,                             <span style="color: #008000">#</span><span style="color: #008000">数据库用户名</span>
        <span style="color: #800000">'</span><span style="color: #800000">PASSWORD</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">279819</span><span style="color: #800000">'</span>,                       <span style="color: #008000">#</span><span style="color: #008000">数据库密码</span>
        <span style="color: #800000">'</span><span style="color: #800000">HOST</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">127.0.0.1</span><span style="color: #800000">'</span>,                        <span style="color: #008000">#</span><span style="color: #008000">数据库链接地址</span>
        <span style="color: #800000">'</span><span style="color: #800000">PORT</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">3306</span><span style="color: #800000">'</span>,                             <span style="color: #008000">#</span><span style="color: #008000">数据库端口</span>
<span style="color: #000000">    }
}


</span><span style="color: #008000">#</span><span style="color: #008000"> Password validation</span><span style="color: #008000">
#</span><span style="color: #008000"> https://docs.djangoproject.com/en/1.10/ref/settings/#auth-password-validators</span>
<span style="color: #000000">
AUTH_PASSWORD_VALIDATORS </span>=<span style="color: #000000"> [
    {
        </span><span style="color: #800000">'</span><span style="color: #800000">NAME</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">django.contrib.auth.password_validation.UserAttributeSimilarityValidator</span><span style="color: #800000">'</span><span style="color: #000000">,
    },
    {
        </span><span style="color: #800000">'</span><span style="color: #800000">NAME</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">django.contrib.auth.password_validation.MinimumLengthValidator</span><span style="color: #800000">'</span><span style="color: #000000">,
    },
    {
        </span><span style="color: #800000">'</span><span style="color: #800000">NAME</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">django.contrib.auth.password_validation.CommonPasswordValidator</span><span style="color: #800000">'</span><span style="color: #000000">,
    },
    {
        </span><span style="color: #800000">'</span><span style="color: #800000">NAME</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">django.contrib.auth.password_validation.NumericPasswordValidator</span><span style="color: #800000">'</span><span style="color: #000000">,
    },
]


</span><span style="color: #008000">#</span><span style="color: #008000"> Internationalization</span><span style="color: #008000">
#</span><span style="color: #008000"> https://docs.djangoproject.com/en/1.10/topics/i18n/</span>
<span style="color: #000000">
LANGUAGE_CODE </span>= <span style="color: #800000">'</span><span style="color: #800000">en-us</span><span style="color: #800000">'</span><span style="color: #000000">

TIME_ZONE </span>= <span style="color: #800000">'</span><span style="color: #800000">UTC</span><span style="color: #800000">'</span><span style="color: #000000">

USE_I18N </span>=<span style="color: #000000"> True

USE_L10N </span>=<span style="color: #000000"> True

USE_TZ </span>=<span style="color: #000000"> True


</span><span style="color: #008000">#</span><span style="color: #008000"> Static files (CSS, JavaScript, Images)</span><span style="color: #008000">
#</span><span style="color: #008000"> https://docs.djangoproject.com/en/1.10/howto/static-files/</span>

<span style="color: #008000">#</span><span style="color: #008000">配置静态文件前缀</span>
STATIC_URL = <span style="color: #800000">'</span><span style="color: #800000">/static/</span><span style="color: #800000">'</span>
<span style="color: #008000">#</span><span style="color: #008000">配置静态文件目录</span>
STATICFILES_DIRS =<span style="color: #000000"> (
    os.path.join(BASE_DIR,</span><span style="color: #800000">'</span><span style="color: #800000">static</span><span style="color: #800000">'</span><span style="color: #000000">)
)</span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<pre></pre></div>