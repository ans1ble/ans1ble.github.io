第一百六十节，封装库--JavaScript，ajax注册表单到数据库


			<div id="cnblogs_post_body" class="blogpost-body"><p><span style="color: #0000ff; background-color: #ffffff"><strong>封装库--JavaScript，ajax注册表单到数据库</strong></span></p>
<p><span style="color: #0000ff; background-color: #ffffff"><strong>效果图</strong></span></p>
<p><span style="color: #0000ff; background-color: #ffffff"><strong><img src="https://images2015.cnblogs.com/blog/955761/201703/955761-20170303172211548-1411739778.png" alt=""></strong></span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>前台js</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">var</span> biaodan = $().xu_lie_biao_dan($('form').sh_jd());   <span style="color: #008000">//</span><span style="color: #008000">序列化获取表单数据，返回对象</span>
        $().Ajax({                            <span style="color: #008000">//</span><span style="color: #008000">执行Ajax数据传输</span>
            method:'post',                    <span style="color: #008000">//</span><span style="color: #008000">post方式发送</span>
            url:'hj.php',                     <span style="color: #008000">//</span><span style="color: #008000">发送到hj.php</span>
            data:biaodan,                     <span style="color: #008000">//</span><span style="color: #008000">发送内容，序列化获取到的表单对象</span>
            success:<span style="color: #0000ff">function</span> (text) {         <span style="color: #008000">//</span><span style="color: #008000">执行回调函数</span>
                <span style="color: #0000ff">if</span> (text == 1<span style="color: #000000">){
                    alert(</span>'注册成功');         <span style="color: #ff0000"><strong>//可以做注册成功的操作</strong></span>
                }<span style="color: #0000ff">else</span><span style="color: #000000"> {
                    alert(</span>'注册失败');         <span style="color: #ff0000"><strong>//可以做注册失败的操作</strong></span>
<span style="color: #000000">                }
            },
            async:</span><span style="color: #0000ff">true</span>                        <span style="color: #008000">//</span><span style="color: #008000">异步模式</span>
        });</pre>
</div>
<p>通讯PHP页面代码</p>
<div class="cnblogs_code">
<pre>&lt;?<span style="color: #000000">php
    </span><span style="color: #008080">header</span>('Content-Type:text/html; charset=utf-8'<span style="color: #000000">);
    </span><span style="color: #008000">//</span><span style="color: #008000">连接数据库</span>
    <span style="color: #008080">define</span>('DB_HOST', 'localhost'<span style="color: #000000">);
    </span><span style="color: #008080">define</span>('DB_USER', 'root'<span style="color: #000000">);
    </span><span style="color: #008080">define</span>('DB_PWD', '279819'<span style="color: #000000">);
    </span><span style="color: #008080">define</span>('DB_NAME', 'beke'<span style="color: #000000">);

    </span><span style="color: #800080">$conn</span> = @<span style="color: #008080">mysql_connect</span>(DB_HOST, DB_USER, DB_PWD) or <span style="color: #0000ff">die</span>('数据库链接失败：'.<span style="color: #008080">mysql_error</span><span style="color: #000000">());

    @</span><span style="color: #008080">mysql_select_db</span>(DB_NAME) or <span style="color: #0000ff">die</span>('数据库错误：'.<span style="color: #008080">mysql_error</span><span style="color: #000000">());

    @</span><span style="color: #008080">mysql_query</span>('SET NAMES UTF8') or <span style="color: #0000ff">die</span>('字符集错误：'.<span style="color: #008080">mysql_error</span><span style="color: #000000">());


    </span><span style="color: #800080">$_birthday</span> = <span style="color: #800080">$_POST</span>['year'].'-'.<span style="color: #800080">$_POST</span>['month'].'-'.<span style="color: #800080">$_POST</span>['day'<span style="color: #000000">];

    </span><span style="color: #800080">$query</span> = "<span style="color: #000000">INSERT INTO huiyuan (user, pass, ques, ans, email, birthday, ps)
                                                VALUES ('{</span><span style="color: #800080">$_POST</span>['user']}', sha1('{<span style="color: #800080">$_POST</span>['pass']}'), '{<span style="color: #800080">$_POST</span>['ques']}', '{<span style="color: #800080">$_POST</span>['ans']}', '{<span style="color: #800080">$_POST</span>['email']}', '{<span style="color: #800080">$_birthday</span>}', '{<span style="color: #800080">$_POST</span>['ps']}')"<span style="color: #000000">;

    </span><span style="color: #008080">mysql_query</span>(<span style="color: #800080">$query</span>) or <span style="color: #0000ff">die</span>('新增失败！'.<span style="color: #008080">mysql_error</span><span style="color: #000000">());

    </span><span style="color: #0000ff">echo</span> <span style="color: #008080">mysql_affected_rows</span>();  <span style="color: #008000">//</span><span style="color: #008000">注册成功返回值给Ajax</span>

    <span style="color: #008080">mysql_close</span><span style="color: #000000">();


</span>?&gt;</pre>
</div>
<p>数据库数据</p>
<p><img src="https://images2015.cnblogs.com/blog/955761/201703/955761-20170303172822532-400262640.png" alt=""></p></div>