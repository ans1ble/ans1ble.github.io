第三百九十五节，Django+Xadmin打造上线标准的在线教育平台—Xadmin集成富文本框


			<div id="cnblogs_post_body" class="blogpost-body"><p><strong>第三百九十五节，Django+Xadmin打造上线标准的在线教育平台—Xadmin集成富文本框</strong></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>首先安装DjangoUeditor3模块</strong></span></p>
<p><span style="color: #ff0000"><strong>Ueditor HTML编辑器是百度开源的HTML编辑器</strong></span></p>
<p>&nbsp;</p>
<p><strong>下载地址&nbsp;https://github.com/andyzsf/DjangoUeditor3</strong></p>
<p><strong>下载后解压下载包，找到<span style="color: #0000ff">DjangoUeditor3-master\DjangoUeditor文件夹</span></strong></p>
<p><strong>&nbsp;将DjangoUeditor文件夹，整个文件夹复制到<strong>Xadmin同级目录</strong></strong></p>
<p><strong><strong><img src="https://images2017.cnblogs.com/blog/955761/201709/955761-20170923174953478-1149284164.png" alt=""></strong></strong></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>安装好后在settings.py将<span style="color: #0000ff">DjangoUeditor</span>添加到app</strong></span></p>
<div class="cnblogs_code">
<pre>INSTALLED_APPS =<span style="color: #000000"> [
    </span><span style="color: #800000">'</span><span style="color: #800000">django.contrib.admin</span><span style="color: #800000">'</span><span style="color: #000000">,
    </span><span style="color: #800000">'</span><span style="color: #800000">django.contrib.auth</span><span style="color: #800000">'</span><span style="color: #000000">,
    </span><span style="color: #800000">'</span><span style="color: #800000">django.contrib.contenttypes</span><span style="color: #800000">'</span><span style="color: #000000">,
    </span><span style="color: #800000">'</span><span style="color: #800000">django.contrib.sessions</span><span style="color: #800000">'</span><span style="color: #000000">,
    </span><span style="color: #800000">'</span><span style="color: #800000">django.contrib.messages</span><span style="color: #800000">'</span><span style="color: #000000">,
    </span><span style="color: #800000">'</span><span style="color: #800000">django.contrib.staticfiles</span><span style="color: #800000">'</span><span style="color: #000000">,
    </span><span style="color: #800000">'</span><span style="color: #800000">app_users</span><span style="color: #800000">'</span>,                        <span style="color: #008000">#</span><span style="color: #008000"> 注册 APP</span>
    <span style="color: #800000">'</span><span style="color: #800000">app_courses</span><span style="color: #800000">'</span><span style="color: #000000">,
    </span><span style="color: #800000">'</span><span style="color: #800000">app_organization</span><span style="color: #800000">'</span><span style="color: #000000">,
    </span><span style="color: #800000">'</span><span style="color: #800000">app_operation</span><span style="color: #800000">'</span><span style="color: #000000">,
    </span><span style="color: #800000">'</span><span style="color: #800000">xadmin</span><span style="color: #800000">'</span>,                           <span style="color: #008000">#</span><span style="color: #008000"> 注册xadmin的app</span>
    <span style="color: #800000">'</span><span style="color: #800000">crispy_forms</span><span style="color: #800000">'</span>,                     <span style="color: #008000">#</span><span style="color: #008000"> 注册xadmin的依赖app</span>
    <span style="color: #800000">'</span><span style="color: #800000">captcha</span><span style="color: #800000">'</span>,                          <span style="color: #008000">#</span><span style="color: #008000"> 注册验证码app</span>
    <span style="color: #800000">'</span><span style="color: #800000">pure_pagination</span><span style="color: #800000">'</span>,                  <span style="color: #008000">#</span><span style="color: #008000"> 注册分页app</span>
    <span style="background-color: #ff99cc"><span style="color: #800000">'</span><span style="color: #800000">DjangoUeditor</span><span style="color: #800000">'</span>                     <span style="color: #008000">#</span><span style="color: #008000"> 注册DjangoUeditor的APP</span></span>
]</pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>然后在全局的urls.py文件配置路由映射</strong></span></p>
<div class="cnblogs_code">
<pre>urlpatterns =<span style="color: #000000"> [
    url(r</span><span style="color: #800000">'</span><span style="color: #800000">^xadmin/</span><span style="color: #800000">'</span><span style="color: #000000">, xadmin.site.urls),

    url(r</span><span style="color: #800000">'</span><span style="color: #800000">^index.html</span><span style="color: #800000">'</span>, TemplateView.as_view(template_name=<span style="color: #800000">'</span><span style="color: #800000">index.html</span><span style="color: #800000">'</span>), name=<span style="color: #800000">'</span><span style="color: #800000">index</span><span style="color: #800000">'</span><span style="color: #000000">),

    </span><span style="color: #008000">#</span><span style="color: #008000"> 注册</span>
    url(r<span style="color: #800000">'</span><span style="color: #800000">^register.html</span><span style="color: #800000">'</span>, zhu_ce.as_view(), name=<span style="color: #800000">'</span><span style="color: #800000">register</span><span style="color: #800000">'</span><span style="color: #000000">),
    url(r</span><span style="color: #800000">'</span><span style="color: #800000">^captcha/</span><span style="color: #800000">'</span>, include(<span style="color: #800000">'</span><span style="color: #800000">captcha.urls</span><span style="color: #800000">'</span>), name=<span style="color: #800000">'</span><span style="color: #800000">captcha</span><span style="color: #800000">'</span><span style="color: #000000">),
    url(r</span><span style="color: #800000">'</span><span style="color: #800000">^active/(?P&lt;active_de&gt;.*)/$</span><span style="color: #800000">'</span>, active_code.as_view(), name=<span style="color: #800000">"</span><span style="color: #800000">user_active</span><span style="color: #800000">"</span><span style="color: #000000">),

    </span><span style="color: #008000">#</span><span style="color: #008000"> 登录</span>
    url(r<span style="color: #800000">'</span><span style="color: #800000">^login.html</span><span style="color: #800000">'</span>, TemplateView.as_view(template_name=<span style="color: #800000">'</span><span style="color: #800000">login.html</span><span style="color: #800000">'</span>), name=<span style="color: #800000">'</span><span style="color: #800000">login</span><span style="color: #800000">'</span><span style="color: #000000">),
    url(r</span><span style="color: #800000">'</span><span style="color: #800000">^deng_lu</span><span style="color: #800000">'</span>, deng_lu.as_view(), name=<span style="color: #800000">'</span><span style="color: #800000">deng_lu</span><span style="color: #800000">'</span><span style="color: #000000">),
    url(r</span><span style="color: #800000">'</span><span style="color: #800000">^logout</span><span style="color: #800000">'</span>, logout.as_view(), name=<span style="color: #800000">'</span><span style="color: #800000">deng_lu</span><span style="color: #800000">'</span><span style="color: #000000">),

    </span><span style="color: #008000">#</span><span style="color: #008000"> 授课机构</span>
    url(r<span style="color: #800000">'</span><span style="color: #800000">^org_list.html</span><span style="color: #800000">'</span>, org_list.as_view(), name=<span style="color: #800000">'</span><span style="color: #800000">org_list</span><span style="color: #800000">'</span><span style="color: #000000">),

    </span><span style="color: #008000">#</span><span style="color: #008000"> 专门处理静态资源请求映射，也就是media上传文件夹里的请求映射</span>
    url(r<span style="color: #800000">'</span><span style="color: #800000">media/(?P&lt;path&gt;.*)$</span><span style="color: #800000">'</span>, serve, {<span style="color: #800000">'</span><span style="color: #800000">document_root</span><span style="color: #800000">'</span><span style="color: #000000">: MEDIA_ROOT}),

    </span><span style="color: #008000">#</span><span style="color: #008000"> 配置静态文件访问</span>
    <span style="color: #008000">#</span><span style="color: #008000"> url(r'static/(?P&lt;path&gt;.*)$', serve, {'document_root': STATIC_ROOT}),</span>
<span style="color: #000000">
    url(r</span><span style="color: #800000">'</span><span style="color: #800000">course_comment.html</span><span style="color: #800000">'</span>, course_comment.as_view(), name=<span style="color: #800000">'</span><span style="color: #800000">course_comment</span><span style="color: #800000">'</span><span style="color: #000000">),
    url(r</span><span style="color: #800000">'</span><span style="color: #800000">usercenter_info.html</span><span style="color: #800000">'</span>, usercenter_info.as_view(), name=<span style="color: #800000">'</span><span style="color: #800000">usercenter_info</span><span style="color: #800000">'</span><span style="color: #000000">),

    </span><span style="color: #008000">#</span><span style="color: #008000"> 上传头像</span>
    url(r<span style="color: #800000">'</span><span style="color: #800000">touxiang/</span><span style="color: #800000">'</span>, touxiang.as_view(), name=<span style="color: #800000">'</span><span style="color: #800000">touxiang</span><span style="color: #800000">'</span><span style="color: #000000">),

    </span><span style="color: #008000">#</span><span style="color: #008000"> 配置DjangoUeditor富文本路由映射</span>
    <span style="background-color: #ff99cc">url(r<span style="color: #800000">'</span><span style="color: #800000">^ueditor/</span><span style="color: #800000">'</span>,include(<span style="color: #800000">'</span><span style="color: #800000">DjangoUeditor.urls</span><span style="color: #800000">'</span></span><span style="color: #000000"><span style="background-color: #ff99cc"> ))</span>
]</span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>在models.py文件，在要使用<strong>富文本框</strong>的字段使用UEditorField</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf-8 -*-</span>
<span style="color: #0000ff">from</span> <span style="color: #800080">__future__</span> <span style="color: #0000ff">import</span><span style="color: #000000"> unicode_literals
</span><span style="color: #0000ff">from</span> datetime <span style="color: #0000ff">import</span><span style="color: #000000"> datetime

</span><span style="color: #0000ff">from</span> django.db <span style="color: #0000ff">import</span> models        <span style="color: #008000">#</span><span style="color: #008000"> 导入models对象</span>
<span style="background-color: #ff99cc"><span style="color: #0000ff">from</span> DjangoUeditor.models <span style="color: #0000ff">import</span><span style="color: #000000"> UEditorField
</span></span><span style="color: #0000ff">from</span> system.storage <span style="color: #0000ff">import</span><span style="color: #000000"> ImageStorage


</span><span style="color: #0000ff">class</span><span style="color: #000000"> Course(models.Model):
    name </span>= models.CharField(max_length=50, verbose_name=<span style="color: #800000">'</span><span style="color: #800000">课程名称</span><span style="color: #800000">'</span><span style="color: #000000">)
    desc </span>= models.CharField(max_length=300, verbose_name=<span style="color: #800000">'</span><span style="color: #800000">课程描述</span><span style="color: #800000">'</span><span style="color: #000000">)
<span style="background-color: #ff99cc">    detail </span></span><span style="background-color: #ff99cc">= UEditorField(verbose_name=<span style="color: #800000">'</span><span style="color: #800000">内容</span><span style="color: #800000">'</span><span style="color: #000000">,
                          width</span>=900,height=300<span style="color: #000000">,
                          imagePath</span>=<span style="color: #800000">"</span><span style="color: #800000">neird/tup/</span><span style="color: #800000">"</span><span style="color: #000000">,
                          filePath</span>=<span style="color: #800000">"</span><span style="color: #800000">neird/wjian/</span><span style="color: #800000">"</span><span style="color: #000000">,
                          default</span>=<span style="color: #800000">''</span><span style="color: #000000">,
                          toolbars</span>=<span style="color: #800000">'</span><span style="color: #800000">mini</span><span style="color: #800000">'</span></span><span style="color: #000000"><span style="background-color: #ff99cc">)</span>
    degree </span>= models.CharField(verbose_name=<span style="color: #800000">'</span><span style="color: #800000">课程级别</span><span style="color: #800000">'</span>, choices=((<span style="color: #800000">'</span><span style="color: #800000">cj</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">初级</span><span style="color: #800000">'</span>), (<span style="color: #800000">'</span><span style="color: #800000">zj</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">中级</span><span style="color: #800000">'</span>), (<span style="color: #800000">'</span><span style="color: #800000">gj</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">高级</span><span style="color: #800000">'</span>)), max_length=3<span style="color: #000000">)
    learn_times </span>= models.IntegerField(default=0, verbose_name=<span style="color: #800000">'</span><span style="color: #800000">学习时长(分钟)</span><span style="color: #800000">'</span><span style="color: #000000">)
    students </span>= models.IntegerField(default=0, verbose_name=<span style="color: #800000">'</span><span style="color: #800000">学习人数</span><span style="color: #800000">'</span><span style="color: #000000">)
    fav_nums </span>= models.IntegerField(default=0, verbose_name=<span style="color: #800000">'</span><span style="color: #800000">收藏人数</span><span style="color: #800000">'</span><span style="color: #000000">)
    image </span>= models.ImageField(upload_to=<span style="color: #800000">'</span><span style="color: #800000">courses/%Y/%m</span><span style="color: #800000">'</span>, verbose_name=<span style="color: #800000">'</span><span style="color: #800000">课程封面图</span><span style="color: #800000">'</span>, max_length=100<span style="color: #000000">)
    click_nums </span>= models.IntegerField(default=0, verbose_name=<span style="color: #800000">'</span><span style="color: #800000">点击数</span><span style="color: #800000">'</span><span style="color: #000000">)
    add_time </span>= models.DateTimeField(default=datetime.now, verbose_name=<span style="color: #800000">'</span><span style="color: #800000">添加时间</span><span style="color: #800000">'</span><span style="color: #000000">)

    </span><span style="color: #0000ff">class</span><span style="color: #000000"> Meta:
        verbose_name </span>= <span style="color: #800000">'</span><span style="color: #800000">课程</span><span style="color: #800000">'</span><span style="color: #000000">
        verbose_name_plural </span>=<span style="color: #000000"> verbose_name

    </span><span style="color: #0000ff">def</span> <span style="color: #800080">__str__</span><span style="color: #000000">(self):
        </span><span style="color: #0000ff">return</span> self.name        <span style="color: #008000">#</span><span style="color: #008000"> 设置在xadmin后台显示字段, 注意如果此表被另外的了外键关联了，这个返回字段就是外键表的外键名称</span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>在adminx.py文件里找到对应的数据表管理器，在管理器里指定字段用<strong>富文本框</strong></strong></span></p>
<p><span style="color: #ff0000"><strong>style_fields = {'字段名称':'ueditor'}指定字段使用富文本框</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">class</span> CourseAdmin(object):               <span style="color: #008000">#</span><span style="color: #008000"> 自定义数据表管理器类</span>

    <span style="color: #008000">#</span><span style="color: #008000"> 设置xadmin后台显示字段</span>
    list_display = [<span style="color: #800000">'</span><span style="color: #800000">name</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">desc</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">detail</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">degree</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">learn_times</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">students</span><span style="color: #800000">'</span><span style="color: #000000">,
                    </span><span style="color: #800000">'</span><span style="color: #800000">fav_nums</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">image</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">click_nums</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">add_time</span><span style="color: #800000">'</span><span style="color: #000000">]

    </span><span style="color: #008000">#</span><span style="color: #008000"> 设置xadmin后台搜索字段，注意：搜索字段如果有时间类型会报错</span>
    search_fields = [<span style="color: #800000">'</span><span style="color: #800000">name</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">desc</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">detail</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">degree</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">learn_times</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">students</span><span style="color: #800000">'</span><span style="color: #000000">,
                     </span><span style="color: #800000">'</span><span style="color: #800000">fav_nums</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">image</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">click_nums</span><span style="color: #800000">'</span><span style="color: #000000">]

    </span><span style="color: #008000">#</span><span style="color: #008000"> 设置xadmin后台过滤器帅选字段，时间用过滤器来做</span>
    list_filter = [<span style="color: #800000">'</span><span style="color: #800000">name</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">desc</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">detail</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">degree</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">learn_times</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">students</span><span style="color: #800000">'</span><span style="color: #000000">,
                   </span><span style="color: #800000">'</span><span style="color: #800000">fav_nums</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">image</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">click_nums</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">add_time</span><span style="color: #800000">'</span><span style="color: #000000">]
    model_icon </span>= <span style="color: #800000">'</span><span style="color: #800000">fa fa-clone</span><span style="color: #800000">'</span><span style="background-color: #ff99cc"><span style="color: #000000">
    style_fields </span>= {<span style="color: #800000">'</span><span style="color: #800000">detail</span><span style="color: #800000">'</span>:<span style="color: #800000">'</span><span style="color: #800000">ueditor</span><span style="color: #800000">'</span></span><span style="color: #000000"><span style="background-color: #ff99cc">}</span>
xadmin.site.register(Course, CourseAdmin)     </span><span style="color: #008000">#</span><span style="color: #008000"> 将数据表注册到xadmin后台显示</span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong><strong>富文本框参数说明</strong></strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #000000">Ueditor HTML编辑器是百度开源的HTML编辑器，

本模块帮助在Django应用中集成百度Ueditor HTML编辑器。
安装包中已经集成Ueditor v1.</span>3.6<span style="color: #000000">

使用Django</span>-<span style="color: #000000">Ueditor非常简单，方法如下：

</span>1<span style="color: #000000">、安装方法
    
    </span>**<span style="color: #000000">方法一：下载安装包，在命令行运行：
        python setup.py install
    </span>**<span style="color: #000000">方法二：使用pip工具在命令行运行(推荐)：
           pip install DjangoUeditor

</span>2<span style="color: #000000">、在INSTALL_APPS里面增加DjangoUeditor app，如下：
     
        INSTALLED_APPS </span>=<span style="color: #000000"> (
            </span><span style="color: #008000">#</span><span style="color: #008000">........</span>
            <span style="color: #800000">'</span><span style="color: #800000">DjangoUeditor</span><span style="color: #800000">'</span><span style="color: #000000">,
        )


</span>3<span style="color: #000000">、在urls.py中增加：

    url(r</span><span style="color: #800000">'</span><span style="color: #800000">^ueditor/</span><span style="color: #800000">'</span>,include(<span style="color: #800000">'</span><span style="color: #800000">DjangoUeditor.urls</span><span style="color: #800000">'</span><span style="color: #000000"> )),

</span>4<span style="color: #000000">、在models中这样定义：
    
    </span><span style="color: #0000ff">from</span> DjangoUeditor.models <span style="color: #0000ff">import</span><span style="color: #000000"> UEditorField
    </span><span style="color: #0000ff">class</span><span style="color: #000000"> Blog(models.Model):
        Name</span>=models.CharField(,max_length=100,blank=<span style="color: #000000">True)
        Content</span>=UEditorField(<span style="color: #800000">'</span><span style="color: #800000">内容    </span><span style="color: #800000">'</span>,height=100,width=500,default=<span style="color: #800000">'</span><span style="color: #800000">test</span><span style="color: #800000">'</span>,imagePath=<span style="color: #800000">"</span><span style="color: #800000">uploadimg/</span><span style="color: #800000">"</span>,imageManagerPath=<span style="color: #800000">"</span><span style="color: #800000">imglib</span><span style="color: #800000">"</span>,toolbars=<span style="color: #800000">'</span><span style="color: #800000">mini</span><span style="color: #800000">'</span>,options={<span style="color: #800000">"</span><span style="color: #800000">elementPathEnabled</span><span style="color: #800000">"</span>:True},filePath=<span style="color: #800000">'</span><span style="color: #800000">upload</span><span style="color: #800000">'</span>,blank=<span style="color: #000000">True)

    说明：
    UEditorField继承自models.TextField,因此你可以直接将model里面定义的models.TextField直接改成UEditorField即可。
    UEditorField提供了额外的参数：
        toolbars:配置你想显示的工具栏，取值为mini,normal,full,besttome, 代表小，一般，全部,涂伟忠贡献的一种样式。如果默认的工具栏不符合您的要求，您可以在settings里面配置自己的显示按钮。参见后面介绍。
        imagePath:图片上传的路径,如</span><span style="color: #800000">"</span><span style="color: #800000">images/</span><span style="color: #800000">"</span>,实现上传到<span style="color: #800000">"</span><span style="color: #800000">{{MEDIA_ROOT}}/images</span><span style="color: #800000">"</span><span style="color: #000000">文件夹
        filePath:附件上传的路径,如</span><span style="color: #800000">"</span><span style="color: #800000">files/</span><span style="color: #800000">"</span>,实现上传到<span style="color: #800000">"</span><span style="color: #800000">{{MEDIA_ROOT}}/files</span><span style="color: #800000">"</span><span style="color: #000000">文件夹
        scrawlPath:涂鸦文件上传的路径,如</span><span style="color: #800000">"</span><span style="color: #800000">scrawls/</span><span style="color: #800000">"</span>,实现上传到<span style="color: #800000">"</span><span style="color: #800000">{{MEDIA_ROOT}}/scrawls</span><span style="color: #800000">"</span>文件夹,如果不指定则默认=<span style="color: #000000">imagepath
        imageManagerPath:图片管理器显示的路径，如</span><span style="color: #800000">"</span><span style="color: #800000">imglib/</span><span style="color: #800000">"</span>,实现上传到<span style="color: #800000">"</span><span style="color: #800000">{{MEDIA_ROOT}}/imglib</span><span style="color: #800000">"</span>,如果不指定则默认=<span style="color: #000000">imagepath。
        options：其他UEditor参数，字典类型。参见Ueditor的文档ueditor_config.js里面的说明。
        css:编辑器textarea的CSS样式
        width，height:编辑器的宽度和高度，以像素为单位。

</span>5<span style="color: #000000">、在表单中使用非常简单，与常规的form字段没什么差别，如下：
    
    </span><span style="color: #0000ff">class</span><span style="color: #000000"> TestUeditorModelForm(forms.ModelForm):
        </span><span style="color: #0000ff">class</span><span style="color: #000000"> Meta:
            model</span>=<span style="color: #000000">Blog
    </span>***********************************<span style="color: #000000">
    如果不是用ModelForm，可以有两种方法使用：

    </span>1<span style="color: #000000">: 使用forms.UEditorField

    </span><span style="color: #0000ff">from</span>  DjangoUeditor.forms <span style="color: #0000ff">import</span><span style="color: #000000"> UEditorField
    </span><span style="color: #0000ff">class</span><span style="color: #000000"> TestUEditorForm(forms.Form):
        Description</span>=UEditorField(<span style="color: #800000">"</span><span style="color: #800000">描述</span><span style="color: #800000">"</span>,initial=<span style="color: #800000">"</span><span style="color: #800000">abc</span><span style="color: #800000">"</span>,width=600,height=800<span style="color: #000000">)
    
    </span>2<span style="color: #000000">: widgets.UEditorWidget

    </span><span style="color: #0000ff">from</span>  DjangoUeditor.widgets <span style="color: #0000ff">import</span><span style="color: #000000"> UEditorWidget
    </span><span style="color: #0000ff">class</span><span style="color: #000000"> TestUEditorForm(forms.Form):
        Content</span>=forms.CharField(label=<span style="color: #800000">"</span><span style="color: #800000">内容</span><span style="color: #800000">"</span>,widget=UEditorWidget(width=800,height=500, imagePath=<span style="color: #800000">'</span><span style="color: #800000">aa</span><span style="color: #800000">'</span>, filePath=<span style="color: #800000">'</span><span style="color: #800000">bb</span><span style="color: #800000">'</span>,toolbars=<span style="color: #000000">{}))
    
    widgets.UEditorWidget和forms.UEditorField的输入参数与上述models.UEditorField一样。

</span>6<span style="color: #000000">、Settings配置
     
      在Django的Settings可以配置以下参数：
            UEDITOR_SETTINGS</span>=<span style="color: #000000">{
                </span><span style="color: #800000">"</span><span style="color: #800000">toolbars</span><span style="color: #800000">"</span>:{           <span style="color: #008000">#</span><span style="color: #008000">定义多个工具栏显示的按钮，允行定义多个</span>
                    <span style="color: #800000">"</span><span style="color: #800000">name1</span><span style="color: #800000">"</span>:[[ <span style="color: #800000">'</span><span style="color: #800000">source</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">|</span><span style="color: #800000">'</span>,<span style="color: #800000">'</span><span style="color: #800000">bold</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">italic</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">underline</span><span style="color: #800000">'</span><span style="color: #000000">]],
                    </span><span style="color: #800000">"</span><span style="color: #800000">name2</span><span style="color: #800000">"</span><span style="color: #000000">,[]
                },
                </span><span style="color: #800000">"</span><span style="color: #800000">images_upload</span><span style="color: #800000">"</span><span style="color: #000000">:{
                    </span><span style="color: #800000">"</span><span style="color: #800000">allow_type</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">jpg,png</span><span style="color: #800000">"</span>,    <span style="color: #008000">#</span><span style="color: #008000">定义允许的上传的图片类型</span>
                    <span style="color: #800000">"</span><span style="color: #800000">max_size</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">2222kb</span><span style="color: #800000">"</span>        <span style="color: #008000">#</span><span style="color: #008000">定义允许上传的图片大小，0代表不限制</span>
<span style="color: #000000">                },
                </span><span style="color: #800000">"</span><span style="color: #800000">files_upload</span><span style="color: #800000">"</span><span style="color: #000000">:{
                     </span><span style="color: #800000">"</span><span style="color: #800000">allow_type</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">zip,rar</span><span style="color: #800000">"</span>,   <span style="color: #008000">#</span><span style="color: #008000">定义允许的上传的文件类型</span>
                     <span style="color: #800000">"</span><span style="color: #800000">max_size</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">2222kb</span><span style="color: #800000">"</span>       <span style="color: #008000">#</span><span style="color: #008000">定义允许上传的文件大小，0代表不限制</span>
<span style="color: #000000">                 },,
                </span><span style="color: #800000">"</span><span style="color: #800000">image_manager</span><span style="color: #800000">"</span><span style="color: #000000">:{
                     </span><span style="color: #800000">"</span><span style="color: #800000">location</span><span style="color: #800000">"</span>:<span style="color: #800000">""</span>         <span style="color: #008000">#</span><span style="color: #008000">图片管理器的位置,如果没有指定，默认跟图片路径上传一样</span>
<span style="color: #000000">                },
            }
</span>7<span style="color: #000000">、在模板里面：

    </span>&lt;head&gt;<span style="color: #000000">
        ......
        {{ form.media }}        </span><span style="color: #008000">#</span><span style="color: #008000">这一句会将所需要的CSS和JS加进来。</span>
<span style="color: #000000">        ......
    </span>&lt;/head&gt;<span style="color: #000000">
    注：运行collectstatic命令，将所依赖的css,js之类的文件复制到{{STATIC_ROOT}}文件夹里面。

</span>8<span style="color: #000000">、高级运用：

     </span>****************<span style="color: #000000">
     动态指定imagePath、filePath、scrawlPath、imageManagerPath
     </span>****************<span style="color: #000000">
     这几个路径文件用于保存上传的图片或附件，您可以直接指定路径，如：
          UEditorField(</span><span style="color: #800000">'</span><span style="color: #800000">内容</span><span style="color: #800000">'</span>,imagePath=<span style="color: #800000">"</span><span style="color: #800000">uploadimg/</span><span style="color: #800000">"</span><span style="color: #000000">)
     则图片会被上传到</span><span style="color: #800000">"</span><span style="color: #800000">{{MEDIA_ROOT}}/uploadimg</span><span style="color: #800000">"</span><span style="color: #000000">文件夹，也可以指定为一个函数，如：

      </span><span style="color: #0000ff">def</span> getImagePath(model_instance=<span style="color: #000000">None):
          </span><span style="color: #0000ff">return</span> <span style="color: #800000">"</span><span style="color: #800000">abc/</span><span style="color: #800000">"</span><span style="color: #000000">
      UEditorField(</span><span style="color: #800000">'</span><span style="color: #800000">内容</span><span style="color: #800000">'</span>,imagePath=<span style="color: #000000">getImagePath)
      则图片会被上传到</span><span style="color: #800000">"</span><span style="color: #800000">{{MEDIA_ROOT}}/abc</span><span style="color: #800000">"</span><span style="color: #000000">文件夹。
     </span>****************<span style="color: #000000">
     使上传路径(imagePath、filePath、scrawlPath、imageManagerPath)与Model实例字段值相关
     </span>****************<span style="color: #000000">
        在有些情况下，我们可能想让上传的文件路径是由当前Model实例字值组名而成，比如：
        </span><span style="color: #0000ff">class</span><span style="color: #000000"> Blog(Models.Model):
            Name</span>=models.CharField(<span style="color: #800000">'</span><span style="color: #800000">姓名</span><span style="color: #800000">'</span>,max_length=100,blank=<span style="color: #000000">True)
            Description</span>=UEditorField(<span style="color: #800000">'</span><span style="color: #800000">描述</span><span style="color: #800000">'</span>,blank=True,imagePath=getUploadPath,toolbars=<span style="color: #800000">"</span><span style="color: #800000">full</span><span style="color: #800000">"</span><span style="color: #000000">)

     id  </span>|   Name    |<span style="color: #000000">       Description
     </span>------------------------------------
     1   |   Tom     |<span style="color: #000000">       ...........
     </span>2   |   Jack    |<span style="color: #000000">       ...........

      我们想让第一条记录上传的图片或附件上传到</span><span style="color: #800000">"</span><span style="color: #800000">{{MEDIA_ROOT}}/Tom</span><span style="color: #800000">"</span>文件夹,第2条记录则上传到<span style="color: #800000">"</span><span style="color: #800000">{{MEDIA_ROOT}}/Jack</span><span style="color: #800000">"</span><span style="color: #000000">文件夹。
      该怎么做呢，很简单。
      </span><span style="color: #0000ff">def</span> getUploadPath(model_instance=<span style="color: #000000">None):
          </span><span style="color: #0000ff">return</span> <span style="color: #800000">"</span><span style="color: #800000">%s/</span><span style="color: #800000">"</span> %<span style="color: #000000"> model_instance.Name
      在Model里面这样定义：
      Description</span>=UEditorField(<span style="color: #800000">'</span><span style="color: #800000">描述</span><span style="color: #800000">'</span>,blank=True,imagePath=getUploadPath,toolbars=<span style="color: #800000">"</span><span style="color: #800000">full</span><span style="color: #800000">"</span><span style="color: #000000">)
      这上面model_instance就是当前model的实例对象。
      还需要这样定义表单对象：
      </span><span style="color: #0000ff">from</span>  DjangoUeditor.forms <span style="color: #0000ff">import</span><span style="color: #000000"> UEditorModelForm
      </span><span style="color: #0000ff">class</span><span style="color: #000000"> UEditorTestModelForm(UEditorModelForm):
            </span><span style="color: #0000ff">class</span><span style="color: #000000"> Meta:
                model</span>=<span style="color: #000000">Blog
      特别注意：
         </span>**<span style="color: #000000">表单对象必须是继承自UEditorModelForm，否则您会发现model_instance总会是None。
         </span>**<span style="color: #000000">同时在Admin管理界面中，此特性无效，model_instance总会是None。
         </span>**<span style="color: #000000">在新建表单中，model_instance由于还没有保存到数据库，所以如果访问model_instance.pk可能是空的。因为您需要在getUploadPath处理这种情况


</span><span style="color: #0000ff">class</span><span style="color: #000000"> UEditorTestModelForm(UEditorModelForm):
    </span><span style="color: #0000ff">class</span><span style="color: #000000"> Meta:
        model</span>=<span style="color: #000000">Blog




</span>8<span style="color: #000000">、其他事项：

    </span>**本程序版本号采用a.b.ccc,其中a.b是本程序的号，ccc是ueditor的版本号，如1.2.122，1.2是DjangoUeditor的版本号，122指Ueditor 1.2.2<span style="color: #000000">.
    </span>**<span style="color: #000000">本程序安装包里面已经包括了Ueditor，不需要再额外安装。
    </span>**<span style="color: #000000">目前暂时不支持ueditor的插件
    </span>**<span style="color: #000000">别忘记了运行collectstatic命令，该命令可以将ueditor的所有文件复制到{{STATIC_ROOT}}文件夹里面
    </span>**Django默认开启了CSRF中间件，因此如果你的表单没有加入{% csrf_token %<span style="color: #000000">}，那么当您上传文件和图片时会失败
   </span></pre>
</div>
<p><span style="color: #ff0000"><strong>效果</strong></span></p>
<p><span style="color: #ff0000"><strong><img src="https://images2017.cnblogs.com/blog/955761/201709/955761-20170923180146150-1761417760.png" alt=""></strong></span></p>
<p>&nbsp;</p></div>