第一百四十二节，JavaScript，封装库--运动动画和透明度动画


			<div id="cnblogs_post_body" class="blogpost-body"><p><span style="color: #0000ff"><strong>JavaScript，封装库--运动动画和透明度动画</strong></span></p>
<p>&nbsp;</p>
<div class="cnblogs_code">
<pre><span style="color: #008000">/*</span><span style="color: #008000">* yi_dong_tou_ming()方法，说明
 * * yi_dong_tou_ming()方法，将一个元素，进行一下动画操作
 * 1，x将元素横向左移动或者右移动
 * 2, y将元素竖向上移动或者下移动
 * 3，w将元素动画增加或者减少宽度
 * 4，h将元素动画增加或者减少高度
 * 5，o将元素动画增加或者减少透明度
 * *************************************
 *  x将元素横向左移动或者右移动，首先将目标设置定位，position:absolute;
 *  o将元素动画增加或者减少透明度，结合css里元素原始透明度filter: alpha(opacity=0);opacity: 0;
 *  *************************************
 *  yi_dong_tou_ming()方法，参数说明
 *  参数是一个对象如下
 *  yi_dong_tou_ming({
            'attr':'x',        【为动画方式】，   x.为横向移动，y.为竖向移动，w.为增加宽度动画，h.为增加高度动画，o.为透明度动画，【必填】
            'type':'1',        【动画模式】，     0.匀速模式，1.缓冲模式【可选，默认缓冲】
            'speed':6,         【缓冲速度】，     动画模式为缓冲时设置，【可选，默认为6】,以此值改变跨度.每一次动画动态增加或者减少，实现缓冲效果
            'start':50,        【动画起始位置】， 起始的像素或者透明度【可选，默认为对象原始位置】
            'target':100,      【目标量】，       就是在原始的像素或者透明度上，增加或者减少到目标量的像素或者透明度【可先，注意目标量不填，增量必填】
            'alter':50,        【增量】，         就是在对象原始的像素或者透明度上，增加或者减少像素或者透明度【可先，注意增量不填，目标量必填】
            'step':7,          【跨度】，         每一次动画增加或者减少的，像素或者透明度,【可选，默认20】
            't':50             【每次动画时间】， 也就是多少毫秒执行一次动画【可选，默认10】
        });
 *</span><span style="color: #008000">*/</span><span style="color: #000000">
feng_zhuang_ku.prototype.yi_dong_tou_ming </span>= <span style="color: #0000ff">function</span><span style="color: #000000"> (obj) {
    </span><span style="color: #0000ff">for</span> (<span style="color: #0000ff">var</span> i = 0; i &lt; <span style="color: #0000ff">this</span>.jie_dian.length; i++<span style="color: #000000">) {
        </span><span style="color: #0000ff">var</span> element = <span style="color: #0000ff">this</span><span style="color: #000000">.jie_dian[i];
         </span><span style="color: #008000">//</span><span style="color: #008000"> attr，为动画方式，</span>
         <span style="color: #008000">//</span><span style="color: #008000"> x.为横向移动</span>
         <span style="color: #008000">//</span><span style="color: #008000"> y.为竖向移动</span>
         <span style="color: #008000">//</span><span style="color: #008000"> w.为增加宽度动画</span>
         <span style="color: #008000">//</span><span style="color: #008000"> h.为增加高度动画</span>
         <span style="color: #008000">//</span><span style="color: #008000"> o.为透明度动画</span>
        <span style="color: #0000ff">var</span> attr = obj['attr'] == 'x' ? 'left' : obj['attr'] == 'y' ? 'top'<span style="color: #000000"> :
            obj[</span>'attr'] == 'w' ? 'width' : obj['attr'] == 'h' ? 'height'<span style="color: #000000"> :
                obj[</span>'attr'] == 'o' ? 'opacity' : 'left'<span style="color: #000000">;

        </span><span style="color: #008000">//</span><span style="color: #008000"> start.为动画起始位置，</span>
        <span style="color: #008000">//</span><span style="color: #008000"> 如果输入了动画起始位置，值就为输入的起始位置，移动动画是像素值（如100），透明度动画是透明度百分比（如50）</span>
        <span style="color: #008000">//</span><span style="color: #008000"> 如果没输入，默认移动动画获取的对象原始像素位置，透明度动画获取的对象原始透明度，除以100等于原始透明度百分比</span>
        <span style="color: #0000ff">var</span> start = obj['start'] != undefined ? obj['start'<span style="color: #000000">] :
            attr </span>== 'opacity' ? parseFloat(getStyle(element, attr)) * 100<span style="color: #000000"> :
                parseInt(getStyle(element, attr));

         </span><span style="color: #008000">//</span><span style="color: #008000"> t.为每次动画时间，也就是多少毫秒执行一次动画</span>
         <span style="color: #008000">//</span><span style="color: #008000"> 不传默认，是10毫秒执行一次动画</span>
        <span style="color: #0000ff">var</span> t = obj['t'] != undefined ? obj['t'] : 10<span style="color: #000000">;

         </span><span style="color: #008000">//</span><span style="color: #008000"> step.为跨度，每一次动画增加或者减少的，像素或者透明度</span>
        <span style="color: #0000ff">var</span> step = obj['step'] != undefined ? obj['step'] : 20<span style="color: #000000">;

         </span><span style="color: #008000">//</span><span style="color: #008000"> alter.为增量，就是在对象原始的像素或者透明度上，增加或者减少像素或者透明度</span>
        <span style="color: #0000ff">var</span> alter = obj['alter'<span style="color: #000000">];

         </span><span style="color: #008000">//</span><span style="color: #008000"> target.为目标量，就是在原始的像素或者透明度上，增加或者减少到目标量的像素或者透明度</span>
         <span style="color: #008000">//</span><span style="color: #008000"> 注意，增量，是在原始上增加或者减少多少，目标量是在原始的基础上增加或者减少到目标</span>
        <span style="color: #0000ff">var</span> target = obj['target'<span style="color: #000000">];

         </span><span style="color: #008000">//</span><span style="color: #008000"> speed.为缓冲速度，动画模式为缓冲时，以此值改变step.每一次动画动态增加或者减少，实现缓冲效果</span>
         <span style="color: #008000">//</span><span style="color: #008000"> 不传，默认为6</span>
        <span style="color: #0000ff">var</span> speed = obj['speed'] != undefined ? obj['speed'] : 6<span style="color: #000000">;

         </span><span style="color: #008000">//</span><span style="color: #008000"> type.为动画模式，匀速为匀速模式，缓冲为缓冲模式</span>
         <span style="color: #008000">//</span><span style="color: #008000"> 不传，默认为缓冲模式</span>
        <span style="color: #0000ff">var</span> type = obj['type'] == 0 ? 'constant' : obj['type'] == 1 ? 'buffer' : 'buffer'<span style="color: #000000">;
        </span><span style="color: #0000ff">if</span> (alter != undefined &amp;&amp; target ==<span style="color: #000000"> undefined) {
            target </span>= alter +<span style="color: #000000"> start;
        } </span><span style="color: #0000ff">else</span> <span style="color: #0000ff">if</span> (alter == undefined &amp;&amp; target ==<span style="color: #000000"> undefined) {
            </span><span style="color: #0000ff">throw</span> <span style="color: #0000ff">new</span> Error('alter增量或target目标量必须传一个！'<span style="color: #000000">);
        }
        </span><span style="color: #0000ff">if</span> (start &gt; target) step = -<span style="color: #000000">step;
        </span><span style="color: #0000ff">if</span> (attr == 'opacity'<span style="color: #000000">) {
            element.style.opacity </span>= parseInt(start) / 100<span style="color: #000000">;
            element.style.filter </span>= 'alpha(opacity=' + parseInt(start) + ')'<span style="color: #000000">;
        } </span><span style="color: #0000ff">else</span><span style="color: #000000"> {
            element.style[attr] </span>= start + 'px'<span style="color: #000000">;
        }
        clearInterval(window.timer);
        timer </span>= setInterval(<span style="color: #0000ff">function</span><span style="color: #000000"> () {
            </span><span style="color: #0000ff">if</span> (type == 'buffer'<span style="color: #000000">) {
                step </span>= attr == 'opacity' ? (target - parseFloat(getStyle(element, attr)) * 100) /<span style="color: #000000"> speed :
                (target </span>- parseInt(getStyle(element, attr))) /<span style="color: #000000"> speed;
                step </span>= step &gt; 0 ?<span style="color: #000000"> Math.ceil(step) : Math.floor(step);
            }
            </span><span style="color: #0000ff">if</span> (attr == 'opacity'<span style="color: #000000">) {
                </span><span style="color: #0000ff">if</span> (step == 0<span style="color: #000000">) {
                    setOpacity();
                } </span><span style="color: #0000ff">else</span> <span style="color: #0000ff">if</span> (step &gt; 0 &amp;&amp; Math.abs(parseFloat(getStyle(element, attr)) * 100 - target) &lt;=<span style="color: #000000"> step) {
                    setOpacity();
                } </span><span style="color: #0000ff">else</span> <span style="color: #0000ff">if</span> (step &lt; 0 &amp;&amp; (parseFloat(getStyle(element, attr)) * 100 - target) &lt;=<span style="color: #000000"> Math.abs(step)) {
                    setOpacity();
                } </span><span style="color: #0000ff">else</span><span style="color: #000000"> {
                    </span><span style="color: #0000ff">var</span> temp = parseFloat(getStyle(element, attr)) * 100<span style="color: #000000">;
                    element.style.opacity </span>= parseInt(temp + step) / 100<span style="color: #000000">;
                    element.style.filter </span>= 'alpha(opacity=' + parseInt(temp + step) + ')'<span style="color: #000000">
                }
            } </span><span style="color: #0000ff">else</span><span style="color: #000000"> {
                </span><span style="color: #0000ff">if</span> (step == 0<span style="color: #000000">) {
                    setTarget();
                } </span><span style="color: #0000ff">else</span> <span style="color: #0000ff">if</span> (step &gt; 0 &amp;&amp; Math.abs(parseInt(getStyle(element, attr)) - target) &lt;=<span style="color: #000000"> step) {
                    setTarget();
                } </span><span style="color: #0000ff">else</span> <span style="color: #0000ff">if</span> (step &lt; 0 &amp;&amp; (parseInt(getStyle(element, attr)) - target) &lt;=<span style="color: #000000"> Math.abs(step)) {
                    setTarget();
                } </span><span style="color: #0000ff">else</span><span style="color: #000000"> {
                    element.style[attr] </span>= parseInt(getStyle(element, attr)) + step + 'px'<span style="color: #000000">;
                }
            }
            </span><span style="color: #008000">//</span><span style="color: #008000">document.getElementById('aaa').innerHTML += step + '&lt;br /&gt;';</span>
<span style="color: #000000">        }, t);
        </span><span style="color: #0000ff">function</span><span style="color: #000000"> setTarget() {
            element.style[attr] </span>= target + 'px'<span style="color: #000000">;
            clearInterval(timer);
        }
        </span><span style="color: #0000ff">function</span><span style="color: #000000"> setOpacity() {
            element.style.opacity </span>= parseInt(target) / 100<span style="color: #000000">;
            element.style.filter </span>= 'alpha(opacity=' + parseInt(target) + ')'<span style="color: #000000">;
            clearInterval(timer);
        }
    }
    </span><span style="color: #0000ff">return</span> <span style="color: #0000ff">this</span><span style="color: #000000">;
};</span></pre>
</div>
<p>&nbsp;</p></div>