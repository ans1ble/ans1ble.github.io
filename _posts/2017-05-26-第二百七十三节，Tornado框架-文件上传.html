第二百七十三节，Tornado框架-文件上传


			<div id="cnblogs_post_body" class="blogpost-body"><p><span style="color: #000000"><strong>Tornado框架-文件上传</strong></span></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>第一、普通表单上传文件</strong></span></p>
<p><span style="color: #ff0000"><strong>self.request.files["fafafa"] 获取上传文件信息，参数["上传文件框的name名称"]</strong></span><br><span style="color: #ff0000"><strong>['filename']获取上传文件的名称</strong></span><br><span style="color: #ff0000"><strong>['body']获取上传文件的内容</strong></span></p>
<p><span style="color: #0000ff"><strong>框架引擎</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000">coding:utf-8</span>

<span style="color: #0000ff">import</span><span style="color: #000000"> tornado.ioloop
</span><span style="color: #0000ff">import</span> tornado.web                                              <span style="color: #008000">#</span><span style="color: #008000">导入tornado模块下的web文件</span>

<span style="color: #0000ff">class</span><span style="color: #000000"> dluHandler(tornado.web.RequestHandler):
    </span><span style="color: #0000ff">def</span><span style="color: #000000"> get(self):
        self.render(</span><span style="color: #800000">"</span><span style="color: #800000">dlu.html</span><span style="color: #800000">"</span><span style="color: #000000">)
    </span><span style="color: #0000ff">def</span><span style="color: #000000"> post(self):
        <span style="background-color: #ff99cc">file_metas </span></span><span style="background-color: #ff99cc">= self.request.files[<span style="color: #800000">"</span><span style="color: #800000">fafafa</span><span style="color: #800000">"</span>]               <span style="color: #008000">#</span><span style="color: #008000">获取上传文件信息</span>
        <span style="color: #0000ff">for</span> meta <span style="color: #0000ff">in</span> file_metas:                                 <span style="color: #008000">#</span><span style="color: #008000">循环文件信息</span>
            file_name = meta[<span style="color: #800000">'</span><span style="color: #800000">filename</span><span style="color: #800000">'</span>]                        <span style="color: #008000">#</span><span style="color: #008000">获取文件的名称</span>
            <span style="color: #0000ff">import</span> os                                           <span style="color: #008000">#</span><span style="color: #008000">引入os路径处理模块</span>
            with open(os.path.join(<span style="color: #800000">'</span><span style="color: #800000">statics</span><span style="color: #800000">'</span>,<span style="color: #800000">'</span><span style="color: #800000">img</span><span style="color: #800000">'</span>,file_name),<span style="color: #800000">'</span><span style="color: #800000">wb</span><span style="color: #800000">'</span>) as up:            <span style="color: #008000">#</span><span style="color: #008000">os拼接文件保存路径，以字节码模式打开</span>
                up.write(meta[<span style="color: #800000">'</span><span style="color: #800000">body</span><span style="color: #800000">'</span>])                                                <span style="color: #008000">#</span><span style="color: #008000">将文件写入到保存路径目录</span>
</span><span style="color: #000000">
settings </span>= {                                            <span style="color: #008000">#</span><span style="color: #008000">html文件归类配置，设置一个字典</span>
    <span style="color: #800000">"</span><span style="color: #800000">template_path</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">views</span><span style="color: #800000">"</span>,                            <span style="color: #008000">#</span><span style="color: #008000">键为template_path固定的，值为要存放HTML的文件夹名称</span>
    <span style="color: #800000">"</span><span style="color: #800000">static_path</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">statics</span><span style="color: #800000">"</span>,                            <span style="color: #008000">#</span><span style="color: #008000">键为static_path固定的，值为要存放js和css的文件夹名称</span>
<span style="color: #000000">}

</span><span style="color: #008000">#</span><span style="color: #008000">路由映射</span>
application = tornado.web.Application([                 <span style="color: #008000">#</span><span style="color: #008000">创建一个变量等于tornado.web下的Application方法</span>
    (r<span style="color: #800000">"</span><span style="color: #800000">/dlu</span><span style="color: #800000">"</span><span style="color: #000000">, dluHandler),
],</span>**settings)                                           <span style="color: #008000">#</span><span style="color: #008000">将html文件归类配置字典，写在路由映射的第二个参数里</span>

<span style="color: #0000ff">if</span> <span style="color: #800080">__name__</span> == <span style="color: #800000">"</span><span style="color: #800000">__main__</span><span style="color: #800000">"</span><span style="color: #000000">:
    </span><span style="color: #008000">#</span><span style="color: #008000">内部socket运行起来</span>
    application.listen(8888)                            <span style="color: #008000">#</span><span style="color: #008000">设置端口</span>
    tornado.ioloop.IOLoop.instance().start()&nbsp;</pre>
</div>
<p><span style="color: #0000ff"><strong>html</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">&lt;!</span><span style="color: #ff00ff">DOCTYPE html</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">html </span><span style="color: #ff0000">lang</span><span style="color: #0000ff">="en"</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">head</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">meta </span><span style="color: #ff0000">charset</span><span style="color: #0000ff">="UTF-8"</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">title</span><span style="color: #0000ff">&gt;</span>Title<span style="color: #0000ff">&lt;/</span><span style="color: #800000">title</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">script </span><span style="color: #ff0000">type</span><span style="color: #0000ff">="text/javascript"</span><span style="color: #ff0000"> src</span><span style="color: #0000ff">='{{static_url("jquery.min.js")}}' </span><span style="color: #ff0000">charset</span><span style="color: #0000ff">="UTF-8"</span><span style="color: #0000ff">&gt;&lt;/</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">head</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">body</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">form </span><span style="color: #ff0000">id</span><span style="color: #0000ff">="my_form"</span><span style="color: #ff0000"> name</span><span style="color: #0000ff">="form"</span><span style="background-color: #ff99cc"><span style="color: #ff0000"> action</span><span style="color: #0000ff">="/dlu"</span><span style="color: #ff0000"> method</span><span style="color: #0000ff">="POST"</span><span style="color: #ff0000"> enctype</span><span style="color: #0000ff">="multipart/form-data"</span></span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">div </span><span style="color: #ff0000">id</span><span style="color: #0000ff">="main"</span><span style="color: #0000ff">&gt;</span>
        <span style="color: #0000ff">&lt;</span><span style="color: #800000">input </span><span style="color: #ff0000">name</span><span style="color: #0000ff">="favor"</span><span style="color: #ff0000"> type</span><span style="color: #0000ff">="text"</span><span style="color: #0000ff">/&gt;</span>
        <span style="background-color: #ff99cc"><span style="color: #0000ff">&lt;</span><span style="color: #800000">input </span><span style="color: #ff0000">name</span><span style="color: #0000ff">="fafafa"</span><span style="color: #ff0000"> id</span><span style="color: #0000ff">="my_file"</span><span style="color: #ff0000"> type</span><span style="color: #0000ff">="file"</span><span style="color: #0000ff">/&gt;</span></span>
        <span style="color: #0000ff">&lt;</span><span style="color: #800000">input </span><span style="color: #ff0000">type</span><span style="color: #0000ff">="submit"</span><span style="color: #ff0000"> value</span><span style="color: #0000ff">="提交"</span><span style="color: #0000ff">/&gt;</span>
    <span style="color: #0000ff">&lt;/</span><span style="color: #800000">div</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">form</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">body</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">html</span><span style="color: #0000ff">&gt;</span></pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201705/955761-20170526144823841-1134839941.png" alt=""></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>第二、jquery的ajax上传文件</strong></span></p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>注意：FormData();创建表单对象兼容性不好，<span style="color: #0000ff">不推荐</span></strong></span></p>
<p><span style="color: #0000ff; background-color: #ffffff"><strong>html</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">&lt;!</span><span style="color: #ff00ff">DOCTYPE html</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">html </span><span style="color: #ff0000">lang</span><span style="color: #0000ff">="en"</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">head</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">meta </span><span style="color: #ff0000">charset</span><span style="color: #0000ff">="UTF-8"</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">title</span><span style="color: #0000ff">&gt;</span>Title<span style="color: #0000ff">&lt;/</span><span style="color: #800000">title</span><span style="color: #0000ff">&gt;</span>
    <span style="background-color: #ff99cc"><span style="color: #0000ff">&lt;</span><span style="color: #800000">script </span><span style="color: #ff0000">type</span><span style="color: #0000ff">="text/javascript"</span><span style="color: #ff0000"> src</span><span style="color: #0000ff">='{{static_url("jquery.min.js")}}' </span><span style="color: #ff0000">charset</span><span style="color: #0000ff">="UTF-8"</span><span style="color: #0000ff">&gt;&lt;/</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span></span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">head</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">body</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">input </span><span style="color: #ff0000">class</span><span style="color: #0000ff">="shchlj"</span><span style="color: #ff0000"> type</span><span style="color: #0000ff">="text"</span><span style="color: #ff0000"> name</span><span style="color: #0000ff">="luj"</span><span style="color: #0000ff">/&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">input </span><span style="color: #ff0000">type</span><span style="color: #0000ff">="file"</span><span style="color: #ff0000"> id</span><span style="color: #0000ff">="img"</span> <span style="color: #0000ff">/&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">input </span><span style="color: #ff0000">type</span><span style="color: #0000ff">="button"</span><span style="color: #ff0000"> value</span><span style="color: #0000ff">="上传"</span><span style="background-color: #ff99cc"><span style="color: #ff0000"> onclick</span><span style="color: #0000ff">="UploadFile();"</span></span> <span style="color: #0000ff">/&gt;</span>
    <span style="background-color: #ff99cc"><span style="color: #0000ff">&lt;</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span>
        <span style="color: #0000ff">function</span><span style="color: #000000"> UploadFile(){
            </span><span style="color: #0000ff">var</span><span style="color: #000000"> fileObj </span><span style="color: #000000">=</span><span style="color: #000000"> $(</span><span style="color: #000000">"</span><span style="color: #000000">#img</span><span style="color: #000000">"</span><span style="color: #000000">)[</span><span style="color: #000000">0</span><span style="color: #000000">].files[</span><span style="color: #000000">0</span><span style="color: #000000">];        </span><span style="color: #008000">//</span><span style="color: #008000">获取上传文件名称</span>
            <span style="color: #0000ff">var</span><span style="color: #000000"> form </span><span style="color: #000000">=</span> <span style="color: #0000ff">new</span><span style="color: #000000"> FormData();                  </span><span style="color: #008000">//</span><span style="color: #008000">创建表单对象</span>
<span style="color: #000000">            form.append(</span><span style="color: #000000">"</span><span style="color: #000000">k1</span><span style="color: #000000">"</span><span style="color: #000000">, </span><span style="color: #000000">"</span><span style="color: #000000">v1</span><span style="color: #000000">"</span><span style="color: #000000">);                    </span><span style="color: #008000">//</span><span style="color: #008000">向表单对象添加name和value</span>
<span style="color: #000000">            form.append(</span><span style="color: #000000">"</span><span style="color: #000000">fff</span><span style="color: #000000">"</span><span style="color: #000000">, fileObj);                </span><span style="color: #008000">//</span><span style="color: #008000">向表单对象添加name和value,将上传文件名称添加到value</span>
<span style="color: #000000">
            $.ajax({                                    </span><span style="color: #008000">//</span><span style="color: #008000">jquery的ajax提交</span>
<span style="color: #000000">                type: </span><span style="color: #000000">'</span><span style="color: #000000">POST</span><span style="color: #000000">'</span><span style="color: #000000">,
                url: </span><span style="color: #000000">'</span><span style="color: #000000">/dlu</span><span style="color: #000000">'</span><span style="color: #000000">,
                data: form,                             </span><span style="color: #008000">//</span><span style="color: #008000">提交数据为表单对象</span>
<span style="color: #000000">                processData: </span><span style="color: #0000ff">false</span><span style="color: #000000">,                     </span><span style="color: #008000">//</span><span style="color: #008000">默认为 true，数据被处理为 URL 编码格式。如果为 false，则阻止将传入的数据处理为 URL 编码的格式。</span>
<span style="color: #000000">                contentType: </span><span style="color: #0000ff">false</span><span style="color: #000000">,                     </span><span style="color: #008000">//</span><span style="color: #008000">指 定 请 求 内 容 的 类 型</span>
<span style="color: #000000">                success: </span><span style="color: #0000ff">function</span><span style="color: #000000"> (response, status, xhr) {      </span><span style="color: #008000">//</span><span style="color: #008000">提交成功</span>
<span style="color: #000000">                    $(</span><span style="color: #000000">'</span><span style="color: #000000">.shchlj</span><span style="color: #000000">'</span><span style="color: #000000">).val(response)                   </span><span style="color: #008000">//</span><span style="color: #008000">将返回文件的服务器上传路径，添加到输入框值</span>
<span style="color: #000000">                },
                error: </span><span style="color: #0000ff">function</span><span style="color: #000000"> (xhr, errorText, errorStatus) {  </span><span style="color: #008000">//</span><span style="color: #008000">如果发生错误，返回错误信息</span>
<span style="color: #000000">
                }

            })
        }
    </span><span style="color: #0000ff">&lt;/</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span></span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">body</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">html</span><span style="color: #0000ff">&gt;</span></pre>
</div>
<p><span style="color: #0000ff"><strong>框架引擎</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000">coding:utf-8</span>

<span style="color: #0000ff">import</span><span style="color: #000000"> tornado.ioloop
</span><span style="color: #0000ff">import</span> tornado.web                                              <span style="color: #008000">#</span><span style="color: #008000">导入tornado模块下的web文件</span>
<span style="color: #0000ff">import</span> session_lei                                              <span style="color: #008000">#</span><span style="color: #008000">导入session模块</span>

<span style="color: #0000ff">class</span><span style="color: #000000"> dluHandler(tornado.web.RequestHandler):
    </span><span style="color: #0000ff">def</span><span style="color: #000000"> get(self):
        self.render(</span><span style="color: #800000">"</span><span style="color: #800000">dlu.html</span><span style="color: #800000">"</span><span style="color: #000000">)
    </span><span style="background-color: #ff99cc"><span style="color: #0000ff">def</span><span style="color: #000000"> post(self):
        file_metas </span>= self.request.files[<span style="color: #800000">"</span><span style="color: #800000">fff</span><span style="color: #800000">"</span>]               <span style="color: #008000">#</span><span style="color: #008000">获取上传文件信息</span>
        <span style="color: #0000ff">for</span> meta <span style="color: #0000ff">in</span> file_metas:                                 <span style="color: #008000">#</span><span style="color: #008000">循环文件信息</span>
            file_name = meta[<span style="color: #800000">'</span><span style="color: #800000">filename</span><span style="color: #800000">'</span>]                        <span style="color: #008000">#</span><span style="color: #008000">获取文件的名称</span>
            <span style="color: #0000ff">import</span> os                                           <span style="color: #008000">#</span><span style="color: #008000">引入os路径处理模块</span>
            with open(os.path.join(<span style="color: #800000">'</span><span style="color: #800000">statics</span><span style="color: #800000">'</span>,<span style="color: #800000">'</span><span style="color: #800000">img</span><span style="color: #800000">'</span>,file_name),<span style="color: #800000">'</span><span style="color: #800000">wb</span><span style="color: #800000">'</span>) as up:            <span style="color: #008000">#</span><span style="color: #008000">os拼接文件保存路径，以字节码模式打开</span>
                up.write(meta[<span style="color: #800000">'</span><span style="color: #800000">body</span><span style="color: #800000">'</span>])                                                <span style="color: #008000">#</span><span style="color: #008000">将文件写入到保存路径目录</span>
                self.write(os.path.join(<span style="color: #800000">'</span><span style="color: #800000">statics</span><span style="color: #800000">'</span>,<span style="color: #800000">'</span><span style="color: #800000">img</span><span style="color: #800000">'</span>,file_name))                   <span style="color: #008000">#</span><span style="color: #008000">将上传好的路径返回</span></span>
<span style="color: #000000">
settings </span>= {                                            <span style="color: #008000">#</span><span style="color: #008000">html文件归类配置，设置一个字典</span>
    <span style="color: #800000">"</span><span style="color: #800000">template_path</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">views</span><span style="color: #800000">"</span>,                            <span style="color: #008000">#</span><span style="color: #008000">键为template_path固定的，值为要存放HTML的文件夹名称</span>
    <span style="color: #800000">"</span><span style="color: #800000">static_path</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">statics</span><span style="color: #800000">"</span>,                            <span style="color: #008000">#</span><span style="color: #008000">键为static_path固定的，值为要存放js和css的文件夹名称</span>
<span style="color: #000000">}

</span><span style="color: #008000">#</span><span style="color: #008000">路由映射</span>
application = tornado.web.Application([                 <span style="color: #008000">#</span><span style="color: #008000">创建一个变量等于tornado.web下的Application方法</span>
    <span style="background-color: #ff99cc">(r<span style="color: #800000">"</span><span style="color: #800000">/dlu</span><span style="color: #800000">"</span></span><span style="color: #000000"><span style="background-color: #ff99cc">, dluHandler),</span>
],</span>**settings)                                           <span style="color: #008000">#</span><span style="color: #008000">将html文件归类配置字典，写在路由映射的第二个参数里</span>

<span style="color: #0000ff">if</span> <span style="color: #800080">__name__</span> == <span style="color: #800000">"</span><span style="color: #800000">__main__</span><span style="color: #800000">"</span><span style="color: #000000">:
    </span><span style="color: #008000">#</span><span style="color: #008000">内部socket运行起来</span>
    application.listen(8888)                            <span style="color: #008000">#</span><span style="color: #008000">设置端口</span>
    tornado.ioloop.IOLoop.instance().start()</pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201705/955761-20170527094525216-444515124.png" alt=""></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>第三、利用iframe框架上传文件</strong></span></p>
<p><span style="color: #0000ff; background-color: #ffffff"><strong>html</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">&lt;!</span><span style="color: #ff00ff">DOCTYPE html</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">html </span><span style="color: #ff0000">lang</span><span style="color: #0000ff">="en"</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">head</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">meta </span><span style="color: #ff0000">charset</span><span style="color: #0000ff">="UTF-8"</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">title</span><span style="color: #0000ff">&gt;</span>Title<span style="color: #0000ff">&lt;/</span><span style="color: #800000">title</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">script </span><span style="color: #ff0000">type</span><span style="color: #0000ff">="text/javascript"</span><span style="color: #ff0000"> src</span><span style="color: #0000ff">='{{static_url("jquery.min.js")}}' </span><span style="color: #ff0000">charset</span><span style="color: #0000ff">="UTF-8"</span><span style="color: #0000ff">&gt;&lt;/</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">head</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">body</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">form </span><span style="color: #ff0000">id</span><span style="color: #0000ff">="my_form"</span><span style="color: #ff0000"> name</span><span style="color: #0000ff">="form"</span><span style="color: #ff0000"> action</span><span style="color: #0000ff">="/dlu"</span><span style="color: #ff0000"> method</span><span style="color: #0000ff">="POST"</span><span style="color: #ff0000"> enctype</span><span style="color: #0000ff">="multipart/form-data"</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">div </span><span style="color: #ff0000">id</span><span style="color: #0000ff">="main"</span><span style="color: #0000ff">&gt;</span>
        <span style="color: #0000ff">&lt;</span><span style="color: #800000">input </span><span style="color: #ff0000">class</span><span style="color: #0000ff">="shchlj"</span><span style="color: #ff0000"> type</span><span style="color: #0000ff">="text"</span><span style="color: #ff0000"> name</span><span style="color: #0000ff">="luj"</span><span style="color: #0000ff">/&gt;</span>
        <span style="background-color: #ff99cc"><span style="color: #0000ff">&lt;</span><span style="color: #800000">input </span><span style="color: #ff0000">name</span><span style="color: #0000ff">="fff"</span><span style="color: #ff0000"> id</span><span style="color: #0000ff">="my_file"</span><span style="color: #ff0000"> type</span><span style="color: #0000ff">="file"</span><span style="color: #0000ff">/&gt;</span></span>
        <span style="color: #0000ff">&lt;</span><span style="color: #800000">input </span><span style="color: #ff0000">type</span><span style="color: #0000ff">="button"</span><span style="color: #ff0000"> name</span><span style="color: #0000ff">="action"</span><span style="color: #ff0000"> value</span><span style="color: #0000ff">="Upload"</span><span style="background-color: #ff99cc"><span style="color: #ff0000"> onclick</span><span style="color: #0000ff">="redirect()"</span></span><span style="color: #0000ff">/&gt;</span>
        <span style="background-color: #ff99cc"><span style="color: #0000ff">&lt;</span><span style="color: #800000">iframe </span><span style="color: #ff0000">style</span><span style="color: #0000ff">="display: none;"</span><span style="color: #ff0000"> id</span><span style="color: #0000ff">='my_iframe' </span><span style="color: #ff0000">name</span><span style="color: #0000ff">='my_iframe' </span><span style="color: #ff0000">src</span><span style="color: #0000ff">=""</span><span style="color: #ff0000"> class</span><span style="color: #0000ff">="hide"</span><span style="color: #0000ff">&gt;&lt;/</span><span style="color: #800000">iframe</span><span style="color: #0000ff">&gt;</span></span>
    <span style="color: #0000ff">&lt;/</span><span style="color: #800000">div</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">form</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span>
    <span style="background-color: #ff99cc"><span style="color: #0000ff">function</span><span style="color: #000000"> redirect() {
        document.getElementById(</span><span style="color: #000000">'</span><span style="color: #000000">my_iframe</span><span style="color: #000000">'</span><span style="color: #000000">).onload </span><span style="color: #000000">=</span><span style="color: #000000"> Testt;       </span><span style="color: #008000">//</span><span style="color: #008000">等待框架加载完成后执行Testt函数</span>
<span style="color: #000000">        document.getElementById(</span><span style="color: #000000">'</span><span style="color: #000000">my_form</span><span style="color: #000000">'</span><span style="color: #000000">).target </span><span style="color: #000000">=</span> <span style="color: #000000">'</span><span style="color: #000000">my_iframe</span><span style="color: #000000">'</span><span style="color: #000000">;   </span><span style="color: #008000">//</span><span style="color: #008000">target属性告诉浏览器希望将所链接的资源显示在哪里，提交后返回数据将显示到框架里</span>
<span style="color: #000000">        document.getElementById(</span><span style="color: #000000">'</span><span style="color: #000000">my_form</span><span style="color: #000000">'</span><span style="color: #000000">).submit();               </span><span style="color: #008000">//</span><span style="color: #008000">执行提交方法</span>
<span style="color: #000000">
    }

    </span><span style="color: #0000ff">function</span><span style="color: #000000"> Testt(ths) {                                          </span><span style="color: #008000">//</span><span style="color: #008000">框架加载完成后执行Testt函数</span>
        <span style="color: #0000ff">var</span><span style="color: #000000"> t </span><span style="color: #000000">=</span><span style="color: #000000"> $(</span><span style="color: #000000">"</span><span style="color: #000000">#my_iframe</span><span style="color: #000000">"</span><span style="color: #000000">).contents().find(</span><span style="color: #000000">"</span><span style="color: #000000">body</span><span style="color: #000000">"</span><span style="color: #000000">).text();    </span><span style="color: #008000">//</span><span style="color: #008000">contents()，获取某元素下面所有元素节点，包括文本节点，如果是 iframe，则可以查找文本内容，集合元素</span>
<span style="color: #000000">        $(</span><span style="color: #000000">'</span><span style="color: #000000">.shchlj</span><span style="color: #000000">'</span><span style="color: #000000">).val(t);                                       </span><span style="color: #008000">//</span><span style="color: #008000">获取框架里的返回内容，写入输入框</span>
<span style="color: #000000">    }
</span></span><span style="color: #0000ff">&lt;/</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">body</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">html</span><span style="color: #0000ff">&gt;</span></pre>
</div>
<p><span style="color: #0000ff"><strong>框架引擎</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000">coding:utf-8</span>

<span style="color: #0000ff">import</span><span style="color: #000000"> tornado.ioloop
</span><span style="color: #0000ff">import</span> tornado.web                                              <span style="color: #008000">#</span><span style="color: #008000">导入tornado模块下的web文件</span>
<span style="color: #0000ff">import</span> session_lei                                              <span style="color: #008000">#</span><span style="color: #008000">导入session模块</span>

<span style="color: #0000ff">class</span><span style="color: #000000"> dluHandler(tornado.web.RequestHandler):
    </span><span style="color: #0000ff">def</span><span style="color: #000000"> get(self):
        self.render(</span><span style="color: #800000">"</span><span style="color: #800000">dlu.html</span><span style="color: #800000">"</span><span style="color: #000000">)
    </span><span style="color: #0000ff">def</span><span style="color: #000000"> post(self):
        <span style="background-color: #ff99cc">file_metas </span></span><span style="background-color: #ff99cc">= self.request.files[<span style="color: #800000">"</span><span style="color: #800000">fff</span><span style="color: #800000">"</span>]               <span style="color: #008000">#</span><span style="color: #008000">获取上传文件信息</span>
        <span style="color: #0000ff">for</span> meta <span style="color: #0000ff">in</span> file_metas:                                 <span style="color: #008000">#</span><span style="color: #008000">循环文件信息</span>
            file_name = meta[<span style="color: #800000">'</span><span style="color: #800000">filename</span><span style="color: #800000">'</span>]                        <span style="color: #008000">#</span><span style="color: #008000">获取文件的名称</span>
            <span style="color: #0000ff">import</span> os                                           <span style="color: #008000">#</span><span style="color: #008000">引入os路径处理模块</span>
            with open(os.path.join(<span style="color: #800000">'</span><span style="color: #800000">statics</span><span style="color: #800000">'</span>,<span style="color: #800000">'</span><span style="color: #800000">img</span><span style="color: #800000">'</span>,file_name),<span style="color: #800000">'</span><span style="color: #800000">wb</span><span style="color: #800000">'</span>) as up:            <span style="color: #008000">#</span><span style="color: #008000">os拼接文件保存路径，以字节码模式打开</span>
                up.write(meta[<span style="color: #800000">'</span><span style="color: #800000">body</span><span style="color: #800000">'</span>])                                                <span style="color: #008000">#</span><span style="color: #008000">将文件写入到保存路径目录</span>
                self.write(os.path.join(<span style="color: #800000">'</span><span style="color: #800000">statics</span><span style="color: #800000">'</span>,<span style="color: #800000">'</span><span style="color: #800000">img</span><span style="color: #800000">'</span>,file_name))                   <span style="color: #008000">#</span><span style="color: #008000">将上传好的路径返回</span></span>
<span style="color: #000000">
settings </span>= {                                            <span style="color: #008000">#</span><span style="color: #008000">html文件归类配置，设置一个字典</span>
    <span style="color: #800000">"</span><span style="color: #800000">template_path</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">views</span><span style="color: #800000">"</span>,                            <span style="color: #008000">#</span><span style="color: #008000">键为template_path固定的，值为要存放HTML的文件夹名称</span>
    <span style="color: #800000">"</span><span style="color: #800000">static_path</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">statics</span><span style="color: #800000">"</span>,                            <span style="color: #008000">#</span><span style="color: #008000">键为static_path固定的，值为要存放js和css的文件夹名称</span>
<span style="color: #000000">}

</span><span style="color: #008000">#</span><span style="color: #008000">路由映射</span>
application = tornado.web.Application([                 <span style="color: #008000">#</span><span style="color: #008000">创建一个变量等于tornado.web下的Application方法</span>
    <span style="background-color: #ff99cc">(r<span style="color: #800000">"</span><span style="color: #800000">/dlu</span><span style="color: #800000">"</span></span><span style="color: #000000"><span style="background-color: #ff99cc">, dluHandler),</span>
],</span>**settings)                                           <span style="color: #008000">#</span><span style="color: #008000">将html文件归类配置字典，写在路由映射的第二个参数里</span>

<span style="color: #0000ff">if</span> <span style="color: #800080">__name__</span> == <span style="color: #800000">"</span><span style="color: #800000">__main__</span><span style="color: #800000">"</span><span style="color: #000000">:
    </span><span style="color: #008000">#</span><span style="color: #008000">内部socket运行起来</span>
    application.listen(8888)                            <span style="color: #008000">#</span><span style="color: #008000">设置端口</span>
    tornado.ioloop.IOLoop.instance().start()</pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>第四、jquery.form.js表单插件上传文件【推荐】</strong></span></p>
<p><span style="color: #0000ff; background-color: #ffffff"><strong>html</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">&lt;!</span><span style="color: #ff00ff">DOCTYPE html</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">html </span><span style="color: #ff0000">lang</span><span style="color: #0000ff">="en"</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">head</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">meta </span><span style="color: #ff0000">charset</span><span style="color: #0000ff">="UTF-8"</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">title</span><span style="color: #0000ff">&gt;</span>Title<span style="color: #0000ff">&lt;/</span><span style="color: #800000">title</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">script </span><span style="color: #ff0000">type</span><span style="color: #0000ff">="text/javascript"</span><span style="color: #ff0000"> src</span><span style="color: #0000ff">='{{static_url("jquery.min.js")}}' </span><span style="color: #ff0000">charset</span><span style="color: #0000ff">="UTF-8"</span><span style="color: #0000ff">&gt;&lt;/</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span>
    <span style="background-color: #ff99cc"><span style="color: #0000ff">&lt;</span><span style="color: #800000">script </span><span style="color: #ff0000">type</span><span style="color: #0000ff">="text/javascript"</span><span style="color: #ff0000"> src</span><span style="color: #0000ff">='{{static_url("jquery.form.js")}}' </span><span style="color: #ff0000">charset</span><span style="color: #0000ff">="UTF-8"</span><span style="color: #0000ff">&gt;&lt;/</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span></span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">head</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">body</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">form </span><span style="color: #ff0000">id</span><span style="color: #0000ff">="my_form"</span><span style="color: #ff0000"> name</span><span style="color: #0000ff">="form"</span><span style="color: #ff0000"> action</span><span style="color: #0000ff">="/dlu"</span><span style="color: #ff0000"> method</span><span style="color: #0000ff">="POST"</span><span style="color: #ff0000"> enctype</span><span style="color: #0000ff">="multipart/form-data"</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">div </span><span style="color: #ff0000">id</span><span style="color: #0000ff">="main"</span><span style="color: #0000ff">&gt;</span>
        <span style="color: #0000ff">&lt;</span><span style="color: #800000">input </span><span style="color: #ff0000">class</span><span style="color: #0000ff">="shchlj"</span><span style="color: #ff0000"> type</span><span style="color: #0000ff">="text"</span><span style="color: #ff0000"> name</span><span style="color: #0000ff">="luj"</span><span style="color: #0000ff">/&gt;</span>
        <span style="color: #0000ff">&lt;</span><span style="color: #800000">input </span><span style="background-color: #ff99cc"><span style="color: #ff0000">name</span><span style="color: #0000ff">="fff"</span></span><span style="color: #ff0000"> id</span><span style="color: #0000ff">="my_file"</span><span style="color: #ff0000"> type</span><span style="color: #0000ff">="file"</span><span style="color: #0000ff">/&gt;</span>
        <span style="background-color: #ff99cc"><span style="color: #0000ff">&lt;</span><span style="color: #800000">input </span><span style="color: #ff0000">type</span><span style="color: #0000ff">="submit"</span><span style="color: #ff0000"> value</span><span style="color: #0000ff">="上传"</span><span style="color: #0000ff">/&gt;</span></span>
    <span style="color: #0000ff">&lt;/</span><span style="color: #800000">div</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">form</span><span style="color: #0000ff">&gt;</span>
<span style="background-color: #ff99cc"><span style="color: #0000ff">&lt;</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">
    $(</span><span style="color: #000000">'</span><span style="color: #000000">#my_form</span><span style="color: #000000">'</span><span style="color: #000000">).ajaxForm({                                        </span><span style="color: #008000">//</span><span style="color: #008000">jquery.form.js，表单提交插件，会自动阻止跳转</span>
<span style="color: #000000">        url: </span><span style="color: #000000">'</span><span style="color: #000000">/dlu</span><span style="color: #000000">'</span><span style="color: #000000">,                                                </span><span style="color: #008000">//</span><span style="color: #008000">设置提交的 url，可覆盖 action 属性</span>
<span style="color: #000000">        type: </span><span style="color: #000000">'</span><span style="color: #000000">POST</span><span style="color: #000000">'</span><span style="color: #000000">,                                               </span><span style="color: #008000">//</span><span style="color: #008000">GET,POST</span>
<span style="color: #000000">        beforeSubmit: </span><span style="color: #0000ff">function</span><span style="color: #000000"> (formData, jqForm, options) {        </span><span style="color: #008000">//</span><span style="color: #008000">提交前的验证</span>
<span style="color: #000000">
        },
        success: </span><span style="color: #0000ff">function</span><span style="color: #000000"> (responseText, statusText) {              </span><span style="color: #008000">//</span><span style="color: #008000">提交成功后的操作</span>
<span style="color: #000000">            $(</span><span style="color: #000000">'</span><span style="color: #000000">.shchlj</span><span style="color: #000000">'</span><span style="color: #000000">).val(responseText);                         </span><span style="color: #008000">//</span><span style="color: #008000">将服务器返回路径写入输入框</span>
<span style="color: #000000">        },
        error: </span><span style="color: #0000ff">function</span><span style="color: #000000"> (event, errorText, errorType) {             </span><span style="color: #008000">//</span><span style="color: #008000">错误时调用,提交失败的操作</span>
<span style="color: #000000">
        }
    });
</span><span style="color: #0000ff">&lt;/</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span></span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">body</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">html</span><span style="color: #0000ff">&gt;</span></pre>
</div>
<p><strong><span style="color: #0000ff">框架引擎</span></strong></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000">coding:utf-8</span>

<span style="color: #0000ff">import</span><span style="color: #000000"> tornado.ioloop
</span><span style="color: #0000ff">import</span> tornado.web                                              <span style="color: #008000">#</span><span style="color: #008000">导入tornado模块下的web文件</span>
<span style="color: #0000ff">import</span> session_lei                                              <span style="color: #008000">#</span><span style="color: #008000">导入session模块</span>

<span style="color: #0000ff">class</span><span style="color: #000000"> dluHandler(tornado.web.RequestHandler):
    </span><span style="color: #0000ff">def</span><span style="color: #000000"> get(self):
        self.render(</span><span style="color: #800000">"</span><span style="color: #800000">dlu.html</span><span style="color: #800000">"</span><span style="color: #000000">)
    </span><span style="background-color: #ff99cc"><span style="color: #0000ff">def</span><span style="color: #000000"> post(self):
        file_metas </span>= self.request.files[<span style="color: #800000">"</span><span style="color: #800000">fff</span><span style="color: #800000">"</span>]               <span style="color: #008000">#</span><span style="color: #008000">获取上传文件信息</span>
        <span style="color: #0000ff">for</span> meta <span style="color: #0000ff">in</span> file_metas:                                 <span style="color: #008000">#</span><span style="color: #008000">循环文件信息</span>
            file_name = meta[<span style="color: #800000">'</span><span style="color: #800000">filename</span><span style="color: #800000">'</span>]                        <span style="color: #008000">#</span><span style="color: #008000">获取文件的名称</span>
            <span style="color: #0000ff">import</span> os                                           <span style="color: #008000">#</span><span style="color: #008000">引入os路径处理模块</span>
            with open(os.path.join(<span style="color: #800000">'</span><span style="color: #800000">statics</span><span style="color: #800000">'</span>,<span style="color: #800000">'</span><span style="color: #800000">img</span><span style="color: #800000">'</span>,file_name),<span style="color: #800000">'</span><span style="color: #800000">wb</span><span style="color: #800000">'</span>) as up:            <span style="color: #008000">#</span><span style="color: #008000">os拼接文件保存路径，以字节码模式打开</span>
                up.write(meta[<span style="color: #800000">'</span><span style="color: #800000">body</span><span style="color: #800000">'</span>])                                                <span style="color: #008000">#</span><span style="color: #008000">将文件写入到保存路径目录</span>
                self.write(os.path.join(<span style="color: #800000">'</span><span style="color: #800000">statics</span><span style="color: #800000">'</span>,<span style="color: #800000">'</span><span style="color: #800000">img</span><span style="color: #800000">'</span>,file_name))                   <span style="color: #008000">#</span><span style="color: #008000">将上传好的路径返回</span></span>
<span style="color: #000000">
settings </span>= {                                            <span style="color: #008000">#</span><span style="color: #008000">html文件归类配置，设置一个字典</span>
    <span style="color: #800000">"</span><span style="color: #800000">template_path</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">views</span><span style="color: #800000">"</span>,                            <span style="color: #008000">#</span><span style="color: #008000">键为template_path固定的，值为要存放HTML的文件夹名称</span>
    <span style="color: #800000">"</span><span style="color: #800000">static_path</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">statics</span><span style="color: #800000">"</span>,                            <span style="color: #008000">#</span><span style="color: #008000">键为static_path固定的，值为要存放js和css的文件夹名称</span>
<span style="color: #000000">}

</span><span style="color: #008000">#</span><span style="color: #008000">路由映射</span>
application = tornado.web.Application([                 <span style="color: #008000">#</span><span style="color: #008000">创建一个变量等于tornado.web下的Application方法</span>
    <span style="background-color: #ff99cc">(r<span style="color: #800000">"</span><span style="color: #800000">/dlu</span><span style="color: #800000">"</span></span><span style="color: #000000"><span style="background-color: #ff99cc">, dluHandler),</span>
],</span>**settings)                                           <span style="color: #008000">#</span><span style="color: #008000">将html文件归类配置字典，写在路由映射的第二个参数里</span>

<span style="color: #0000ff">if</span> <span style="color: #800080">__name__</span> == <span style="color: #800000">"</span><span style="color: #800000">__main__</span><span style="color: #800000">"</span><span style="color: #000000">:
    </span><span style="color: #008000">#</span><span style="color: #008000">内部socket运行起来</span>
    application.listen(8888)                            <span style="color: #008000">#</span><span style="color: #008000">设置端口</span>
    tornado.ioloop.IOLoop.instance().start()</pre>
</div>
<p>&nbsp;</p></div>