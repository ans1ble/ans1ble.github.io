第五十八节，上下文管理


			<div id="cnblogs_post_body" class="blogpost-body"><p><span style="color: #0000ff; font-size: 18pt"><strong>上下文管理</strong></span></p>
<p><span style="color: #000000"><strong>上下文管理就是在执行一段代码块的时候，通过一个装饰器函数，在执行代码块之前到<strong>装饰器函数里</strong>做一个操作，然后执行代码块，执行代码块之后再到<strong>装饰器函数里做另外一个操作</strong></strong></span></p>
<p>&nbsp;</p>
<p><span style="color: #000000"><strong><strong>要使用上下文管理首先要&nbsp;<span style="color: #0000ff">import contextlib</span> &nbsp; 导入上下文管理模块</strong></strong></span></p>
<p><strong><span style="color: #ff0000">@contextlib.contextmanager 定义上下文管理装饰器，写在下文管理装饰器函数上面</span></strong></p>
<p>&nbsp;</p>
<p><strong><span style="color: #ff0000">yield 遇到yield，跳出装饰器函数，执行代码块后，在回到yield这里向下执行</span></strong></p>
<p>&nbsp;</p>
<p><strong><span style="color: #ff0000">with 执行上下文管理装饰器，后面写要执行的下文管理装饰器名称，里面写代码块</span></strong></p>
<p><span style="color: #0000ff"><strong><strong>上下文管理使用代码</strong></strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf8 -*-</span>
<span style="color: #0000ff">import</span> contextlib   <span style="color: #008000">#</span><span style="color: #008000">导入上下文管理模块</span>
<span style="color: #000000">
a </span>= <span style="color: #800000">"</span><span style="color: #800000">1</span><span style="color: #800000">"</span><span style="color: #000000">
b </span>= <span style="color: #800000">"</span><span style="color: #800000">2</span><span style="color: #800000">"</span><span style="color: #000000">
@contextlib.contextmanager </span><span style="color: #008000">#</span><span style="color: #008000">定义上下文管理装饰器</span>
<span style="color: #0000ff">def</span> f(a,b): <span style="color: #008000">#</span><span style="color: #008000">定义上下文管理装饰器函数，设置形式参数来接收实际参数</span>
    <span style="color: #0000ff">print</span>(<span style="color: #800000">"</span><span style="color: #800000">执行代码块之前，操作</span><span style="color: #800000">"</span>,a) <span style="color: #008000">#</span><span style="color: #008000">执行代码块之前打印</span>
    <span style="color: #0000ff">try</span><span style="color: #000000">:
        </span><span style="color: #0000ff">yield</span>   <span style="color: #008000">#</span><span style="color: #008000">遇到yield，跳出装饰器函数，执行代码块后，在回到yield这里向下执行</span>
    <span style="color: #0000ff">finally</span><span style="color: #000000">:
        </span><span style="color: #0000ff">print</span>(<span style="color: #800000">"</span><span style="color: #800000">执行代码块之后，操作</span><span style="color: #800000">"</span>,b) <span style="color: #008000">#</span><span style="color: #008000">#执行代码块之后打印</span>
<span style="color: #000000">
with f(a, b): </span><span style="color: #008000">#</span><span style="color: #008000">执行下文管理装饰器函数，传入实际参数</span>
    <span style="color: #0000ff">print</span>(<span style="color: #800000">"</span><span style="color: #800000">执行代码块</span><span style="color: #800000">"</span><span style="color: #000000">)

</span><span style="color: #008000">#</span><span style="color: #008000"> 输出</span><span style="color: #008000">
#</span><span style="color: #008000"> 执行代码块之前，操作 1</span><span style="color: #008000">
#</span><span style="color: #008000"> 执行代码块</span><span style="color: #008000">
#</span><span style="color: #008000"> 执行代码块之后，操作 2</span></pre>
</div>
<p><span style="color: #0000ff"><strong><strong>上下文管理原理图</strong></strong></span></p>
<p><span style="color: #0000ff"><strong><strong><img src="https://images2015.cnblogs.com/blog/955761/201610/955761-20161011103842852-326263759.png" alt=""></strong></strong></span></p>
<p>&nbsp;</p></div>