第三百一十八节，Django框架，信号


			<div id="cnblogs_post_body" class="blogpost-body"><p><strong>第三百一十八节，Django框架，信号</strong></p>
<p><strong>Django中提供了“信号调度”，用于在框架执行操作时解耦。通俗来讲，就是一些动作发生的时候，信号允许特定的发送者去提醒一些接受者。</strong></p>
<p><span style="color: #0000ff"><strong>也就是当程序有指定动作时，触发一个信号函数</strong></span></p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong><strong>1、Django内置信号</strong></strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #000000">Model signals　　#数据库操作时
    pre_init                    </span><span style="color: #008000">#</span><span style="color: #008000"> django的modal执行其构造方法前，自动触发</span>
    post_init                   <span style="color: #008000">#</span><span style="color: #008000"> django的modal执行其构造方法后，自动触发</span>
    pre_save                    <span style="color: #008000">#</span><span style="color: #008000"> django的modal对象保存前，自动触发</span>
    post_save                   <span style="color: #008000">#</span><span style="color: #008000"> django的modal对象保存后，自动触发</span>
    pre_delete                  <span style="color: #008000">#</span><span style="color: #008000"> django的modal对象删除前，自动触发</span>
    post_delete                 <span style="color: #008000">#</span><span style="color: #008000"> django的modal对象删除后，自动触发</span>
    m2m_changed                 <span style="color: #008000">#</span><span style="color: #008000"> django的modal中使用m2m字段操作第三张表（add,remove,clear）前后，自动触发</span>
    class_prepared              <span style="color: #008000">#</span><span style="color: #008000"> 程序启动时，检测已注册的app中modal类，对于每一个类，自动触发</span>
<span style="color: #000000">Management signals　　#执行命令时
    pre_migrate                 </span><span style="color: #008000">#</span><span style="color: #008000"> 执行migrate命令前，自动触发</span>
    post_migrate                <span style="color: #008000">#</span><span style="color: #008000"> 执行migrate命令后，自动触发</span>
Request/<span style="color: #000000">response signals　　
    request_started             </span><span style="color: #008000">#</span><span style="color: #008000"> 请求到来前，自动触发</span>
    request_finished            <span style="color: #008000">#</span><span style="color: #008000"> 请求结束后，自动触发</span>
    got_request_exception       <span style="color: #008000">#</span><span style="color: #008000"> 请求异常后，自动触发</span>
<span style="color: #000000">Test signals
    setting_changed             </span><span style="color: #008000">#</span><span style="color: #008000"> 使用test测试修改配置文件时，自动触发</span>
    template_rendered           <span style="color: #008000">#</span><span style="color: #008000"> 使用test测试渲染模板时，自动触发</span>
<span style="color: #000000">Database Wrappers
    connection_created          </span><span style="color: #008000">#</span><span style="color: #008000"> 创建数据库连接时，自动触发</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>信号的使用</strong></span></p>
<p><span style="color: #ff0000"><strong>首先在app项目的__init__.py 这个文件，设置信号行为，因为这个文件是所有操作都会经过的</strong></span></p>
<p><span style="color: #0000ff"><strong>1、在<strong>__init__.py导入信号模块</strong></strong></span></p>
<p><span style="color: #0000ff"><strong><strong>2、自定义信号执行函数</strong></strong></span></p>
<p><span style="color: #0000ff"><strong><strong>3、将信号执行函数注册到信号</strong></strong></span></p>
<p><span style="color: #0000ff"><strong>注意：</strong></span></p>
<p><span style="color: #0000ff"><strong>　　1、自定义信号执行函数，有两个固定参数sender, **kwargs</strong></span></p>
<p><span style="color: #0000ff"><strong>　　<strong>sender：返回触发信号执行函数的，对象或方法</strong></strong></span></p>
<p><span style="color: #0000ff"><strong><strong>　　<strong>kwargs：触发<strong><strong>信号执行函数的，<strong><strong>对象或方法传过来的数据</strong></strong></strong></strong></strong></strong></strong></span></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff">connect()</span>注册信号执行函数到信号里</strong></span><br><strong>使用方式：</strong><br><strong>	信号名称.connect(自定义信号执行函数名称)</strong></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">from</span> django.core.signals <span style="color: #0000ff">import</span><span style="color: #000000"> request_finished
</span><span style="color: #0000ff">from</span> django.core.signals <span style="color: #0000ff">import</span><span style="color: #000000; background-color: #ff99cc"> request_started     #有请求是触发信息
</span><span style="color: #0000ff">from</span> django.core.signals <span style="color: #0000ff">import</span><span style="color: #000000"> got_request_exception

</span><span style="color: #0000ff">from</span> django.db.models.signals <span style="color: #0000ff">import</span><span style="color: #000000"> class_prepared
</span><span style="color: #0000ff">from</span> django.db.models.signals <span style="color: #0000ff">import</span><span style="color: #000000"> pre_init, post_init
</span><span style="color: #0000ff">from</span> django.db.models.signals <span style="color: #0000ff">import</span><span style="color: #000000"> pre_save, post_save
</span><span style="color: #0000ff">from</span> django.db.models.signals <span style="color: #0000ff">import</span><span style="color: #000000"> pre_delete, post_delete
</span><span style="color: #0000ff">from</span> django.db.models.signals <span style="color: #0000ff">import</span><span style="color: #000000"> m2m_changed
</span><span style="color: #0000ff">from</span> django.db.models.signals <span style="color: #0000ff">import</span><span style="color: #000000"> pre_migrate, post_migrate

</span><span style="color: #0000ff">from</span> django.test.signals <span style="color: #0000ff">import</span><span style="color: #000000"> setting_changed
</span><span style="color: #0000ff">from</span> django.test.signals <span style="color: #0000ff">import</span><span style="color: #000000"> template_rendered

</span><span style="color: #0000ff">from</span> django.db.backends.signals <span style="color: #0000ff">import</span><span style="color: #000000"> connection_created


</span><span style="color: #0000ff">def</span> <span style="background-color: #ffff00">callback</span>(sender, **kwargs):   <span style="color: #008000">#</span><span style="color: #008000">自定义信号函数</span>
    <span style="color: #0000ff">print</span>(<span style="color: #800000">"</span><span style="color: #800000">执行信号函数</span><span style="color: #800000">"</span><span style="color: #000000">)
    </span><span style="color: #008000">#</span><span style="color: #008000"> print(sender)   #打印触发信号的对象或方法</span>
    <span style="color: #008000">#</span><span style="color: #008000"> print(kwargs)   #触发者传过来的数据</span>
<span style="color: #000000"><span style="background-color: #ff99cc">

request_started</span>.connect(<span style="background-color: #ffff00">callback</span>)   </span><span style="color: #008000">#</span><span style="color: #008000">将自定义信号函数注册到信号</span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>2、自定义信号</strong></span></p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>自定义信号需要我们手动触发</strong></span></p>
<p><span style="color: #0000ff; background-color: #ffffff"><strong>a. 定义信号模块</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">import</span><span style="color: #000000"><span style="background-color: #ff99cc"> django.dispatch</span>　　
<span style="background-color: #ff99cc">pizza_done </span></span>= django.dispatch.Signal(providing_args=[<span style="background-color: #ffff00"><span style="color: #800000">"</span><span style="color: #800000">toppings</span><span style="color: #800000">"</span>, <span style="color: #800000">"</span><span style="color: #800000">size</span><span style="color: #800000">"</span></span>])  #定义一个信号，触发时必须传两个参数</pre>
</div>
<p><span style="color: #0000ff"><strong>b. 注册信号</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">def</span><span style="background-color: #ff99cc"> callback</span>(sender, **<span style="color: #000000">kwargs):
    </span><span style="color: #0000ff">print</span>(<span style="color: #800000">"</span><span style="color: #800000">callback</span><span style="color: #800000">"</span><span style="color: #000000">)
    </span><span style="color: #0000ff">print</span><span style="color: #000000">(sender,kwargs)
 
<span style="background-color: #ff99cc">pizza_done</span>.connect(<span style="background-color: #ff99cc">callback</span>)</span></pre>
</div>
<p><span style="color: #0000ff"><strong>c. 触发信号</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">from</span> 路径 <span style="color: #0000ff">import</span><span style="color: #000000"> pizza_done
 
<span style="background-color: #ff99cc">pizza_done.send</span>(sender</span>=<span style="color: #800000">'</span><span style="color: #800000">seven</span><span style="color: #800000">'</span>,<span style="background-color: #ffff00">toppings=123, size=456</span>)</pre>
</div>
<p>&nbsp;</p></div>