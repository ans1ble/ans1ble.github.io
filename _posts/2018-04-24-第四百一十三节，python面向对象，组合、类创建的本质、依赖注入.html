第四百一十三节，python面向对象，组合、类创建的本质、依赖注入


			<div id="cnblogs_post_body" class="blogpost-body"><p><span style="color: #ff0000; font-size: x-large"><strong>组合</strong></span></p>
<p>&nbsp;</p>
<p><span style="font-size: x-large">组合举例<br>组合就是多个类，或者若干类联合起来完成一个任务<br>下面举例两个类联合起来完成一个任务<br>为了降低代码的耦合度，我们一般不会在一个类里实例化另外一个类，都是将一个类在外面实例化后传参到另外一个来<br>这样就带来了一个问题，如果有很多类相互继承，我们就需要在外面实例化很多类<br>最好能动态实例化类并传参（依赖注入），后面讲到</span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<pre>组合举例<br># 组合就是多个类，或者若干类联合起来完成一个任务<br># 下面举例两个类联合起来完成一个任务<br># 为了降低代码的耦合度，我们一般不会在一个类里实例化另外一个类，都是将一个类在外面实例化后传参到另外一个来<br># 这样就带来了一个问题，如果有很多类相互继承，我们就需要在外面实例化很多类<br># 最好能动态实例化类并传参（依赖注入），后面讲到<br><br><br></pre>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">class</span><span style="color: #000000"> shujukulianjie:
    </span><span style="color: #800000">"""</span><span style="color: #800000">
    连接数据库类
    </span><span style="color: #800000">"""</span>
    <span style="color: #0000ff">def</span> <span style="color: #800080">__init__</span><span style="color: #000000">(self, host):
        self.host </span>=<span style="color: #000000"> host

    </span><span style="color: #0000ff">def</span><span style="color: #000000"> lianjie(self):
        </span><span style="color: #800000">"""</span><span style="color: #800000">
        连接数据库
        </span><span style="color: #800000">"""</span>
        <span style="color: #0000ff">print</span>(<span style="color: #800000">"</span><span style="color: #800000">连接数据库{host}</span><span style="color: #800000">"</span>.format(host=<span style="color: #000000">self.host))

    </span><span style="color: #0000ff">def</span><span style="color: #000000"> guanbi(self):
        </span><span style="color: #800000">"""</span><span style="color: #800000">
        关闭数据库
        </span><span style="color: #800000">"""</span>
        <span style="color: #0000ff">print</span>(<span style="color: #800000">"</span><span style="color: #800000">连接数据库{host}</span><span style="color: #800000">"</span>.format(host=<span style="color: #000000">self.host))


</span><span style="color: #0000ff">class</span><span style="color: #000000"> yhucaozuo:
    </span><span style="color: #800000">"""</span><span style="color: #800000">
    用户操作类
    </span><span style="color: #800000">"""</span>
    <span style="color: #0000ff">def</span> <span style="color: #800080">__init__</span><span style="color: #000000">(self, shujuk):
        self.shujuk </span>=<span style="color: #000000"> shujuk

    </span><span style="color: #0000ff">def</span><span style="color: #000000"> yhdlu(self, user):
        </span><span style="color: #800000">"""</span><span style="color: #800000">
        用户登录
        </span><span style="color: #800000">"""</span><span style="color: #000000">
        self.shujuk.lianjie()
        </span><span style="color: #0000ff">print</span>(<span style="color: #800000">"</span><span style="color: #800000">用户{user}登录成功！</span><span style="color: #800000">"</span>.format(user=<span style="color: #000000">user))

obj_shujukulianjie </span>= shujukulianjie(<span style="color: #800000">"</span><span style="color: #800000">127.0.0.1</span><span style="color: #800000">"</span><span style="color: #000000">)

obj_yhucaozuo </span>=<span style="color: #000000"> yhucaozuo(obj_shujukulianjie)
obj_yhucaozuo.yhdlu(</span><span style="color: #800000">"</span><span style="color: #800000">abcde</span><span style="color: #800000">"</span>)</pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; font-size: x-large">创建类的本质</span></p>
<p>&nbsp;</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">class</span><span style="color: #000000"> shujukulianjie:
    </span><span style="color: #0000ff">def</span> <span style="color: #800080">__init__</span><span style="color: #000000">(self, host):
        self.host </span>=<span style="color: #000000"> host

    </span><span style="color: #0000ff">def</span><span style="color: #000000"> lianjie(self):
        </span><span style="color: #800000">"""</span><span style="color: #800000">
        连接数据库
        </span><span style="color: #800000">"""</span>
        <span style="color: #0000ff">print</span>(<span style="color: #800000">"</span><span style="color: #800000">连接数据库{host}</span><span style="color: #800000">"</span>.format(host=<span style="color: #000000">self.host))

obj_shujukulianjie </span>= shujukulianjie(<span style="color: #800000">"</span><span style="color: #800000">127.0.0.1</span><span style="color: #800000">"</span><span style="color: #000000">)

</span><span style="color: #008000">#</span><span style="color: #008000"> 类创建的本质</span><span style="color: #008000">
#</span><span style="color: #008000"> 类是由Type创建的</span><span style="color: #008000">
#</span><span style="color: #008000"> 当实例化一个对象时，都经过了哪些</span><span style="color: #008000">
#</span><span style="color: #008000"> 1.执行Type的__call__方法</span>
    <span style="color: #008000">#</span><span style="color: #008000"> 在__call__方法里执行shujukulianjie类的__new__方法</span>
    <span style="color: #008000">#</span><span style="color: #008000"> 在__call__方法里执行shujukulianjie类的__init__方法</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="font-size: x-large">讲依赖注入前我们需了解一下类创建的本质</span></p>
<p>&nbsp;</p>
<p><br><span style="font-size: large">类创建的本质<br>类是由Type创建的<br>当实例化一个对象时，都经过了哪些<br>1.执行Type的__call__方法<br>&nbsp;&nbsp;&nbsp; 
在__call__方法里执行shujukulianjie类的__new__方法<br>&nbsp;&nbsp;&nbsp; 
在__call__方法里执行shujukulianjie类的__init__方法</span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<pre></pre>
<p>&nbsp;</p>
<p><span style="font-size: large">可以看到执行Type的__call__方法是隐形的</span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="font-size: x-large"><strong><span style="color: #ff0000">自定义type类<br></span></strong>继承自定义type类的类，会由自定义type类创建</span></p>
<p>&nbsp;</p>
<div class="cnblogs_code">
<pre><span style="color: #000000">自定义type类
</span><span style="color: #0000ff">class</span><span style="color: #000000"> MyType(type):
    </span><span style="color: #0000ff">print</span>(<span style="color: #800000">'</span><span style="color: #800000">执行__call__</span><span style="color: #800000">'</span><span style="color: #000000">)

    </span><span style="color: #0000ff">def</span> <span style="color: #800080">__call__</span>(cls, *args, **<span style="color: #000000">kwargs):
        </span><span style="color: #0000ff">print</span>(<span style="color: #800000">'</span><span style="color: #800000">执行__new__</span><span style="color: #800000">'</span><span style="color: #000000">)
        obj </span>= cls.<span style="color: #800080">__new__</span>(cls, *args, **<span style="color: #000000">kwargs)

        </span><span style="color: #0000ff">print</span>(<span style="color: #800000">'</span><span style="color: #800000">执行__init__</span><span style="color: #800000">'</span><span style="color: #000000">)
        obj.</span><span style="color: #800080">__init__</span>(<span style="color: #800000">"</span><span style="color: #800000">127.0.0.1</span><span style="color: #800000">"</span><span style="color: #000000">)

        </span><span style="color: #0000ff">return</span><span style="color: #000000"> obj


</span><span style="color: #008000">#</span><span style="color: #008000"> 继承type类，此类就会由自定义type类创建</span>
<span style="color: #0000ff">class</span> shujukulianjie(metaclass=<span style="color: #000000">MyType):
    </span><span style="color: #0000ff">def</span> <span style="color: #800080">__init__</span><span style="color: #000000">(self, host):
        self.host </span>=<span style="color: #000000"> host

    </span><span style="color: #0000ff">def</span><span style="color: #000000"> lianjie(self):
        </span><span style="color: #800000">"""</span><span style="color: #800000">
        连接数据库
        </span><span style="color: #800000">"""</span>
        <span style="color: #0000ff">print</span>(<span style="color: #800000">"</span><span style="color: #800000">连接数据库{host}</span><span style="color: #800000">"</span>.format(host=<span style="color: #000000">self.host))

obj_shujukulianjie </span>=<span style="color: #000000"> shujukulianjie()
obj_shujukulianjie.lianjie()
</span><span style="color: #008000">#</span><span style="color: #008000"> 类创建的本质</span><span style="color: #008000">
#</span><span style="color: #008000"> 类是由Type创建的</span><span style="color: #008000">
#</span><span style="color: #008000"> 当实例化一个对象时，都经过了哪些</span><span style="color: #008000">
#</span><span style="color: #008000"> 1.执行Type的__call__方法</span>
    <span style="color: #008000">#</span><span style="color: #008000"> 在__call__方法里执行shujukulianjie类的__new__方法</span>
    <span style="color: #008000">#</span><span style="color: #008000"> 在__call__方法里执行shujukulianjie类的__init__方法</span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><a href="http://www.jxiou.com/" target="_blank">叫卖录音网</a><br><a href="http://www.jxiou.com/lu_yin_wang_zhan.html" target="_blank">录音网站</a></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; font-size: x-large"><strong>依赖关系注入</strong></span></p>
<p>&nbsp;</p>
<p><span style="font-size: x-large">依赖关系注入，就是将类与类之间的依赖关系，通过创建类时的__call__方法，在执行__init__方法之前，注入到__init__方法里<br>如果一个来需要继承另外一个类。名称为子类的名称，值为实例化父类，这样父类将注入到子类的__init__方法里，这样就完成了继承</span></p>
<p>&nbsp;</p>
<div class="cnblogs_code">
<pre><span style="color: #000000">依赖关系注入类
</span><span style="color: #0000ff">class</span><span style="color: #000000"> Mapper:
    </span><span style="color: #800080">__mapper_relation</span> =<span style="color: #000000"> {}

    @staticmethod
    </span><span style="color: #0000ff">def</span><span style="color: #000000"> register(cls, value):
        Mapper.</span><span style="color: #800080">__mapper_relation</span>[cls] =<span style="color: #000000"> value

    @staticmethod
    </span><span style="color: #0000ff">def</span><span style="color: #000000"> exist(cls):
        </span><span style="color: #0000ff">if</span> cls <span style="color: #0000ff">in</span> Mapper.<span style="color: #800080">__mapper_relation</span><span style="color: #000000">:
            </span><span style="color: #0000ff">return</span><span style="color: #000000"> True
        </span><span style="color: #0000ff">return</span><span style="color: #000000"> False

    @staticmethod
    </span><span style="color: #0000ff">def</span><span style="color: #000000"> value(cls):
        </span><span style="color: #0000ff">return</span> Mapper.<span style="color: #800080">__mapper_relation</span><span style="color: #000000">[cls]


</span><span style="color: #008000">#</span><span style="color: #008000"> 自定义type类</span>
<span style="color: #0000ff">class</span><span style="color: #000000"> MyType(type):
    </span><span style="color: #0000ff">def</span> <span style="color: #800080">__call__</span>(cls, *args, **<span style="color: #000000">kwargs):
        obj </span>= cls.<span style="color: #800080">__new__</span>(cls, *args, **<span style="color: #000000">kwargs)
        arg_list </span>=<span style="color: #000000"> list(args)
        </span><span style="color: #0000ff">if</span><span style="color: #000000"> Mapper.exist(cls):
            value </span>=<span style="color: #000000"> Mapper.value(cls)
            arg_list.append(value)
        obj.</span><span style="color: #800080">__init__</span>(*arg_list, **<span style="color: #000000">kwargs)

        </span><span style="color: #0000ff">return</span><span style="color: #000000"> obj


</span><span style="color: #008000">#</span><span style="color: #008000"> 继承type类，此类就会由自定义type类创建</span>
<span style="color: #0000ff">class</span> shujukulianjie(metaclass=<span style="color: #000000">MyType):
    </span><span style="color: #0000ff">def</span> <span style="color: #800080">__init__</span><span style="color: #000000">(self, name):
        self.name </span>=<span style="color: #000000"> name

    </span><span style="color: #0000ff">def</span><span style="color: #000000"> lianjie(self):
        </span><span style="color: #800000">"""</span><span style="color: #800000">
        连接数据库
        </span><span style="color: #800000">"""</span>
        <span style="color: #0000ff">print</span>(<span style="color: #800000">"</span><span style="color: #800000">连接数据库{name}</span><span style="color: #800000">"</span>.format(name=<span style="color: #000000">self.name))


</span><span style="color: #0000ff">class</span> yhucaozuo(metaclass=<span style="color: #000000">MyType):
    </span><span style="color: #800000">"""</span><span style="color: #800000">
    用户操作类
    </span><span style="color: #800000">"""</span>
    <span style="color: #0000ff">def</span> <span style="color: #800080">__init__</span><span style="color: #000000">(self, name):
        self.name </span>=<span style="color: #000000"> name

    </span><span style="color: #0000ff">def</span><span style="color: #000000"> yhdlu(self, user):
        </span><span style="color: #800000">"""</span><span style="color: #800000">
        用户登录
        </span><span style="color: #800000">"""</span><span style="color: #000000">
        self.name.lianjie()
        </span><span style="color: #0000ff">print</span>(<span style="color: #800000">"</span><span style="color: #800000">用户{user}登录成功！</span><span style="color: #800000">"</span>.format(user=<span style="color: #000000">user))

</span><span style="color: #008000">#</span><span style="color: #008000"> 依赖关系注入，就是将类与类之间的依赖关系，通过创建类时的__call__方法，在执行__init__方法之前，注入到__init__方法里</span><span style="color: #008000">
#</span><span style="color: #008000"> 依赖关系注入，register()</span><span style="color: #008000">
#</span><span style="color: #008000"> 第一个参数依赖关系名称</span><span style="color: #008000">
#</span><span style="color: #008000"> 第二个参数依赖关系值</span><span style="color: #008000">
#</span><span style="color: #008000"> 如果一个来需要继承另外一个类。名称为子类的名称，值为实例化父类，这样父类将注入到子类的__init__方法里，这样就完成了继承</span>
Mapper.register(shujukulianjie,<span style="color: #800000">'</span><span style="color: #800000">127.0.0.1</span><span style="color: #800000">'</span><span style="color: #000000">)
Mapper.register(yhucaozuo,shujukulianjie())


obj </span>=<span style="color: #000000"> yhucaozuo()
obj.yhdlu(</span><span style="color: #800000">'</span><span style="color: #800000">adc</span><span style="color: #800000">'</span>)</pre>
</div>
<p>&nbsp;</p>
<pre></pre>
<p>&nbsp;</p></div>