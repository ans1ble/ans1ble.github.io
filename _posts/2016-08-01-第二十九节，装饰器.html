第二十九节，装饰器


			<div id="cnblogs_post_body" class="blogpost-body"><p><strong>装饰器简介</strong></p>
<p><strong>装饰器，用于装饰某个函数，或者方法，或者类</strong><br /><strong>装饰可以用于某个函数或者方法或者类在执行之前或者执行后做某些操作，也可以理解为，为某个函数或者方法或者类添加功能</strong><br /><strong>好处：是不用改变原来的函数，就可以给原来的函数添加功能</strong><br /><strong>方法：</strong><br /><span style="color: #000000;"><strong>1，定义一个函数，里面传一个值用于接收被装饰函数的名称（叫做装饰器函数）</strong></span><br /><span style="color: #000000;"><strong>2，在装饰器函数里定义一个函数（叫做装饰器功能函数）来写添加功能和执行被装饰函数</strong></span><br /><strong>3，在装饰器功能函数return返回被装饰函数给装饰器功能函数，并且在装饰器函数return返回装饰器功能函数给装饰器函数</strong></p>
<p><strong>4，在被装饰函数上面写上 @装饰器函数名 就可以调用执行装饰器函数</strong></p>
<p><span style="color: #ff0000;"><strong><strong>重点：只要函数应用上了装饰器，那么函数就会被重新定义，重新定义为装饰器的内层函数，装饰器内层函数的返回结果就等于应用了装饰器的函数结果</strong></strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000;">#</span><span style="color: #008000;">!/usr/bin/env python</span><span style="color: #008000;">
#</span><span style="color: #008000;"> -*- coding:utf-8 -*-</span><span style="color: #008000;">
#</span><span style="color: #008000;">装饰器函数</span>
<span style="color: #0000ff;">def</span><span style="color: #000000;"> zh(sh): <span style="color: #008000;">#接收被装饰函数的名称
    </span></span><span style="color: #0000ff;">def</span> zhshi():    <span style="color: #008000;">#</span><span style="color: #008000;">装饰器功能函数</span>
        <span style="color: #0000ff;">print</span>(<span style="color: #800000;">"</span><span style="color: #800000;">在执行被装饰函数前添加功能</span><span style="color: #800000;">"</span><span style="color: #000000;">)
        r </span>=  sh()   <span style="color: #008000;">#</span><span style="color: #008000;"> 执行装饰器函数接收到的被装饰函数，也就是执行被装饰函数</span>
        <span style="color: #0000ff;">print</span>(<span style="color: #800000;">"</span><span style="color: #800000;">在执行被装饰函数后添加功能</span><span style="color: #800000;">"</span><span style="color: #000000;">)
        </span><span style="color: #0000ff;">return</span> r    <span style="color: #008000;">#</span><span style="color: #008000;">将被装饰函数执行的结果返回给装饰器功能函数</span>
    <span style="color: #0000ff;">return</span> zhshi    <span style="color: #008000;">#</span><span style="color: #008000;">将装饰器功能函数名称返回给装饰器函数</span>
<span style="color: #000000;">
@zh     </span><span style="color: #008000;">#</span><span style="color: #008000;"> @zh 的意思是执行装饰器函数，并且将被装饰的函数名，当做参数传给装饰器函数，并且将装饰器函数的返回值重新赋值给被装饰的函数</span><span style="color: #008000;">
#</span><span style="color: #008000;">被装饰函数</span>
<span style="color: #0000ff;">def</span><span style="color: #000000;"> f1():
    </span><span style="color: #0000ff;">print</span>(<span style="color: #800000;">"</span><span style="color: #800000;">f1被装饰函数功能</span><span style="color: #800000;">"</span><span style="color: #000000;">)

</span><span style="color: #008000;">#</span><span style="color: #008000;">执行f1函数</span>
<span style="color: #000000;">f1()
</span><span style="color: #008000;">#</span><span style="color: #008000;"> 在执行被装饰函数前添加功能</span><span style="color: #008000;">
#</span><span style="color: #008000;"> f1被装饰函数功能</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 在执行被装饰函数后添加功能</span></pre>
</div>
<p><img src="//images2015.cnblogs.com/blog/955761/201608/955761-20160801170634512-86935061.png" alt="" /></p>
<p><span style="color: #ff0000;"><strong><strong>重点：只要函数应用上了装饰器，那么函数就会被重新定义，重新定义为装饰器的内层函数，装饰器内层函数的返回结果就等于应用了装饰器的函数结果</strong></strong></span></p>
<p>&nbsp;</p>
<p><span style="color: #000000;"><strong><strong>装饰器装饰含两个参数的函数，就是原始的函数有两个形式参数</strong></strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000;">#</span><span style="color: #008000;">!/usr/bin/env python</span><span style="color: #008000;">
#</span><span style="color: #008000;"> -*- coding:utf-8 -*-</span><span style="color: #008000;">
#</span><span style="color: #008000;">装饰器函数</span>
<span style="color: #0000ff;">def</span> zh(sh):     <span style="color: #008000;">#</span><span style="color: #008000;">定义装饰器函数，接收被装饰函数的名称</span>
    <span style="color: #0000ff;">def</span> zhshi(a1,a2):   <span style="color: #008000;">#</span><span style="color: #008000;">定义装饰器功能函数，接收被装饰函数的形式参数，注意这里的形式参数可以不给被装饰函数的形式参数一样，但个数要一样</span>
        <span style="color: #0000ff;">print</span>(<span style="color: #800000;">"</span><span style="color: #800000;">在执行被装饰函数前添加功能</span><span style="color: #800000;">"</span><span style="color: #000000;">)
        r </span>=  sh(a1,a2)  <span style="color: #008000;">#</span><span style="color: #008000;">接收被装饰函数的形式参数并且执行被装饰函数</span>
        <span style="color: #0000ff;">print</span>(<span style="color: #800000;">"</span><span style="color: #800000;">在执行被装饰函数后添加功能</span><span style="color: #800000;">"</span><span style="color: #000000;">)
        </span><span style="color: #0000ff;">return</span> r    <span style="color: #008000;">#</span><span style="color: #008000;">将被装饰函数返回结果给，装饰器功能函数</span>
    <span style="color: #0000ff;">return</span> zhshi    <span style="color: #008000;">#</span><span style="color: #008000;">将装饰器功能函数名称返回给，装饰器函数</span>
<span style="color: #000000;">
@zh     </span><span style="color: #008000;">#</span><span style="color: #008000;">调用执行装饰器</span><span style="color: #008000;">
#</span><span style="color: #008000;">被装饰函数</span>
<span style="color: #0000ff;">def</span><span style="color: #000000;"> f1(a1,a2):
    a3 </span>= a1 +<span style="color: #000000;"> a2
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> a3

</span><span style="color: #008000;">#</span><span style="color: #008000;">执行f1函数</span>
s1 = f1(3,5<span style="color: #000000;">)
</span><span style="color: #0000ff;">print</span><span style="color: #000000;">(s1)
</span><span style="color: #008000;">#</span><span style="color: #008000;"> 最后打印结果</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 在执行被装饰函数前添加功能</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 在执行被装饰函数后添加功能</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 8</span></pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201608/955761-20160802000202528-276481187.png" alt="" /></p>
<p><span style="color: #ff0000;"><strong><strong><strong><strong>重点：只要函数应用上了装饰器，那么函数就会被重新定义，重新定义为装饰器的内层函数，装饰器内层函数的返回结果就等于应用了装饰器的函数结果</strong></strong></strong></strong></span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><strong>装饰器装饰含N个参数和任意参数的函数（推荐）</strong></p>
<p>&nbsp;</p>
<p><strong>用（动态参数）一个*元组类型非约束参数名称 *args 和（动态参数）两个**字典类型非约束参数名称 **kwargs ，来实现装饰器装饰任意参数的函数（详情见自定义函数动态参数）</strong></p>
<p>&nbsp;</p>
<p><strong>动态参数）一个*元组类型*args：可以接受多个单一性的实际参数</strong><br /><strong>动态参数）两个**字典类型非约束参数名称**kwargs：可以接受多个键值性参数</strong><br /><strong>以上结合就可以接受任意参数</strong></p>
<div class="cnblogs_code">
<pre><span style="color: #008000;">#</span><span style="color: #008000;">!/usr/bin/env python</span><span style="color: #008000;">
#</span><span style="color: #008000;"> -*- coding:utf-8 -*-</span><span style="color: #008000;">
#</span><span style="color: #008000;">装饰器函数</span>
<span style="color: #0000ff;">def</span> zh(sh):     <span style="color: #008000;">#</span><span style="color: #008000;">定义装饰器函数，接收被装饰函数的名称</span>
    <span style="color: #0000ff;">def</span> zhshi(*args,**kwargs):   <span style="color: #008000;">#</span><span style="color: #008000;">定义装饰器功能函数，用*args,**kwargs动态参数，接收被装饰函数的形式参数</span>
        <span style="color: #0000ff;">print</span>(<span style="color: #800000;">"</span><span style="color: #800000;">在执行被装饰函数前添加功能</span><span style="color: #800000;">"</span><span style="color: #000000;">)
        r </span>=  sh(*args,**kwargs)  <span style="color: #008000;">#</span><span style="color: #008000;">用*args,**kwargs动态参数，接收被装饰函数的形式参数并且执行被装饰函数</span>
        <span style="color: #0000ff;">print</span>(<span style="color: #800000;">"</span><span style="color: #800000;">在执行被装饰函数后添加功能</span><span style="color: #800000;">"</span><span style="color: #000000;">)
        </span><span style="color: #0000ff;">return</span> r    <span style="color: #008000;">#</span><span style="color: #008000;">将被装饰函数返回结果给，装饰器功能函数</span>
    <span style="color: #0000ff;">return</span> zhshi    <span style="color: #008000;">#</span><span style="color: #008000;">将装饰器功能函数名称返回给，装饰器函数</span>
<span style="color: #000000;">
@zh     </span><span style="color: #008000;">#</span><span style="color: #008000;">调用执行装饰器</span><span style="color: #008000;">
#</span><span style="color: #008000;">被装饰函数</span>
<span style="color: #0000ff;">def</span><span style="color: #000000;"> f1(a1,a2,a3):
    a4 </span>= a1 +<span style="color: #000000;"> a2
    </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(a4)
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> a3

</span><span style="color: #008000;">#</span><span style="color: #008000;">执行f1函数</span>
s1 = f1(3,5,<span style="color: #800000;">"</span><span style="color: #800000;">林贵秀</span><span style="color: #800000;">"</span><span style="color: #000000;">)
</span><span style="color: #0000ff;">print</span><span style="color: #000000;">(s1)
</span><span style="color: #008000;">#</span><span style="color: #008000;"> 在执行被装饰函数前添加功能</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 8</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 在执行被装饰函数后添加功能</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 林贵秀</span></pre>
</div>
<p>&nbsp;<img src="https://images2015.cnblogs.com/blog/955761/201608/955761-20160802153240200-1879195022.png" alt="" /></p>
<p>&nbsp;</p>
<p><strong>装饰器之多个装饰器装饰同一个函数（重点）</strong></p>
<p><span style="color: #ff0000;"><strong><strong>装饰器之多个装饰器装饰同一个函数，是从被装饰函数最近的一个装饰器调用开始的，依次从下到上的将装饰器内层函数赋值叠加给上一个装饰器，等到达最上层调用装饰器时在一步一步向叠加的函数里面解析，将最后结果返回给<strong><strong>最上层调用装饰器在返回给被装饰函数</strong></strong></strong></strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000;">#</span><span style="color: #008000;">!/usr/bin/env python</span><span style="color: #008000;">
#</span><span style="color: #008000;"> -*- coding:utf-8 -*-</span><span style="color: #008000;">
#</span><span style="color: #008000;">装饰器之多个装饰器装饰同一个函数，注意注释说明的步骤</span><span style="color: #008000;">
#</span><span style="color: #008000;">装饰器函数1</span>
<span style="color: #0000ff;">def</span> zh(sh): <span style="color: #008000;">#</span><span style="color: #008000;">第一步将zh装饰器函数放入内存，第五步执行zh装饰器函数</span>
    <span style="color: #0000ff;">def</span> zhshi(*args,**<span style="color: #000000;">kwargs):
        </span><span style="color: #0000ff;">print</span>(<span style="color: #800000;">"</span><span style="color: #800000;">在执行被装饰函数前添加功能</span><span style="color: #800000;">"</span>)  <span style="color: #008000;">#</span><span style="color: #008000;">打印字符串</span>
        r =  sh(*args,**kwargs)     <span style="color: #008000;">#</span><span style="color: #008000;">注意此时的sh函数就是zh2装饰器函数的内层函数zhshi2，也就是执行的zhshi2（）函数</span>
        <span style="color: #0000ff;">print</span>(<span style="color: #800000;">"</span><span style="color: #800000;">在执行被装饰函数后添加功能</span><span style="color: #800000;">"</span>)  <span style="color: #008000;">#</span><span style="color: #008000;">打印字符串</span>
        <span style="color: #0000ff;">return</span> r    <span style="color: #008000;">#</span><span style="color: #008000;">返回zhshi2函数的返回值</span>
    <span style="color: #0000ff;">return</span><span style="color: #000000;"> zhshi
</span><span style="color: #008000;">#</span><span style="color: #008000;">装饰器函数2</span>
<span style="color: #0000ff;">def</span> zh2(sh):    <span style="color: #008000;">#</span><span style="color: #008000;">第二步将zh2装饰器函数放入内存，第四步将zh2装饰器函数名和它的参数传入zh装饰器函数</span>
    <span style="color: #0000ff;">def</span> zhshi2(*args,**<span style="color: #000000;">kwargs):
        </span><span style="color: #0000ff;">print</span>(<span style="color: #800000;">"</span><span style="color: #800000;">额外增加</span><span style="color: #800000;">"</span><span style="color: #000000;">)
        r </span>=  sh(*args,**<span style="color: #000000;">kwargs)
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> r
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> zhshi2
@zh
@zh2    </span><span style="color: #008000;">#</span><span style="color: #008000;">第三步执行zh2装饰器函数并且把f1函数名和它的参数传入zh2装饰器函数</span>
<span style="color: #0000ff;">def</span><span style="color: #000000;"> f1(a1,a2,a3):
    a4 </span>= a1 +<span style="color: #000000;"> a2
    </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(a4)
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> a3

</span><span style="color: #008000;">#</span><span style="color: #008000;">执行f1函数</span>
s1 = f1(3,5,<span style="color: #800000;">"</span><span style="color: #800000;">林贵秀</span><span style="color: #800000;">"</span><span style="color: #000000;">)
</span><span style="color: #0000ff;">print</span><span style="color: #000000;">(s1)
</span><span style="color: #008000;">#</span><span style="color: #008000;">打印出</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 在执行被装饰函数前添加功能</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 额外增加</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 8</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 在执行被装饰函数后添加功能</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 林贵秀</span></pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201608/955761-20160802183917950-1033716978.png" alt="" /></p>
<p>&nbsp;</p>
<p><span style="font-size: 16px;"><strong>&nbsp;</strong></span></p></div>