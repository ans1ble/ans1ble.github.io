第二百八十四节，MySQL数据库-MySQL触发器


			<div id="cnblogs_post_body" class="blogpost-body"><p><strong>MySQL数据库-MySQL触发器</strong></p>
<p><span style="color: #ff0000"><strong>对某个表进行【增/删/改】操作的前后如果希望触发某个特定的行为时，可以使用触发器，触发器用于定制用户对表的行进行【增/删/改】前后的行为。</strong></span></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>1、创建触发器基本语法</strong></span></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>TRIGGER触发器</strong></span><br><span style="color: #ff0000"><strong>BEFORE之前</strong></span><br><span style="color: #ff0000"><strong>AFTER之后</strong></span><br><span style="color: #ff0000"><strong>INSERT插入</strong></span><br><span style="color: #ff0000"><strong>DELETE删除</strong></span><br><span style="color: #ff0000"><strong>UPDATE更新</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #000000"># 插入前
</span><span style="color: #008080">--</span><span style="color: #008080"> CREATE(创建) TRIGGER(触发器) 触发器名称 BEFORE(之前) INSERT(插入) ON 表名称 FOR(为) EACH(每一) ROW(行)</span><span style="color: #008080">
--</span><span style="color: #008080"> BEGIN(触发器开始)</span><span style="color: #008080">
--</span><span style="color: #008080">     触发器行为......</span><span style="color: #008080">
--</span><span style="color: #008080"> END(触发器结束)</span>
<span style="color: #0000ff">CREATE</span> <span style="color: #0000ff">TRIGGER</span> tri_before_insert_tb1 BEFORE <span style="color: #0000ff">INSERT</span> <span style="color: #0000ff">ON</span> tb1 <span style="color: #0000ff">FOR</span><span style="color: #000000"> EACH ROW
</span><span style="color: #0000ff">BEGIN</span><span style="color: #000000">
    ...
</span><span style="color: #0000ff">END</span><span style="color: #000000">

# 插入后
</span><span style="color: #008080">--</span><span style="color: #008080"> CREATE(创建) TRIGGER(触发器) 触发器名称 AFTER(之后) INSERT(插入) ON 表名称 FOR(为) EACH(每一) ROW(行)</span><span style="color: #008080">
--</span><span style="color: #008080"> BEGIN(触发器开始)</span><span style="color: #008080">
--</span><span style="color: #008080">     触发器行为......</span><span style="color: #008080">
--</span><span style="color: #008080"> END(触发器结束)</span>
<span style="color: #0000ff">CREATE</span> <span style="color: #0000ff">TRIGGER</span> tri_after_insert_tb1 AFTER <span style="color: #0000ff">INSERT</span> <span style="color: #0000ff">ON</span> tb1 <span style="color: #0000ff">FOR</span><span style="color: #000000"> EACH ROW
</span><span style="color: #0000ff">BEGIN</span><span style="color: #000000">
    ...
</span><span style="color: #0000ff">END</span><span style="color: #000000">

# 删除前
</span><span style="color: #008080">--</span><span style="color: #008080"> CREATE(创建) TRIGGER(触发器) 触发器名称 BEFORE(之前) DELETE(删除) ON 表名称 FOR(为) EACH(每一) ROW(行)</span><span style="color: #008080">
--</span><span style="color: #008080"> BEGIN(触发器开始)</span><span style="color: #008080">
--</span><span style="color: #008080">     触发器行为......</span><span style="color: #008080">
--</span><span style="color: #008080"> END(触发器结束)</span>
<span style="color: #0000ff">CREATE</span> <span style="color: #0000ff">TRIGGER</span> tri_before_delete_tb1 BEFORE <span style="color: #0000ff">DELETE</span> <span style="color: #0000ff">ON</span> tb1 <span style="color: #0000ff">FOR</span><span style="color: #000000"> EACH ROW
</span><span style="color: #0000ff">BEGIN</span><span style="color: #000000">
    ...
</span><span style="color: #0000ff">END</span><span style="color: #000000">

# 删除后
</span><span style="color: #008080">--</span><span style="color: #008080"> CREATE(创建) TRIGGER(触发器) 触发器名称 AFTER(之后) DELETE(删除) ON 表名称 FOR(为) EACH(每一) ROW(行)</span><span style="color: #008080">
--</span><span style="color: #008080"> BEGIN(触发器开始)</span><span style="color: #008080">
--</span><span style="color: #008080">     触发器行为......</span><span style="color: #008080">
--</span><span style="color: #008080"> END(触发器结束)</span>
<span style="color: #0000ff">CREATE</span> <span style="color: #0000ff">TRIGGER</span> tri_after_delete_tb1 AFTER <span style="color: #0000ff">DELETE</span> <span style="color: #0000ff">ON</span> tb1 <span style="color: #0000ff">FOR</span><span style="color: #000000"> EACH ROW
</span><span style="color: #0000ff">BEGIN</span><span style="color: #000000">
    ...
</span><span style="color: #0000ff">END</span><span style="color: #000000">

# 更新前
</span><span style="color: #008080">--</span><span style="color: #008080"> CREATE(创建) TRIGGER(触发器) 触发器名称 BEFORE(之前) UPDATE(更新) ON 表名称 FOR(为) EACH(每一) ROW(行)</span><span style="color: #008080">
--</span><span style="color: #008080"> BEGIN(触发器开始)</span><span style="color: #008080">
--</span><span style="color: #008080">     触发器行为......</span><span style="color: #008080">
--</span><span style="color: #008080"> END(触发器结束)</span>
<span style="color: #0000ff">CREATE</span> <span style="color: #0000ff">TRIGGER</span> tri_before_update_tb1 BEFORE <span style="color: #0000ff">UPDATE</span> <span style="color: #0000ff">ON</span> tb1 <span style="color: #0000ff">FOR</span><span style="color: #000000"> EACH ROW
</span><span style="color: #0000ff">BEGIN</span><span style="color: #000000">
    ...
</span><span style="color: #0000ff">END</span><span style="color: #000000">

# 更新后
</span><span style="color: #008080">--</span><span style="color: #008080"> CREATE(创建) TRIGGER(触发器) 触发器名称 AFTER(之后) UPDATE(更新) ON 表名称 FOR(为) EACH(每一) ROW(行)</span><span style="color: #008080">
--</span><span style="color: #008080"> BEGIN(触发器开始)</span><span style="color: #008080">
--</span><span style="color: #008080">     触发器行为......</span><span style="color: #008080">
--</span><span style="color: #008080"> END(触发器结束)</span>
<span style="color: #0000ff">CREATE</span> <span style="color: #0000ff">TRIGGER</span> tri_after_update_tb1 AFTER <span style="color: #0000ff">UPDATE</span> <span style="color: #0000ff">ON</span> tb1 <span style="color: #0000ff">FOR</span><span style="color: #000000"> EACH ROW
</span><span style="color: #0000ff">BEGIN</span><span style="color: #000000">
    ...
</span><span style="color: #0000ff">END</span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>2、实列，创建一张表插入之前的触发器</strong></span></p>
<p><span style="color: #ff0000"><strong>当向指定的一张表插入一条数据时，触发器自动向另外一张表插入一条数据</strong></span></p>
<p><span style="color: #0000ff"><strong>有这样两个表</strong></span></p>
<p><span style="color: #0000ff"><strong>usr表</strong></span></p>
<p><span style="color: #ff0000"><strong><img src="https://images2015.cnblogs.com/blog/955761/201706/955761-20170614175831462-1917275817.png" alt=""></strong></span></p>
<p><span style="color: #0000ff"><strong>jif表</strong></span></p>
<p><span style="color: #ff0000"><strong><img src="https://images2015.cnblogs.com/blog/955761/201706/955761-20170614175946493-756182514.png" alt=""></strong></span></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>创建一个触发器，当向usr表插入一条数据之前，触发器自动向jif表插入一条数据</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #000000"># 插入前
</span><span style="color: #008080">--</span><span style="color: #008080"> CREATE(创建) TRIGGER(触发器) 触发器名称 BEFORE(之前) INSERT(插入) ON 表名称 FOR(为) EACH(每一) ROW(行)</span><span style="color: #008080">
--</span><span style="color: #008080"> BEGIN(触发器开始)</span><span style="color: #008080">
--</span><span style="color: #008080">     触发器行为......</span><span style="color: #008080">
--</span><span style="color: #008080"> END(触发器结束)</span>
<span style="color: #000000">
delimiter $$ </span><span style="color: #008080">--</span><span style="color: #008080"> 因为可能有多条触发行为，所有需要修改语句结束符</span>
<span style="color: #0000ff">DROP</span> <span style="color: #0000ff">TRIGGER</span> <span style="color: #0000ff">if</span> <span style="color: #808080">EXISTS</span> chufa_qi_usr; <span style="color: #008080">--</span><span style="color: #008080"> 判断这个触发器如果存在删除</span>

<span style="color: #0000ff">CREATE</span> <span style="color: #0000ff">TRIGGER</span> chufa_qi_usr BEFORE <span style="color: #0000ff">INSERT</span> <span style="color: #0000ff">ON</span> usr <span style="color: #0000ff">FOR</span> EACH ROW <span style="color: #008080">--</span><span style="color: #008080"> 给usr表创建一个插入数据之前的触发器</span>
<span style="color: #0000ff">BEGIN</span>
    <span style="color: #0000ff">INSERT</span> <span style="color: #0000ff">INTO</span> jif (jif) <span style="color: #0000ff">VALUES</span> (<span style="color: #ff0000">'</span><span style="color: #ff0000">123</span><span style="color: #ff0000">'</span>); <span style="color: #008080">--</span><span style="color: #008080"> 向jif表的jif字段插入值123</span>
<span style="color: #0000ff">END</span><span style="color: #000000"> $$
delimiter ;</span></pre>
</div>
<p><span style="color: #ff0000"><strong>&nbsp;可以看到usr表的触发器已经创建</strong></span></p>
<p><span style="color: #ff0000"><strong><img src="https://images2015.cnblogs.com/blog/955761/201706/955761-20170614183018259-649907483.png" alt=""></strong></span></p>
<p><span style="color: #ff0000"><strong>当向usr表插入一条数据之前，触发器会自动向<strong>jif表的jif字段插入一条数据</strong></strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">INSERT</span> <span style="color: #0000ff">INTO</span> usr (yhm,xb,nl) <span style="color: #0000ff">VALUES</span> (<span style="color: #ff0000">'</span><span style="color: #ff0000">张无忌</span><span style="color: #ff0000">'</span>,<span style="color: #ff0000">'</span><span style="color: #ff0000">男</span><span style="color: #ff0000">'</span>,<span style="color: #ff0000">'</span><span style="color: #ff0000">30</span><span style="color: #ff0000">'</span>); <span style="color: #008080">--</span><span style="color: #008080"> 向usr表插入数据</span></pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201706/955761-20170614183440696-408399702.png" alt=""></p>
<p><img src="https://images2015.cnblogs.com/blog/955761/201706/955761-20170614183448087-935278904.png" alt=""></p>
<p><span style="color: #ff0000"><strong>&nbsp;注意：其他的、增、删、改、之前或者之后触发器原理相同</strong></span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>3、在触发器里获取到，触发器表指定字段的插入值</strong></span></p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff">NEW</span>获取触发器表指定字段的插入值，后面跟要获取值的字段名称，如：<span style="color: #0000ff">NEW.nl</span></strong></span></p>
<p><span style="color: #ff0000"><strong>获取触发器表指定字段的插入值，可以做判断和传值写入等操作</strong></span></p>
<p><span style="color: #0000ff"><strong>举例：判断触发表插入数据时，如果nl字段值等于30将nl字段值写入另外一张表</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008080">--</span><span style="color: #008080"> CREATE(创建) TRIGGER(触发器) 触发器名称 BEFORE(之前) INSERT(插入) ON 表名称 FOR(为) EACH(每一) ROW(行)</span><span style="color: #008080">
--</span><span style="color: #008080"> BEGIN(触发器开始)</span><span style="color: #008080">
--</span><span style="color: #008080">     触发器行为......</span><span style="color: #008080">
--</span><span style="color: #008080"> END(触发器结束)</span>
<span style="color: #000000">
delimiter $$ </span><span style="color: #008080">--</span><span style="color: #008080"> 因为可能有多条触发行为，所有需要修改语句结束符</span>
<span style="color: #0000ff">DROP</span> <span style="color: #0000ff">TRIGGER</span> <span style="color: #0000ff">if</span> <span style="color: #808080">EXISTS</span> chufa_qi_usr; <span style="color: #008080">--</span><span style="color: #008080"> 判断这个触发器如果存在删除</span>

<span style="color: #0000ff">CREATE</span> <span style="color: #0000ff">TRIGGER</span> chufa_qi_usr BEFORE <span style="color: #0000ff">INSERT</span> <span style="color: #0000ff">ON</span> usr <span style="color: #0000ff">FOR</span> EACH ROW <span style="color: #008080">--</span><span style="color: #008080"> 给usr表创建一个插入数据之前的触发器</span>
<span style="color: #0000ff">BEGIN</span>
        <span style="color: #0000ff">IF</span> <span style="background-color: #ffff00">NEW.nl</span> <span style="color: #808080">=</span> <span style="background-color: #ff99cc"><span style="color: #ff0000">'</span><span style="color: #ff0000">30</span><span style="color: #ff0000">'</span></span> <span style="color: #0000ff">THEN</span>  <span style="color: #008080">--</span><span style="color: #008080"> 判断插入数据时触发表的nl字段的值如果等于30</span>
            <span style="color: #0000ff">INSERT</span> <span style="color: #0000ff">INTO</span> jif (jif) <span style="color: #0000ff">VALUES</span> (<span style="background-color: #ffff00">NEW.nl</span>); <span style="color: #008080">--</span><span style="color: #008080"> 获取触发器表插入数据时的nl字段值，插入到jif表的jif字段里</span>
        <span style="color: #0000ff">END</span> <span style="color: #0000ff">IF</span><span style="color: #000000">;
</span><span style="color: #0000ff">END</span><span style="color: #000000"> $$
delimiter ;</span></pre>
</div>
<p><span style="color: #0000ff"><strong>插入数据</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">INSERT</span> <span style="color: #0000ff">INTO</span> usr (yhm,xb,nl) <span style="color: #0000ff">VALUES</span> (<span style="color: #ff0000">'</span><span style="color: #ff0000">东方不败</span><span style="color: #ff0000">'</span>,<span style="color: #ff0000">'</span><span style="color: #ff0000">男</span><span style="color: #ff0000">'</span>,<span style="color: #ff0000">'</span><span style="color: #ff0000">30</span><span style="color: #ff0000">'</span>); <span style="color: #008080">--</span><span style="color: #008080"> 向usr表插入数据</span></pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201706/955761-20170614192520853-249543203.png" alt=""></p>
<p><span style="color: #ff0000"><strong><img src="https://images2015.cnblogs.com/blog/955761/201706/955761-20170614192545962-1004478913.png" alt=""></strong></span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>4、在触发器里获取到，触发器表指定字段的删除值</strong></span></p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff">OLD</span>获取触发器表指定字段的删除值，后面跟要获取值的字段名称，如：<span style="color: #0000ff">OLD.nl</span></strong></span></p>
<p><span style="color: #ff0000"><strong>获取触发器表指定字段的删除值，可以做判断和传值写入等操作</strong></span></p>
<p><span style="color: #0000ff"><strong>举例：判断触发表删除数据时，如果nl字段值等于30将nl字段值写入另外一张表</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008080">--</span><span style="color: #008080"> CREATE(创建) TRIGGER(触发器) 触发器名称 BEFORE(之前) DELETE(删除) ON 表名称 FOR(为) EACH(每一) ROW(行)</span><span style="color: #008080">
--</span><span style="color: #008080"> BEGIN(触发器开始)</span><span style="color: #008080">
--</span><span style="color: #008080">     触发器行为......</span><span style="color: #008080">
--</span><span style="color: #008080"> END(触发器结束)</span>
<span style="color: #000000">
delimiter $$ </span><span style="color: #008080">--</span><span style="color: #008080"> 因为可能有多条触发行为，所有需要修改语句结束符</span>
<span style="color: #0000ff">DROP</span> <span style="color: #0000ff">TRIGGER</span> <span style="color: #0000ff">if</span> <span style="color: #808080">EXISTS</span> chufa_qi_usr; <span style="color: #008080">--</span><span style="color: #008080"> 判断这个触发器如果存在删除</span>

<span style="color: #0000ff">CREATE</span> <span style="color: #0000ff">TRIGGER</span> chufa_qi_usr BEFORE <span style="color: #0000ff">DELETE</span> <span style="color: #0000ff">ON</span> usr <span style="color: #0000ff">FOR</span> EACH ROW <span style="color: #008080">--</span><span style="color: #008080"> 给usr表创建一个插入数据之前的触发器</span>
<span style="color: #0000ff">BEGIN</span>
        <span style="color: #0000ff">IF</span> OLD.nl <span style="color: #808080">=</span> <span style="color: #ff0000">'</span><span style="color: #ff0000">30</span><span style="color: #ff0000">'</span> <span style="color: #0000ff">THEN</span>  <span style="color: #008080">--</span><span style="color: #008080"> 判断删除数据时触发表的nl字段的值如果等于30</span>
            <span style="color: #0000ff">INSERT</span> <span style="color: #0000ff">INTO</span> jif (jif) <span style="color: #0000ff">VALUES</span> (OLD.nl); <span style="color: #008080">--</span><span style="color: #008080"> 获取触发器表删除数据时的nl字段值，插入到jif表的jif字段里</span>
        <span style="color: #0000ff">END</span> <span style="color: #0000ff">IF</span><span style="color: #000000">;
</span><span style="color: #0000ff">END</span><span style="color: #000000"> $$
delimiter ;</span></pre>
</div>
<p><span style="color: #0000ff"><strong>删除数据</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">DELETE</span> <span style="color: #0000ff">FROM</span> usr <span style="color: #0000ff">WHERE</span> id<span style="color: #808080">=</span><span style="color: #800000; font-weight: bold">15</span>; <span style="color: #008080">--</span><span style="color: #008080"> 删除usr表id等于15的数据</span></pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201706/955761-20170614201940134-95308671.png" alt=""></p>
<p><img src="https://images2015.cnblogs.com/blog/955761/201706/955761-20170614201948587-2049357466.png" alt=""></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>5、触发器获取触发表操作字段值重点：</strong></span></p>
<p><span style="color: #ff0000"><strong><strong><span style="color: #0000ff">NEW</span>获取触发表<strong><strong>插入数据时，</strong></strong>指定字段的插入值<span style="color: #0000ff">（插入数据使用）</span></strong></strong></span></p>
<p><span style="color: #ff0000"><strong><strong><strong><span style="color: #0000ff">OLD</span><strong><strong>获取触发表<strong><strong>删除数据时，</strong></strong>指定字段的删除值<span style="color: #0000ff"><strong><strong>（删除数据使用）</strong></strong></span></strong></strong></strong></strong></strong></span></p>
<p><span style="color: #ff0000"><strong><strong><strong><strong><strong><strong><strong><span style="color: #0000ff">NEW、</span><strong><strong><strong><span style="color: #0000ff">OLD</span><strong><strong><strong><strong><strong>更新数据时</strong></strong></strong></strong></strong>都可以使用<span style="color: #0000ff"><strong><strong><strong><strong><strong><strong><strong>（更新数据使用）</strong></strong></strong></strong></strong></strong></strong></span></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></span></p>
<p>&nbsp;</p></div>