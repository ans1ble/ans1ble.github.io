第三百一十九节，Django框架，文件上传


			<div id="cnblogs_post_body" class="blogpost-body"><p><strong>第三百一十九节，Django框架，文件上传</strong></p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>1、自定义上传【推荐】</strong></span></p>
<p><strong><span style="color: #0000ff">请求对象.FILES.get()</span><span style="color: #ff0000">获取上传文件的对象</span></strong><br><strong><span style="color: #0000ff">上传对象.name</span><span style="color: #ff0000">获取上传文件名称</span></strong><br><strong><span style="color: #0000ff">上传对象.chunks()</span><span style="color: #ff0000">获取上传数据包，字节码类型</span></strong></p>
<p><span style="color: #ff0000"><strong>html</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">&lt;!</span><span style="color: #ff00ff">DOCTYPE html</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">html </span><span style="color: #ff0000">lang</span><span style="color: #0000ff">="en"</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">head</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">meta </span><span style="color: #ff0000">charset</span><span style="color: #0000ff">="UTF-8"</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">title</span><span style="color: #0000ff">&gt;</span>Title<span style="color: #0000ff">&lt;/</span><span style="color: #800000">title</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">link </span><span style="color: #ff0000">rel</span><span style="color: #0000ff">="stylesheet"</span><span style="color: #ff0000"> type</span><span style="color: #0000ff">="text/css"</span><span style="color: #ff0000"> href</span><span style="color: #0000ff">="/static/css/tou.css"</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">head</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">body</span><span style="color: #0000ff">&gt;</span>

<span style="color: #0000ff">&lt;</span><span style="color: #800000">form </span><span style="color: #ff0000">action</span><span style="color: #0000ff">="/bugarticles/"</span><span style="color: #ff0000"> enctype</span><span style="color: #0000ff">="multipart/form-data"</span><span style="color: #ff0000"> method</span><span style="color: #0000ff">="post"</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">input </span><span style="color: #ff0000">type</span><span style="color: #0000ff">="file"</span><span style="color: #ff0000"> name</span><span style="color: #0000ff">="<span style="background-color: #ff99cc">shch</span>"</span><span style="color: #0000ff">/&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">input </span><span style="color: #ff0000">type</span><span style="color: #0000ff">="submit"</span><span style="color: #ff0000"> value</span><span style="color: #0000ff">="上传"</span><span style="color: #0000ff">/&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">form</span><span style="color: #0000ff">&gt;</span>


<span style="color: #0000ff">&lt;/</span><span style="color: #800000">body</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">html</span><span style="color: #0000ff">&gt;</span></pre>
</div>
<p><span style="color: #ff0000"><strong>逻辑处理</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">from</span> django.shortcuts <span style="color: #0000ff">import</span><span style="color: #000000"> render,redirect
</span><span style="color: #0000ff">import</span><span style="color: #000000"> os

</span><span style="color: #008000">#</span><span style="color: #008000">逻辑处理模块</span>

<span style="color: #0000ff">def</span><span style="color: #000000"> special(request):
    </span><span style="color: #0000ff">if</span> request.method == <span style="color: #800000">"</span><span style="color: #800000">POST</span><span style="color: #800000">"</span><span style="color: #000000">:
        obj </span>= request.<span style="background-color: #ff99cc">FILES.get(<span style="color: #800000">'</span><span style="color: #800000">shch</span><span style="color: #800000">'</span>)</span>                  <span style="color: #008000">#</span><span style="color: #008000">获取上传文件对象</span>
<span style="color: #000000">
        f </span>= open(os.path.join(<span style="color: #800000">"</span><span style="color: #800000">app1</span><span style="color: #800000">"</span>, <span style="background-color: #ff99cc">obj.name</span>), <span style="color: #800000">'</span><span style="color: #800000">wb</span><span style="color: #800000">'</span>)   <span style="color: #008000">#</span><span style="color: #008000">以读写字节模式打开，存在覆盖没有创建</span>

        <span style="color: #0000ff">for</span> chunk <span style="color: #0000ff">in</span> obj.<span style="background-color: #ff99cc">chunks()</span>:                      <span style="color: #008000">#</span><span style="color: #008000">循环文件数据块</span>
            f.write(chunk)                              <span style="color: #008000">#</span><span style="color: #008000">写入文件</span>
        f.close()                                       <span style="color: #008000">#</span><span style="color: #008000">关闭打开文件</span>

    <span style="color: #0000ff">return</span> render(request, <span style="color: #800000">'</span><span style="color: #800000">app1/index.html</span><span style="color: #800000">'</span>,locals())</pre>
</div>
<p>&nbsp;</p>
<p><strong>内置方式</strong></p>
<p><strong>表单验证模块</strong></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">class</span><span style="color: #000000"> FileForm(forms.Form):
    ExcelFile </span>= forms.FileField()</pre>
</div>
<p><strong>数据库操作Models模块</strong></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">from</span> django.db <span style="color: #0000ff">import</span><span style="color: #000000"> models

</span><span style="color: #0000ff">class</span><span style="color: #000000"> UploadFile(models.Model):
    userid </span>= models.CharField(max_length = 30<span style="color: #000000">)
    file </span>= models.FileField(upload_to = <span style="color: #800000">'</span><span style="color: #800000">./upload/</span><span style="color: #800000">'</span><span style="color: #000000">)
    date </span>= models.DateTimeField(auto_now_add=True)</pre>
</div>
<p><strong>逻辑处理模块</strong></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">def</span><span style="color: #000000"> UploadFile(request):
    uf </span>=<span style="color: #000000"> AssetForm.FileForm(request.POST,request.FILES)
    </span><span style="color: #0000ff">if</span><span style="color: #000000"> uf.is_valid():
            upload </span>=<span style="color: #000000"> models.UploadFile()
            upload.userid </span>= 1<span style="color: #000000">
            upload.file </span>= uf.cleaned_data[<span style="color: #800000">'</span><span style="color: #800000">ExcelFile</span><span style="color: #800000">'</span><span style="color: #000000">]
            upload.save()
            
            </span><span style="color: #0000ff">print</span> upload.file</pre>
</div>
<p>&nbsp;</p></div>