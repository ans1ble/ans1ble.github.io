第四百零二节，Django+Xadmin打造上线标准的在线教育平台—生产环境部署，uwsgi安装和启动，nginx的安装与启动，uwsgi与nginx的配置文件+虚拟主机配置


			<div id="cnblogs_post_body" class="blogpost-body"><p><strong>第四百零二节，Django+Xadmin打造上线标准的在线教育平台—生产环境部署，uwsgi安装和启动，nginx的安装与启动，<strong>uwsgi与<strong>nginx</strong></strong>的配置文件+虚拟主机配置</strong></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>软件版本&nbsp;</strong></span></p>
<p><span style="color: #0000ff"><strong>uwsgi-2.0.15</strong></span><br><span style="color: #0000ff"><strong>nginx-1.12.1</strong></span></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>1.用Navicat Premium远程登录Linux系统数据库，创建网站需要的数据库</strong></span></p>
<p><strong><img src="https://images2017.cnblogs.com/blog/955761/201710/955761-20171006174101630-1218176473.png" alt=""></strong></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>2.数据库创建好后，将开发环境的数据库传输到刚才创建的数据库</strong></span></p>
<p><strong><img src="https://images2017.cnblogs.com/blog/955761/201710/955761-20171006174506927-516073824.png" alt=""></strong></p>
<p>传输数据</p>
<p><img src="https://images2017.cnblogs.com/blog/955761/201710/955761-20171006174740130-783787968.png" alt=""></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>如果在传输数据时，怎么都传输不了，老报错误，有可能是传输数据太大，要在软件设置一下，改一个变量，将参数调大</strong></span></p>
<p><img src="https://images2017.cnblogs.com/blog/955761/201710/955761-20171012202632184-847107764.png" alt=""></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>3.数据库数据传输好后，<span style="color: #0000ff">在<strong>Linux系统的opt目录创建Python虚拟环境，一般虚拟环境创建在<strong><strong>opt目录不然会有权限问题</strong></strong></strong></span></strong></span></p>
<p><span style="color: #ff0000"><strong>将开发环境里的整个Django项目，上传到Linux系统里准备好的python虚拟环境里的网站安装目录里，</strong></span></p>
<p><span style="color: #ff0000"><strong>在虚拟环境里创建一个网站目录，目录里包含两个文件夹，一个是<strong>Django项目，一个是创建来专门放配置文件的目录</strong></strong></span></p>
<p><img src="https://images2017.cnblogs.com/blog/955761/201710/955761-20171009222151543-1676714567.png" alt=""></p>
<p><strong>上传好项目后，检查<strong>Django项目里的settings.py配置文件，配置数据库相关信息链接刚才导入的数据库，检查用户名密码是否正确，连接数据库的用户名，必须有操作当前网站数据库的权限，和当前用户可以任意ip访问数据库权限，详情见<strong>第三百九十九节的16小节说明</strong></strong></strong></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">MySQL数据库</span>
DATABASES =<span style="color: #000000"> {
    </span><span style="color: #800000">'</span><span style="color: #800000">default</span><span style="color: #800000">'</span><span style="color: #000000">: {
        </span><span style="color: #800000">'</span><span style="color: #800000">ENGINE</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">django.db.backends.mysql</span><span style="color: #800000">'</span>,       <span style="color: #008000">#</span><span style="color: #008000"> 配置数据库引擎名称</span>
        <span style="color: #800000">'</span><span style="color: #800000">NAME</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">jxiou2</span><span style="color: #800000">'</span>,                         <span style="color: #008000">#</span><span style="color: #008000"> 数据库名称</span>
        <span style="color: #800000">'</span><span style="color: #800000">USER</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">test_user</span><span style="color: #800000">'</span>,                             <span style="color: #008000">#</span><span style="color: #008000"> 数据库用户名</span>
        <span style="color: #800000">'</span><span style="color: #800000">PASSWORD</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">test_user</span><span style="color: #800000">'</span>,                       <span style="color: #008000">#</span><span style="color: #008000"> 数据库密码</span>
        <span style="color: #800000">'</span><span style="color: #800000">HOST</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">127.0.0.1</span><span style="color: #800000">'</span>,                        <span style="color: #008000">#</span><span style="color: #008000"> 数据库链接地址</span>
        <span style="color: #800000">'</span><span style="color: #800000">PORT</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">3306</span><span style="color: #800000">'</span>,                             <span style="color: #008000">#</span><span style="color: #008000"> 数据库端口</span>
<span style="color: #000000">    }
}</span></pre>
</div>
<p><strong>修改后保存</strong></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>4.测试<strong><strong>Django项目项目是否能够运行</strong></strong></strong></span></p>
<p><strong><strong><strong>执行命令进入虚拟环境</strong></strong></strong></p>
<div class="cnblogs_code">
<pre>[root@192 ~]<span style="color: #008000">#</span><span style="color: #008000"> workon jxiou2</span>
(jxiou) [root@192 ~]<span style="color: #008000">#</span> </pre>
</div>
<p><strong>在虚拟环境里cd到Django根项目</strong></p>
<div class="cnblogs_code">
<pre>[root@192 ~]<span style="color: #008000">#</span><span style="color: #008000"> workon jxiou2</span>
(jxiou) [root@192 ~]<span style="color: #008000">#</span><span style="color: #008000"> cd /opt/xu_ni_huan_jing/jxiou2/jxiou/MxOnline　　　　进入django根目录</span>
(jxiou) [root@192 MxOnline]<span style="color: #008000">#</span><span style="color: #008000"> dir　　　　　　　　　　　　　　　　　　　　查看根目录下的文件</span>
apps  extra_apps  <span style="background-color: #ffff00">manage.py</span>  media  MxOnline  <span style="color: #800080">__pycache__</span><span style="color: #000000">  static  system  templates
(jxiou) [root@</span>192 MxOnline]<span style="color: #008000">#</span> </pre>
</div>
<p><strong>执行命令，从<span style="background-color: #ffff00">manage.py</span>启动Django项目</strong></p>
<div class="cnblogs_code">
<pre>(jxiou) [root@192 MxOnline]<span style="color: #008000">#</span><span style="color: #008000"> python manage.py runserver</span>
<span style="color: #000000">Performing system checks...

System check identified no issues (0 silenced).

You have </span>1 unapplied migration(s). Your project may <span style="color: #0000ff">not</span> work properly until you apply the migrations <span style="color: #0000ff">for</span><span style="color: #000000"> app(s): reversion.
Run </span><span style="color: #800000">'</span><span style="color: #800000">python manage.py migrate</span><span style="color: #800000">'</span><span style="color: #000000"> to apply them.

October </span>07, 2017 - 01:07:13<span style="color: #000000">
Django version </span>1.10, using settings <span style="color: #800000">'</span><span style="color: #800000">MxOnline.settings</span><span style="color: #800000">'</span><span style="color: #000000">
Starting development server at http:</span>//127.0.0.1:8000/<span style="color: #000000">
Quit the server with CONTROL</span>-C.</pre>
</div>
<p><strong>可以看到项目已经启动，可以访问http://127.0.0.1:8000/</strong></p>
<p><strong><img src="https://images2017.cnblogs.com/blog/955761/201710/955761-20171006181333161-637579568.png" alt=""></strong></p>
<p><span style="color: #0000ff"><strong>以上测试Django项目可以远行，这只是测试一下，正真的生产中不是从manage.py启动Django项目，而是用uwsgi模块来启动，所以以上只是为<strong>uwsgi做准备，至此在终端按ctrl+c键停止<strong>Django项目</strong></strong></strong></span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>【主题开始】</strong></span></p>
<p><span style="color: #ff0000"><strong><strong><strong>uwsgi+<strong>nginx</strong></strong>+虚拟环境</strong></strong></span></p>
<p><span style="color: #000000"><strong><strong><strong><strong><strong>uwsgi+<strong>nginx部署原理图</strong></strong></strong></strong></strong></strong></span></p>
<p><span style="color: #000000"><strong><strong><strong><strong><strong><strong><img src="https://images2017.cnblogs.com/blog/955761/201710/955761-20171008153634606-1884287219.png" alt=""></strong></strong></strong></strong></strong></strong></span></p>
<p><span style="color: #ff0000"><strong>&nbsp;5.在虚拟环境安装uwsgi</strong></span></p>
<p><strong>　　<strong>uwsgi是Python写的一个模块，能启动<strong>Django项目，<span style="color: #0000ff">它的角色就是处理网站的动态请求</span></strong></strong></strong></p>
<p><strong>　　uWSGI的主要特点如下：</strong></p>
<p><strong>　　◆超快的性能。</strong></p>
<p><strong>　　◆低内存占用（实测为apache2的mod_wsgi的一半左右）。</strong></p>
<p><strong>　　◆多app管理。</strong></p>
<p><strong>　　◆详尽的日志功能（可以用来分析app性能和瓶颈）。</strong></p>
<p><strong>　　◆高度可定制（内存大小限制，服务一定次数后重启等）。</strong></p>
<p><strong>安装</strong></p>
<div class="cnblogs_code">
<pre>(jxiou) [root@192 MxOnline]<span style="color: #008000">#</span><span style="color: #008000"> pip install uwsgi</span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>6.安装好uwsgi后，测试<strong>uwsgi启动<strong><strong><strong>Django项目</strong></strong></strong></strong></strong></span></p>
<p><strong><strong>首先cd 进入到<strong><strong><strong><strong><strong>Django项目里，在此目录下执行命令</strong></strong></strong></strong></strong></strong></strong></p>
<p><strong><strong><strong><strong><strong><strong><strong><strong>uwsgi --http&nbsp;<strong>127.0.0.1</strong>:8000 --module MxOnline.wsgi(<strong><strong><strong><strong><strong><strong><strong><strong>wsgi.py路径</strong></strong></strong></strong></strong></strong></strong></strong>)&nbsp;<strong>--static-map=/static=static(静态文件路径)</strong></strong></strong></strong></strong></strong></strong></strong></strong></p>
<div class="cnblogs_code">
<pre>(jxiou) [root@192 MxOnline]<span style="color: #008000">#</span><span style="color: #008000"> uwsgi --http 127.0.0.1:8000 --module MxOnline.wsgi --static-map=/static=static</span></pre>
</div>
<p><strong>此时浏览器访问</strong></p>
<p><strong>http://127.0.0.1:8000/</strong></p>
<p><strong><img src="https://images2017.cnblogs.com/blog/955761/201710/955761-20171008163612778-839572888.png" alt=""></strong></p>
<p><strong>此时可以看到<strong>uwsgi可以启动<strong><strong><strong><strong><strong>Django项目了，我们按ctrl+c关闭退出</strong></strong></strong></strong></strong></strong></strong></p>
<p><span style="color: #ff0000"><strong><strong><strong><strong><strong><strong><strong><strong><strong>uwsgi常用命令</strong></strong></strong></strong></strong></strong></strong></strong></strong></span></p>
<p><strong><strong><strong><strong><strong><strong><strong><strong><strong><span style="color: #0000ff">ps -ef|grep -i uwsgi </span>&nbsp; &nbsp; 查看<strong><strong><strong><strong><strong><strong><strong><strong><strong>uwsgi启动进程</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></p>
<p><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><span style="color: #0000ff">pkill -9 nginx</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 杀掉<strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>uwsgi启动进程</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></p>
<p><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><span style="color: #0000ff">uwsgi &nbsp;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 启动<strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>uwsgi</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>7.使用配置文件启动uWSGI [ini]</strong></span></p>
<p><strong>在<strong>网站安装目录里与<strong><strong><strong><strong><strong><strong><strong>Django项目同级我们创建了一个pzhi文件夹，就是专门用来放配置文件的</strong></strong></strong></strong></strong></strong></strong></strong></strong></p>
<p><img src="https://images2017.cnblogs.com/blog/955761/201710/955761-20171009224244512-1803112173.png" alt=""></p>
<p><strong>在<strong><strong><strong><strong><strong><strong><strong><strong><strong>pzhi文件夹创建 网站名称_<strong><strong>uwsgi</strong></strong>.ini文件，来写<strong>uWSGI的配置文件</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></p>
<p><strong>创建 jxiou_uwsgi.ini 文件</strong></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000"> uwsgi.ini</span>
<span style="color: #000000">[uwsgi]

</span><span style="color: #008000">#</span><span style="color: #008000"> 指定Django项目的根目录</span>
chdir           = /opt/xu_ni_huan_jing/jxiou2/jxiou/MxOnline/

<span style="color: #008000">#</span><span style="color: #008000"> 指定Django项目里的wsgi.py文件路径，上面已经指定了根目录，这里拼接根目录即可</span>
module          =<span style="color: #000000"> MxOnline.wsgi

</span><span style="color: #008000">#</span><span style="color: #008000"> 启用主进程</span>
master          =<span style="color: #000000"> true

</span><span style="color: #008000">#</span><span style="color: #008000"> 设置启动进程最大数</span>
processes       = 10

<span style="color: #008000">#</span><span style="color: #008000"> 设置监听端口</span>
socket          = 127.0.0.1:8000

<span style="color: #008000">#</span><span style="color: #008000"> 自动移除unix Socket和pid文件当服务停止的时候</span>
vacuum          =<span style="color: #000000"> true

</span><span style="color: #008000">#</span><span style="color: #008000"> 设置python虚拟环境</span>
virtualenv = /opt/xu_ni_huan_jing/jxiou2/

<span style="color: #008000">#</span><span style="color: #008000"> 设置uwsgi日志保存路径，一般设置到当前配置文件所在目录</span>
logto = /opt/xu_ni_huan_jing/jxiou2/jxiou/pzhi/uwsgi.log</pre>
</div>
<p>&nbsp;</p>
<p><strong>创建好uWSGI的配置文件后，cd 进入到当前&nbsp;<strong>jxiou_uwsgi.ini&nbsp;</strong>配置文件目录，执行启动<strong><strong>uwsgi</strong></strong>命令</strong></p>
<div class="cnblogs_code">
<pre>(jxiou) [root@192 pzhi]<span style="color: #008000">#</span><span style="color: #008000"> uwsgi --ini jxiou_uwsgi.ini &amp;         启动uwsgi配置文件</span>
[uWSGI] getting INI configuration <span style="color: #0000ff">from</span><span style="color: #000000"> jxiou_uwsgi.ini
(jxiou) [root@</span>192 pzhi]<span style="color: #008000">#</span><span style="color: #008000"> ps -ef|grep -i uwsgi　　　　　　　　　　查看uwsgi启动进程</span>
root     43159     1  1 03:50 ?        00:00:01 uwsgi --<span style="color: #000000">ini jxiou_uwsgi.ini
root     </span>43164 43159  0 03:50 ?        00:00:00 uwsgi --<span style="color: #000000">ini jxiou_uwsgi.ini
root     </span>43165 43159  0 03:50 ?        00:00:00 uwsgi --<span style="color: #000000">ini jxiou_uwsgi.ini
root     </span>43166 43159  0 03:50 ?        00:00:00 uwsgi --<span style="color: #000000">ini jxiou_uwsgi.ini
root     </span>43167 43159  0 03:50 ?        00:00:00 uwsgi --<span style="color: #000000">ini jxiou_uwsgi.ini
root     </span>43168 43159  0 03:50 ?        00:00:00 uwsgi --<span style="color: #000000">ini jxiou_uwsgi.ini
root     </span>43185 14898  0 03:51 pts/1    00:00:00 grep -<span style="color: #000000">i uwsgi
(jxiou) [root@</span>192 pzhi]<span style="color: #008000">#</span> </pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>8.安装Nginx</strong></span></p>
<p><strong>在系统/etc/yum.repos.d/目录配置Nginx的安装源，</strong></p>
<p><strong>创建nginx.repo文件</strong></p>
<p><strong>vim /etc/yum.repos.d/nginx.repo</strong></p>
<div class="cnblogs_code">
<pre><span style="color: #000000">[nginx]
name</span>=<span style="color: #000000">nginx repo
</span><span style="color: #008000">#</span><span style="color: #008000"> 下面这行centos根据你自己的操作系统修改比如：OS/rehel</span><span style="color: #008000">
#</span><span style="color: #008000"> 6是你Linux系统的版本，可以通过URL查看路径是否正确</span>
baseurl=http://nginx.org/packages/centos/6/$basearch/<span style="color: #000000">
gpgcheck</span>=<span style="color: #000000">0
enabled</span>=1</pre>
</div>
<p><strong>可以访问一下http://nginx.org/packages/centos &nbsp;安装源是否存在</strong></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>9.配置好<strong>Nginx安装源后，执行命令安装<strong>Nginx</strong></strong></strong></span></p>
<div class="cnblogs_code">
<pre>(jxiou) [root@192 pzhi]<span style="color: #008000">#</span><span style="color: #008000"> yum -y install nginx</span></pre>
</div>
<p><strong>&nbsp;</strong></p>
<p><span style="color: #ff0000"><strong><strong><strong><strong>Nginx安装好后，<strong><strong><strong>Nginx的启动文件在&nbsp;/usr/sbin/nginx &nbsp; &nbsp;执行此文件即可启动<strong><strong><strong><strong><strong><strong><strong>Nginx</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></span></p>
<p><strong><img src="https://images2017.cnblogs.com/blog/955761/201710/955761-20171009231716184-129938113.png" alt=""></strong></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>/etc/nginx/conf.d &nbsp; 这个目录为<strong><strong><strong><strong>Nginx配置文件启动目录，当<strong><strong><strong><strong>Nginx启动时会自动启动目录里的conf文件</strong></strong></strong></strong></strong></strong></strong></strong></strong></span></p>
<p><span style="color: #ff0000"><strong><strong><strong><strong><strong><strong><strong><strong><strong><img src="https://images2017.cnblogs.com/blog/955761/201710/955761-20171009232217980-1460464247.png" alt=""></strong></strong></strong></strong></strong></strong></strong></strong></strong></span></p>
<p>&nbsp;</p>
<p><span style="font-size: 14pt; color: #ff0000; background-color: #ffff00"><strong>注意：设置配置文件时，在系统创建文件将代码复制到文件里，不可在系统外导入配置文件</strong></span></p>
<p>&nbsp;</p>
<p><span style="color: #000000"><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>在<strong>网站安装目录里与<strong><strong><strong><strong><strong><strong><strong>Django项目同级我们创建了一个pzhi文件夹，就是专门用来放配置文件的</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></span></p>
<p><span style="color: #ff0000"><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><img src="https://images2017.cnblogs.com/blog/955761/201710/955761-20171009233415840-2144280851.png" alt=""></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></span></p>
<p><span style="color: #000000"><strong><strong><strong><strong><strong><strong><strong><strong><strong>安装好<strong><strong><strong><strong>nginx后</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong><strong>在<strong><strong><strong><strong><strong><strong><strong><strong><strong>pzhi文件夹创建 网站名称_<strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>nginx</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong>.<strong><strong><strong><strong><strong><strong><strong><strong><strong>conf</strong></strong></strong></strong></strong></strong></strong></strong></strong>文件，来写<strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>nginx</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong><strong>I的配置文件</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></span></p>
<p><strong>创建 jxiou_<strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>nginx</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong>.<strong>conf</strong> 文件</strong></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000"> nginx配置文件</span>
<span style="color: #000000">upstream django {
    </span><span style="color: #008000">#</span><span style="color: #008000"> 设置动态请求转发端口，要与uwsgi配置文件的socket监听端口一致</span>
    server 127.0.0.1:8000<span style="color: #000000">;
}

server {
    </span><span style="color: #008000">#</span><span style="color: #008000"> 设置监听端口</span>
    listen      80<span style="color: #000000">;

    </span><span style="color: #008000">#</span><span style="color: #008000"> 设置网站访问ip或者域名，域名要解析好</span>
    server_name 192.168.158.132<span style="color: #000000"> ;

    </span><span style="color: #008000">#</span><span style="color: #008000"> 设置编码</span>
    charset     utf-8<span style="color: #000000">;

    </span><span style="color: #008000">#</span><span style="color: #008000"> 设置网站最大上传限制</span>
<span style="color: #000000">    client_max_body_size 75M;

    </span><span style="color: #008000">#</span><span style="color: #008000"> 设置Django的media用户上传文件目录</span>
    location /<span style="color: #000000">media  {
        alias </span>/opt/xu_ni_huan_jing/jxiou2/jxiou/MxOnline/media/<span style="color: #000000">;
    }

    </span><span style="color: #008000">#</span><span style="color: #008000"> 设置Django的static静态文件目录如js、css文件目录</span>
    location /<span style="color: #000000">static {
        alias </span>/opt/xu_ni_huan_jing/jxiou2/jxiou/MxOnline/static/<span style="color: #000000">;
    }

    </span><span style="color: #008000">#</span><span style="color: #008000"> 设置动态请求转发给uwsgi</span>
    location /<span style="color: #000000"> {
        </span><span style="color: #008000">#</span><span style="color: #008000"> 动态请求时，执行upstream django的配置转发</span>
<span style="color: #000000">        uwsgi_pass  django;
        </span><span style="color: #008000">#</span><span style="color: #008000"> 通过nginx启动目录 /etc/nginx/uwsgi_params 的uwsgi_params模块文件，与uwsgi交互</span>
        include     uwsgi_params; <span style="color: #008000">#</span><span style="color: #008000"> the uwsgi_params file you installed</span>
<span style="color: #000000">    }
    
    </span><span style="color: #008000">#</span><span style="color: #008000"> 指定日志存放路径，一般指定到网站配置文件目录</span>
    access_log  /opt/xu_ni_huan_jing/jxiou2/jxiou/pzhi/<span style="color: #000000">nginx.log  main;
}</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>nginx</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong><strong>I的配置文件写好后，将配置文件软连接到&nbsp;<strong>/etc/nginx/conf.d 目录，也就是<strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>nginx</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong><strong>I的启动目录</strong></strong></strong></span></p>
<div class="cnblogs_code">
<pre>sudo ln -s /opt/xu_ni_huan_jing/jxiou2/jxiou/pzhi/jxiou_nginx.conf /etc/nginx/conf.d/</pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>软连接创建好后，启动nginx</strong></span></p>
<p><span style="color: #0000ff"><strong>/usr/sbin/nginx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000000">启动<strong>nginx</strong></span></strong></span></p>
<p><span style="color: #0000ff"><strong>ps -ef|grep -i nginx &nbsp; &nbsp; <span style="color: #000000">查看<strong><strong>nginx启动进程</strong></strong></span></strong></span></p>
<p><span style="color: #0000ff"><strong><strong><strong>pkill -9 nginx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #000000">杀死<strong><strong><strong>nginx启动进程</strong></strong></strong></span></strong></strong></strong></span></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong><strong><strong><strong><strong><strong>补充内容防盗链配置</strong></strong></strong></strong></strong></strong></span></p>
<p>&nbsp;</p>
<div class="cnblogs_code">
<pre><span style="color: #000000">Nginx防盗链配置
有些时候，大家不想让别人调用自己的图片，一是因为个人版权的问题，再一点就是会增加服务器的负载、还会产生一些没必要的流量。

其实在Nginx里面，很容易就做到防盗链的，在nginx.conf文件加入一个localtion配置项。

下面请看配置：

location </span>~ .*\.(jpg|jpeg|JPG|png|gif|<span style="color: #000000">icon)$ {
        valid_referers blocked www.qixing318.com qixing318.com;
        </span><span style="color: #0000ff">if</span><span style="color: #000000"> ($invalid_referer) {
            </span><span style="color: #0000ff">return</span> 404<span style="color: #000000">;
        }
}
gif</span>|jpg|jpeg|<span style="color: #000000">….,这些是你想要屏蔽的文件类型，可以根据情况修改。

只需要把文中 www.qixing318.com qixing318.com 修改为你允许显示你网站图片的其他网站域名，注意中间用空格分开，而不是逗号。

这样直接返回的是404页面。也可以用http:</span>//domain.com/404<span style="color: #000000">.jpg，显示给盗链者看到的图片，注意不要放到自己的域名上，因为放盗链的作用，那样对方是看不到的，可以上传到一些支持外联的网络相册上。

当然了，也可以设置某个目录防盗链，只需把localtion匹配的改成一个目录就可以了，比如：

location </span>~ ^/images/<span style="color: #000000"> {
    valid_referers none blocked www.qixing318.com qixing318.com;
    </span><span style="color: #0000ff">if</span><span style="color: #000000"> ($invalid_referer) {
        </span><span style="color: #0000ff">return</span> 404<span style="color: #000000">;
    }
    </span><span style="color: #008000">#</span><span style="color: #008000">rewrite ^/ http://otherdomin.com/404.jpg;</span>
}</pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong><strong><strong><strong><strong><strong><strong>启动nginx后访问<strong><strong><strong><strong><strong><strong>nginx配置文件里设置的访问域名或者ip</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></span></p>
<p><span style="color: #ff0000"><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><img src="https://images2017.cnblogs.com/blog/955761/201710/955761-20171010134428777-455688013.png" alt=""></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>当然此时网站可以启动了，但是后台和网站的一些样式和静态文件无法访问</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></span></p>
<p><span style="color: #000000"><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>所以，我们需要拉取所有静态文件到static目录</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></span></p>
<p><span style="color: #000000"><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>在django的setting文件中，添加下面一行内容：</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></span></p>
<p>&nbsp;</p>
<div class="cnblogs_code">
<pre>STATIC_URL = <span style="color: #800000">'</span><span style="color: #800000">/static/</span><span style="color: #800000">'</span>    <span style="color: #008000">#</span><span style="color: #008000"> 设置静态文件前缀名称</span><span style="color: #008000">
#</span><span style="color: #008000"> 配置静态文件目录</span><span style="background-color: #ff99cc"><span style="color: #008000">
#</span><span style="color: #008000">STATICFILES_DIRS = [</span><span style="color: #008000">
#</span><span style="color: #008000">    os.path.join(BASE_DIR, 'static'),   # 设置静态文件路径</span><span style="color: #008000">
#</span><span style="color: #008000">]</span></span><span style="color: #008000">
#</span><span style="color: #008000"> 配置静态文件访问路径</span>
<span style="background-color: #ff99cc">STATIC_ROOT = os.path.join(BASE_DIR, <span style="color: #800000">'</span><span style="color: #800000">static</span><span style="color: #800000">'</span>)   </span></pre>
</div>
<p>&nbsp;</p>
<pre><code><br><span style="font-size: 16px"><strong><span style="color: #ff0000">运行命令，拉取文件<br><br></span>cd 进入到网站项目根目录</strong></span><br></code></pre>
<div class="cnblogs_code">
<pre>python manage.py collectstatic</pre>
</div>
<p><strong>&nbsp;此时网站部署完成</strong></p>
<p>&nbsp;</p>
<p><span style="background-color: #ffff00; color: #ff0000"><strong><strong>注意：设置配置文件时，在系统创建文件将代码复制到文件里，不可在系统外导入配置文件</strong></strong></span></p>
<p><span style="background-color: #ffffff; color: #ff0000"><strong><strong>此时部署完成，网站配置文件夹里会有如下文件</strong></strong></span></p>
<p><span style="background-color: #ffffff; color: #ff0000"><strong><strong><img src="https://images2017.cnblogs.com/blog/955761/201710/955761-20171010153245574-1158439174.png" alt=""></strong></strong></span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>日后操作管理</strong></span></p>
<p><strong>停止网站服务</strong></p>
<p><strong>首先进入虚拟环境</strong></p>
<p><strong>1.pkill -9 uwsgi&nbsp; &nbsp; 　　&nbsp;　　　　　　杀死uwsgi进程</strong></p>
<p><strong>2.ps -ef|grep -i uwsgi　　　　　　 查看进程情况</strong></p>
<p><strong>3.<strong>pkill -9&nbsp;</strong>nginx　　　　　　　　 &nbsp; &nbsp; 杀死nginx进程</strong></p>
<p><strong>4.<strong>ps -ef|grep -i&nbsp;<strong>nginx　　　　　　&nbsp;<strong>查看进程情况</strong></strong></strong></strong></p>
<p>&nbsp;</p>
<p><strong>启动网站服务</strong></p>
<p><strong><strong>首先进入虚拟环境</strong></strong></p>
<p><strong><strong>cd进入到<strong>uwsgi的配置文件目录</strong></strong></strong></p>
<p><strong>1.uwsgi -i jxiou_uwsgi.ini &amp;　　　 启动<strong>uwsgi</strong><br></strong></p>
<p><strong>2.ps -ef|grep -i uwsgi　　　　　　 查看进程情况</strong></p>
<p><strong>3./usr/sbin/nginx　　　　　　　　 启动<strong>nginx</strong></strong></p>
<p><strong>4.<strong>ps -ef|grep -i&nbsp;<strong>nginx　　　　　　&nbsp;<strong>查看进程情况</strong></strong></strong></strong></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="background-color: #ffffff; color: #ff0000"><strong>最后别忘了关闭Django调试模式</strong></span></p>
<p><span style="background-color: #ffffff; color: #ff0000"><strong>就是在<strong>settings.py文件关闭调试模式，关闭后配置的404才能起作用，不至于大黄页</strong></strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000"> SECURITY WARNING: don't run with debug turned on in production!</span>
DEBUG = False                                <span style="color: #008000">#</span><span style="color: #008000"> 将调试模式关闭,关闭后访问页面出错不会显示错误(大黄页)</span>
ALLOWED_HOSTS = [<span style="color: #800000">'</span><span style="color: #800000">*</span><span style="color: #800000">'</span>]                        <span style="color: #008000">#</span><span style="color: #008000"> 当关闭调试模式时，必须设置允许访问的ip，*代表所有以访问</span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<pre><code><br><br></code></pre>
<p>&nbsp;</p></div>