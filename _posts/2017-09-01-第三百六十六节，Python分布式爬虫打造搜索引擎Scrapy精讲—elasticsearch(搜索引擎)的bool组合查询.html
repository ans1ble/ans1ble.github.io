第三百六十六节，Python分布式爬虫打造搜索引擎Scrapy精讲—elasticsearch(搜索引擎)的bool组合查询


			<div id="cnblogs_post_body" class="blogpost-body"><p><strong>第三百六十六节，Python分布式爬虫打造搜索引擎Scrapy精讲—elasticsearch(搜索引擎)的bool组合查询</strong></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>bool查询说明</strong></span></p>
<p><span style="color: #ff0000"><strong>filter:[],字段的过滤，不参与打分</strong></span><br><span style="color: #ff0000"><strong>must:[],如果有多个查询，都必须满足【并且】</strong></span><br><span style="color: #ff0000"><strong>should:[],如果有多个查询，满足一个或者多个都匹配【或者】</strong></span><br><span style="color: #ff0000"><strong>must_not:[],相反查询词一个都不满足的就匹配【取反，非】</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000"> bool查询</span><span style="color: #008000">
#</span><span style="color: #008000"> 老版本的filtered已经被bool替换</span><span style="color: #008000">
#</span><span style="color: #008000">用 bool 包括 must should must_not filter 来完成</span><span style="color: #008000">
#</span><span style="color: #008000">格式如下：</span>

<span style="color: #008000">#</span><span style="color: #008000">bool:{</span><span style="color: #008000">
#</span><span style="color: #008000">     "filter":[],      字段的过滤，不参与打分</span><span style="color: #008000">
#</span><span style="color: #008000">     "must":[],        如果有多个查询，都必须满足<span style="background-color: #ff99cc">【并且】</span></span><span style="color: #008000">
#</span><span style="color: #008000">     "should":[],      如果有多个查询，满足一个或者多个都匹配<span style="background-color: #ff99cc">【或者】</span></span><span style="color: #008000">
#</span><span style="color: #008000">     "must_not":[],    相反查询词一个都不满足的就匹配<span style="background-color: #ff99cc">【取反，非】</span></span><span style="color: #008000">
#</span><span style="color: #008000">}</span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>建立测试数据</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">建立测试数据</span>
POST jobbole/job/<span style="color: #000000">_bulk
{</span><span style="color: #800000">"</span><span style="color: #800000">index</span><span style="color: #800000">"</span>:{<span style="color: #800000">"</span><span style="color: #800000">_id</span><span style="color: #800000">"</span>:1<span style="color: #000000">}}
{</span><span style="color: #800000">"</span><span style="color: #800000">salary</span><span style="color: #800000">"</span>:10,<span style="color: #800000">"</span><span style="color: #800000">title</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">python</span><span style="color: #800000">"</span><span style="color: #000000">}
{</span><span style="color: #800000">"</span><span style="color: #800000">index</span><span style="color: #800000">"</span>:{<span style="color: #800000">"</span><span style="color: #800000">_id</span><span style="color: #800000">"</span>:2<span style="color: #000000">}}
{</span><span style="color: #800000">"</span><span style="color: #800000">salary</span><span style="color: #800000">"</span>:20,<span style="color: #800000">"</span><span style="color: #800000">title</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">Scrapy</span><span style="color: #800000">"</span><span style="color: #000000">}
{</span><span style="color: #800000">"</span><span style="color: #800000">index</span><span style="color: #800000">"</span>:{<span style="color: #800000">"</span><span style="color: #800000">_id</span><span style="color: #800000">"</span>:3<span style="color: #000000">}}
{</span><span style="color: #800000">"</span><span style="color: #800000">salary</span><span style="color: #800000">"</span>:30,<span style="color: #800000">"</span><span style="color: #800000">title</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">Django</span><span style="color: #800000">"</span><span style="color: #000000">}
{</span><span style="color: #800000">"</span><span style="color: #800000">index</span><span style="color: #800000">"</span>:{<span style="color: #800000">"</span><span style="color: #800000">_id</span><span style="color: #800000">"</span>:4<span style="color: #000000">}}
{</span><span style="color: #800000">"</span><span style="color: #800000">salary</span><span style="color: #800000">"</span>:40,<span style="color: #800000">"</span><span style="color: #800000">title</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">Elasticsearch</span><span style="color: #800000">"</span>}</pre>
</div>
<p><img src="https://images2017.cnblogs.com/blog/955761/201709/955761-20170901205834155-1675554306.png" alt=""></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>bool组合查询——最简单的filter过滤查询之term查询，相当于等于</strong></span></p>
<p><span style="color: #ff0000"><strong><strong>过滤查询到salary字段等于20的数据</strong></strong></span></p>
<p><span style="color: #000000"><strong>可以看出执行两个两个步骤，先查到所有数据，然后在查到的所有数据过滤查询到salary字段等于20的数据</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000"> bool查询</span><span style="color: #008000">
#</span><span style="color: #008000"> 老版本的filtered已经被bool替换</span><span style="color: #008000">
#</span><span style="color: #008000">用 bool 包括 must should must_not filter 来完成</span><span style="color: #008000">
#</span><span style="color: #008000">格式如下：</span>

<span style="color: #008000">#</span><span style="color: #008000">bool:{</span><span style="color: #008000">
#</span><span style="color: #008000; background-color: #ff99cc">     "filter":[],      字段的过滤，不参与打分</span><span style="color: #008000">
#</span><span style="color: #008000; background-color: #ff99cc">     "must":[],        如果有多个查询，都必须满足</span><span style="color: #008000">
#</span><span style="color: #008000">     "should":[],      如果有多个查询，满足一个或者多个都匹配</span><span style="color: #008000">
#</span><span style="color: #008000">     "must_not":[],    相反查询词一个都不满足的就匹配</span><span style="color: #008000">
#</span><span style="color: #008000">}</span>



<span style="color: #008000">#</span><span style="color: #008000">简单过滤查询</span><span style="color: #008000">
#</span><span style="color: #008000">最简单的filter过滤查询</span><span style="color: #008000">
#</span><span style="color: #008000">如果我们要查salary字段等于20的数据</span>
GET jobbole/job/<span style="color: #000000">_search
{
  </span><span style="color: #800000">"</span><span style="color: #800000">query</span><span style="color: #800000">"</span><span style="color: #000000">: {
    </span><span style="color: #800000">"</span><span style="color: #800000">bool</span><span style="color: #800000">"</span>: {                   <span style="color: #008000">#</span><span style="color: #008000">bool组合查询</span>
<span style="background-color: #ff99cc">      <span style="color: #800000">"</span><span style="color: #800000">must</span><span style="color: #800000">"</span>:{                  <span style="color: #008000">#</span><span style="color: #008000">如果有多个查询词，都必须满足</span>
        <span style="color: #800000">"</span><span style="color: #800000">match_all</span><span style="color: #800000">"</span>:{}          <span style="color: #008000">#</span><span style="color: #008000">查询所有字段</span>
<span style="color: #000000">      },
      </span></span><span style="background-color: #ffff00"><span style="color: #800000">"</span><span style="color: #800000">filter</span><span style="color: #800000">"</span>: {               <span style="color: #008000">#</span><span style="color: #008000">filter过滤</span>
        <span style="color: #800000">"</span><span style="color: #800000">term</span><span style="color: #800000">"</span>: {               <span style="color: #008000">#</span><span style="color: #008000">term查询，不会将我们的搜索词进行分词，将搜索词完全匹配的查询</span>
          <span style="color: #800000">"</span><span style="color: #800000">salary</span><span style="color: #800000">"</span>: 20          <span style="color: #008000">#</span><span style="color: #008000">查询salary字段值为20</span>
</span><span style="color: #000000"><span style="background-color: #ffff00">        }
      }</span>
    }
  }
}



</span><span style="color: #008000">#</span><span style="color: #008000">简单过滤查询</span><span style="color: #008000">
#</span><span style="color: #008000">最简单的filter过滤查询</span><span style="color: #008000">
#</span><span style="color: #008000">如果我们要查salary字段等于20的数据</span>
GET jobbole/job/<span style="color: #000000">_search
{
  </span><span style="color: #800000">"</span><span style="color: #800000">query</span><span style="color: #800000">"</span><span style="color: #000000">: {
    </span><span style="color: #800000">"</span><span style="color: #800000">bool</span><span style="color: #800000">"</span><span style="color: #000000">: {
      </span><span style="color: #800000">"</span><span style="color: #800000">must</span><span style="color: #800000">"</span><span style="color: #000000">:{
        </span><span style="color: #800000">"</span><span style="color: #800000">match_all</span><span style="color: #800000">"</span><span style="color: #000000">:{}
      },
      </span><span style="color: #800000">"</span><span style="color: #800000">filter</span><span style="color: #800000">"</span><span style="color: #000000">: {
        </span><span style="color: #800000">"</span><span style="color: #800000">term</span><span style="color: #800000">"</span><span style="color: #000000">: {
          </span><span style="color: #800000">"</span><span style="color: #800000">salary</span><span style="color: #800000">"</span>: 20<span style="color: #000000">
        }
      }
    }
  }
}</span></pre>
</div>
<p>&nbsp;<img src="https://images2017.cnblogs.com/blog/955761/201709/955761-20170901213239390-548772234.png" alt=""></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>bool组合查询——最简单的filter过滤查询之terms查询，相当于或</strong></span></p>
<p><span style="color: #ff0000"><strong>过滤查询到salary字段等于10或20的数据</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000"> bool查询</span><span style="color: #008000">
#</span><span style="color: #008000"> 老版本的filtered已经被bool替换</span><span style="color: #008000">
#</span><span style="color: #008000">用 bool 包括 must should must_not filter 来完成</span><span style="color: #008000">
#</span><span style="color: #008000">格式如下：</span>

<span style="color: #008000">#</span><span style="color: #008000">bool:{</span><span style="color: #008000">
#</span><span style="color: #008000">     "filter":[],      字段的过滤，不参与打分</span><span style="color: #008000">
#</span><span style="color: #008000">     "must":[],        如果有多个查询，都必须满足</span><span style="color: #008000">
#</span><span style="color: #008000">     "should":[],      如果有多个查询，满足一个或者多个都匹配</span><span style="color: #008000">
#</span><span style="color: #008000">     "must_not":[],    相反查询词一个都不满足的就匹配</span><span style="color: #008000">
#</span><span style="color: #008000">}</span>




<span style="color: #008000">#</span><span style="color: #008000">简单过滤查询</span><span style="color: #008000">
#</span><span style="color: #008000">最简单的filter过滤查询</span><span style="color: #008000">
#</span><span style="color: #008000">如果我们要查salary字段等于20的数据</span><span style="color: #008000">
#</span><span style="color: #008000">过滤salary字段值为10或者20的数据</span>
GET jobbole/job/<span style="color: #000000">_search
{
  </span><span style="color: #800000">"</span><span style="color: #800000">query</span><span style="color: #800000">"</span><span style="color: #000000">: {
    </span><span style="color: #800000">"</span><span style="color: #800000">bool</span><span style="color: #800000">"</span><span style="color: #000000">: {
      </span><span style="color: #800000">"</span><span style="color: #800000">must</span><span style="color: #800000">"</span><span style="color: #000000">:{
        </span><span style="color: #800000">"</span><span style="color: #800000">match_all</span><span style="color: #800000">"</span><span style="color: #000000">:{}
      },
      </span><span style="background-color: #ff99cc"><span style="color: #800000">"</span><span style="color: #800000">filter</span><span style="color: #800000">"</span><span style="color: #000000">: {
        </span><span style="color: #800000">"</span><span style="color: #800000">terms</span><span style="color: #800000">"</span><span style="color: #000000">: {
          </span><span style="color: #800000">"</span><span style="color: #800000">salary</span><span style="color: #800000">"</span>:[10,20</span><span style="color: #000000"><span style="background-color: #ff99cc">]
        }
      }</span>
    }
  }
}</span></pre>
</div>
<p><span style="color: #0000ff"><strong>注意：filter过滤里也可以用其他基本查询的</strong></span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>_analyze测试查看分词器解析的结果</strong></span><br><strong>analyzer设置分词器类型ik_max_word精细化分词，ik_smart非精细化分词</strong><br><strong>text设置词</strong></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">_analyze测试查看分词器解析的结果</span><span style="color: #008000">
#</span><span style="color: #008000">analyzer设置分词器类型ik_max_word精细化分词，ik_smart非精细化分词</span><span style="color: #008000">
#</span><span style="color: #008000">text设置词</span>
<span style="color: #000000">GET _analyze
{
  </span><span style="color: #800000">"</span><span style="color: #800000">analyzer</span><span style="color: #800000">"</span>: <span style="color: #800000">"</span><span style="color: #800000">ik_max_word</span><span style="color: #800000">"</span><span style="color: #000000">,
  </span><span style="color: #800000">"</span><span style="color: #800000">text</span><span style="color: #800000">"</span>: <span style="color: #800000">"</span><span style="color: #800000">Python网络开发工程师</span><span style="color: #800000">"</span><span style="color: #000000">
}

GET _analyze
{
  </span><span style="color: #800000">"</span><span style="color: #800000">analyzer</span><span style="color: #800000">"</span>: <span style="color: #800000">"</span><span style="color: #800000">ik_smart</span><span style="color: #800000">"</span><span style="color: #000000">,
  </span><span style="color: #800000">"</span><span style="color: #800000">text</span><span style="color: #800000">"</span>: <span style="color: #800000">"</span><span style="color: #800000">Python网络开发工程师</span><span style="color: #800000">"</span><span style="color: #000000">
}</span></pre>
</div>
<p><img src="https://images2017.cnblogs.com/blog/955761/201709/955761-20170901221416249-700237337.png" alt=""></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>bool组合查询——组合复杂查询1</strong></span><br><span style="color: #ff0000"><strong>查询salary字段等于20或者title字段等于python、salary字段不等于30、并且salary字段不等于10的数据</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000"> bool查询</span><span style="color: #008000">
#</span><span style="color: #008000"> 老版本的filtered已经被bool替换</span><span style="color: #008000">
#</span><span style="color: #008000">用 bool 包括 must should must_not filter 来完成</span><span style="color: #008000">
#</span><span style="color: #008000">格式如下：</span>

<span style="color: #008000">#</span><span style="color: #008000">bool:{</span><span style="color: #008000">
#</span><span style="color: #008000">     "filter":[],      字段的过滤，不参与打分</span><span style="color: #008000">
#</span><span style="color: #008000">     "must":[],        如果有多个查询，都必须满足【并且】</span><span style="color: #008000">
#</span><span style="color: #008000">     "should":[],      如果有多个查询，满足一个或者多个都匹配【或者】</span><span style="color: #008000">
#</span><span style="color: #008000">     "must_not":[],    相反查询词一个都不满足的就匹配【取反，非】</span><span style="color: #008000">
#</span><span style="color: #008000">}</span>

<span style="color: #008000">#</span><span style="color: #008000"> 查询salary字段等于20或者title字段等于python、salary字段不等于30、并且salary字段不等于10的数据</span>
GET jobbole/job/<span style="color: #000000">_search
{
  </span><span style="color: #800000">"</span><span style="color: #800000">query</span><span style="color: #800000">"</span><span style="color: #000000">: {
    </span><span style="color: #800000">"</span><span style="color: #800000">bool</span><span style="color: #800000">"</span><span style="color: #000000">: {
      </span><span style="background-color: #ff99cc"><span style="color: #800000">"</span><span style="color: #800000">should</span><span style="color: #800000">"</span><span style="color: #000000">: [
        {</span><span style="color: #800000">"</span><span style="color: #800000">term</span><span style="color: #800000">"</span>:{<span style="color: #800000">"</span><span style="color: #800000">salary</span><span style="color: #800000">"</span>:20<span style="color: #000000">}},
        {</span><span style="color: #800000">"</span><span style="color: #800000">term</span><span style="color: #800000">"</span>:{<span style="color: #800000">"</span><span style="color: #800000">title</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">python</span><span style="color: #800000">"</span></span><span style="color: #000000"><span style="background-color: #ff99cc">}}
      ]</span>,
      </span><span style="background-color: #ffff00"><span style="color: #800000">"</span><span style="color: #800000">must_not</span><span style="color: #800000">"</span><span style="color: #000000">: [
        {</span><span style="color: #800000">"</span><span style="color: #800000">term</span><span style="color: #800000">"</span>: {<span style="color: #800000">"</span><span style="color: #800000">salary</span><span style="color: #800000">"</span>:30<span style="color: #000000">}},
        {</span><span style="color: #800000">"</span><span style="color: #800000">term</span><span style="color: #800000">"</span>: {<span style="color: #800000">"</span><span style="color: #800000">salary</span><span style="color: #800000">"</span>:10</span><span style="color: #000000"><span style="background-color: #ffff00">}}]</span>
    }
  }
}</span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>bool组合查询——组合复杂查询2</strong></span><br><span style="color: #ff0000"><strong>查询salary字段等于20或者title字段等于python、salary字段不等于30、并且salary字段不等于10的数据</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000"> bool查询</span><span style="color: #008000">
#</span><span style="color: #008000"> 老版本的filtered已经被bool替换</span><span style="color: #008000">
#</span><span style="color: #008000">用 bool 包括 must should must_not filter 来完成</span><span style="color: #008000">
#</span><span style="color: #008000">格式如下：</span>

<span style="color: #008000">#</span><span style="color: #008000">bool:{</span><span style="color: #008000">
#</span><span style="color: #008000">     "filter":[],      字段的过滤，不参与打分</span><span style="color: #008000">
#</span><span style="color: #008000">     "must":[],        如果有多个查询，都必须满足【并且】</span><span style="color: #008000">
#</span><span style="color: #008000">     "should":[],      如果有多个查询，满足一个或者多个都匹配【或者】</span><span style="color: #008000">
#</span><span style="color: #008000">     "must_not":[],    相反查询词一个都不满足的就匹配【取反，非】</span><span style="color: #008000">
#</span><span style="color: #008000">}</span>

<span style="color: #008000">#</span><span style="color: #008000"> 查询title字段等于python、或者、(title字段等于elasticsearch并且salary等于30)的数据</span>
GET jobbole/job/<span style="color: #000000">_search
{
  </span><span style="color: #800000">"</span><span style="color: #800000">query</span><span style="color: #800000">"</span><span style="color: #000000">: {
    </span><span style="color: #800000">"</span><span style="color: #800000">bool</span><span style="color: #800000">"</span><span style="color: #000000">: {
      </span><span style="color: #800000">"</span><span style="color: #800000">should</span><span style="color: #800000">"</span><span style="color: #000000">:[
<span style="background-color: #ff99cc">        {</span></span><span style="background-color: #ff99cc"><span style="color: #800000">"</span><span style="color: #800000">term</span><span style="color: #800000">"</span>:{<span style="color: #800000">"</span><span style="color: #800000">title</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">python</span><span style="color: #800000">"</span></span><span style="color: #000000"><span style="background-color: #ff99cc">}},</span>
        {</span><span style="color: #800000">"</span><span style="color: #800000">bool</span><span style="color: #800000">"</span><span style="color: #000000">: {
          </span><span style="background-color: #ffff00"><span style="color: #800000">"</span><span style="color: #800000">must</span><span style="color: #800000">"</span><span style="color: #000000">: [
            {</span><span style="color: #800000">"</span><span style="color: #800000">term</span><span style="color: #800000">"</span>: {<span style="color: #800000">"</span><span style="color: #800000">title</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">elasticsearch</span><span style="color: #800000">"</span><span style="color: #000000">}},
            {</span><span style="color: #800000">"</span><span style="color: #800000">term</span><span style="color: #800000">"</span>:{<span style="color: #800000">"</span><span style="color: #800000">salary</span><span style="color: #800000">"</span>:30</span><span style="color: #000000"><span style="background-color: #ffff00">}}
          ]</span>
        }}
      ]
    }
  }
}</span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>bool组合查询——过滤空和非空</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">建立数据</span>
POST bbole/jo/<span style="color: #000000">_bulk
{</span><span style="color: #800000">"</span><span style="color: #800000">index</span><span style="color: #800000">"</span>:{<span style="color: #800000">"</span><span style="color: #800000">_id</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">1</span><span style="color: #800000">"</span><span style="color: #000000">}}
{</span><span style="color: #800000">"</span><span style="color: #800000">tags</span><span style="color: #800000">"</span>:[<span style="color: #800000">"</span><span style="color: #800000">search</span><span style="color: #800000">"</span><span style="color: #000000">]}
{</span><span style="color: #800000">"</span><span style="color: #800000">index</span><span style="color: #800000">"</span>:{<span style="color: #800000">"</span><span style="color: #800000">_id</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">2</span><span style="color: #800000">"</span><span style="color: #000000">}}
{</span><span style="color: #800000">"</span><span style="color: #800000">tags</span><span style="color: #800000">"</span>:[<span style="color: #800000">"</span><span style="color: #800000">search</span><span style="color: #800000">"</span>,<span style="color: #800000">"</span><span style="color: #800000">python</span><span style="color: #800000">"</span><span style="color: #000000">]}
{</span><span style="color: #800000">"</span><span style="color: #800000">index</span><span style="color: #800000">"</span>:{<span style="color: #800000">"</span><span style="color: #800000">_id</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">3</span><span style="color: #800000">"</span><span style="color: #000000">}}
{</span><span style="color: #800000">"</span><span style="color: #800000">other_field</span><span style="color: #800000">"</span>:[<span style="color: #800000">"</span><span style="color: #800000">some data</span><span style="color: #800000">"</span><span style="color: #000000">]}
{</span><span style="color: #800000">"</span><span style="color: #800000">index</span><span style="color: #800000">"</span>:{<span style="color: #800000">"</span><span style="color: #800000">_id</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">4</span><span style="color: #800000">"</span><span style="color: #000000">}}
{</span><span style="color: #800000">"</span><span style="color: #800000">tags</span><span style="color: #800000">"</span><span style="color: #000000">:null}
{</span><span style="color: #800000">"</span><span style="color: #800000">index</span><span style="color: #800000">"</span>:{<span style="color: #800000">"</span><span style="color: #800000">_id</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">1</span><span style="color: #800000">"</span><span style="color: #000000">}}
{</span><span style="color: #800000">"</span><span style="color: #800000">tags</span><span style="color: #800000">"</span>:[<span style="color: #800000">"</span><span style="color: #800000">search</span><span style="color: #800000">"</span>,null]}</pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>处理null空值的方法</strong></span></p>
<p><span style="color: #ff0000"><strong>获取tags字段，值不为空并且值不为null的数据</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000"> bool查询</span><span style="color: #008000">
#</span><span style="color: #008000"> 老版本的filtered已经被bool替换</span><span style="color: #008000">
#</span><span style="color: #008000">用 bool 包括 must should must_not filter 来完成</span><span style="color: #008000">
#</span><span style="color: #008000">格式如下：</span>

<span style="color: #008000">#</span><span style="color: #008000">bool:{</span><span style="color: #008000">
#</span><span style="color: #008000">     "filter":[],      字段的过滤，不参与打分</span><span style="color: #008000">
#</span><span style="color: #008000">     "must":[],        如果有多个查询，都必须满足【并且】</span><span style="color: #008000">
#</span><span style="color: #008000">     "should":[],      如果有多个查询，满足一个或者多个都匹配【或者】</span><span style="color: #008000">
#</span><span style="color: #008000">     "must_not":[],    相反查询词一个都不满足的就匹配【取反，非】</span><span style="color: #008000">
#</span><span style="color: #008000">}</span>


<span style="color: #008000">#</span><span style="color: #008000">处理null空值的方法</span><span style="color: #008000">
#</span><span style="color: #008000">获取tags字段，值不为空并且值不为null的数据</span>
GET bbole/jo/<span style="color: #000000">_search
{
  </span><span style="color: #800000">"</span><span style="color: #800000">query</span><span style="color: #800000">"</span><span style="color: #000000">: {
    </span><span style="color: #800000">"</span><span style="color: #800000">bool</span><span style="color: #800000">"</span><span style="color: #000000">: {
      </span><span style="background-color: #ff99cc"><span style="color: #800000">"</span><span style="color: #800000">filter</span><span style="color: #800000">"</span><span style="color: #000000">: {
        </span><span style="color: #800000">"</span><span style="color: #800000">exists</span><span style="color: #800000">"</span><span style="color: #000000">: {
          </span><span style="color: #800000">"</span><span style="color: #800000">field</span><span style="color: #800000">"</span>: <span style="color: #800000">"</span><span style="color: #800000">tags</span><span style="color: #800000">"</span></span><span style="color: #000000"><span style="background-color: #ff99cc">
        }
      }</span>
    }
  }
}</span></pre>
</div>
<p><span style="color: #ff0000"><strong>获取tags字段值为空或者为null的数据，如果数据没有tags字段也会获取</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000"> bool查询</span><span style="color: #008000">
#</span><span style="color: #008000"> 老版本的filtered已经被bool替换</span><span style="color: #008000">
#</span><span style="color: #008000">用 bool 包括 must should must_not filter 来完成</span><span style="color: #008000">
#</span><span style="color: #008000">格式如下：</span>

<span style="color: #008000">#</span><span style="color: #008000">bool:{</span><span style="color: #008000">
#</span><span style="color: #008000">     "filter":[],      字段的过滤，不参与打分</span><span style="color: #008000">
#</span><span style="color: #008000">     "must":[],        如果有多个查询，都必须满足【并且】</span><span style="color: #008000">
#</span><span style="color: #008000">     "should":[],      如果有多个查询，满足一个或者多个都匹配【或者】</span><span style="color: #008000">
#</span><span style="color: #008000">     "must_not":[],    相反查询词一个都不满足的就匹配【取反，非】</span><span style="color: #008000">
#</span><span style="color: #008000">}</span>


<span style="color: #008000">#</span><span style="color: #008000">获取tags字段值为空或者为null的数据，如果数据没有tags字段也会获取</span>
GET bbole/jo/<span style="color: #000000">_search
{
  </span><span style="color: #800000">"</span><span style="color: #800000">query</span><span style="color: #800000">"</span><span style="color: #000000">: {
    </span><span style="color: #800000">"</span><span style="color: #800000">bool</span><span style="color: #800000">"</span><span style="color: #000000">: {
      </span><span style="background-color: #ff99cc"><span style="color: #800000">"</span><span style="color: #800000">must_not</span><span style="color: #800000">"</span><span style="color: #000000">: {
        </span><span style="color: #800000">"</span><span style="color: #800000">exists</span><span style="color: #800000">"</span><span style="color: #000000">: {
          </span><span style="color: #800000">"</span><span style="color: #800000">field</span><span style="color: #800000">"</span>: <span style="color: #800000">"</span><span style="color: #800000">tags</span><span style="color: #800000">"</span></span><span style="color: #000000"><span style="background-color: #ff99cc">
        }
      }</span>
    }
  }
}</span></pre>
</div>
<p>&nbsp;</p></div>