第二百八十八节，MySQL数据库-索引、limit分页、执行计划、慢日志查询


			<div id="cnblogs_post_body" class="blogpost-body"><p><strong>MySQL数据库-索引、limit分页、执行计划、慢日志查询</strong></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>索引，是数据库中专门用于帮助用户快速查询数据的一种数据结构。类似于字典中的目录，查找字典内容时可以根据目录查找到数据的存放位置，然后直接获取即可。</strong></span></p>
<p><span style="color: #ff0000"><strong>如果没有创建索引查找数据时，是全表扫描的，也就是向查字典一样没有目录，靠一页一页的翻到目标数据位置，这样如果数据量大会相当耗时，</strong></span></p>
<p><span style="color: #ff0000"><strong>索引就是快速帮助用户找到目标数据，节省时间</strong></span></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>索引简介</strong></span></p>
<p><span style="color: #ff0000"><strong>索引是以B+tree方式的树形结构存放数据的</strong></span></p>
<p><span style="color: #ff0000"><strong><img src="https://images2015.cnblogs.com/blog/955761/201706/955761-20170616221433743-1645501906.jpg" alt=""></strong></span></p>
<p>&nbsp;</p>
<p><span style="color: #0000ff"><strong>详情，可以网上搜索一下<strong>B+tree</strong></strong></span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>MySQL中常见索引有：</strong></span></p>
<p><span style="color: #ff0000"><strong>　　普通索引</strong></span><br><span style="color: #ff0000"><strong>　　唯一索引</strong></span><br><span style="color: #ff0000"><strong>　　主键索引</strong></span><br><span style="color: #ff0000"><strong>　　组合索引</strong></span><br><span style="color: #ff0000"><strong>　　全文索引</strong></span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>1、普通索引</strong></span></p>
<p><span style="color: #ff0000"><strong>普通索引仅有一个功能：加速查询</strong></span></p>
<p><span style="color: #ff0000"><strong>　　<span style="background-color: #ffffff">创建表时创建普通索引</span></strong></span></p>
<p><span style="color: #ff0000"><strong>　　index(创建普通索引) 索引名称 (创建索引的字段、可以是多个字段)</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">create</span> <span style="color: #0000ff">table</span> in1(        <span style="color: #008080">--</span><span style="color: #008080"> 创建表</span>
    nid <span style="color: #0000ff">int</span> <span style="color: #808080">not</span> <span style="color: #0000ff">null</span> auto_increment <span style="color: #0000ff">primary</span> <span style="color: #0000ff">key</span>,  <span style="color: #008080">--</span><span style="color: #008080"> 创建nid字段，自增，主键</span>
    name <span style="color: #0000ff">varchar</span>(<span style="color: #800000; font-weight: bold">32</span>) <span style="color: #808080">not</span> <span style="color: #0000ff">null</span>,  <span style="color: #008080">--</span><span style="color: #008080"> 创建字段</span>
    email <span style="color: #0000ff">varchar</span>(<span style="color: #800000; font-weight: bold">64</span>) <span style="color: #808080">not</span> <span style="color: #0000ff">null</span>, <span style="color: #008080">--</span><span style="color: #008080"> 创建字段</span>
    extra <span style="color: #0000ff">text</span><span style="color: #000000">,
    </span><span style="background-color: #ffff00"><span style="color: #0000ff">index</span> ix_name (name)</span> <span style="color: #008080">--</span><span style="color: #008080"> 创建普通索引</span>
<span style="color: #000000">)

</span><span style="color: #008080">--</span><span style="color: #008080"> index(创建普通索引) 索引名称 (创建索引的字段、可以是多个字段)</span></pre>
</div>
<p><span style="color: #ff0000"><strong>　　<span style="background-color: #ffffff">向已有表创建普通索引</span></strong></span></p>
<p><span style="color: #ff0000"><strong>　　create(创建) index(索引) 索引名称 on 表名称(字段)</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008080">--</span><span style="color: #008080"> create(创建) index(索引) 索引名称 on 表名称(字段)</span>

<span style="color: #0000ff">create</span> <span style="color: #0000ff">index</span> index_name <span style="color: #0000ff">on</span> table_name(column_name)</pre>
</div>
<p>　　<span style="color: #ff0000; background-color: #ffffff"><strong>删除表的普通索引</strong></span></p>
<p>　　<span style="color: #ff0000"><strong>drop(删除) &nbsp;INDEX(索引)&nbsp; 索引名称 on 表名称</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008080">--</span><span style="color: #008080"> drop(删除) <strong>INDEX(索引)</strong> 索引名称 on 表名称;</span>

<span style="color: #0000ff">drop INDEX</span> index_name <span style="color: #0000ff">on</span> table_name;</pre>
</div>
<p><strong>　　<span style="color: #ff0000; background-color: #ffffff">查看索引</span></strong></p>
<p><strong>　　<span style="color: #ff0000">show(查看) index(索引) 表名称;</span></strong></p>
<div class="cnblogs_code">
<pre><span style="color: #008080">--</span><span style="color: #008080"> show(查看) index(索引) 表名称;</span>
<span style="color: #000000">

show </span><span style="color: #0000ff">index</span> <span style="color: #0000ff">from</span> usr;</pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffffff"><strong>　　当创建索引后，执行一个sql查询语句，用执行计划验证这个查询语句是否使用索引找到的数据【重点】</strong></span></p>
<p><span style="color: #ff0000"><strong>&nbsp;　　<span style="color: #0000ff">EXPLAIN</span>表示执行计划，后面跟sql查询语句，返回的<span style="color: #0000ff">type的值</span>如果是<span style="color: #0000ff">ref</span>表示当前查询使用索引查询的，如果值是<span style="color: #0000ff">ALL</span>表示当前查询使用的全表扫描</strong></span></p>
<p><span style="color: #ff0000"><strong>　　<strong>EXPLAIN执行计划返回<span style="color: #0000ff"><strong>ref</strong></span></strong></strong></span></p>
<div class="cnblogs_code">
<pre>EXPLAIN <span style="color: #0000ff">SELECT</span> <span style="color: #808080">*</span> <span style="color: #0000ff">FROM</span> usr <span style="color: #0000ff">WHERE</span> nl <span style="color: #808080">=</span> <span style="color: #800000; font-weight: bold">19</span>;</pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201706/955761-20170617003831759-2036766576.png" alt=""></p>
<p><span style="color: #ff0000"><strong>　　如果是全表扫描</strong></span></p>
<p><span style="color: #ff0000"><strong><img src="https://images2015.cnblogs.com/blog/955761/201706/955761-20170617003932509-1283536991.png" alt=""></strong></span></p>
<p><span style="color: #ff0000"><strong>&nbsp;　　注意：对于创建索引时如果是BLOB&nbsp;和&nbsp;TEXT&nbsp;类型，必须指定length。</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">create</span> <span style="color: #0000ff">index</span> ix_extra <span style="color: #0000ff">on</span> in1(extra(<span style="color: #800000; font-weight: bold">32</span>));</pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>2、唯一索引</strong></span></p>
<p><span style="color: #ff0000"><strong>唯一索引有两个功能：加速查询 和 唯一约束（可含null），也就是约束此列类容不允许重复</strong></span></p>
<p><span style="color: #ff0000"><strong>　　创建表时创建唯一索引</strong></span></p>
<p>&nbsp;　　<span style="color: #ff0000"><strong>unique唯一索引</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">create</span> <span style="color: #0000ff">table</span><span style="color: #000000"> in1(
    nid </span><span style="color: #0000ff">int</span> <span style="color: #808080">not</span> <span style="color: #0000ff">null</span> auto_increment <span style="color: #0000ff">primary</span> <span style="color: #0000ff">key</span><span style="color: #000000">,
    name </span><span style="color: #0000ff">varchar</span>(<span style="color: #800000; font-weight: bold">32</span>) <span style="color: #808080">not</span> <span style="color: #0000ff">null</span><span style="color: #000000">,
    email </span><span style="color: #0000ff">varchar</span>(<span style="color: #800000; font-weight: bold">64</span>) <span style="color: #808080">not</span> <span style="color: #0000ff">null</span><span style="color: #000000">,
    extra </span><span style="color: #0000ff">text</span><span style="color: #000000">,
    </span><span style="background-color: #ffff00"><span style="color: #0000ff">unique</span> ix_name (name)</span> <span style="color: #008080">--</span><span style="color: #008080"> 创建字段</span>
<span style="color: #000000">)
</span><span style="color: #008080">--</span><span style="color: #008080"> unique(唯一) 索引名称 (索引字段)</span></pre>
</div>
<p>　　<span style="color: #ff0000"><strong>向已有表创建唯一索引</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008080">--</span><span style="color: #008080"> create unique index 索引名 on 表名(字段、多个字段,隔开)</span>

<span style="color: #0000ff">create</span> <span style="color: #0000ff">unique</span> <span style="color: #0000ff">index</span> index_usr <span style="color: #0000ff">on</span> usr(nl,zij);</pre>
</div>
<p>　　<span style="color: #ff0000"><strong>删除唯一索引</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008080">--</span><span style="color: #008080"> drop INDEX 索引名 on 表名</span>

<span style="color: #0000ff">drop</span> <span style="color: #0000ff">INDEX</span> index_usr <span style="color: #0000ff">on</span> usr;</pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>3、主键索引</strong></span></p>
<p><span style="color: #ff0000"><strong>主键有两个功能：加速查询 和 唯一约束（不允许有null），<strong>也就是约束此列类容不允许重复，一张表只能有一个主键</strong></strong></span></p>
<p><span style="color: #ff0000"><strong>&nbsp;　　primary key(字段名称,多个字段将组合成一个主键索引)</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">CREATE</span> <span style="color: #0000ff">TABLE</span><span style="color: #000000"> `usr` (
  `id` </span><span style="color: #0000ff">int</span>(<span style="color: #800000; font-weight: bold">20</span>) <span style="color: #808080">NOT</span> <span style="color: #0000ff">NULL</span> AUTO_INCREMENT COMMENT <span style="color: #ff0000">'</span><span style="color: #ff0000">id</span><span style="color: #ff0000">'</span><span style="color: #000000">,
  `yhm` </span><span style="color: #0000ff">char</span>(<span style="color: #800000; font-weight: bold">255</span>) <span style="color: #808080">NOT</span> <span style="color: #0000ff">NULL</span> COMMENT <span style="color: #ff0000">'</span><span style="color: #ff0000">用户名</span><span style="color: #ff0000">'</span><span style="color: #000000">,
  `xb` </span><span style="color: #0000ff">char</span>(<span style="color: #800000; font-weight: bold">255</span>) <span style="color: #808080">NOT</span> <span style="color: #0000ff">NULL</span> COMMENT <span style="color: #ff0000">'</span><span style="color: #ff0000">性别</span><span style="color: #ff0000">'</span><span style="color: #000000">,
  `nl` </span><span style="color: #0000ff">int</span>(<span style="color: #800000; font-weight: bold">255</span>) <span style="color: #808080">NOT</span> <span style="color: #0000ff">NULL</span> COMMENT <span style="color: #ff0000">'</span><span style="color: #ff0000">年龄</span><span style="color: #ff0000">'</span><span style="color: #000000">,
  `zij` </span><span style="color: #0000ff">int</span>(<span style="color: #800000; font-weight: bold">255</span>) unsigned <span style="color: #808080">NOT</span> <span style="color: #0000ff">NULL</span><span style="color: #000000">,
  </span><span style="background-color: #ffff00"><span style="color: #0000ff">PRIMARY</span> <span style="color: #0000ff">KEY</span></span><span style="color: #000000"><span style="background-color: #ffff00"> (`id`)</span>
) ENGINE</span><span style="color: #808080">=</span>InnoDB AUTO_INCREMENT<span style="color: #808080">=</span><span style="color: #800000; font-weight: bold">17</span> <span style="color: #0000ff">DEFAULT</span> CHARSET<span style="color: #808080">=</span>utf8 COMMENT<span style="color: #808080">=</span><span style="color: #ff0000">'</span><span style="color: #ff0000">用户表</span><span style="color: #ff0000">'</span>;</pre>
</div>
<p>　　<span style="color: #ff0000"><strong>给已有表创建主键索引</strong></span></p>
<p>　　<span style="color: #ff0000"><strong>alter table 表名 add primary key(列名);</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008080">--</span><span style="color: #008080"> alter table 表名 add primary key(列名);</span>

<span style="color: #0000ff">alter</span> <span style="color: #0000ff">table</span> usr <span style="color: #0000ff">add</span> <span style="color: #0000ff">primary</span> <span style="color: #0000ff">key</span>(id);</pre>
</div>
<p>　　<span style="color: #ff0000"><strong>删除主键索引</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008080">--</span><span style="color: #008080"> alter table 表名  modify 主键索引字段 字段数据类型, drop primary key;</span>

<span style="color: #0000ff">alter</span> <span style="color: #0000ff">table</span> usr  modify id <span style="color: #0000ff">int</span>, <span style="color: #0000ff">drop</span> <span style="color: #0000ff">primary</span> <span style="color: #0000ff">key</span>;</pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>4、组合索引</strong></span></p>
<p><span style="color: #ff0000"><strong>组合索引是将n个列组合成一个索引</strong></span></p>
<p><span style="color: #ff0000"><strong>其应用场景为：频繁的同时使用n列来进行查询，如：where n1 = 'alex' and n2 = 666。</strong></span></p>
<p><span style="color: #ff0000"><strong>index 索引名称 (字段1,字段2)组合普通索引</strong></span><br><span style="color: #ff0000"><strong>unique 索引名称 (字段1,字段2)组合唯一索引</strong></span><br><span style="color: #ff0000"><strong>PRIMARY KEY (字段1,字段2)组合主键索引</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008080">--</span><span style="color: #008080"> index 索引名称 (字段1,字段2)组合普通索引</span>
<span style="color: #0000ff">index</span><span style="color: #000000"> ix_name (n1,n2)<br>
</span><span style="color: #0000ff">create</span> <span style="color: #0000ff">index</span> index_name <span style="color: #0000ff">on</span><span style="color: #000000"> table_name(n1,n2)

</span><span style="color: #008080">--</span><span style="color: #008080"> unique 索引名称 (字段1,字段2)组合唯一索引</span>
<span style="color: #0000ff">unique</span><span style="color: #000000"> ix_name (n1,n2)<br>
</span><span style="color: #0000ff">create</span> <span style="color: #0000ff">unique</span> <span style="color: #0000ff">index</span> index_usr <span style="color: #0000ff">on</span><span style="color: #000000"> usr(n1,n2)

</span><span style="color: #008080">--</span><span style="color: #008080"> PRIMARY KEY (字段1,字段2)组合主键索引</span>
<span style="color: #0000ff">PRIMARY</span> <span style="color: #0000ff">KEY</span><span style="color: #000000"> (n1,n2)<br>
</span><span style="color: #0000ff">alter</span> <span style="color: #0000ff">table</span> usr <span style="color: #0000ff">add</span> <span style="color: #0000ff">primary</span> <span style="color: #0000ff">key</span>(n1,n2);</pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>组合索引注意事项，最左前缀【重点】</strong></span></p>
<p><span style="color: #ff0000"><strong>1、也就是说如果是多个字段组合成一个索引，当查询字段时只查询的组合字段的左边第一个字段，<span style="color: #0000ff">是走索引的。</span></strong></span></p>
<p><span style="color: #ff0000"><strong>2、如果查询的组合字段的所有字段，<span style="color: #0000ff">也是走索引的</span></strong></span></p>
<p><span style="color: #ff0000"><strong>3、如果查询的不是索引组合字段，也不是只查询的<strong>左边第一个字段，<span style="color: #0000ff">是不走索引的</span></strong></strong></span></p>
<p><span style="color: #ff0000"><strong>如：</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">create</span> <span style="color: #0000ff">index</span> index_usr <span style="color: #0000ff">on</span> usr(n1,n2);  <span style="color: #008080">--</span><span style="color: #008080"> 创建组合普通索引</span>

<span style="background-color: #ffff00"><span style="color: #0000ff">SELECT</span> <span style="color: #808080">*</span> <span style="color: #0000ff">FROM</span> usr <span style="color: #0000ff">WHERE</span> n1 <span style="color: #808080">=</span> <span style="color: #ff0000">'</span><span style="color: #ff0000">x</span><span style="color: #ff0000">'</span>;  <span style="color: #008080">--</span><span style="color: #008080"> 走索引</span>

<span style="color: #0000ff">SELECT</span> <span style="color: #808080">*</span> <span style="color: #0000ff">FROM</span> usr <span style="color: #0000ff">WHERE</span> n1 <span style="color: #808080">=</span> <span style="color: #ff0000">'</span><span style="color: #ff0000">x</span><span style="color: #ff0000">'</span> <span style="color: #808080">AND</span> n2 <span style="color: #808080">=</span> <span style="color: #ff0000">'</span><span style="color: #ff0000">x</span><span style="color: #ff0000">'</span>;  <span style="color: #008080">--</span><span style="color: #008080"> 走索引</span></span>

<span style="background-color: #ff99cc"><span style="color: #0000ff">SELECT</span> <span style="color: #808080">*</span> <span style="color: #0000ff">FROM</span> usr <span style="color: #0000ff">WHERE</span> n2 <span style="color: #808080">=</span> <span style="color: #ff0000">'</span><span style="color: #ff0000">x</span><span style="color: #ff0000">'</span>;  <span style="color: #008080">--</span><span style="color: #008080"> 不走索引</span></span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>&nbsp;5、全文索引</strong></span></p>
<p><span style="color: #ff0000"><strong>全文索引，也就是向搜索引擎那样，根据一个关键词，搜索出所有数据里包含此关键词的数据，但是对中文支持不好，因为是根据空格或者分隔符分词的，所以一般我们不用这个方案</strong></span></p>
<p><span style="color: #ff0000"><strong>全文索引对中文起不了什么作用，索引就不说了</strong></span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>索引补充</strong></span></p>
<p><span style="color: #ff0000"><strong>1、索引</strong></span><br><span style="color: #ff0000"><strong>　　索引是表的目录，在查找内容之前可以先在目录中查找索引位置，以此快速定位查询数据。对于索引，会保存在额外的文件中。</strong></span></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>2、索引种类</strong></span></p>
<p><span style="color: #ff0000"><strong>　　普通索引：仅加速查询</strong></span><br><span style="color: #ff0000"><strong>　　唯一索引：加速查询 + 列值唯一（可以有null）</strong></span><br><span style="color: #ff0000"><strong>　　主键索引：加速查询 + 列值唯一 +　表中只有一个（不可以有null）</strong></span><br><span style="color: #ff0000"><strong>　　<span style="color: #0000ff">组合索引</span>：多列值组成一个索引，<span style="color: #0000ff"><strong>组合索引要比<strong>索引合并效率高</strong></strong></span></strong></span><br><span style="color: #ff0000"><strong>              　　专门用于组合搜索，其效率大于索引合并</strong></span><br><span style="color: #ff0000"><strong>　　全文索引：对文本的内容进行分词，进行搜索 </strong></span><br><span style="color: #ff0000"><strong>　　<span style="color: #0000ff">索引合并</span>，使用多个单列索引组合搜索</strong></span><br><span style="color: #ff0000"><strong>　　<span style="color: #0000ff">覆盖索引</span>，select的数据列只用从索引中就能够取得，不必读取数据行，换句话说查询列要被所建的索引覆盖</strong></span></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong><strong>3、相关命令</strong></strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #808080">-</span><span style="color: #000000"> 查看表结构
    </span><span style="color: #0000ff">desc</span><span style="color: #000000"> 表名
 
</span><span style="color: #808080">-</span><span style="color: #000000"> 查看生成表的SQL
    show </span><span style="color: #0000ff">create</span> <span style="color: #0000ff">table</span><span style="color: #000000"> 表名
 
</span><span style="color: #808080">-</span><span style="color: #000000"> 查看索引
    show </span><span style="color: #0000ff">index</span> <span style="color: #0000ff">from</span><span style="color: #000000">  表名
 
</span><span style="color: #808080">-</span><span style="color: #000000"> 查看执行时间
    </span><span style="color: #0000ff">set</span> profiling <span style="color: #808080">=</span> <span style="color: #800000; font-weight: bold">1</span><span style="color: #000000">;
    SQL...
    show profiles;</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong><strong>4、使用索引和不使用索引</strong></strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #000000">由于索引是专门用于加速搜索而生，所以加上索引之后，查询效率会快到飞起来。
 
# 有索引
mysql</span><span style="color: #808080">&gt;</span> <span style="color: #0000ff">select</span> <span style="color: #808080">*</span> <span style="color: #0000ff">from</span> tb1 <span style="color: #0000ff">where</span> name <span style="color: #808080">=</span> <span style="color: #ff0000">'</span><span style="color: #ff0000">wupeiqi-888</span><span style="color: #ff0000">'</span><span style="color: #000000">;
</span><span style="color: #808080">+</span><span style="color: #008080">--</span><span style="color: #008080">---+-------------+---------------------+----------------------------------+---------------------+</span>
<span style="color: #808080">|</span> nid <span style="color: #808080">|</span> name        <span style="color: #808080">|</span> email               <span style="color: #808080">|</span> radom                            <span style="color: #808080">|</span> ctime               <span style="color: #808080">|</span>
<span style="color: #808080">+</span><span style="color: #008080">--</span><span style="color: #008080">---+-------------+---------------------+----------------------------------+---------------------+</span>
<span style="color: #808080">|</span> <span style="color: #800000; font-weight: bold">889</span> <span style="color: #808080">|</span> wupeiqi<span style="color: #808080">-</span><span style="color: #800000; font-weight: bold">888</span> <span style="color: #808080">|</span> wupeiqi888<span style="color: #008000">@live</span>.com <span style="color: #808080">|</span> 5312269e76a16a90b8a8301d5314204b <span style="color: #808080">|</span> <span style="color: #800000; font-weight: bold">2016</span><span style="color: #808080">-</span><span style="color: #800000; font-weight: bold">08</span><span style="color: #808080">-</span><span style="color: #800000; font-weight: bold">03</span> <span style="color: #800000; font-weight: bold">09</span>:<span style="color: #800000; font-weight: bold">33</span>:<span style="color: #800000; font-weight: bold">35</span> <span style="color: #808080">|</span>
<span style="color: #808080">+</span><span style="color: #008080">--</span><span style="color: #008080">---+-------------+---------------------+----------------------------------+---------------------+</span>
<span style="color: #800000; font-weight: bold">1</span> row <span style="color: #808080">in</span> <span style="color: #0000ff">set</span> (<span style="color: #800000; font-weight: bold">0.00</span><span style="color: #000000"> sec)
 
# 无索引
mysql</span><span style="color: #808080">&gt;</span> <span style="color: #0000ff">select</span> <span style="color: #808080">*</span> <span style="color: #0000ff">from</span> tb1 <span style="color: #0000ff">where</span> email <span style="color: #808080">=</span> <span style="color: #ff0000">'</span><span style="color: #ff0000">wupeiqi888@live.com</span><span style="color: #ff0000">'</span><span style="color: #000000">;
</span><span style="color: #808080">+</span><span style="color: #008080">--</span><span style="color: #008080">---+-------------+---------------------+----------------------------------+---------------------+</span>
<span style="color: #808080">|</span> nid <span style="color: #808080">|</span> name        <span style="color: #808080">|</span> email               <span style="color: #808080">|</span> radom                            <span style="color: #808080">|</span> ctime               <span style="color: #808080">|</span>
<span style="color: #808080">+</span><span style="color: #008080">--</span><span style="color: #008080">---+-------------+---------------------+----------------------------------+---------------------+</span>
<span style="color: #808080">|</span> <span style="color: #800000; font-weight: bold">889</span> <span style="color: #808080">|</span> wupeiqi<span style="color: #808080">-</span><span style="color: #800000; font-weight: bold">888</span> <span style="color: #808080">|</span> wupeiqi888<span style="color: #008000">@live</span>.com <span style="color: #808080">|</span> 5312269e76a16a90b8a8301d5314204b <span style="color: #808080">|</span> <span style="color: #800000; font-weight: bold">2016</span><span style="color: #808080">-</span><span style="color: #800000; font-weight: bold">08</span><span style="color: #808080">-</span><span style="color: #800000; font-weight: bold">03</span> <span style="color: #800000; font-weight: bold">09</span>:<span style="color: #800000; font-weight: bold">33</span>:<span style="color: #800000; font-weight: bold">35</span> <span style="color: #808080">|</span>
<span style="color: #808080">+</span><span style="color: #008080">--</span><span style="color: #008080">---+-------------+---------------------+----------------------------------+---------------------+</span>
<span style="color: #800000; font-weight: bold">1</span> row <span style="color: #808080">in</span> <span style="color: #0000ff">set</span> (<span style="color: #800000; font-weight: bold">1.23</span> sec)</pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>5、正确使用索引</strong></span></p>
<p><span style="color: #ff0000"><strong>数据库表中添加索引后确实会让查询速度起飞，但前提必须是正确的使用索引来查询，如果以错误的方式使用，则即使建立索引也会不奏效。</strong></span><br><span style="color: #ff0000"><strong>即使建立索引，索引也不会生效：</strong></span></p>
<p>&nbsp;</p>
<div class="cnblogs_code">
<pre><strong><span style="color: #008080">--</span><span style="color: #008080"> like '%xx'  模糊查询</span></strong>
    <span style="color: #0000ff">select</span> <span style="color: #808080">*</span> <span style="color: #0000ff">from</span> tb1 <span style="color: #0000ff">where</span> name <span style="color: #808080">like</span> <span style="color: #ff0000">'</span><span style="color: #ff0000; background-color: #ffff00">%cn</span><span style="color: #ff0000">'</span>;  <span style="color: #008080">--</span><span style="color: #008080"> 表示查询tb1表里name字段里，前面可以是多个任意字符后面包含cn的所有数据，<span style="background-color: #ffff00">%写在前面不走索引</span></span>
        <span style="color: #0000ff">select</span> <span style="color: #808080">*</span> <span style="color: #0000ff">from</span> tb1 <span style="color: #0000ff">where</span> name <span style="color: #808080">like</span> <span style="color: #ff0000">'</span><span style="color: #ff0000; background-color: #ffff00">cn%</span><span style="color: #ff0000">'</span>;  <span style="color: #008080">--</span><span style="color: #008080"> 表示查询tb1表里name字段里，后面可以是多个任意字符前面包含cn的所有数据，<span style="background-color: #ffff00">%写在后面走索引</span></span>


<strong><span style="color: #008080">--</span><span style="color: #008080"> 使用函数</span></strong>
    <span style="color: #0000ff">select</span> <span style="color: #808080">*</span> <span style="color: #0000ff">from</span> tb1 <span style="color: #0000ff">where</span> <span style="background-color: #ffff00"><span style="color: #ff00ff">reverse</span>(name)</span> <span style="color: #808080">=</span> <span style="color: #ff0000">'</span><span style="color: #ff0000">wupeiqi</span><span style="color: #ff0000">'</span>;  <span style="color: #008080">--</span><span style="color: #008080"> 在查询条件里，<span style="background-color: #ffff00">对索引字段使用了函数，不走索引</span></span>


<strong><span style="color: #008080">--</span><span style="color: #008080"> or 条件或</span></strong>
    <span style="color: #0000ff">select</span> <span style="color: #808080">*</span> <span style="color: #0000ff">from</span> tb1 <span style="color: #0000ff">where</span> <span style="background-color: #ffff00">nid</span> <span style="color: #808080">=</span> <span style="color: #800000; font-weight: bold">1</span> <span style="color: #808080">or</span> <span style="background-color: #ffff00">email</span> <span style="color: #808080">=</span> <span style="color: #ff0000">'</span><span style="color: #ff0000">seven@live.com</span><span style="color: #ff0000">'</span>; <span style="color: #008080">--</span><span style="color: #008080"> 条件或，<span style="background-color: #ffff00">如果两个字段都建了索引，那就走索引。如果只有一个字段建了索引，那就不走索引</span></span>
    <span style="color: #008080">--</span><span style="color: #008080"> 特别的：当or条件中有未建立索引的列才失效，以下会走索引</span>
            <span style="color: #0000ff">select</span> <span style="color: #808080">*</span> <span style="color: #0000ff">from</span> tb1 <span style="color: #0000ff">where</span> <span style="background-color: #ffff00">nid</span> <span style="color: #808080">=</span> <span style="color: #800000; font-weight: bold">1</span> <span style="color: #808080">or</span> <span style="background-color: #ffff00">name</span> <span style="color: #808080">=</span> <span style="color: #ff0000">'</span><span style="color: #ff0000">seven</span><span style="color: #ff0000">'</span>;  <span style="color: #008080">--</span><span style="color: #008080; background-color: #ffff00"> 如果两个字段都建了索引，那就走索引</span>
            <span style="color: #0000ff">select</span> <span style="color: #808080">*</span> <span style="color: #0000ff">from</span> tb1 <span style="color: #0000ff">where</span> <span style="background-color: #ffff00">nid</span> <span style="color: #808080">=</span> <span style="color: #800000; font-weight: bold">1</span> <span style="color: #808080">or</span> <span style="background-color: #ffff00">email</span> <span style="color: #808080">=</span> <span style="color: #ff0000">'</span><span style="color: #ff0000">seven@live.com</span><span style="color: #ff0000">'</span> <span style="color: #808080">and</span> <span style="background-color: #ffff00">name</span> <span style="color: #808080">=</span> <span style="color: #ff0000">'</span><span style="color: #ff0000">alex</span><span style="color: #ff0000">'</span>  <span style="color: #008080">--</span><span style="color: #008080; background-color: #ffff00"> 如果只有email没建索引，其他字段都建了索引，这样是走索引的</span>



<strong><span style="color: #008080">--</span><span style="color: #008080"> 类型不一致</span></strong>
    <span style="color: #008080">--</span><span style="color: #008080"> 如果列是字符串类型，<span style="background-color: #ffff00">传入条件是必须用引号引起来，不然也不走索引</span></span>
    <span style="color: #0000ff">select</span> <span style="color: #808080">*</span> <span style="color: #0000ff">from</span> tb1 <span style="color: #0000ff">where</span> name <span style="color: #808080">=</span> <span style="color: #800000; font-weight: bold; background-color: #ffff00">999</span><span style="color: #000000">;



</span><strong><span style="color: #008080">--</span><span style="color: #008080"> !=</span></strong>
    <span style="color: #0000ff">select</span> <span style="color: #808080">*</span> <span style="color: #0000ff">from</span> tb1 <span style="color: #0000ff">where</span> <span style="background-color: #ffff00">name</span> <span style="color: #808080; background-color: #ffff00">!=</span> <span style="color: #ff0000">'</span><span style="color: #ff0000">alex</span><span style="color: #ff0000">'</span>  <span style="color: #008080">--</span><span style="color: #008080"> 不等于、<span style="background-color: #ffff00">因为取反全部，所以不走索引</span></span>
    <span style="color: #008080">--</span><span style="color: #008080"> 特别的：如果是主键，则还是会走索引</span>
        <span style="color: #0000ff">select</span> <span style="color: #808080">*</span> <span style="color: #0000ff">from</span> tb1 <span style="color: #0000ff">where</span> <span style="background-color: #ffff00">nid <span style="color: #808080">!=</span></span> <span style="color: #800000; font-weight: bold">123</span>  <span style="color: #008080">--</span><span style="color: #008080"> 如果不等于，<span style="background-color: #ffff00">取反主键索引，会走索引的</span></span>


<strong><span style="color: #008080">--</span><span style="color: #008080"> &gt;</span></strong>
    <span style="color: #0000ff">select</span> <span style="color: #808080">*</span> <span style="color: #0000ff">from</span> tb1 <span style="color: #0000ff">where</span> name <span style="color: #808080; background-color: #ffff00">&gt;</span> <span style="color: #ff0000">'</span><span style="color: #ff0000">alex</span><span style="color: #ff0000">'</span> <span style="color: #008080">--</span><span style="color: #008080; background-color: #ffff00"> 这种大于，不走索引</span>
    <span style="color: #008080">--</span><span style="color: #008080"> 特别的：如果是主键或索引是整数类型，则还是会走索引</span>
        <span style="color: #0000ff">select</span> <span style="color: #808080">*</span> <span style="color: #0000ff">from</span> tb1 <span style="color: #0000ff">where</span> <span style="background-color: #ffff00">nid</span> <span style="color: #808080; background-color: #ffff00">&gt;</span> <span style="color: #800000; font-weight: bold">123</span>  <span style="color: #008080">--</span><span style="color: #008080; background-color: #ffff00"> 主键大于，走索引</span>
        <span style="color: #0000ff">select</span> <span style="color: #808080">*</span> <span style="color: #0000ff">from</span> tb1 <span style="color: #0000ff">where</span> <span style="background-color: #ffff00">num <span style="color: #808080">&gt;</span></span> <span style="color: #800000; font-weight: bold">123</span>        <span style="color: #008080">--</span><span style="color: #008080; background-color: #ffff00"> 索引字段整数类型，走索引</span>


<strong><span style="color: #008080">--</span><span style="color: #008080"> order by   排序</span></strong>
    <span style="color: #0000ff">select</span> <span style="background-color: #ffff00">email</span> <span style="color: #0000ff">from</span> tb1 <span style="color: #0000ff">order</span> <span style="color: #0000ff">by</span> <span style="background-color: #ffff00">name</span> <span style="color: #0000ff">desc</span>;  <span style="color: #008080">--</span><span style="color: #008080; background-color: #ffff00"> 当根据索引排序时候，选择的映射如果不是索引，则不走索引</span>
    
        <span style="color: #0000ff">select</span> <span style="color: #808080; background-color: #ffff00">*</span> <span style="color: #0000ff">from</span> tb1 <span style="color: #0000ff">order</span> <span style="color: #0000ff">by</span> <span style="background-color: #ffff00">nid</span> <span style="color: #0000ff">desc</span>;  <span style="color: #008080">--</span><span style="color: #008080"> 特别的：<span style="background-color: #ffff00">如果对主键排序，则还是走索引：</span></span>


 
<strong><span style="color: #008080">--</span><span style="color: #008080"> 组合索引最左前缀</span></strong>
    <span style="color: #008080">--</span><span style="color: #008080"> 如果组合索引为：(<span style="background-color: #ffff00">name,email</span>)  <span style="background-color: #ffff00">将这两个字段组合成一个索引</span></span>
    <span style="background-color: #ffff00">name</span> <span style="color: #808080">and</span> <span style="background-color: #ffff00">email</span>       <span style="color: #008080">--</span><span style="color: #008080"> 使用索引</span>
    <span style="background-color: #ffff00">name</span>                 <span style="color: #008080">--</span><span style="color: #008080"> 使用索引</span>
    <span style="background-color: #ff99cc">email</span>                <span style="color: #008080">--</span><span style="color: #008080; background-color: #ff99cc"> 不使用索引</span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>6、其他注意事项</strong></span></p>
<div class="cnblogs_code">
<pre>避免使用select <span style="color: #808080">*</span>  <span style="color: #008080">--</span><span style="color: #008080"> 避免使用*，在取字段时能少就少取字段</span>

<span style="color: #ff00ff">count</span>(<span style="color: #800000; font-weight: bold">1</span>)或count(列) 代替 <span style="color: #ff00ff">count</span>(<span style="color: #808080">*</span>)  <span style="color: #008080">--</span><span style="color: #008080"> 因为*效率低</span>
<span style="color: #000000">
创建表时尽量时 </span><span style="color: #0000ff">char</span> 代替 <span style="color: #0000ff">varchar</span>  <span style="color: #008080">--</span><span style="color: #008080"> 因为char效率高查询快</span>
<span style="color: #000000">
表的字段顺序固定长度的字段优先前放 </span><span style="color: #008080">--</span><span style="color: #008080"> 这样效率高点</span>
<span style="color: #000000">
组合索引代替多个单列索引（经常使用多个条件查询时）</span><span style="color: #008080">--</span><span style="color: #008080"> 因为组合索引要比，多个单列索引合并查询效率高</span>
<span style="color: #000000">
尽量使用短索引  </span><span style="color: #008080">--</span><span style="color: #008080"> 如果只有前8位字符不一样，后面都是一样的，就没必要将整个字段全部键索引，只需要将字段里的前8位建索引即可</span>
<span style="color: #0000ff">create</span> <span style="color: #0000ff">index</span> index_name <span style="color: #0000ff">on</span> table_name(nl(<span style="color: #800000; font-weight: bold">8</span><span style="color: #000000">));

使用连接（</span><span style="color: #808080">JOIN</span>）来代替子查询(Sub<span style="color: #808080">-</span>Queries) <span style="color: #008080">--</span><span style="color: #008080"> JOIN链表查询效率高</span>
<span style="color: #000000">
连表时注意条件类型需一致 </span><span style="color: #008080">--</span><span style="color: #008080"> 也就是条件的数据类型一致效率高</span>
<span style="color: #000000">
索引散列值（重复多）不适合建索引，例：性别不适合 </span><span style="color: #008080">--</span><span style="color: #008080"> 一共就两个值男、女，基本都是重复的，建索引也不起作用</span>
<span style="color: #000000">
避免过度创建索引

如果大数据表导入另外的数据库时，建议先将索引去掉，导入后重建索引</span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong><strong>7、limit分页</strong></strong></span></p>
<p><span style="color: #ff0000"><strong>无论是否有索引，limit分页是一个值得关注的问题</strong></span></p>
<p><span style="color: #ff0000"><strong>假如一张表有5000000条数据</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008080">--</span><span style="color: #008080"> 不可取</span>
<span style="color: #0000ff">SELECT</span> <span style="color: #808080">*</span> <span style="color: #0000ff">FROM</span> usr LIMIT <span style="color: #800000; font-weight: bold">2000000</span>,<span style="color: #800000; font-weight: bold">5</span>;   <span style="color: #008080">--</span><span style="color: #008080"> 从两百万条，开始取5条，那么会全表扫描到两百万条的位置开始取5条，效率很低</span>

<span style="color: #008080">--</span><span style="color: #008080"> 这个办法也不可取，比上面好</span>
<span style="color: #0000ff">SELECT</span> <span style="color: #808080">*</span> <span style="color: #0000ff">FROM</span> usr id <span style="color: #808080">&gt;</span> (<span style="color: #0000ff">SELECT</span> id <span style="color: #0000ff">FROM</span> usr LIMIT <span style="color: #800000; font-weight: bold">2000000</span>,<span style="color: #800000; font-weight: bold">1</span>) LIMIT <span style="color: #800000; font-weight: bold">5</span>; <span style="color: #008080">--</span><span style="color: #008080"> 先从ID找两百万条的位置取一条id，id有索引只查ID会走索引到两百万的位置，得到ID后将ID作为查询条件，会直接从这个ID查找，不在全表扫描</span></pre>
</div>
<p><span style="color: #ff0000"><strong>分页优化方案</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #000000">每页显示10条：
当前 </span><span style="color: #800000; font-weight: bold">118</span> <span style="color: #800000; font-weight: bold">120</span>， <span style="color: #800000; font-weight: bold">125</span><span style="color: #000000">

倒序：
            大      小
            </span><span style="color: #800000; font-weight: bold">980</span>    <span style="color: #800000; font-weight: bold">970</span>  <span style="color: #800000; font-weight: bold">7</span> <span style="color: #800000; font-weight: bold">6</span>  <span style="color: #800000; font-weight: bold">6</span> <span style="color: #800000; font-weight: bold">5</span>  <span style="color: #800000; font-weight: bold">54</span>  <span style="color: #800000; font-weight: bold">43</span>  <span style="color: #800000; font-weight: bold">32</span>

<span style="color: #800000; font-weight: bold">21</span> <span style="color: #800000; font-weight: bold">19</span> <span style="color: #800000; font-weight: bold">98</span><span style="color: #000000">     
下一页：
        </span><span style="color: #008080">--</span><span style="color: #008080"> 有页面</span>
    <span style="color: #0000ff">select</span> 
        <span style="color: #808080">*</span> 
    <span style="color: #0000ff">from</span><span style="color: #000000"> 
        tb1 
    </span><span style="color: #0000ff">where</span><span style="color: #000000"> 
        nid </span><span style="color: #808080">&lt;</span> (<span style="color: #0000ff">select</span> nid <span style="color: #0000ff">from</span> (<span style="color: #0000ff">select</span> nid <span style="color: #0000ff">from</span> tb1 <span style="color: #0000ff">where</span> nid <span style="color: #808080">&lt;</span> 当前页最小值 <span style="color: #0000ff">order</span> <span style="color: #0000ff">by</span> nid <span style="color: #0000ff">desc</span> limit 每页数据 <span style="color: #808080">*</span>【页码<span style="color: #808080">-</span>当前页】) A <span style="color: #0000ff">order</span> <span style="color: #0000ff">by</span> A.nid <span style="color: #0000ff">asc</span> limit <span style="color: #800000; font-weight: bold">1</span><span style="color: #000000">)  
    </span><span style="color: #0000ff">order</span> <span style="color: #0000ff">by</span><span style="color: #000000"> 
        nid </span><span style="color: #0000ff">desc</span><span style="color: #000000"> 
    limit </span><span style="color: #800000; font-weight: bold">10</span><span style="color: #000000">;


        </span><span style="color: #008080">--</span><span style="color: #008080"> 无页面</span>
    <span style="color: #0000ff">select</span> 
        <span style="color: #808080">*</span> 
    <span style="color: #0000ff">from</span><span style="color: #000000"> 
        tb1 
    </span><span style="color: #0000ff">where</span><span style="color: #000000"> 
        nid </span><span style="color: #808080">&lt;</span> (<span style="color: #0000ff">select</span> nid <span style="color: #0000ff">from</span> (<span style="color: #0000ff">select</span> nid <span style="color: #0000ff">from</span> tb1 <span style="color: #0000ff">where</span> nid <span style="color: #808080">&lt;</span> <span style="color: #800000; font-weight: bold">970</span>  <span style="color: #0000ff">order</span> <span style="color: #0000ff">by</span> nid <span style="color: #0000ff">desc</span> limit <span style="color: #800000; font-weight: bold">40</span>) A <span style="color: #0000ff">order</span> <span style="color: #0000ff">by</span> A.nid <span style="color: #0000ff">asc</span> limit <span style="color: #800000; font-weight: bold">1</span><span style="color: #000000">)  
    </span><span style="color: #0000ff">order</span> <span style="color: #0000ff">by</span><span style="color: #000000"> 
        nid </span><span style="color: #0000ff">desc</span><span style="color: #000000"> 
    limit </span><span style="color: #800000; font-weight: bold">10</span><span style="color: #000000">;


上一页：
        </span><span style="color: #008080">--</span><span style="color: #008080"> 有页面</span>
    <span style="color: #0000ff">select</span> 
        <span style="color: #808080">*</span> 
    <span style="color: #0000ff">from</span><span style="color: #000000"> 
        tb1 
    </span><span style="color: #0000ff">where</span><span style="color: #000000"> 
        nid </span><span style="color: #808080">&lt;</span> (<span style="color: #0000ff">select</span> nid <span style="color: #0000ff">from</span> (<span style="color: #0000ff">select</span> nid <span style="color: #0000ff">from</span> tb1 <span style="color: #0000ff">where</span> nid <span style="color: #808080">&gt;</span> 当前页最大值 <span style="color: #0000ff">order</span> <span style="color: #0000ff">by</span> nid <span style="color: #0000ff">asc</span> limit 每页数据 <span style="color: #808080">*</span>【当前页<span style="color: #808080">-</span>页码】) A <span style="color: #0000ff">order</span> <span style="color: #0000ff">by</span> A.nid <span style="color: #0000ff">asc</span> limit <span style="color: #800000; font-weight: bold">1</span><span style="color: #000000">)  
    </span><span style="color: #0000ff">order</span> <span style="color: #0000ff">by</span><span style="color: #000000"> 
        nid </span><span style="color: #0000ff">desc</span><span style="color: #000000"> 
    limit </span><span style="color: #800000; font-weight: bold">10</span><span style="color: #000000">;

        </span><span style="color: #008080">--</span><span style="color: #008080"> 无页面</span>
    <span style="color: #0000ff">select</span> 
        <span style="color: #808080">*</span> 
    <span style="color: #0000ff">from</span><span style="color: #000000"> 
        tb1 
    </span><span style="color: #0000ff">where</span><span style="color: #000000"> 
        nid </span><span style="color: #808080">&lt;</span> (<span style="color: #0000ff">select</span> nid <span style="color: #0000ff">from</span> (<span style="color: #0000ff">select</span> nid <span style="color: #0000ff">from</span> tb1 <span style="color: #0000ff">where</span> nid <span style="color: #808080">&gt;</span> <span style="color: #800000; font-weight: bold">980</span> <span style="color: #0000ff">order</span> <span style="color: #0000ff">by</span> nid <span style="color: #0000ff">asc</span> limit <span style="color: #800000; font-weight: bold">20</span>) A <span style="color: #0000ff">order</span> <span style="color: #0000ff">by</span> A.nid <span style="color: #0000ff">desc</span> limit <span style="color: #800000; font-weight: bold">1</span><span style="color: #000000">)  
    </span><span style="color: #0000ff">order</span> <span style="color: #0000ff">by</span><span style="color: #000000"> 
        nid </span><span style="color: #0000ff">desc</span><span style="color: #000000"> 
    limit </span><span style="color: #800000; font-weight: bold">10</span>;</pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>8、执行计划</strong></span></p>
<p><span style="color: #ff0000"><strong>explain + 查询SQL - 用于显示SQL执行信息参数，根据参考信息可以进行SQL优化</strong></span></p>
<div class="cnblogs_code">
<pre>mysql<span style="color: #808080">&gt;</span> explain <span style="color: #0000ff">select</span> <span style="color: #808080">*</span> <span style="color: #0000ff">from</span><span style="color: #000000"> tb2;
</span><span style="color: #808080">+</span><span style="color: #008080">--</span><span style="color: #008080">--+-------------+-------+------+---------------+------+---------+------+------+-------+</span>
<span style="color: #808080">|</span> id <span style="color: #808080">|</span> select_type <span style="color: #808080">|</span> <span style="color: #0000ff">table</span> <span style="color: #808080">|</span><span style="background-color: #ffff00"> type</span> <span style="color: #808080">|</span> possible_keys <span style="color: #808080">|</span> <span style="color: #0000ff">key</span>  <span style="color: #808080">|</span> key_len <span style="color: #808080">|</span> ref  <span style="color: #808080">|</span> <span style="background-color: #ffff00">rows</span> <span style="color: #808080">|</span> Extra <span style="color: #808080">|</span>
<span style="color: #808080">+</span><span style="color: #008080">--</span><span style="color: #008080">--+-------------+-------+------+---------------+------+---------+------+------+-------+</span>
<span style="color: #808080">|</span>  <span style="color: #800000; font-weight: bold">1</span> <span style="color: #808080">|</span> SIMPLE      <span style="color: #808080">|</span> tb2   <span style="color: #808080">|</span> <span style="color: #808080; background-color: #ffff00">ALL</span>  <span style="color: #808080">|</span> <span style="color: #0000ff">NULL</span>          <span style="color: #808080">|</span> <span style="color: #0000ff">NULL</span> <span style="color: #808080">|</span> <span style="color: #0000ff">NULL</span>    <span style="color: #808080">|</span> <span style="color: #0000ff">NULL</span> <span style="color: #808080">|</span>   <span style="color: #800000; font-weight: bold; background-color: #ffff00"> 2 </span><span style="color: #808080">|</span> <span style="color: #0000ff">NULL</span>  <span style="color: #808080">|</span>
<span style="color: #808080">+</span><span style="color: #008080">--</span><span style="color: #008080">--+-------------+-------+------+---------------+------+---------+------+------+-------+</span>
<span style="color: #800000; font-weight: bold">1</span> row <span style="color: #808080">in</span> <span style="color: #0000ff">set</span> (<span style="color: #800000; font-weight: bold">0.00</span> sec)</pre>
</div>
<p><span style="color: #ff0000"><strong>执行计划详情</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #000000">id
        查询顺序标识
            如：mysql</span><span style="color: #808080">&gt;</span> explain <span style="color: #0000ff">select</span> <span style="color: #808080">*</span> <span style="color: #0000ff">from</span> (<span style="color: #0000ff">select</span> nid,name <span style="color: #0000ff">from</span> tb1 <span style="color: #0000ff">where</span> nid <span style="color: #808080">&lt;</span> <span style="color: #800000; font-weight: bold">10</span>) <span style="color: #0000ff">as</span><span style="color: #000000"> B;
            </span><span style="color: #808080">+</span><span style="color: #008080">--</span><span style="color: #008080">--+-------------+------------+-------+---------------+---------+---------+------+------+-------------+</span>
            <span style="color: #808080">|</span> id <span style="color: #808080">|</span> select_type <span style="color: #808080">|</span> <span style="color: #0000ff">table</span>      <span style="color: #808080">|</span> type  <span style="color: #808080">|</span> possible_keys <span style="color: #808080">|</span> <span style="color: #0000ff">key</span>     <span style="color: #808080">|</span> key_len <span style="color: #808080">|</span> ref  <span style="color: #808080">|</span> rows <span style="color: #808080">|</span> Extra       <span style="color: #808080">|</span>
            <span style="color: #808080">+</span><span style="color: #008080">--</span><span style="color: #008080">--+-------------+------------+-------+---------------+---------+---------+------+------+-------------+</span>
            <span style="color: #808080">|</span>  <span style="color: #800000; font-weight: bold">1</span> <span style="color: #808080">|</span> <span style="color: #0000ff">PRIMARY</span>     <span style="color: #808080">|</span> <span style="color: #808080">&lt;</span>derived2<span style="color: #808080">&gt;</span> <span style="color: #808080">|</span> <span style="color: #808080">ALL</span>   <span style="color: #808080">|</span> <span style="color: #0000ff">NULL</span>          <span style="color: #808080">|</span> <span style="color: #0000ff">NULL</span>    <span style="color: #808080">|</span> <span style="color: #0000ff">NULL</span>    <span style="color: #808080">|</span> <span style="color: #0000ff">NULL</span> <span style="color: #808080">|</span>    <span style="color: #800000; font-weight: bold">9</span> <span style="color: #808080">|</span> <span style="color: #0000ff">NULL</span>        <span style="color: #808080">|</span>
            <span style="color: #808080">|</span>  <span style="color: #800000; font-weight: bold">2</span> <span style="color: #808080">|</span> DERIVED     <span style="color: #808080">|</span> tb1        <span style="color: #808080">|</span> range <span style="color: #808080">|</span> <span style="color: #0000ff">PRIMARY</span>       <span style="color: #808080">|</span> <span style="color: #0000ff">PRIMARY</span> <span style="color: #808080">|</span> <span style="color: #800000; font-weight: bold">8</span>       <span style="color: #808080">|</span> <span style="color: #0000ff">NULL</span> <span style="color: #808080">|</span>    <span style="color: #800000; font-weight: bold">9</span> <span style="color: #808080">|</span> Using <span style="color: #0000ff">where</span> <span style="color: #808080">|</span>
            <span style="color: #808080">+</span><span style="color: #008080">--</span><span style="color: #008080">--+-------------+------------+-------+---------------+---------+---------+------+------+-------------+</span>
<span style="color: #000000">        特别的：如果使用union连接气值可能为null


    select_type
        查询类型
            SIMPLE          简单查询
            </span><span style="color: #0000ff">PRIMARY</span><span style="color: #000000">         最外层查询
            SUBQUERY        映射为子查询
            DERIVED         子查询
            </span><span style="color: #0000ff">UNION</span><span style="color: #000000">           联合
            </span><span style="color: #0000ff">UNION</span><span style="color: #000000"> RESULT    使用联合的结果
            ...
    </span><span style="color: #0000ff">table</span><span style="color: #000000">
        正在访问的表名


    type
        查询时的访问方式，性能：</span><span style="color: #808080">all</span> <span style="color: #808080">&lt;</span> <span style="color: #0000ff">index</span> <span style="color: #808080">&lt;</span> range <span style="color: #808080">&lt;</span> index_merge <span style="color: #808080">&lt;</span> ref_or_null <span style="color: #808080">&lt;</span> ref <span style="color: #808080">&lt;</span> eq_ref <span style="color: #808080">&lt;</span> system<span style="color: #808080">/</span><span style="color: #000000">const
            </span><span style="color: #808080; background-color: #ff99cc">ALL</span><span style="color: #000000; background-color: #ff99cc">             全表扫描，对于数据表从头到尾找一遍
                            </span><span style="color: #0000ff">select</span> <span style="color: #808080">*</span> <span style="color: #0000ff">from</span><span style="color: #000000"> tb1;
                            特别的：如果有limit限制，则找到之后就不在继续向下扫描
                                   </span><span style="color: #0000ff">select</span> <span style="color: #808080">*</span> <span style="color: #0000ff">from</span> tb1 <span style="color: #0000ff">where</span> email <span style="color: #808080">=</span> <span style="color: #ff0000">'</span><span style="color: #ff0000">seven@live.com</span><span style="color: #ff0000">'</span>
                                   <span style="color: #0000ff">select</span> <span style="color: #808080">*</span> <span style="color: #0000ff">from</span> tb1 <span style="color: #0000ff">where</span> email <span style="color: #808080">=</span> <span style="color: #ff0000">'</span><span style="color: #ff0000">seven@live.com</span><span style="color: #ff0000">'</span> limit <span style="color: #800000; font-weight: bold">1</span><span style="color: #000000">;
                                   虽然上述两个语句都会进行全表扫描，第二句使用了limit，则找到一个后就不再继续扫描。

            </span><span style="color: #0000ff; background-color: #ff99cc">INDEX</span><span style="color: #000000; background-color: #ff99cc">           全索引扫描，对索引从头到尾找一遍
                            </span><span style="color: #0000ff">select</span> nid <span style="color: #0000ff">from</span><span style="color: #000000"> tb1;

            RANGE          对索引列进行范围查找
                            </span><span style="color: #0000ff">select</span> <span style="color: #808080">*</span>  <span style="color: #0000ff">from</span> tb1 <span style="color: #0000ff">where</span> name <span style="color: #808080">&lt;</span> <span style="color: #ff0000">'</span><span style="color: #ff0000">alex</span><span style="color: #ff0000">'</span><span style="color: #000000">;
                            PS:
                                </span><span style="color: #808080">between</span> <span style="color: #808080">and</span>
                                <span style="color: #808080">in</span>
                                <span style="color: #808080">&gt;</span>   <span style="color: #808080">&gt;=</span>  <span style="color: #808080">&lt;</span>   <span style="color: #808080">&lt;=</span><span style="color: #000000">  操作
                                注意：</span><span style="color: #808080">!=</span> 和 <span style="color: #808080">&gt;</span><span style="color: #000000"> 符号 除外


            INDEX_MERGE     合并索引，使用多个单列索引搜索
                            </span><span style="color: #0000ff">select</span> <span style="color: #808080">*</span>  <span style="color: #0000ff">from</span> tb1 <span style="color: #0000ff">where</span> name <span style="color: #808080">=</span> <span style="color: #ff0000">'</span><span style="color: #ff0000">alex</span><span style="color: #ff0000">'</span> <span style="color: #808080">or</span> nid <span style="color: #808080">in</span> (<span style="color: #800000; font-weight: bold">11</span>,<span style="color: #800000; font-weight: bold">22</span>,<span style="color: #800000; font-weight: bold">33</span><span style="color: #000000">);

            REF             根据索引查找一个或多个值
                            </span><span style="color: #0000ff">select</span> <span style="color: #808080">*</span>  <span style="color: #0000ff">from</span> tb1 <span style="color: #0000ff">where</span> name <span style="color: #808080">=</span> <span style="color: #ff0000">'</span><span style="color: #ff0000">seven</span><span style="color: #ff0000">'</span><span style="color: #000000">;

            EQ_REF          连接时使用primary </span><span style="color: #0000ff">key</span><span style="color: #000000"> 或 unique类型
                            </span><span style="color: #0000ff">select</span> tb2.nid,tb1.name <span style="color: #0000ff">from</span> tb2 <span style="color: #808080">left</span> <span style="color: #808080">join</span> tb1 <span style="color: #0000ff">on</span> tb2.nid <span style="color: #808080">=</span><span style="color: #000000"> tb1.nid;



            <span style="background-color: #ccffff">CONST</span>           常量
                            表最多有一个匹配行,因为仅有一行,在这行的列值可被优化器剩余部分认为是常数,const表很快,因为它们只读取一次。
                            </span><span style="color: #0000ff">select</span> nid <span style="color: #0000ff">from</span> tb1 <span style="color: #0000ff">where</span> nid <span style="color: #808080">=</span> <span style="color: #800000; font-weight: bold">2</span><span style="color: #000000"> ;

            SYSTEM          系统
                            表仅有一行(</span><span style="color: #808080">=</span><span style="color: #000000">系统表)。这是const联接类型的一个特例。
                            </span><span style="color: #0000ff">select</span> <span style="color: #808080">*</span> <span style="color: #0000ff">from</span> (<span style="color: #0000ff">select</span> nid <span style="color: #0000ff">from</span> tb1 <span style="color: #0000ff">where</span> nid <span style="color: #808080">=</span> <span style="color: #800000; font-weight: bold">1</span>) <span style="color: #0000ff">as</span><span style="color: #000000"> A;
    possible_keys
        可能使用的索引

    </span><span style="color: #0000ff">key</span><span style="color: #000000">
        真实使用的

    key_len
        MySQL中使用索引字节长度

    <span style="background-color: #ccffff">rows</span>
        <span style="background-color: #ccffff">mysql估计为了找到所需的行而要读取的行数 </span></span><span style="background-color: #ccffff"><span style="color: #008080">--</span><span style="color: #008080">---- 只是预估值，表示扫描了多少行</span></span>
<span style="color: #000000">
    extra
        该列包含MySQL解决查询的详细信息
        “Using </span><span style="color: #0000ff">index</span><span style="color: #000000">”
            此值表示mysql将使用覆盖索引，以避免访问表。不要把覆盖索引和index访问类型弄混了。
        “Using </span><span style="color: #0000ff">where</span><span style="color: #000000">”
            这意味着mysql服务器将在存储引擎检索行后再进行过滤，许多where条件里涉及索引中的列，当（并且如果）它读取索引时，就能被存储引擎检验，因此不是所有带where子句的查询都会显示“Using </span><span style="color: #0000ff">where</span>”。有时“Using <span style="color: #0000ff">where</span><span style="color: #000000">”的出现就是一个暗示：查询可受益于不同的索引。
        “Using </span><span style="color: #0000ff">temporary</span><span style="color: #000000">”
            这意味着mysql在对查询结果排序时会使用一个临时表。
        “Using filesort”
            这意味着mysql会对结果使用一个外部索引排序，而不是按索引次序从表里读取行。mysql有两种文件排序算法，这两种排序方式都可以在内存或者磁盘上完成，explain不会告诉你mysql将使用哪一种文件排序，也不会告诉你排序会在内存里还是磁盘上完成。
        “Range checked </span><span style="color: #0000ff">for</span> each record(<span style="color: #0000ff">index</span><span style="color: #000000"> map: N)”
            这个意味着没有好用的索引，新的索引将在联接的每一行上重新估算，N是显示在possible_keys列中索引的位图，并且是冗余的。</span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>9、慢日志查询</strong></span></p>
<p><span style="color: #ff0000"><strong>慢日志查询，就是用一个日志文件记录，sql语句查询数据库时，耗时比较长的，或者没有使用索引的情况记录一下，我们可以根据这个日志记录情况来对数据库进行优化。</strong></span></p>
<p><span style="color: #ff0000"><strong>数据库自带记录慢日志功能，默认没有开启，需要我们手动开启一下</strong></span></p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>开启慢日志相关全局变量</strong></span></p>
<div class="cnblogs_code">
<pre>slow_query_log <span style="color: #808080">=</span> <span style="color: #0000ff">OFF</span>                       <span style="color: #008080">--</span><span style="color: #008080"> 是否开启慢日志记录</span>
long_query_time <span style="color: #808080">=</span> <span style="color: #800000; font-weight: bold">2</span>                        <span style="color: #008080">--</span><span style="color: #008080"> 时间限制，sql查询超过此时间，则记录，默认是10秒</span>
slow_query_log_file <span style="color: #808080">=</span> <span style="color: #808080">/</span>usr<span style="color: #808080">/</span>slow.<span style="color: #ff00ff">log</span>        <span style="color: #008080">--</span><span style="color: #008080"> 日志文件，日志文件路径</span>
log_queries_not_using_indexes <span style="color: #808080">=</span> <span style="color: #0000ff">OFF</span>        <span style="color: #008080">--</span><span style="color: #008080"> 未使用索引的搜索是否记录</span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>开启记录慢日志功能有两种方法：</strong></span></p>
<p><span style="color: #ff0000"><strong>　　1、在数据库配置文件<span style="color: #0000ff">my-default.ini</span>文件里配置，在文件里写入<strong>相关全局变量，<span style="color: #0000ff">保存后需要重启数据库<span style="color: #ff0000">【推荐】</span></span></strong></strong></span></p>
<p><span style="color: #ff0000"><strong><strong>　　<strong><span style="color: #0000ff">my-default.ini</span>文件在安装的数据库目录里</strong></strong></strong></span></p>
<p><span style="color: #ff0000"><strong><strong><strong><img src="https://images2015.cnblogs.com/blog/955761/201706/955761-20170618105123853-1438457967.png" alt=""></strong></strong></strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #000000"># For advice on how to change settings please see
# http:</span><span style="color: #008000">//</span><span style="color: #008000">dev.mysql.com/doc/refman/5.7/en/server-configuration-defaults.html</span>
# *** DO NOT EDIT THIS FILE. It'<span style="color: #000000">s a template which will be copied to the
# *** default location during install, and will be replaced if you
# *** upgrade to a newer version of MySQL.

[mysqld]

# Remove leading # and set to the amount of RAM for the most important data
# cache in MySQL. Start at 70% of total RAM for dedicated server, else 10%.
# innodb_buffer_pool_size = 128M

# Remove leading # to turn on a very important data integrity option: logging
# changes to the binary log between backups.
# log_bin

# These are commonly set, remove the # and set as required.
# basedir = .....
# datadir = .....
# port = .....
# server_id = .....

<span style="background-color: #ff99cc">slow_query_log = ON                       
long_query_time = 1                        
slow_query_log_file = /usr/slow.log        
log_queries_not_using_indexes = ON </span>       


# Remove leading # to set options mainly useful for reporting servers.
# The server defaults are faster for transactions and fast SELECTs.
# Adjust sizes as needed, experiment to find the optimal values.
# join_buffer_size = 128M
# sort_buffer_size = 2M
# read_rnd_buffer_size = 2M 

sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES </span></pre>
</div>
<p>&nbsp;</p>
<p>　　<span style="color: #ff0000"><strong>2、使用命令开启，记录日志，不需要重启数据库</strong></span></p>
<p><span style="color: #ff0000"><strong>　　首先使用命令查看相关的全局变量是否开始</strong></span></p>
<div class="cnblogs_code">
<pre>SHOW GLOBAL VARIABLES <span style="color: #808080">LIKE</span> <span style="color: #ff0000">'</span><span style="color: #ff0000">%query%</span><span style="color: #ff0000">'</span>;  <span style="color: #008080">--</span><span style="color: #008080"> 使用模糊查询全局变量情况</span></pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201706/955761-20170618112036196-1661435468.png" alt=""></p>
<p>　　<span style="color: #ff0000"><strong>查看未使用索引的搜索是否记录</strong></span></p>
<div class="cnblogs_code">
<pre>SHOW GLOBAL VARIABLES <span style="color: #808080">LIKE</span> <span style="color: #ff0000">'</span><span style="color: #ff0000">log_queries_not_using_indexes</span><span style="color: #ff0000">'</span>;  <span style="color: #008080">--</span><span style="color: #008080"> 未使用索引的搜索是否记录</span></pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201706/955761-20170618112421806-1720470762.png" alt=""></p>
<p>&nbsp;</p>
<p>　　<span style="color: #ff0000"><strong>使用命令开启慢日志记录相关全局变量，<span style="color: #0000ff">注意使用命令开启的全局变量数据库重启后变量将恢复默认</span></strong></span></p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff">　　</span>如果想要<strong>数据库重启后慢日志变量也是开启的，建议在<strong>my-default.ini文件里配置</strong></strong></strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">SET</span> GLOBAL slow_query_log <span style="color: #808080">=</span> <span style="color: #0000ff">on</span>;  <span style="color: #008080">--</span><span style="color: #008080"> 开启慢日志记录</span>
<span style="color: #0000ff">SET</span> GLOBAL long_query_time <span style="color: #808080">=</span> <span style="color: #800000; font-weight: bold">1</span>;  <span style="color: #008080">--</span><span style="color: #008080"> 设置sql语句查询耗时超过1秒的记录</span>
<span style="color: #0000ff">SET</span> GLOBAL log_queries_not_using_indexes <span style="color: #808080">=</span> <span style="color: #0000ff">on</span>;  <span style="color: #008080">--</span><span style="color: #008080"> 开启记录没有使用索引的sql查询记录</span></pre>
</div>
<p>&nbsp;<img src="https://images2015.cnblogs.com/blog/955761/201706/955761-20170618142735571-1149547923.png" alt=""></p>
<p><img src="https://images2015.cnblogs.com/blog/955761/201706/955761-20170618142746040-10128346.png" alt=""></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>查看MySQL慢日志文件</strong></span></p>
<p><span style="color: #ff0000"><strong>win版本没有mysqldumpslow解释器来执行mysqldumpslow.pl文件，索引需要安装<span style="color: #0000ff">ActivePerl_5.16.2.3010812913.msi，软件来执行<strong>mysqldumpslow.pl文件</strong></span></strong></span></p>
<p><span style="color: #ff0000"><strong>双击下一步，下一步安装好<span style="color: #0000ff"><strong>ActivePerl_5.16.2.3010812913.msi，软件</strong></span></strong></span></p>
<p><span style="color: #ff0000"><strong><strong>linu版本就不需要了，linu版本自带了<strong>mysqldumpslow解释器</strong></strong></strong></span></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong><strong>安装好<strong><strong>ActivePerl_5.16.2.3010812913.msi，软件后，管理员方式运行cmd命令</strong></strong></strong></strong></span></p>
<div class="cnblogs_code">
<pre>cd E:\mysql-<span style="color: #800000">5.7</span>.<span style="color: #800000">16</span>-winx64\bin  <span style="color: #008000">#</span><span style="color: #008000">进入mysql安装目录的bin目录里</span></pre>
</div>
<p><span style="color: #ff0000; background-color: #ffff00"><strong><strong><strong><strong><img src="https://images2015.cnblogs.com/blog/955761/201706/955761-20170618170700759-1727907848.png" alt=""></strong></strong></strong></strong></span></p>
<p><span style="color: #ff0000; background-color: #ffffff"><strong><strong><strong><strong>注意：以下操作，<strong><strong>linu版本不需要加<span style="color: #0000ff">perl</span>，<strong>win版本加<strong><span style="color: #0000ff">perl</span>表示用安装的<strong>ActivePerl来执行<strong>mysqldumpslow.pl文件</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></span></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong><strong><strong><strong>查看解析慢日志文件的<strong>mysqldumpslow.pl文件说明</strong></strong></strong></strong></strong></span></p>
<div class="cnblogs_code">
<pre>perl mysqldumpslow.pl --help  <span style="color: #008000">#</span><span style="color: #008000">查看解析慢日志文件的mysqldumpslow.pl文件说明</span></pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201706/955761-20170618171640790-1524376495.png" alt=""></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong><strong><strong><strong><strong><strong>mysqldumpslow.pl文件说明</strong></strong></strong></strong></strong></strong></span></p>
<p>&nbsp;</p>
<div class="cnblogs_code">
<pre><span style="color: #008000">"""
--verbose    版本
--debug      调试
--help       帮助
 
-v           版本
-d           调试模式
<span style="background-color: #ffff00">-s ORDER     排序方式</span>
             what to sort by (al, at, ar, c, l, r, t), 'at' is default
              al: average lock time    -- 平均锁时间
              ar: average rows sent    -- 返回值时间
              <span style="background-color: #ffff00">at: average query time   -- sql查询时间</span>
               c: count
               l: lock time
               r: rows sent
               t: query time
-r           反转顺序，默认文件倒序拍。reverse the sort order (largest last instead of first)
<span style="background-color: #ffff00">-t NUM       显示前N条just show the top n queries  -- 显示多少条数据</span>
<span style="background-color: #ffff00">-a           不要将SQL中数字转换成N，字符串转换成S。don't abstract all numbers to N and strings to 'S'  -- 默认会转换数字和字符串，-a表示不转换</span>
-n NUM       abstract numbers with at least n digits within names
<span style="background-color: #ffff00">-g PATTERN   正则匹配；grep: only consider stmts that include this string   -g表示支持正则匹配，后面就可以跟正则</span>
-h HOSTNAME  mysql机器名或者IP；hostname of db server for *-slow.log filename (can be wildcard),
             default is '*', i.e. match all
-i NAME      name of server instance (if using mysql.server startup script)
-l           总时间中不减去锁定时间；don't subtract lock time from total time
"""</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>下面我们开始查看日志</strong></span></p>
<p><span style="color: #ff0000"><strong>CHCP 65001 -- 设置cmd为utf-8变量，因为可能有中文，65001为utf-8编码号</strong></span></p>
<div class="cnblogs_code">
<pre>CHCP <span style="color: #800000; font-weight: bold">65001</span> <span style="color: #008080">--</span><span style="color: #008080"> 设置cmd为utf-8变量，因为可能有中文，65001为utf-8编码号</span></pre>
</div>
<p><span style="color: #ff0000"><strong>输入查看日志命令</strong></span></p>
<p><span style="color: #ff0000"><strong>注意：组合命令时按照上面的说明顺序进行</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008080">--</span><span style="color: #008080"> mysqldumpslow.pl -s(排序方式) at(按照sql查询时间) -t 5 -a(转换数字和字符串)  日志路径</span>
mysqldumpslow.pl <span style="color: #808080">-</span>s at <span style="color: #808080">-</span>t <span style="color: #800000; font-weight: bold">5</span> <span style="color: #808080">-</span>a  E:\mysql<span style="color: #808080">-</span><span style="color: #800000; font-weight: bold">5.7</span>.<span style="color: #800000; font-weight: bold">16</span><span style="color: #808080">-</span>winx64\data\SKY<span style="color: #808080">-</span>20160816NYP<span style="color: #808080">-</span>slow.<span style="color: #ff00ff">log</span></pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201706/955761-20170618183626103-875566380.png" alt=""></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>这样就可以根据查询数据，和扫描了多少行来进行数据库表优化</strong></span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff"><strong>&nbsp;</strong></span></strong></span></p></div>