第二百九十六节，python操作redis缓存-Hash哈希类型，可以理解为字典类型


			<div id="cnblogs_post_body" class="blogpost-body"><p><strong>第二百九十六节，python操作redis缓存-Hash哈希类型，可以理解为字典类型</strong></p>
<p>&nbsp;</p>
<p><strong>Hash操作，redis中Hash在内存中的存储格式如下图：</strong></p>
<p><strong><img src="https://images2015.cnblogs.com/blog/955761/201707/955761-20170703131722862-1984505591.png" alt=""></strong></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff">hset(name, key, value)</span>name对应的hash中设置一个键值对（不存在，则创建；否则，修改）</strong></span><br><strong>　　name，redis的name</strong><br><strong>　　key，name对应的hash中的key</strong><br><strong>　　value，name对应的hash中的value</strong><br><strong>　　hsetnx(name, key, value),当name对应的hash中不存在当前key时则创建（相当于添加）</strong></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf-8 -*-</span>

<span style="color: #0000ff">import</span> redis                <span style="color: #008000">#</span><span style="color: #008000">导入操作redis模块</span>
<span style="color: #000000">
pool </span>= redis.ConnectionPool(host=<span style="color: #800000">'</span><span style="color: #800000">127.0.0.1</span><span style="color: #800000">'</span>, port=6379)  <span style="color: #008000">#</span><span style="color: #008000">配置连接池连接信息</span>
<span style="color: #000000">
r </span>= redis.Redis(connection_pool=pool)                       <span style="color: #008000">#</span><span style="color: #008000">连接连接池</span>
r.<span style="background-color: #ff99cc">hset(<span style="color: #800000">'</span><span style="color: #800000">foo</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">k1</span><span style="color: #800000">'</span>,<span style="color: #800000">'</span><span style="color: #800000">v1</span><span style="color: #800000">'</span>)</span>                                    <span style="color: #008000">#</span><span style="color: #008000">hset(name, key, value)name对应的hash中设置一个键值对（不存在，则创建；否则，修改）</span>
<span style="color: #000000">
f </span>= r.hgetall(<span style="color: #800000">'</span><span style="color: #800000">foo</span><span style="color: #800000">'</span>)                                        <span style="color: #008000">#</span><span style="color: #008000">获取名称对应的键和值</span>
<span style="color: #0000ff">print</span><span style="color: #000000">(f)
</span><span style="color: #008000">#</span><span style="color: #008000">返回：{b'k1': b'v1'}</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff">hmset(name, mapping)</span>在name对应的hash中批量设置键值对</strong></span><br><strong>　　name，redis的name</strong><br><strong>　　mapping，字典，如：{'k1':'v1', 'k2': 'v2'}</strong></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf-8 -*-</span>

<span style="color: #0000ff">import</span> redis                <span style="color: #008000">#</span><span style="color: #008000">导入操作redis模块</span>
<span style="color: #000000">
pool </span>= redis.ConnectionPool(host=<span style="color: #800000">'</span><span style="color: #800000">127.0.0.1</span><span style="color: #800000">'</span>, port=6379)  <span style="color: #008000">#</span><span style="color: #008000">配置连接池连接信息</span>
<span style="color: #000000">
r </span>= redis.Redis(connection_pool=pool)                       <span style="color: #008000">#</span><span style="color: #008000">连接连接池</span>
r.<span style="background-color: #ff99cc">hmset(<span style="color: #800000">'</span><span style="color: #800000">foo</span><span style="color: #800000">'</span>,{<span style="color: #800000">'</span><span style="color: #800000">k1</span><span style="color: #800000">'</span>:<span style="color: #800000">'</span><span style="color: #800000">v1</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">k2</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">v2</span><span style="color: #800000">'</span>})</span>                      <span style="color: #008000">#</span><span style="color: #008000">hmset(name, mapping)在name对应的hash中批量设置键值对</span>
<span style="color: #000000">
f </span>= r.hgetall(<span style="color: #800000">'</span><span style="color: #800000">foo</span><span style="color: #800000">'</span>)                                        <span style="color: #008000">#</span><span style="color: #008000">获取名称对应的键和值</span>
<span style="color: #0000ff">print</span><span style="color: #000000">(f)
</span><span style="color: #008000">#</span><span style="color: #008000">返回：{b'k2': b'v2', b'k1': b'v1'}</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff">hget(name,key)</span>在name对应的hash中获取根据key获取value</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf-8 -*-</span>

<span style="color: #0000ff">import</span> redis                <span style="color: #008000">#</span><span style="color: #008000">导入操作redis模块</span>
<span style="color: #000000">
pool </span>= redis.ConnectionPool(host=<span style="color: #800000">'</span><span style="color: #800000">127.0.0.1</span><span style="color: #800000">'</span>, port=6379)  <span style="color: #008000">#</span><span style="color: #008000">配置连接池连接信息</span>
<span style="color: #000000">
r </span>= redis.Redis(connection_pool=pool)                       <span style="color: #008000">#</span><span style="color: #008000">连接连接池</span>
r.hmset(<span style="color: #800000">'</span><span style="color: #800000">foo</span><span style="color: #800000">'</span>,{<span style="color: #800000">'</span><span style="color: #800000">k1</span><span style="color: #800000">'</span>:<span style="color: #800000">'</span><span style="color: #800000">v1</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">k2</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">v2</span><span style="color: #800000">'</span>})                      <span style="color: #008000">#</span><span style="color: #008000">hmset(name, mapping)在name对应的hash中批量设置键值对</span>

<span style="color: #008000">#</span><span style="color: #008000"> f = r.hgetall('foo')                                        #获取名称对应的键和值</span>
<span style="color: #000000">
f </span>=  r.<span style="background-color: #ff99cc">hget(<span style="color: #800000">'</span><span style="color: #800000">foo</span><span style="color: #800000">'</span>,<span style="color: #800000">'</span><span style="color: #800000">k1</span><span style="color: #800000">'</span>)</span>                                       <span style="color: #008000">#</span><span style="color: #008000">hget(name,key)在name对应的hash中获取根据key获取value</span>
<span style="color: #0000ff">print</span><span style="color: #000000">(f)
</span><span style="color: #008000">#</span><span style="color: #008000">返回：b'v1'</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff">hmget(name, keys, *args)</span>在name对应的hash中获取多个key的值</strong></span><br><strong>　　name，reids对应的name</strong><br><strong>　　keys，要获取key集合，如：['k1', 'k2', 'k3']</strong><br><strong>　　*args，要获取的key，如：k1,k2,k3</strong><br><strong>　　如：r.mget('xx', ['k1', 'k2'])</strong><br><strong>　　或：r.hmget('xx', 'k1', 'k2')</strong></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf-8 -*-</span>

<span style="color: #0000ff">import</span> redis                <span style="color: #008000">#</span><span style="color: #008000">导入操作redis模块</span>
<span style="color: #000000">
pool </span>= redis.ConnectionPool(host=<span style="color: #800000">'</span><span style="color: #800000">127.0.0.1</span><span style="color: #800000">'</span>, port=6379)  <span style="color: #008000">#</span><span style="color: #008000">配置连接池连接信息</span>
<span style="color: #000000">
r </span>= redis.Redis(connection_pool=pool)                       <span style="color: #008000">#</span><span style="color: #008000">连接连接池</span>
r.hmset(<span style="color: #800000">'</span><span style="color: #800000">foo</span><span style="color: #800000">'</span>,{<span style="color: #800000">'</span><span style="color: #800000">k1</span><span style="color: #800000">'</span>:<span style="color: #800000">'</span><span style="color: #800000">v1</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">k2</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">v2</span><span style="color: #800000">'</span>})                      <span style="color: #008000">#</span><span style="color: #008000">hmset(name, mapping)在name对应的hash中批量设置键值对</span>

<span style="color: #008000">#</span><span style="color: #008000"> f = r.hgetall('foo')                                        #获取名称对应的键和值</span>
<span style="color: #000000">
f </span>=  r.<span style="background-color: #ff99cc">hmget(<span style="color: #800000">'</span><span style="color: #800000">foo</span><span style="color: #800000">'</span>,[<span style="color: #800000">'</span><span style="color: #800000">k1</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">k2</span><span style="color: #800000">'</span>])</span>                                      <span style="color: #008000">#</span><span style="color: #008000">hmget(name, keys, *args)在name对应的hash中获取多个key的值</span><span style="color: #008000">
#</span><span style="color: #008000">或者</span>
f2 =  r.<span style="background-color: #ff99cc">hmget(<span style="color: #800000">'</span><span style="color: #800000">foo</span><span style="color: #800000">'</span>,<span style="color: #800000">'</span><span style="color: #800000">k1</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">k2</span><span style="color: #800000">'</span><span style="color: #000000">)
</span></span><span style="color: #0000ff">print</span><span style="color: #000000">(f)
</span><span style="color: #0000ff">print</span><span style="color: #000000">(f2)

</span><span style="color: #008000">#</span><span style="color: #008000">返回：</span><span style="color: #008000">
#</span><span style="color: #008000"> [b'v1', b'v2']</span><span style="color: #008000">
#</span><span style="color: #008000"> [b'v1', b'v2']</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff">hgetall(name)</span>获取name对应hash的所有键值</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf-8 -*-</span>

<span style="color: #0000ff">import</span> redis                <span style="color: #008000">#</span><span style="color: #008000">导入操作redis模块</span>
<span style="color: #000000">
pool </span>= redis.ConnectionPool(host=<span style="color: #800000">'</span><span style="color: #800000">127.0.0.1</span><span style="color: #800000">'</span>, port=6379)  <span style="color: #008000">#</span><span style="color: #008000">配置连接池连接信息</span>
<span style="color: #000000">
r </span>= redis.Redis(connection_pool=pool)                       <span style="color: #008000">#</span><span style="color: #008000">连接连接池</span>
r.hmset(<span style="color: #800000">'</span><span style="color: #800000">foo</span><span style="color: #800000">'</span>,{<span style="color: #800000">'</span><span style="color: #800000">k1</span><span style="color: #800000">'</span>:<span style="color: #800000">'</span><span style="color: #800000">v1</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">k2</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">v2</span><span style="color: #800000">'</span>})                      <span style="color: #008000">#</span><span style="color: #008000">hmset(name, mapping)在name对应的hash中批量设置键值对</span>
<span style="color: #000000">
f </span>= r.<span style="background-color: #ff99cc">hgetall(<span style="color: #800000">'</span><span style="color: #800000">foo</span><span style="color: #800000">'</span>)</span>                                        <span style="color: #008000">#</span><span style="color: #008000">获取name对应hash的所有键值</span>
<span style="color: #0000ff">print</span><span style="color: #000000">(f)

</span><span style="color: #008000">#</span><span style="color: #008000">返回：</span><span style="color: #008000">
#</span><span style="color: #008000"> {b'k1': b'v1', b'k2': b'v2'}</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff">hlen(name)</span>获取name对应的hash中键值对的个数</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf-8 -*-</span>

<span style="color: #0000ff">import</span> redis                <span style="color: #008000">#</span><span style="color: #008000">导入操作redis模块</span>
<span style="color: #000000">
pool </span>= redis.ConnectionPool(host=<span style="color: #800000">'</span><span style="color: #800000">127.0.0.1</span><span style="color: #800000">'</span>, port=6379)  <span style="color: #008000">#</span><span style="color: #008000">配置连接池连接信息</span>
<span style="color: #000000">
r </span>= redis.Redis(connection_pool=pool)                       <span style="color: #008000">#</span><span style="color: #008000">连接连接池</span>
r.hmset(<span style="color: #800000">'</span><span style="color: #800000">foo</span><span style="color: #800000">'</span>,{<span style="color: #800000">'</span><span style="color: #800000">k1</span><span style="color: #800000">'</span>:<span style="color: #800000">'</span><span style="color: #800000">v1</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">k2</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">v2</span><span style="color: #800000">'</span>})                      <span style="color: #008000">#</span><span style="color: #008000">hmset(name, mapping)在name对应的hash中批量设置键值对</span>

<span style="color: #008000">#</span><span style="color: #008000"> f = r.hgetall('foo')                                        #获取name对应hash的所有键值</span>
<span style="color: #000000">
f </span>= r.<span style="background-color: #ff99cc">hlen(<span style="color: #800000">'</span><span style="color: #800000">foo</span><span style="color: #800000">'</span>)</span>                                             <span style="color: #008000">#</span><span style="color: #008000">hlen(name)获取name对应的hash中键值对的个数</span>
<span style="color: #0000ff">print</span><span style="color: #000000">(f)

</span><span style="color: #008000">#</span><span style="color: #008000">返回：</span><span style="color: #008000">
#</span><span style="color: #008000"> 2</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff">hkeys(name)</span>获取name对应的hash中所有的key的值</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf-8 -*-</span>

<span style="color: #0000ff">import</span> redis                <span style="color: #008000">#</span><span style="color: #008000">导入操作redis模块</span>
<span style="color: #000000">
pool </span>= redis.ConnectionPool(host=<span style="color: #800000">'</span><span style="color: #800000">127.0.0.1</span><span style="color: #800000">'</span>, port=6379)  <span style="color: #008000">#</span><span style="color: #008000">配置连接池连接信息</span>
<span style="color: #000000">
r </span>= redis.Redis(connection_pool=pool)                       <span style="color: #008000">#</span><span style="color: #008000">连接连接池</span>
r.hmset(<span style="color: #800000">'</span><span style="color: #800000">foo</span><span style="color: #800000">'</span>,{<span style="color: #800000">'</span><span style="color: #800000">k1</span><span style="color: #800000">'</span>:<span style="color: #800000">'</span><span style="color: #800000">v1</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">k2</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">v2</span><span style="color: #800000">'</span>})                      <span style="color: #008000">#</span><span style="color: #008000">hmset(name, mapping)在name对应的hash中批量设置键值对</span>

<span style="color: #008000">#</span><span style="color: #008000"> f = r.hgetall('foo')                                        #获取name对应hash的所有键值</span>
<span style="color: #000000">
f </span>= r.<span style="background-color: #ff99cc">hkeys(<span style="color: #800000">'</span><span style="color: #800000">foo</span><span style="color: #800000">'</span>)</span>                                            <span style="color: #008000">#</span><span style="color: #008000">hkeys(name)获取name对应的hash中所有的key</span>
<span style="color: #0000ff">print</span><span style="color: #000000">(f)

</span><span style="color: #008000">#</span><span style="color: #008000">返回：</span><span style="color: #008000">
#</span><span style="color: #008000"> [b'k2', b'k1']</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff">hvals(name)</span>获取name对应的hash中所有的value的值</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf-8 -*-</span>

<span style="color: #0000ff">import</span> redis                <span style="color: #008000">#</span><span style="color: #008000">导入操作redis模块</span>
<span style="color: #000000">
pool </span>= redis.ConnectionPool(host=<span style="color: #800000">'</span><span style="color: #800000">127.0.0.1</span><span style="color: #800000">'</span>, port=6379)  <span style="color: #008000">#</span><span style="color: #008000">配置连接池连接信息</span>
<span style="color: #000000">
r </span>= redis.Redis(connection_pool=pool)                       <span style="color: #008000">#</span><span style="color: #008000">连接连接池</span>
r.hmset(<span style="color: #800000">'</span><span style="color: #800000">foo</span><span style="color: #800000">'</span>,{<span style="color: #800000">'</span><span style="color: #800000">k1</span><span style="color: #800000">'</span>:<span style="color: #800000">'</span><span style="color: #800000">v1</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">k2</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">v2</span><span style="color: #800000">'</span>})                      <span style="color: #008000">#</span><span style="color: #008000">hmset(name, mapping)在name对应的hash中批量设置键值对</span>

<span style="color: #008000">#</span><span style="color: #008000"> f = r.hgetall('foo')                                        #获取name对应hash的所有键值</span>
<span style="color: #000000">
f </span>= r.<span style="background-color: #ff99cc">hvals(<span style="color: #800000">'</span><span style="color: #800000">foo</span><span style="color: #800000">'</span>)</span>                                            <span style="color: #008000">#</span><span style="color: #008000">hvals(name)获取name对应的hash中所有的value的值</span>
<span style="color: #0000ff">print</span><span style="color: #000000">(f)

</span><span style="color: #008000">#</span><span style="color: #008000">返回：</span><span style="color: #008000">
#</span><span style="color: #008000"> [b'v2', b'v1']</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff">hexists(name, key)</span>检查name对应的hash是否存在当前传入的key</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf-8 -*-</span>

<span style="color: #0000ff">import</span> redis                <span style="color: #008000">#</span><span style="color: #008000">导入操作redis模块</span>
<span style="color: #000000">
pool </span>= redis.ConnectionPool(host=<span style="color: #800000">'</span><span style="color: #800000">127.0.0.1</span><span style="color: #800000">'</span>, port=6379)  <span style="color: #008000">#</span><span style="color: #008000">配置连接池连接信息</span>
<span style="color: #000000">
r </span>= redis.Redis(connection_pool=pool)                       <span style="color: #008000">#</span><span style="color: #008000">连接连接池</span>
r.hmset(<span style="color: #800000">'</span><span style="color: #800000">foo</span><span style="color: #800000">'</span>,{<span style="color: #800000">'</span><span style="color: #800000">k1</span><span style="color: #800000">'</span>:<span style="color: #800000">'</span><span style="color: #800000">v1</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">k2</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">v2</span><span style="color: #800000">'</span>})                      <span style="color: #008000">#</span><span style="color: #008000">hmset(name, mapping)在name对应的hash中批量设置键值对</span>

<span style="color: #008000">#</span><span style="color: #008000"> f = r.hgetall('foo')                                        #获取name对应hash的所有键值</span>
<span style="color: #000000">
f </span>= r.<span style="background-color: #ff99cc">hexists(<span style="color: #800000">'</span><span style="color: #800000">foo</span><span style="color: #800000">'</span>,<span style="color: #800000">'</span><span style="color: #800000">k1</span><span style="color: #800000">'</span>)</span>                                          <span style="color: #008000">#</span><span style="color: #008000">hexists(name, key)检查name对应的hash是否存在当前传入的key</span>
<span style="color: #0000ff">print</span><span style="color: #000000">(f)

</span><span style="color: #008000">#</span><span style="color: #008000">返回：</span><span style="color: #008000">
#</span><span style="color: #008000">True</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff">hdel(name,*keys)</span>将name对应的hash中指定key的键值对删除</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf-8 -*-</span>

<span style="color: #0000ff">import</span> redis                <span style="color: #008000">#</span><span style="color: #008000">导入操作redis模块</span>
<span style="color: #000000">
pool </span>= redis.ConnectionPool(host=<span style="color: #800000">'</span><span style="color: #800000">127.0.0.1</span><span style="color: #800000">'</span>, port=6379)  <span style="color: #008000">#</span><span style="color: #008000">配置连接池连接信息</span>
<span style="color: #000000">
r </span>= redis.Redis(connection_pool=pool)                       <span style="color: #008000">#</span><span style="color: #008000">连接连接池</span>
r.hmset(<span style="color: #800000">'</span><span style="color: #800000">foo</span><span style="color: #800000">'</span>,{<span style="color: #800000">'</span><span style="color: #800000">k1</span><span style="color: #800000">'</span>:<span style="color: #800000">'</span><span style="color: #800000">v1</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">k2</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">v2</span><span style="color: #800000">'</span>})                      <span style="color: #008000">#</span><span style="color: #008000">hmset(name, mapping)在name对应的hash中批量设置键值对</span>
<span style="color: #000000">
r.<span style="background-color: #ff99cc">hdel(</span></span><span style="background-color: #ff99cc"><span style="color: #800000">'</span><span style="color: #800000">foo</span><span style="color: #800000">'</span>,<span style="color: #800000">'</span><span style="color: #800000">k1</span><span style="color: #800000">'</span>)</span>                                          <span style="color: #008000">#</span><span style="color: #008000">hdel(name,*keys)将name对应的hash中指定key的键值对删除</span>
<span style="color: #000000">
f </span>= r.hgetall(<span style="color: #800000">'</span><span style="color: #800000">foo</span><span style="color: #800000">'</span>)                                        <span style="color: #008000">#</span><span style="color: #008000">获取name对应hash的所有键值</span>
<span style="color: #0000ff">print</span><span style="color: #000000">(f)

</span><span style="color: #008000">#</span><span style="color: #008000">返回：</span><span style="color: #008000">
#</span><span style="color: #008000">{b'k2': b'v2'}</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff">hincrby(name, key, amount=1)</span>自增整数，name对应的hash中的指定key的值，不存在则创建key=amount</strong></span><br><strong>　　name，redis中的name</strong><br><strong>　　key， hash对应的key</strong><br><strong>　　amount，自增数（整数）</strong></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf-8 -*-</span>

<span style="color: #0000ff">import</span> redis                <span style="color: #008000">#</span><span style="color: #008000">导入操作redis模块</span>
<span style="color: #000000">
pool </span>= redis.ConnectionPool(host=<span style="color: #800000">'</span><span style="color: #800000">127.0.0.1</span><span style="color: #800000">'</span>, port=6379)  <span style="color: #008000">#</span><span style="color: #008000">配置连接池连接信息</span>
<span style="color: #000000">
r </span>= redis.Redis(connection_pool=pool)                       <span style="color: #008000">#</span><span style="color: #008000">连接连接池</span>
r.hmset(<span style="color: #800000">'</span><span style="color: #800000">foo</span><span style="color: #800000">'</span>,{<span style="color: #800000">'</span><span style="color: #800000">k1</span><span style="color: #800000">'</span>:<span style="color: #800000">'</span><span style="color: #800000">1</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">k2</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">v2</span><span style="color: #800000">'</span>})                      <span style="color: #008000">#</span><span style="color: #008000">hmset(name, mapping)在name对应的hash中批量设置键值对</span>
<span style="color: #000000">
r.<span style="background-color: #ff99cc">hincrby(</span></span><span style="background-color: #ff99cc"><span style="color: #800000">'</span><span style="color: #800000">foo</span><span style="color: #800000">'</span>,<span style="color: #800000">'</span><span style="color: #800000">k1</span><span style="color: #800000">'</span>,amount=1)</span>                              <span style="color: #008000">#</span><span style="color: #008000">hincrby(name, key, amount=1)自增整数，name对应的hash中的指定key的值，不存在则创建key=amount</span>
<span style="color: #000000">
f </span>= r.hgetall(<span style="color: #800000">'</span><span style="color: #800000">foo</span><span style="color: #800000">'</span>)                                        <span style="color: #008000">#</span><span style="color: #008000">获取name对应hash的所有键值</span>
<span style="color: #0000ff">print</span><span style="color: #000000">(f)

</span><span style="color: #008000">#</span><span style="color: #008000">返回：</span><span style="color: #008000">
#</span><span style="color: #008000">{b'k1': b'2', b'k2': b'v2'}</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff">hincrbyfloat(name, key, amount=1.0)</span>自增浮点数 name对应的hash中的指定key的值，不存在则创建key=amount</strong></span><br><strong>　　name，redis中的name</strong><br><strong>　　key， hash对应的key</strong><br><strong>　　amount，自增数（浮点数）</strong></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf-8 -*-</span>

<span style="color: #0000ff">import</span> redis                <span style="color: #008000">#</span><span style="color: #008000">导入操作redis模块</span>
<span style="color: #000000">
pool </span>= redis.ConnectionPool(host=<span style="color: #800000">'</span><span style="color: #800000">127.0.0.1</span><span style="color: #800000">'</span>, port=6379)  <span style="color: #008000">#</span><span style="color: #008000">配置连接池连接信息</span>
<span style="color: #000000">
r </span>= redis.Redis(connection_pool=pool)                       <span style="color: #008000">#</span><span style="color: #008000">连接连接池</span>
r.hmset(<span style="color: #800000">'</span><span style="color: #800000">foo</span><span style="color: #800000">'</span>,{<span style="color: #800000">'</span><span style="color: #800000">k1</span><span style="color: #800000">'</span>:<span style="color: #800000">'</span><span style="color: #800000; background-color: #ff99cc">1</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">k2</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">v2</span><span style="color: #800000">'</span>})                      <span style="color: #008000">#</span><span style="color: #008000">hmset(name, mapping)在name对应的hash中批量设置键值对</span>
<span style="color: #000000">
r.<span style="background-color: #ff99cc">hincrbyfloat(</span></span><span style="background-color: #ff99cc"><span style="color: #800000">'</span><span style="color: #800000">foo</span><span style="color: #800000">'</span>,<span style="color: #800000">'</span><span style="color: #800000">k1</span><span style="color: #800000">'</span>,amount=1.2)</span>                       <span style="color: #008000">#</span><span style="color: #008000">hincrbyfloat(name, key, amount=1.0)自增浮点数 name对应的hash中的指定key的值，不存在则创建key=amount</span>
<span style="color: #000000">
f </span>= r.hgetall(<span style="color: #800000">'</span><span style="color: #800000">foo</span><span style="color: #800000">'</span>)                                        <span style="color: #008000">#</span><span style="color: #008000">获取name对应hash的所有键值</span>
<span style="color: #0000ff">print</span><span style="color: #000000">(f)

</span><span style="color: #008000">#</span><span style="color: #008000">返回：</span><span style="color: #008000">
#</span><span style="color: #008000">{b'k1': b'<span style="background-color: #ff99cc">2.2</span>', b'k2': b'v2'}</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff">hscan(name, cursor=0, match=None, count=None)</span>增量式迭代获取，对于数据大的数据非常有用，hscan可以实现分片的获取数据，并非一次性将数据全部获取完，从而防止内存被撑爆</strong></span><br><strong>　　name，redis的name</strong><br><strong>　　cursor，游标（基于游标分批取获取数据）</strong><br><strong>　　match，匹配指定key，默认None 表示所有的key</strong><br><strong>　　count，每次分片最少获取个数，默认None表示采用Redis的默认分片个数</strong><br><strong>　　如：</strong><br><strong>　　第一次：cursor1, data1 = r.hscan('xx', cursor=0, match=None, count=None)</strong><br><strong>　　第二次：cursor2, data1 = r.hscan('xx', cursor=cursor1, match=None, count=None)</strong><br><strong>　　...</strong><br><strong>　　直到返回值cursor的值为0时，表示数据已经通过分片获取完毕</strong></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf-8 -*-</span>

<span style="color: #0000ff">import</span> redis                <span style="color: #008000">#</span><span style="color: #008000">导入操作redis模块</span>
<span style="color: #000000">
pool </span>= redis.ConnectionPool(host=<span style="color: #800000">'</span><span style="color: #800000">127.0.0.1</span><span style="color: #800000">'</span>, port=6379)  <span style="color: #008000">#</span><span style="color: #008000">配置连接池连接信息</span>
<span style="color: #000000">
r </span>= redis.Redis(connection_pool=pool)                            <span style="color: #008000">#</span><span style="color: #008000">连接连接池</span>
r.hmset(<span style="color: #800000">'</span><span style="color: #800000">foo</span><span style="color: #800000">'</span>,{<span style="color: #800000">'</span><span style="color: #800000">k1</span><span style="color: #800000">'</span>:<span style="color: #800000">'</span><span style="color: #800000">1</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">k2</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">v2</span><span style="color: #800000">'</span>,<span style="color: #800000">'</span><span style="color: #800000">m2</span><span style="color: #800000">'</span>:<span style="color: #800000">'</span><span style="color: #800000">mm</span><span style="color: #800000">'</span>})                  <span style="color: #008000">#</span><span style="color: #008000">hmset(name, mapping)在name对应的hash中批量设置键值对</span>
<span style="color: #000000"><span style="background-color: #ffff99">
cursor1</span>, data1 </span>= r.<span style="background-color: #ff99cc">hscan(<span style="color: #800000">'</span><span style="color: #800000">foo</span><span style="color: #800000">'</span>,cursor=0,match=<span style="color: #800000">'</span><span style="color: #800000">*2</span><span style="color: #800000">'</span>,count=None)</span>        <span style="color: #008000">#</span><span style="color: #008000">获取name对应的键，以2结尾的键</span>
<span style="color: #0000ff">print</span>(cursor1, data1)                                                 <span style="color: #008000">#</span><span style="color: #008000">返回两个值，第一个是获取的游标位置，第二个是获取到的数据</span>
<span style="color: #000000">
cursor2, data2 </span>= r.<span style="background-color: #ff99cc">hscan(<span style="color: #800000">'</span><span style="color: #800000">foo</span><span style="color: #800000">'</span>,cursor=<span style="background-color: #ffff99">cursor1</span>,match=<span style="color: #800000">'</span><span style="color: #800000">*2</span><span style="color: #800000">'</span>,count=None)</span>    <span style="color: #008000">#</span><span style="color: #008000">第二次获取，游标使用第一次返回的游标位置</span>
<span style="color: #0000ff">print</span><span style="color: #000000">(cursor2, data2)

</span><span style="color: #008000">#</span><span style="color: #008000">返回：</span><span style="color: #008000">
#</span><span style="color: #008000"> 0 {b'm2': b'mm', b'k2': b'v2'}</span><span style="color: #008000">
#</span><span style="color: #008000"> 0 {b'm2': b'mm', b'k2': b'v2'}</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff">hscan_iter(name, match=None, count=None)</span>利用yield封装hscan创建生成器，实现分批去redis中获取数据</strong></span><br><strong>　　match，匹配指定key，默认None 表示所有的key</strong><br><strong>　　count，每次分片最少获取个数，默认None表示采用Redis的默认分片个数</strong></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf-8 -*-</span>

<span style="color: #0000ff">import</span> redis                <span style="color: #008000">#</span><span style="color: #008000">导入操作redis模块</span>
<span style="color: #000000">
pool </span>= redis.ConnectionPool(host=<span style="color: #800000">'</span><span style="color: #800000">127.0.0.1</span><span style="color: #800000">'</span>, port=6379)  <span style="color: #008000">#</span><span style="color: #008000">配置连接池连接信息</span>
<span style="color: #000000">
r </span>= redis.Redis(connection_pool=pool)                            <span style="color: #008000">#</span><span style="color: #008000">连接连接池</span>
r.hmset(<span style="color: #800000">'</span><span style="color: #800000">foo</span><span style="color: #800000">'</span>,{<span style="color: #800000">'</span><span style="color: #800000">k1</span><span style="color: #800000">'</span>:<span style="color: #800000">'</span><span style="color: #800000">1</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">k2</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">v2</span><span style="color: #800000">'</span>,<span style="color: #800000">'</span><span style="color: #800000">m2</span><span style="color: #800000">'</span>:<span style="color: #800000">'</span><span style="color: #800000">mm</span><span style="color: #800000">'</span>})                  <span style="color: #008000">#</span><span style="color: #008000">hmset(name, mapping)在name对应的hash中批量设置键值对</span>

<span style="color: #0000ff">for</span> item <span style="color: #0000ff">in</span> r.<span style="background-color: #ff99cc">hscan_iter(<span style="color: #800000">'</span><span style="color: #800000">foo</span><span style="color: #800000">'</span></span><span style="color: #000000"><span style="background-color: #ff99cc">)</span>:
    </span><span style="color: #0000ff">print</span><span style="color: #000000">(item)

</span><span style="color: #008000">#</span><span style="color: #008000">返回：</span><span style="color: #008000">
#</span><span style="color: #008000"> (b'm2', b'mm')</span><span style="color: #008000">
#</span><span style="color: #008000"> (b'k2', b'v2')</span><span style="color: #008000">
#</span><span style="color: #008000"> (b'k1', b'1')</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>哈希类型设置过期时间</strong></span></p>
<p><span style="color: #ff0000"><strong>哈希类型只能将整个哈希表设置过期时间，过期后<strong>name对应里面的所有键值对就过期了</strong></strong></span></p>
<p><span style="color: #ff0000"><strong><strong><span style="color: #0000ff">expire(name,过期时间秒)</span>设置哈希表过期时间</strong></strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf-8 -*-</span>

<span style="color: #0000ff">import</span> redis                <span style="color: #008000">#</span><span style="color: #008000">导入操作redis模块</span>
<span style="color: #000000">
pool </span>= redis.ConnectionPool(host=<span style="color: #800000">'</span><span style="color: #800000">127.0.0.1</span><span style="color: #800000">'</span>, port=6379)  <span style="color: #008000">#</span><span style="color: #008000">配置连接池连接信息</span>
<span style="color: #000000">
r </span>= redis.Redis(connection_pool=pool)                            <span style="color: #008000">#</span><span style="color: #008000">连接连接池</span>
r.hmset(<span style="color: #800000">'</span><span style="color: #800000">foo</span><span style="color: #800000">'</span>,{<span style="color: #800000">'</span><span style="color: #800000">k1</span><span style="color: #800000">'</span>:<span style="color: #800000">'</span><span style="color: #800000">1</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">k2</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">v2</span><span style="color: #800000">'</span>,<span style="color: #800000">'</span><span style="color: #800000">m2</span><span style="color: #800000">'</span>:<span style="color: #800000">'</span><span style="color: #800000">mm</span><span style="color: #800000">'</span>})                  <span style="color: #008000">#</span><span style="color: #008000">hmset(name, mapping)在name对应的hash中批量设置键值对</span>
<span style="color: #000000">
r.<span style="background-color: #ff99cc">expire(</span></span><span style="background-color: #ff99cc"><span style="color: #800000">'</span><span style="color: #800000">foo</span><span style="color: #800000">'</span>,10)</span>                                               <span style="color: #008000">#</span><span style="color: #008000">expire(name,过期时间秒)设置哈希表过期时间</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong><span style="color: #0000ff">exists(name)</span>判断一个哈希名称是否存在</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000"> -*- coding:utf-8 -*-</span>

<span style="color: #0000ff">import</span> redis                <span style="color: #008000">#</span><span style="color: #008000">导入操作redis模块</span>
<span style="color: #000000">
pool </span>= redis.ConnectionPool(host=<span style="color: #800000">'</span><span style="color: #800000">127.0.0.1</span><span style="color: #800000">'</span>, port=6379)  <span style="color: #008000">#</span><span style="color: #008000">配置连接池连接信息</span>
<span style="color: #000000">
r </span>= redis.Redis(connection_pool=pool)                            <span style="color: #008000">#</span><span style="color: #008000">连接连接池</span>
r.hmset(<span style="color: #800000">'</span><span style="color: #800000">foo</span><span style="color: #800000">'</span>,{<span style="color: #800000">'</span><span style="color: #800000">k1</span><span style="color: #800000">'</span>:<span style="color: #800000">'</span><span style="color: #800000">1</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">k2</span><span style="color: #800000">'</span>: <span style="color: #800000">'</span><span style="color: #800000">v2</span><span style="color: #800000">'</span>,<span style="color: #800000">'</span><span style="color: #800000">m2</span><span style="color: #800000">'</span>:<span style="color: #800000">'</span><span style="color: #800000">mm</span><span style="color: #800000">'</span>})                  <span style="color: #008000">#</span><span style="color: #008000">hmset(name, mapping)在name对应的hash中批量设置键值对</span>
<span style="color: #000000">
ret </span>= r.<span style="background-color: #ff99cc">exists(<span style="color: #800000">'</span><span style="color: #800000">foo</span><span style="color: #800000">'</span>)</span>                                            <span style="color: #008000">#</span><span style="color: #008000">exists(name)判断一个哈希名称是否存在</span>
<span style="color: #0000ff">print</span><span style="color: #000000">(ret)
</span><span style="color: #008000">#</span><span style="color: #008000">返回</span><span style="color: #008000">
#</span><span style="color: #008000">True</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>Hash哈希类型结合cookie，实现session</strong></span></p>
<p><span style="color: #ff0000"><strong><strong>session封装模块</strong></strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000">coding:utf-8</span>

<span style="color: #0000ff">import</span> hashlib                                          <span style="color: #008000">#</span><span style="color: #008000">导入md5加密模块</span>
<span style="color: #0000ff">import</span> time                                             <span style="color: #008000">#</span><span style="color: #008000">导入时间模块</span>
<span style="color: #0000ff">import</span> redis                                            <span style="color: #008000">#</span><span style="color: #008000">导入操作redis缓存模块</span>
<span style="color: #000000">
pool </span>= redis.ConnectionPool(host=<span style="color: #800000">'</span><span style="color: #800000">127.0.0.1</span><span style="color: #800000">'</span>, port=6379)    <span style="color: #008000">#</span><span style="color: #008000">配置连接池连接信息</span>
<span style="color: #000000">
r </span>= redis.Redis(connection_pool=pool)                       <span style="color: #008000">#</span><span style="color: #008000">连接连接池</span>


<span style="color: #0000ff">class</span><span style="color: #000000"> Session:
    </span><span style="color: #0000ff">def</span> <span style="color: #800080">__init__</span><span style="color: #000000">(self,_self):
        </span><span style="color: #800000">"""</span><span style="color: #800000">
        self._self = _self 接收创建Session时传进来的对象，也就是继承对象
        self.cookie 设置self.cookie名称
        self.guo_qi 设置cookie和Redis过期时间
        self.sui_ji 接收随机密串
        </span><span style="color: #800000">"""</span><span style="color: #000000">
        self._self </span>=<span style="color: #000000"> _self
        self.cookie </span>= <span style="color: #800000">"</span><span style="color: #800000">_session_</span><span style="color: #800000">"</span><span style="color: #000000">
        self.guo_qi </span>= 60<span style="color: #000000">
        self.redis_guo_qi </span>=<span style="color: #000000"> self.guo_qi
        self.cookie_guo_qi </span>= time.time() +<span style="color: #000000"> self.guo_qi
        self.sui_ji </span>=<span style="color: #000000"> self.suiji_str


    @property  </span><span style="color: #008000">#</span><span style="color: #008000"> 声明特性方法，执行方法是不用写括号</span>
    <span style="color: #0000ff">def</span><span style="color: #000000"> suiji_str(self):
        </span><span style="color: #800000">"""</span><span style="color: #800000">
        返回值：随机密串
        uiji_str 生成随机密串方法
        </span><span style="color: #800000">"""</span><span style="color: #000000">
        obj </span>=<span style="color: #000000"> hashlib.md5()
        obj.update(bytes(str(time.time()), encoding</span>=<span style="color: #800000">'</span><span style="color: #800000">utf-8</span><span style="color: #800000">'</span><span style="color: #000000">))
        random_str </span>=<span style="color: #000000"> obj.hexdigest()
        </span><span style="color: #0000ff">return</span><span style="color: #000000"> random_str


    </span><span style="color: #0000ff">def</span><span style="color: #000000"> chuang_jian(self):
        </span><span style="color: #800000">"""</span><span style="color: #800000">
        返回值：无
        chuang_jian() 创建浏览器cookie和生成Redis缓冲哈希表
        </span><span style="color: #800000">"""</span><span style="color: #000000">
        self._self.set_cookie(self.cookie, self.sui_ji, expires</span>=<span style="color: #000000">self.cookie_guo_qi)
        r.hset(self.sui_ji, </span><span style="color: #800000">'</span><span style="color: #800000">deng_lu_zhuang_tai</span><span style="color: #800000">'</span><span style="color: #000000">, None)
        r.expire(self.sui_ji, self.redis_guo_qi)


    </span><span style="color: #0000ff">def</span> <span style="color: #800080">__setitem__</span><span style="color: #000000">(self, key, value):
        </span><span style="color: #800000">"""</span><span style="color: #800000">
        返回值：无
        接收键和值设置cookie值对应在Redis缓存的哈希表名称里的键值对
        使用方式：
        session对象[键]=值，如:session['deng_lu_zhuang_tai'] = True
        </span><span style="color: #800000">"""</span>
        <span style="color: #0000ff">if</span> <span style="color: #0000ff">not</span><span style="color: #000000"> r.exists(self._self.get_cookie(self.cookie)):
            self.chuang_jian()
            r.hset(self.sui_ji, key, value)
        </span><span style="color: #0000ff">if</span><span style="color: #000000"> r.exists(self._self.get_cookie(self.cookie)):
            r.hset(self._self.get_cookie(self.cookie), key, value)


    </span><span style="color: #0000ff">def</span> <span style="color: #800080">__getitem__</span><span style="color: #000000">(self,key):
        </span><span style="color: #800000">"""</span><span style="color: #800000">
        使用方法：Session对象[xxx]
        功能：获取cookie对应Redis缓存里哈希表名称里的指定键的值，键为接收到参数的值，存在返回值，不存在返回None
        </span><span style="color: #800000">"""</span>
        <span style="color: #0000ff">if</span> <span style="color: #0000ff">not</span><span style="color: #000000"> r.exists(self._self.get_cookie(self.cookie)):
            </span><span style="color: #0000ff">return</span><span style="color: #000000"> None
        </span><span style="color: #0000ff">else</span><span style="color: #000000">:
            fanui </span>=<span style="color: #000000"> r.hget(self._self.get_cookie(self.cookie), key)
            </span><span style="color: #0000ff">if</span> <span style="color: #0000ff">not</span><span style="color: #000000"> fanui:
                </span><span style="color: #0000ff">return</span><span style="color: #000000"> None
            </span><span style="color: #0000ff">else</span><span style="color: #000000">:
                </span><span style="color: #0000ff">return</span> fanui.decode(<span style="color: #800000">"</span><span style="color: #800000">utf-8</span><span style="color: #800000">"</span>)</pre>
</div>
<p><span style="color: #ff0000"><strong>Tornado框架逻辑处理</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000">coding:utf-8</span>

<span style="color: #0000ff">import</span><span style="color: #000000"> tornado.ioloop
</span><span style="color: #0000ff">import</span> tornado.web                              <span style="color: #008000">#</span><span style="color: #008000">导入tornado模块下的web文件</span>
<span style="color: #0000ff">import</span> session as se                            <span style="color: #008000">#</span><span style="color: #008000">导入Session模块</span>




<span style="color: #0000ff">class</span> indexHandler(tornado.web.RequestHandler):  <span style="color: #008000">#</span><span style="color: #008000">定义一个类，继承tornado.web下的RequestHandler类</span>
    <span style="color: #0000ff">def</span> get(self):                                              <span style="color: #008000">#</span><span style="color: #008000">get()方法，接收get方式请求</span>
        <span style="background-color: #ff99cc">session =<span style="color: #000000"> se.Session(self)
        </span><span style="color: #0000ff">if</span> session[<span style="color: #800000">'</span><span style="color: #800000">deng_lu_zhuang_tai</span><span style="color: #800000">'</span>]:</span>                       <span style="color: #008000">#</span><span style="color: #008000">判断当前用户session里的登录状态</span>
            self.render(<span style="color: #800000">"</span><span style="color: #800000">index.html</span><span style="color: #800000">"</span>)                           <span style="color: #008000">#</span><span style="color: #008000"> 显示index.html文件  #显示查看页面</span>
        <span style="color: #0000ff">else</span><span style="color: #000000">:
            self.redirect(</span><span style="color: #800000">"</span><span style="color: #800000">/dlu</span><span style="color: #800000">"</span><span style="color: #000000">)


</span><span style="color: #0000ff">class</span><span style="color: #000000"> dluHandler(tornado.web.RequestHandler):
    </span><span style="color: #0000ff">def</span><span style="color: #000000"> get(self):
        <span style="background-color: #ff99cc">session </span></span><span style="background-color: #ff99cc">=<span style="color: #000000"> se.Session(self)
        </span><span style="color: #0000ff">if</span> session[<span style="color: #800000">'</span><span style="color: #800000">deng_lu_zhuang_tai</span><span style="color: #800000">'</span>]:</span>                       <span style="color: #008000">#</span><span style="color: #008000">判断当前用户session里的登录状态</span>
            self.redirect(<span style="color: #800000">"</span><span style="color: #800000">/index</span><span style="color: #800000">"</span>)                             <span style="color: #008000">#</span><span style="color: #008000">跳转查看页面</span>
        <span style="color: #0000ff">else</span><span style="color: #000000">:
            self.render(</span><span style="color: #800000">"</span><span style="color: #800000">dlu.html</span><span style="color: #800000">"</span><span style="color: #000000">)

    </span><span style="color: #0000ff">def</span><span style="color: #000000"> post(self):
        <span style="background-color: #ff99cc">session </span></span><span style="background-color: #ff99cc">=<span style="color: #000000"> se.Session(self)
        </span><span style="color: #0000ff">if</span> session[<span style="color: #800000">'</span><span style="color: #800000">deng_lu_zhuang_tai</span><span style="color: #800000">'</span></span><span style="color: #000000"><span style="background-color: #ff99cc">]:</span>
            self.redirect(</span><span style="color: #800000">"</span><span style="color: #800000">/index</span><span style="color: #800000">"</span><span style="color: #000000">)
        </span><span style="color: #0000ff">else</span><span style="color: #000000">:
            yong_hu_ming </span>= self.get_argument(<span style="color: #800000">'</span><span style="color: #800000">yhm</span><span style="color: #800000">'</span>)                 <span style="color: #008000">#</span><span style="color: #008000">接收用户输入的登录账号</span>
            mi_ma = self.get_argument(<span style="color: #800000">'</span><span style="color: #800000">mim</span><span style="color: #800000">'</span>)                        <span style="color: #008000">#</span><span style="color: #008000">接收用户输入的登录密码</span>
            <span style="background-color: #ff99cc">session[<span style="color: #800000">'</span><span style="color: #800000">yong_hu_ming</span><span style="color: #800000">'</span>] =</span><span style="color: #000000"><span style="background-color: #ff99cc"> yong_hu_ming</span>
            <span style="background-color: #ff99cc">session[</span></span><span style="background-color: #ff99cc"><span style="color: #800000">'</span><span style="color: #800000">mi_ma</span><span style="color: #800000">'</span>] =</span><span style="color: #000000"><span style="background-color: #ff99cc"> mi_ma</span>
            <span style="background-color: #ff99cc">session[</span></span><span style="background-color: #ff99cc"><span style="color: #800000">'</span><span style="color: #800000">deng_lu_zhuang_tai</span><span style="color: #800000">'</span>] =</span><span style="color: #000000"><span style="background-color: #ff99cc"> True</span>
            <span style="background-color: #ff99cc">self.redirect(</span></span><span style="background-color: #ff99cc"><span style="color: #800000">"</span><span style="color: #800000">/index</span><span style="color: #800000">"</span></span><span style="color: #000000"><span style="background-color: #ff99cc">)</span>



settings </span>= {                                        <span style="color: #008000">#</span><span style="color: #008000">html文件归类配置，设置一个字典</span>
    <span style="color: #800000">"</span><span style="color: #800000">template_path</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">views</span><span style="color: #800000">"</span>,                     <span style="color: #008000">#</span><span style="color: #008000">键为template_path固定的，值为要存放HTML的文件夹名称</span>
    <span style="color: #800000">"</span><span style="color: #800000">static_path</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">statics</span><span style="color: #800000">"</span>,                         <span style="color: #008000">#</span><span style="color: #008000">键为static_path固定的，值为要存放js和css的文件夹名称</span>
    <span style="color: #800000">"</span><span style="color: #800000">cookie_secret</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">61oETzKXQAGaYdkL5gEmGeJJY</span><span style="color: #800000">"</span><span style="color: #000000">,
}

</span><span style="color: #008000">#</span><span style="color: #008000">路由映射</span>
application = tornado.web.Application([         <span style="color: #008000">#</span><span style="color: #008000">创建一个变量等于tornado.web下的Application方法</span>
    (r<span style="color: #800000">"</span><span style="color: #800000">/index</span><span style="color: #800000">"</span>, indexHandler),                   <span style="color: #008000">#</span><span style="color: #008000">判断用户请求路径后缀是否匹配字符串index,如果匹配执行MainHandler方法</span>
    (r<span style="color: #800000">"</span><span style="color: #800000">/dlu</span><span style="color: #800000">"</span><span style="color: #000000">, dluHandler),

],</span>**settings)                                   <span style="color: #008000">#</span><span style="color: #008000">将html文件归类配置字典，写在路由映射的第二个参数里</span>

<span style="color: #0000ff">if</span> <span style="color: #800080">__name__</span> == <span style="color: #800000">"</span><span style="color: #800000">__main__</span><span style="color: #800000">"</span><span style="color: #000000">:
    </span><span style="color: #008000">#</span><span style="color: #008000">内部socket运行起来</span>
    application.listen(8888)                    <span style="color: #008000">#</span><span style="color: #008000">设置端口</span>
    tornado.ioloop.IOLoop.instance().start()</pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000"><strong>实现用户登录后，每次访问一个页面让Hash哈希表和合cookie过期时间累加</strong></span></p>
<p><span style="color: #000000"><strong>在<strong>Tornado框架逻辑处理，配置好html模板可以调用的py模块</strong></strong></span></p>
<p><span style="color: #000000"><strong><strong>在<strong><strong>py模块定义一个执行函数，函数里获取到客户<strong>cookie值，根据<strong>cookie值找到Redis里对应的哈希表</strong></strong></strong></strong></strong></strong></span></p>
<p><span style="color: #000000"><strong><strong><strong><strong><strong><strong>将<strong><strong><strong><strong><strong>cookie时间累加，在将<strong><strong><strong><strong><strong><strong>Redis里对应的哈希表时间累加</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></span></p>
<p><span style="color: #000000"><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>最后在网站的html模板通用区域执行这个函数实现过期时间累加</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></span></p>
<p>&nbsp;</p></div>