第二百七十四节，同源策略和跨域Ajax


			<div id="cnblogs_post_body" class="blogpost-body"><p><strong>同源策略和跨域<strong>Ajax</strong></strong></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>什么是同源<strong>策略</strong></strong></span></p>
<div>&nbsp;<strong>尽管浏览器的安全措施多种多样，但是要想黑掉一个Web应用，只要在浏览器的多种安全措施中找到某种措施的一个漏洞或者绕过一种安全措施的方法即可。浏览器的各种保安措施之间都试图保持相互独立，但是攻击者只要能在出错的地方注入少许JavaScript，所有安全控制几乎全部瓦解——最后还起作用的就是最弱的安全防线：同源策略。同源策略管辖着所有保安措施，然而，由于浏览器及其插件，诸如Acrobat Reader、Flash 和Outlook Express漏洞频出，致使同源策略也频频告破。</strong></div>
<div><strong>&nbsp; 既然web应用的最弱安全防线是同源策略，那什么是同源策略呢？如何去攻破同源策略呢？如何黑web应用呢？</strong></div>
<div><strong>&nbsp;&nbsp;同源策略，它是由Netscape提出的一个著名的安全策略。所有支持javascript的网站都会使用同源策略来保护自己的web应用。</strong></div>
<div><strong>&nbsp; 同源策略又名同域策略，通俗易懂的来说，同源就是（主机名+协议+端口号【若存在】）三者相同。也就是说javascript只可以操作自己域下的东西，不能操作其他域下的东西。比如百度下javascript是不可操作谷歌下的页面。</strong></div>
<div><br>
</div>
<div><strong>&nbsp; 那为什么要同源策略呢？</strong></div>
<div><strong>&nbsp; 如上述所述，同源策略，javascript操作自己web应用，不得操作别人web应用。既然如此，也就是别人无法操作自己web应用，是保证web安全的一种方式。</strong></div>
<div><strong>&nbsp; 假设别人可以操作自己web应用，试想是否很可怕？假如你打开网银页面，蹦出一个恶意广告，当你关闭广告，若没有同源策略，是不是代表恶意广告会操作你网银页面，通过javascript窃取你网银的信息。</strong></div>
<div><strong>&nbsp; 那了解了同源策略，下面举几个url判断是否在同一个域中。</strong></div>
<div><strong>&nbsp; 假设url地址：http://store.company.com/dir/page.html检测下面是否他的同源地址。</strong></div>
<div><strong>&nbsp; 其url的协议：http；主机名：store.company.com 端口号没有或者其相应服务器的默认值</strong></div>
<p><strong>

<br></strong></p>
<div>
<table style="width: 100%" border="1" cellspacing="0" cellpadding="2">
<tbody>
<tr>
<td valign="top"><strong>URL</strong></td>
<td valign="top"><strong>结果</strong></td>
<td valign="top"><strong>原因</strong></td>



















</tr>
<tr>
<td valign="top"><strong>http://store.company.com/dir2/other.html</strong></td>
<td valign="top"><strong>是</strong></td>
<td valign="top"><br>
</td>



















</tr>
<tr>
<td valign="top"><strong>http://store.company.com/dir/inner/another.html</strong></td>
<td valign="top"><strong>是</strong></td>
<td valign="top"><br>
</td>



















</tr>
<tr>
<td valign="top"><strong>https://store.company.com/secure.html</strong></td>
<td valign="top"><strong>不是</strong></td>
<td valign="top"><strong>协议不相同</strong></td>



















</tr>
<tr>
<td valign="top"><strong>http://store.company.com:81/dir/etc.html</strong></td>
<td valign="top"><strong>不是</strong></td>
<td valign="top"><strong>端口号不相同</strong></td>



















</tr>
<tr>
<td valign="top"><strong>http://news.company.com/dir/other.html</strong></td>
<td valign="top"><strong>不是</strong></td>
<td valign="top"><strong>主机名不相同</strong></td>



















</tr>



















</tbody>



















</table>
<div><br>
</div>
<div><img src="https://images2015.cnblogs.com/blog/955761/201705/955761-20170528100013594-1057565942.jpg" alt=""></div>



















</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div><span style="color: #ff0000"><strong>违背了同源策略，有些跨域请求会被浏览器拦截的</strong></span></div>
<div>&nbsp;</div>
<div><span style="color: #ff0000"><strong>在浏览器中，&lt;script&gt;、&lt;img&gt;、&lt;iframe&gt;、&lt;link&gt;等标签都可以加载跨域资源，而不受同源限制，但浏览器限制了JavaScript的权限使其不能读、写加载的内容。也就是说不同源的<strong>JavaScript是无法获取HTML元素，和<strong>JavaScript通讯请求的</strong></strong></strong></span></div>
<div><em id="__mceDel"><span style="color: #ff0000"><strong>&nbsp;&nbsp;</strong></span></em></div>
<div><span style="color: #ff0000"><strong>另外同源策略只对网页的HTML文档做了限制，对加载的其他静态资源如javascript、css、图片等仍然认为属于同源。</strong></span></div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div><span style="color: #ff0000; background-color: #ffff00"><strong>下面讲解ajax跨域请求被阻止</strong></span></div>
<div>&nbsp;</div>
<div><span style="color: #0000ff; background-color: #ffffff"><strong>举例：</strong></span></div>
<div><span style="color: #0000ff; background-color: #ffffff"><strong>首先在本地hosts文件配置两个域名访问IP作为测试用</strong></span></div>
<div>
<p>127.0.0.1 www.fwd.com <br>127.0.0.1  www.khd.com </p>
<p><img src="https://images2015.cnblogs.com/blog/955761/201705/955761-20170528103331016-931118909.png" alt=""></p>













</div>
<div>&nbsp;</div>
<div><span style="color: #000000; background-color: #ffffff"><strong>在 <span style="color: #0000ff">http://www.khd.com:8002/khd</span> 文件里用<strong>ajax请求<span style="color: #0000ff">http://www.fwd.com:8001/fwd</span></strong></strong></span></div>
<div>&nbsp;</div>
<div><span style="color: #000000; background-color: #ffffff"><strong><strong><strong>http://www.khd.com:8002/khd</strong></strong></strong></span></div>
<div>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">&lt;!</span><span style="color: #ff00ff">DOCTYPE html</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">html </span><span style="color: #ff0000">lang</span><span style="color: #0000ff">="en"</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">head</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">meta </span><span style="color: #ff0000">charset</span><span style="color: #0000ff">="UTF-8"</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">title</span><span style="color: #0000ff">&gt;</span>Title<span style="color: #0000ff">&lt;/</span><span style="color: #800000">title</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">script </span><span style="color: #ff0000">type</span><span style="color: #0000ff">="text/javascript"</span><span style="color: #ff0000"> src</span><span style="color: #0000ff">='{{static_url("jquery.min.js")}}' </span><span style="color: #ff0000">charset</span><span style="color: #0000ff">="UTF-8"</span><span style="color: #0000ff">&gt;&lt;/</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">head</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">body</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">input </span><span style="color: #ff0000">type</span><span style="color: #0000ff">="button"</span><span style="color: #ff0000"> value</span><span style="color: #0000ff">="提交"</span><span style="color: #ff0000"> onclick</span><span style="color: #0000ff">="doajax();"</span><span style="color: #0000ff">/&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span>
    <span style="background-color: #ff99cc"><span style="color: #0000ff">function</span><span style="color: #000000"> doajax() {
        $.ajax({
            url: </span><span style="color: #000000">'</span><span style="color: #000000; background-color: #ffff00">http://www.fwd.com:8001/fwd</span><span style="color: #000000">'</span><span style="color: #000000">,
            type: </span><span style="color: #000000">'</span><span style="color: #000000">POST</span><span style="color: #000000">'</span><span style="color: #000000">,
            data:{</span><span style="color: #000000">'</span><span style="color: #000000">k1</span><span style="color: #000000">'</span><span style="color: #000000">:</span><span style="color: #000000">'</span><span style="color: #000000">v1</span><span style="color: #000000">'</span><span style="color: #000000">},
            success: </span><span style="color: #0000ff">function</span><span style="color: #000000"> (responseText, statusText) {
            },
            error: </span><span style="color: #0000ff">function</span><span style="color: #000000"> (event, errorText, errorType) {

            }
        });
    }
</span></span><span style="color: #0000ff">&lt;/</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">body</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">html</span><span style="color: #0000ff">&gt;</span></pre>
</div>
<p><strong><strong>http://www.fwd.com:8001/fwd</strong></strong></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">&lt;!</span><span style="color: #ff00ff">DOCTYPE html</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">html </span><span style="color: #ff0000">lang</span><span style="color: #0000ff">="en"</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">head</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">meta </span><span style="color: #ff0000">charset</span><span style="color: #0000ff">="UTF-8"</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">title</span><span style="color: #0000ff">&gt;</span>Title<span style="color: #0000ff">&lt;/</span><span style="color: #800000">title</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">script </span><span style="color: #ff0000">type</span><span style="color: #0000ff">="text/javascript"</span><span style="color: #ff0000"> src</span><span style="color: #0000ff">='{{static_url("jquery.min.js")}}' </span><span style="color: #ff0000">charset</span><span style="color: #0000ff">="UTF-8"</span><span style="color: #0000ff">&gt;&lt;/</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">script </span><span style="color: #ff0000">type</span><span style="color: #0000ff">="text/javascript"</span><span style="color: #ff0000"> src</span><span style="color: #0000ff">='{{static_url("jquery.form.js")}}' </span><span style="color: #ff0000">charset</span><span style="color: #0000ff">="UTF-8"</span><span style="color: #0000ff">&gt;&lt;/</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">head</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">body</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">
服务端
</span><span style="color: #0000ff">&lt;</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span>

<span style="color: #0000ff">&lt;/</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">body</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">html</span><span style="color: #0000ff">&gt;</span></pre>
</div>
<p><strong>此时点击按钮发起<strong>ajax请求后，</strong>可以看到请求已被浏览器的同源策略阻止</strong></p>
<p><strong><img src="https://images2015.cnblogs.com/blog/955761/201705/955761-20170528104136532-2078477153.png" alt=""></strong></p>
</div>
<div>&nbsp;</div>
<div><span style="color: #0000ff"><strong>跨域阻止原理图</strong></span></div>
<div><span style="color: #0000ff"><strong><img src="https://images2015.cnblogs.com/blog/955761/201705/955761-20170528105833953-1899186829.png" alt=""></strong></span></div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div><span style="color: #ff0000; background-color: #ffff00"><strong>&nbsp;突破浏览器同源策略ajax跨域请求，<strong>有两个办法</strong></strong></span></div>
<div>&nbsp;</div>
<div><span style="color: #ff0000; background-color: #ffff00"><strong>办法一、JSONP方式</strong></span></div>
<div>&nbsp;</div>
<div><span style="color: #ff0000; background-color: #ffffff"><strong>自定义<strong>JSONP</strong>跨域请求数据</strong></span></div>
<div>&nbsp;</div>
<div><span style="color: #ff0000; background-color: #ffffff"><strong>只能是get方法的请求，也就是利用script标签和script标签的src发送<strong>get请求</strong></strong></span></div>
<div><span style="color: #ff0000; background-color: #ffffff"><strong><strong>1在要请求数据的页面用js创建一个<strong>script标签src等于要请求数据的地址</strong></strong></strong></span></div>
<div><span style="color: #ff0000; background-color: #ffffff"><strong><strong><strong>2响应页面返回的必须是一个带有参数的函数名称</strong></strong></strong></span></div>
<div><span style="color: #ff0000; background-color: #ffffff"><strong><strong><strong>3自定义对应响应页面返回的函数，这样自定义的函数也就会执行了，就能得到数据</strong></strong></strong></span></div>
<div><span style="color: #0000ff; background-color: #ffffff"><strong>请求页面</strong></span></div>
<div>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">&lt;!</span><span style="color: #ff00ff">DOCTYPE html</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">html </span><span style="color: #ff0000">lang</span><span style="color: #0000ff">="en"</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">head</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">meta </span><span style="color: #ff0000">charset</span><span style="color: #0000ff">="UTF-8"</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">title</span><span style="color: #0000ff">&gt;</span>Title<span style="color: #0000ff">&lt;/</span><span style="color: #800000">title</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">script </span><span style="color: #ff0000">type</span><span style="color: #0000ff">="text/javascript"</span><span style="color: #ff0000"> src</span><span style="color: #0000ff">='{{static_url("jquery.min.js")}}' </span><span style="color: #ff0000">charset</span><span style="color: #0000ff">="UTF-8"</span><span style="color: #0000ff">&gt;&lt;/</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">head</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">body</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">input </span><span style="color: #ff0000">type</span><span style="color: #0000ff">="button"</span><span style="color: #ff0000"> value</span><span style="color: #0000ff">="跨域提交"</span><span style="color: #ff0000; background-color: #ff99cc"> onclick</span><span style="color: #0000ff"><span style="background-color: #ff99cc">="doajax();</span>"</span><span style="color: #0000ff">/&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span>
    <strong><span style="background-color: #f5f5f5; color: #008000">//</span><span style="background-color: #f5f5f5; color: #008000">利用原生js自己创建一个跨域请求</span></strong>
    <span style="background-color: #ff99cc"><span style="color: #0000ff">function</span><span style="color: #000000"> doajax() {                                 </span><span style="color: #008000">//</span><span style="color: #008000">当点击提交按钮是执行函数</span>
        <span style="color: #0000ff">var</span><span style="color: #000000"> tag </span><span style="color: #000000">=</span><span style="color: #000000"> document.createElement(</span><span style="color: #000000">'</span><span style="color: #000000">script</span><span style="color: #000000">'</span><span style="color: #000000">);     </span><span style="color: #008000">//</span><span style="color: #008000">创建一个script标签</span>
<span style="color: #000000">        tag.src </span><span style="color: #000000">=</span> <span style="color: #000000">'</span><span style="color: #000000">http://www.fwd.com:8001/fwd</span><span style="color: #000000">'</span><span style="color: #000000">;        </span><span style="color: #008000">//</span><span style="color: #008000">设置script标签的src地址，为要请求数据的地址,因为src是不受同源策略</span>
<span style="color: #000000">        document.head.appendChild(tag);                 </span><span style="color: #008000">//</span><span style="color: #008000">将script标签添加到head标签里面</span>
<span style="color: #000000">        document.head.removeChild(tag);                 </span><span style="color: #008000">//</span><span style="color: #008000">添加后会立即发送请求，所以这里可以将添加的script标签删除了</span></span>
<span style="background-color: #f5f5f5; color: #000000">    }
    </span><strong><span style="background-color: #f5f5f5; color: #008000">//</span><span style="background-color: #f5f5f5; color: #008000">响应网站返回，shuju({'k1':'v1'});  也就相当于返回了一个带有参数的函数名称</span></strong>
    <span style="background-color: #ff99cc"><span style="color: #0000ff">function</span><span style="color: #000000"> shuju(shj) {                               </span><span style="color: #008000">//</span><span style="color: #008000">自定义执行函数，和响应网站返回的名称相同，也就会执行自定义函数，而参数就是响应网站返回的数据</span>
        <span style="color: #0000ff">for</span><span style="color: #000000">(</span><span style="color: #0000ff">var</span><span style="color: #000000"> i </span><span style="color: #0000ff">in</span><span style="color: #000000"> shj){                              </span><span style="color: #008000">//</span><span style="color: #008000">循环响应网站返回的数据</span>
<span style="color: #000000">            alert(i </span><span style="color: #000000">+</span> <span style="color: #000000">'</span><span style="color: #000000">:</span><span style="color: #000000">'</span> <span style="color: #000000">+</span><span style="color: #000000"> shj[i]);                    </span><span style="color: #008000">//</span><span style="color: #008000">打印出数据的键和值</span>
<span style="color: #000000">        }
    }
</span></span><span style="color: #0000ff">&lt;/</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">body</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">html</span><span style="color: #0000ff">&gt;</span></pre>
</div>
<p><span style="color: #0000ff"><strong>响应端</strong></span></p>
</div>
<div>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">import</span><span style="color: #000000"> tornado.ioloop
</span><span style="color: #0000ff">import</span> tornado.web                                              <span style="color: #008000">#</span><span style="color: #008000">导入tornado模块下的web文件</span>


<span style="color: #0000ff">class</span><span style="color: #000000"> fwdHandler(tornado.web.RequestHandler):
    </span><span style="background-color: #ff99cc"><span style="color: #0000ff">def</span> get(self):                                      <span style="color: #008000">#</span><span style="color: #008000">接收get请求</span>
        <span style="color: #008000">#</span><span style="color: #008000"> self.render("fwd.html")</span>
        self.write(<span style="color: #800000">"</span><span style="color: #800000">shuju({'k1':'v1'});</span><span style="color: #800000">"</span>)               <span style="color: #008000">#</span></span><span style="color: #008000"><span style="background-color: #ff99cc">返回数据</span>  </span>
    <span style="color: #0000ff">def</span><span style="color: #000000"> post(self):
        self.write(</span><span style="color: #800000">"</span><span style="color: #800000">post请求成功</span><span style="color: #800000">"</span><span style="color: #000000">)

settings </span>= {                                            <span style="color: #008000">#</span><span style="color: #008000">html文件归类配置，设置一个字典</span>
    <span style="color: #800000">"</span><span style="color: #800000">template_path</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">views</span><span style="color: #800000">"</span>,                            <span style="color: #008000">#</span><span style="color: #008000">键为template_path固定的，值为要存放HTML的文件夹名称</span>
    <span style="color: #800000">"</span><span style="color: #800000">static_path</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">statics</span><span style="color: #800000">"</span>,                            <span style="color: #008000">#</span><span style="color: #008000">键为static_path固定的，值为要存放js和css的文件夹名称</span>
<span style="color: #000000">}

</span><span style="color: #008000">#</span><span style="color: #008000">路由映射</span>
application = tornado.web.Application([                 <span style="color: #008000">#</span><span style="color: #008000">创建一个变量等于tornado.web下的Application方法</span>
    (r<span style="color: #800000">"</span><span style="color: #800000">/fwd</span><span style="color: #800000">"</span><span style="color: #000000">, fwdHandler),
],</span>**settings)                                           <span style="color: #008000">#</span><span style="color: #008000">将html文件归类配置字典，写在路由映射的第二个参数里</span>

<span style="color: #0000ff">if</span> <span style="color: #800080">__name__</span> == <span style="color: #800000">"</span><span style="color: #800000">__main__</span><span style="color: #800000">"</span><span style="color: #000000">:
    </span><span style="color: #008000">#</span><span style="color: #008000">内部socket运行起来</span>
    application.listen(8001)                            <span style="color: #008000">#</span><span style="color: #008000">设置端口</span>
    tornado.ioloop.IOLoop.instance().start()</pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201705/955761-20170528142937578-1242567834.png" alt=""></p>
</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div><span style="color: #ff0000"><strong><strong>ajax的</strong>JSONP方式</strong></span></div>
<div><span style="color: #ff0000"><strong><strong><strong>ajax跨域请求本质上就是上面我们自定义跨域的方式，只不过<strong><strong><strong>ajax帮我们封装好了，不用我们去创建<strong>script标签</strong></strong></strong></strong></strong></strong></strong></span></div>
<div><span style="color: #0000ff"><strong>请求页面</strong></span></div>
<div>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">&lt;!</span><span style="color: #ff00ff">DOCTYPE html</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">html </span><span style="color: #ff0000">lang</span><span style="color: #0000ff">="en"</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">head</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">meta </span><span style="color: #ff0000">charset</span><span style="color: #0000ff">="UTF-8"</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">title</span><span style="color: #0000ff">&gt;</span>Title<span style="color: #0000ff">&lt;/</span><span style="color: #800000">title</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">script </span><span style="color: #ff0000">type</span><span style="color: #0000ff">="text/javascript"</span><span style="color: #ff0000"> src</span><span style="color: #0000ff">='{{static_url("jquery.min.js")}}' </span><span style="color: #ff0000">charset</span><span style="color: #0000ff">="UTF-8"</span><span style="color: #0000ff">&gt;&lt;/</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">head</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">body</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">input </span><span style="color: #ff0000">type</span><span style="color: #0000ff">="button"</span><span style="color: #ff0000"> value</span><span style="color: #0000ff">="跨域提交"</span><span style="color: #ff0000; background-color: #ff99cc"> onclick</span><span style="color: #0000ff"><span style="background-color: #ff99cc">="doajax();</span>"</span><span style="color: #0000ff">/&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span>
    <span style="background-color: #ff99cc"><span style="color: #0000ff">function</span><span style="color: #000000"> doajax() {                                 </span><span style="color: #008000">//</span><span style="color: #008000">当点击提交按钮是执行函数</span>
<span style="color: #000000">        $.ajax({
            type: </span><span style="color: #000000">'</span><span style="color: #000000">GET</span><span style="color: #000000">'</span><span style="color: #000000">,
            url: </span><span style="color: #000000">'</span><span style="color: #000000">http://www.fwd.com:8001/fwd</span><span style="color: #000000">'</span><span style="color: #000000">,
            dataType: </span><span style="color: #000000">'</span><span style="color: #000000">jsonp</span><span style="color: #000000">'</span><span style="color: #000000">,   </span><span style="color: #008000">//</span><span style="color: #008000">JSONP，数据类型</span>
<span style="color: #000000">            jsonpCallBack:</span><span style="color: #000000">'</span><span style="color: #000000">shj</span><span style="color: #000000">'</span>  <span style="color: #008000">//</span><span style="color: #008000">接收响应页面带有参数的函数名称</span>
<span style="color: #000000">        });
    }
    </span></span><strong><span style="background-color: #f5f5f5; color: #008000">//</span><span style="background-color: #f5f5f5; color: #008000">响应网站返回，shuju({'k1':'v1'});  也就相当于返回了一个带有参数的函数名称</span>
</strong>    <span style="background-color: #ff99cc"><span style="color: #0000ff">function</span><span style="color: #000000"> shuju(shj) {                               </span><span style="color: #008000">//</span><span style="color: #008000">自定义执行函数，和响应网站返回的名称相同，也就会执行自定义函数，而参数就是响应网站返回的数据</span>
        <span style="color: #0000ff">for</span><span style="color: #000000"> (</span><span style="color: #0000ff">var</span><span style="color: #000000"> i </span><span style="color: #0000ff">in</span><span style="color: #000000"> shj) {                            </span><span style="color: #008000">//</span><span style="color: #008000">循环响应网站返回的数据</span>
<span style="color: #000000">            alert(i </span><span style="color: #000000">+</span> <span style="color: #000000">'</span><span style="color: #000000">:</span><span style="color: #000000">'</span> <span style="color: #000000">+</span><span style="color: #000000"> shj[i]);                    </span><span style="color: #008000">//</span><span style="color: #008000">打印出数据的键和值</span>
<span style="color: #000000">        }
    }
</span></span><span style="color: #0000ff">&lt;/</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">body</span><span style="color: #0000ff">&gt;</span></pre>
</div>
<p><span style="color: #0000ff"><strong>响应端</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000">coding:utf-8</span>

<span style="color: #0000ff">import</span><span style="color: #000000"> tornado.ioloop
</span><span style="color: #0000ff">import</span> tornado.web                                              <span style="color: #008000">#</span><span style="color: #008000">导入tornado模块下的web文件</span>


<span style="color: #0000ff">class</span><span style="color: #000000"> fwdHandler(tornado.web.RequestHandler):
    </span><span style="background-color: #ff99cc"><span style="color: #0000ff">def</span> get(self):                                      <span style="color: #008000">#</span><span style="color: #008000">接收get请求</span>
        <span style="color: #008000">#</span><span style="color: #008000"> self.render("fwd.html")</span>
        self.write(<span style="color: #800000">"</span><span style="color: #800000">shuju({'k1':'v1'});</span><span style="color: #800000">"</span>)               <span style="color: #008000">#</span><span style="color: #008000">返回数据</span></span>
    <span style="color: #0000ff">def</span><span style="color: #000000"> post(self):
        self.write(</span><span style="color: #800000">"</span><span style="color: #800000">post请求成功</span><span style="color: #800000">"</span><span style="color: #000000">)

settings </span>= {                                            <span style="color: #008000">#</span><span style="color: #008000">html文件归类配置，设置一个字典</span>
    <span style="color: #800000">"</span><span style="color: #800000">template_path</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">views</span><span style="color: #800000">"</span>,                            <span style="color: #008000">#</span><span style="color: #008000">键为template_path固定的，值为要存放HTML的文件夹名称</span>
    <span style="color: #800000">"</span><span style="color: #800000">static_path</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">statics</span><span style="color: #800000">"</span>,                            <span style="color: #008000">#</span><span style="color: #008000">键为static_path固定的，值为要存放js和css的文件夹名称</span>
<span style="color: #000000">}

</span><span style="color: #008000">#</span><span style="color: #008000">路由映射</span>
application = tornado.web.Application([                 <span style="color: #008000">#</span><span style="color: #008000">创建一个变量等于tornado.web下的Application方法</span>
    (r<span style="color: #800000">"</span><span style="color: #800000">/fwd</span><span style="color: #800000">"</span><span style="color: #000000">, fwdHandler),
],</span>**settings)                                           <span style="color: #008000">#</span><span style="color: #008000">将html文件归类配置字典，写在路由映射的第二个参数里</span>

<span style="color: #0000ff">if</span> <span style="color: #800080">__name__</span> == <span style="color: #800000">"</span><span style="color: #800000">__main__</span><span style="color: #800000">"</span><span style="color: #000000">:
    </span><span style="color: #008000">#</span><span style="color: #008000">内部socket运行起来</span>
    application.listen(8001)                            <span style="color: #008000">#</span><span style="color: #008000">设置端口</span>
    tornado.ioloop.IOLoop.instance().start()</pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201705/955761-20170528150025422-2021335070.png" alt=""></p>
</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div><span style="color: #ff0000; background-color: #ffff00"><strong>方法二、基于CORS实现跨域Ajax</strong></span></div>
<div><span style="color: #ff0000; background-color: #ffffff"><strong>请求页面不变就像同域一样，只是响应端返回数据的时候带有响应头标识，也就是告诉浏览器允许跨域请求，这是最新的方式，新浏览器支持，老浏览器不支持，将来会都支持</strong></span></div>
<div><span style="color: #000000; background-color: #ffffff"><strong>随着技术的发展，现在的浏览器可以支持主动设置从而允许跨域请求，即：跨域资源共享（CORS，Cross-Origin Resource Sharing），其本质是设置响应头，使得浏览器允许跨域请求。</strong></span></div>
<div>&nbsp;</div>
<div><span style="color: #ff0000; background-color: #ffffff"><strong><strong>CORS实现跨域Ajax有两种方式，简单方式和复杂方式两种</strong></strong></span></div>
<div>
<p><span style="color: #0000ff"><strong>简单请求和非简单请求的区别？</strong></span><br><span style="color: #0000ff"><strong>简单请求：一次请求</strong></span><br><span style="color: #0000ff"><strong>非简单请求：两次请求，在发送数据之前会先发一次请求用于做“预检”，只有“预检”通过后才再发送一次请求用于数据传输。</strong></span></p>







</div>
<div><span style="color: #ff0000; background-color: #ffff00"><strong><strong>简单请求</strong></strong></span></div>
<div><span style="color: #ff0000; background-color: #ffffff"><strong><strong><strong>简单请求：一次请求</strong></strong></strong></span></div>
<div>
<p><strong>条件：</strong><br><strong>    　　1、请求方式：HEAD、GET、POST</strong><br><strong>    　　2、请求头信息：</strong><br><strong>        　　　　Accept</strong><br><strong>        　　　　Accept-Language</strong><br><strong>        　　　　Content-Language</strong><br><strong>        　　　　Last-Event-ID</strong><br><strong>        　　　　<span style="color: #ff0000">Content-Type</span> 对应的值是以下三个中的任意一个</strong><br><strong>                                　　　　　　application/x-www-form-urlencoded</strong><br><strong>                                　　　　　　multipart/form-data</strong><br><strong>                                　　　　　　text/plain</strong><br><span style="color: #ff0000; font-size: 14pt; background-color: #ccffcc"><strong>注意：同时满足以上两个条件时，则是简单请求，否则为复杂请求</strong></span></p>
<p>&nbsp;</p>







</div>
<div>
<p><span style="color: #ff0000"><strong>self.set_header()方法，在响应端的逻辑处理的get或者post里使用，功能：给返回数据加上响应头标识告诉浏览器允许跨域请求</strong></span><br><span style="color: #ff0000"><strong>使用方法：两个参数，参数1，响应头标识，参数2，允许跨域请求的域名(多个域名,号隔开)，(*代表所有域名支持跨域请求)</strong></span><br><span style="color: #ff0000"><strong>self.set_header('Access-Control-Allow-Origin','http://www.jxiou.com/')</strong></span><br><span style="color: #ff0000"><strong>self.set_header('Access-Control-Allow-Origin','*')</strong></span></p>
<p><span style="color: #0000ff"><strong>响应端</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000">coding:utf-8</span>

<span style="color: #0000ff">import</span><span style="color: #000000"> tornado.ioloop
</span><span style="color: #0000ff">import</span> tornado.web                                              <span style="color: #008000">#</span><span style="color: #008000">导入tornado模块下的web文件</span>


<span style="color: #0000ff">class</span><span style="color: #000000"> fwdHandler(tornado.web.RequestHandler):
    </span><span style="color: #0000ff">def</span> get(self):                                      <span style="color: #008000">#</span><span style="color: #008000">接收get请求</span>
        <span style="color: #0000ff">pass</span>
    <span style="background-color: #ff99cc"><span style="color: #0000ff">def</span><span style="color: #000000"> post(self):
       <span style="background-color: #ffff99"><strong> self.set_header(</strong></span></span><span style="background-color: #ffff99"><strong><span style="color: #800000">'</span><span style="color: #800000">Access-Control-Allow-Origin</span><span style="color: #800000">'</span>,<span style="color: #800000">'</span><span style="color: #800000">*</span><span style="color: #800000">'</span></strong></span><span style="color: #000000"><span style="background-color: #ffff99"><strong>)</strong></span>
        self.write(</span><span style="color: #800000">"</span><span style="color: #800000">{'k1':'v1'}</span><span style="color: #800000">"</span>)  <span style="color: #008000">#</span><span style="color: #008000"> 返回数据</span></span>
<span style="color: #000000">
settings </span>= {                                            <span style="color: #008000">#</span><span style="color: #008000">html文件归类配置，设置一个字典</span>
    <span style="color: #800000">"</span><span style="color: #800000">template_path</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">views</span><span style="color: #800000">"</span>,                            <span style="color: #008000">#</span><span style="color: #008000">键为template_path固定的，值为要存放HTML的文件夹名称</span>
    <span style="color: #800000">"</span><span style="color: #800000">static_path</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">statics</span><span style="color: #800000">"</span>,                            <span style="color: #008000">#</span><span style="color: #008000">键为static_path固定的，值为要存放js和css的文件夹名称</span>
<span style="color: #000000">}

</span><span style="color: #008000">#</span><span style="color: #008000">路由映射</span>
application = tornado.web.Application([                 <span style="color: #008000">#</span><span style="color: #008000">创建一个变量等于tornado.web下的Application方法</span>
    (r<span style="color: #800000">"</span><span style="color: #800000">/fwd</span><span style="color: #800000">"</span><span style="color: #000000">, fwdHandler),
],</span>**settings)                                           <span style="color: #008000">#</span><span style="color: #008000">将html文件归类配置字典，写在路由映射的第二个参数里</span>

<span style="color: #0000ff">if</span> <span style="color: #800080">__name__</span> == <span style="color: #800000">"</span><span style="color: #800000">__main__</span><span style="color: #800000">"</span><span style="color: #000000">:
    </span><span style="color: #008000">#</span><span style="color: #008000">内部socket运行起来</span>
    application.listen(8001)                            <span style="color: #008000">#</span><span style="color: #008000">设置端口</span>
    tornado.ioloop.IOLoop.instance().start()</pre>
</div>
<p><span style="color: #0000ff"><strong>请求页面</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">&lt;!</span><span style="color: #ff00ff">DOCTYPE html</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">html </span><span style="color: #ff0000">lang</span><span style="color: #0000ff">="en"</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">head</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">meta </span><span style="color: #ff0000">charset</span><span style="color: #0000ff">="UTF-8"</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">title</span><span style="color: #0000ff">&gt;</span>Title<span style="color: #0000ff">&lt;/</span><span style="color: #800000">title</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">script </span><span style="color: #ff0000">type</span><span style="color: #0000ff">="text/javascript"</span><span style="color: #ff0000"> src</span><span style="color: #0000ff">='{{static_url("jquery.min.js")}}' </span><span style="color: #ff0000">charset</span><span style="color: #0000ff">="UTF-8"</span><span style="color: #0000ff">&gt;&lt;/</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">head</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">body</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">input </span><span style="color: #ff0000">type</span><span style="color: #0000ff">="button"</span><span style="color: #ff0000"> value</span><span style="color: #0000ff">="跨域提交"</span><span style="color: #ff0000; background-color: #ff99cc"> onclick</span><span style="color: #0000ff"><span style="background-color: #ff99cc">="doajax();</span>"</span><span style="color: #0000ff">/&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span>
    <span style="background-color: #ff99cc"><span style="color: #0000ff">function</span><span style="color: #000000"> doajax() {                                 </span><span style="color: #008000">//</span><span style="color: #008000">当点击提交按钮是执行函数</span>
<span style="color: #000000">        $.ajax({
            type: </span><span style="color: #000000">'</span><span style="color: #000000">POST</span><span style="color: #000000">'</span><span style="color: #000000">,
            url: </span><span style="color: #000000">'</span><span style="color: #000000">http://www.fwd.com:8001/fwd</span><span style="color: #000000">'</span><span style="color: #000000">,
            data: {</span><span style="color: #000000">"</span><span style="color: #000000">a</span><span style="color: #000000">"</span><span style="color: #000000">:</span><span style="color: #000000">'</span><span style="color: #000000">b</span><span style="color: #000000">'</span><span style="color: #000000">},
            success: </span><span style="color: #0000ff">function</span><span style="color: #000000"> (response, status, xhr) {
                alert(response);                            </span><span style="color: #008000">//</span><span style="color: #008000">打印返回数据</span>
<span style="color: #000000">            }
        });
    }
</span></span><span style="color: #0000ff">&lt;/</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">body</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">html</span><span style="color: #0000ff">&gt;</span></pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201705/955761-20170528172721969-283568543.png" alt=""></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong><strong>复杂请求</strong><br></strong></span></p>
<p><span style="color: #ff0000"><strong><strong>复杂请求</strong>：两次请求，在发送数据之前会先发一次<span style="color: #0000ff">OPTIONS</span>请求用于做“预检”，只有“预检”通过后才再发送一次请求用于数据传输。</strong></span></p>
<p><span style="color: #ff0000"><strong><span style="background-color: #ffff99">self.set_header('Access-Control-Allow-Origin', "http://www.xxx.com")</span> 预检请求或者数据请求时允许跨域，允许跨域的域名(多个逗号隔开)(*标识所有域名允许)</strong></span><br><span style="color: #ff0000"><strong><span style="background-color: #ffff99">self.set_header('Access-Control-Allow-Headers', "k1,k2")</span>		预检请求时允许请求页面ajax设置请求头headers属性跨域，允许跨域的headers属性请求头(多个逗号隔开)</strong></span><br><span style="color: #ff0000"><strong><span style="background-color: #ffff99">self.set_header('Access-Control-Allow-Methods', "PUT,DELETE")</span>		预检请求时允许请求页面的请求方式跨域，允许跨域的请求方式(多个逗号隔开)</strong></span><br><span style="color: #ff0000"><strong><span style="background-color: #ffff99">self.set_header('Access-Control-Max-Age', 10)</span>				预检请求时设置预检有效时间，如设置10，表示这次预检后10秒后的请求再次预检</strong></span></p>
<p><span style="color: #0000ff"><strong>响应端</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000">coding:utf-8</span>

<span style="color: #0000ff">import</span><span style="color: #000000"> tornado.ioloop
</span><span style="color: #0000ff">import</span> tornado.web                                              <span style="color: #008000">#</span><span style="color: #008000">导入tornado模块下的web文件</span>


<span style="color: #0000ff">class</span><span style="color: #000000"> fwdHandler(tornado.web.RequestHandler):
    </span><span style="color: #0000ff">def</span> get(self):                                      <span style="color: #008000">#</span><span style="color: #008000">接收get请求</span>
        <span style="color: #0000ff">pass</span>
<span style="background-color: #ffff99">    <strong><span style="color: #0000ff">def</span> options(self):                                                  <span style="color: #008000">#</span><span style="color: #008000">接收预检的options请求</span>
        self.set_header(<span style="color: #800000">'</span><span style="color: #800000">Access-Control-Allow-Origin</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">*</span><span style="color: #800000">'</span>)             <span style="color: #008000">#</span><span style="color: #008000">预检请求或者数据请求时允许跨域，允许跨域的域名(多个逗号隔开)(*标识所有域名允许)</span>
        self.set_header(<span style="color: #800000">'</span><span style="color: #800000">Access-Control-Allow-Methods</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">PUT</span><span style="color: #800000">'</span>)          <span style="color: #008000">#</span><span style="color: #008000">预检请求时允许请求页面的请求方式跨域，允许跨域的请求方式(多个逗号隔开)</span>
        <span style="background-color: #ff99cc">self.set_header(<span style="color: #800000">'</span><span style="color: #800000">Access-Control-Allow-Headers</span><span style="color: #800000">'</span>, <span style="color: #800000">"</span><span style="color: #800000">k1,k2</span><span style="color: #800000">"</span>)</span>        <span style="color: #008000">#</span><span style="color: #008000">预检请求时允许请求页面ajax设置请求头headers属性跨域，允许跨域的headers属性请求头(多个逗号隔开)</span>
    <span style="color: #0000ff">def</span><span style="color: #000000"> put(self):
        self.set_header(</span><span style="color: #800000">'</span><span style="color: #800000">Access-Control-Allow-Origin</span><span style="color: #800000">'</span>,<span style="color: #800000">'</span><span style="color: #800000">*</span><span style="color: #800000">'</span><span style="color: #000000">)
        self.write(</span><span style="color: #800000">"</span><span style="color: #800000">{'k1':'v1'}</span><span style="color: #800000">"</span>)                       <span style="color: #008000">#</span><span style="color: #008000"> 返回数据</span></strong></span>
<span style="color: #000000">
settings </span>= {                                            <span style="color: #008000">#</span><span style="color: #008000">html文件归类配置，设置一个字典</span>
    <span style="color: #800000">"</span><span style="color: #800000">template_path</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">views</span><span style="color: #800000">"</span>,                            <span style="color: #008000">#</span><span style="color: #008000">键为template_path固定的，值为要存放HTML的文件夹名称</span>
    <span style="color: #800000">"</span><span style="color: #800000">static_path</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">statics</span><span style="color: #800000">"</span>,                            <span style="color: #008000">#</span><span style="color: #008000">键为static_path固定的，值为要存放js和css的文件夹名称</span>
<span style="color: #000000">}

</span><span style="color: #008000">#</span><span style="color: #008000">路由映射</span>
application = tornado.web.Application([                 <span style="color: #008000">#</span><span style="color: #008000">创建一个变量等于tornado.web下的Application方法</span>
    (r<span style="color: #800000">"</span><span style="color: #800000">/fwd</span><span style="color: #800000">"</span><span style="color: #000000">, fwdHandler),
],</span>**settings)                                           <span style="color: #008000">#</span><span style="color: #008000">将html文件归类配置字典，写在路由映射的第二个参数里</span>

<span style="color: #0000ff">if</span> <span style="color: #800080">__name__</span> == <span style="color: #800000">"</span><span style="color: #800000">__main__</span><span style="color: #800000">"</span><span style="color: #000000">:
    </span><span style="color: #008000">#</span><span style="color: #008000">内部socket运行起来</span>
    application.listen(8001)                            <span style="color: #008000">#</span><span style="color: #008000">设置端口</span>
    tornado.ioloop.IOLoop.instance().start()</pre>
</div>
<p><span style="color: #0000ff"><strong>请求页面</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">&lt;!</span><span style="color: #ff00ff">DOCTYPE html</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">html </span><span style="color: #ff0000">lang</span><span style="color: #0000ff">="en"</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">head</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">meta </span><span style="color: #ff0000">charset</span><span style="color: #0000ff">="UTF-8"</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">title</span><span style="color: #0000ff">&gt;</span>Title<span style="color: #0000ff">&lt;/</span><span style="color: #800000">title</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">script </span><span style="color: #ff0000">type</span><span style="color: #0000ff">="text/javascript"</span><span style="color: #ff0000"> src</span><span style="color: #0000ff">='{{static_url("jquery.min.js")}}' </span><span style="color: #ff0000">charset</span><span style="color: #0000ff">="UTF-8"</span><span style="color: #0000ff">&gt;&lt;/</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">head</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">body</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">input </span><span style="color: #ff0000">type</span><span style="color: #0000ff">="button"</span><span style="color: #ff0000"> value</span><span style="color: #0000ff">="跨域提交"</span><span style="color: #ff0000; background-color: #ffff99"> onclick</span><span style="color: #0000ff"><span style="background-color: #ffff99">="doajax();</span>"</span><span style="color: #0000ff">/&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span>
    <span style="background-color: #ffff99"><span style="color: #0000ff">function</span><span style="color: #000000"> doajax() {                                 </span><span style="color: #008000">//</span><span style="color: #008000">当点击提交按钮是执行函数</span>
<span style="color: #000000">        $.ajax({
            type: </span><span style="color: #000000">'</span><span style="color: #000000">PUT</span><span style="color: #000000">'</span><span style="color: #000000">,                                </span><span style="color: #008000">//</span><span style="color: #008000">复杂请求</span>
<span style="color: #000000">            url: </span><span style="color: #000000">'</span><span style="color: #000000">http://www.fwd.com:8001/fwd</span><span style="color: #000000">'</span><span style="color: #000000">,
            <span style="background-color: #ff99cc">headers: {</span></span><span style="background-color: #ff99cc"><span style="color: #000000">'</span><span style="color: #000000">k1</span><span style="color: #000000">'</span><span style="color: #000000">: </span><span style="color: #000000">'</span><span style="color: #000000">qqtou</span><span style="color: #000000">'</span></span><span style="color: #000000"><span style="background-color: #ff99cc">}</span>,                   </span><span style="color: #008000">//</span><span style="color: #008000">设置请求头</span>
<span style="color: #000000">            data: {</span><span style="color: #000000">"</span><span style="color: #000000">a</span><span style="color: #000000">"</span><span style="color: #000000">:</span><span style="color: #000000">'</span><span style="color: #000000">b</span><span style="color: #000000">'</span><span style="color: #000000">},
            success: </span><span style="color: #0000ff">function</span><span style="color: #000000"> (response, status, xhr) {
                alert(response);                            </span><span style="color: #008000">//</span><span style="color: #008000">打印返回数据</span>
<span style="color: #000000">            }
        });
    }
</span></span><span style="color: #0000ff">&lt;/</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">body</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">html</span><span style="color: #0000ff">&gt;</span></pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201705/955761-20170528190034532-1950044818.png" alt=""></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000; background-color: #ffff00"><strong>跨域传输cookie</strong></span></p>
<p><span style="color: #000000"><strong>在跨域请求中，默认情况下，HTTP Authentication信息，Cookie头以及用户的SSL证书无论在预检请求中或是在实际请求都是不会被发送。</strong></span></p>
<p><span style="color: #0000ff"><strong>如果想要发送：</strong></span><br><span style="color: #ff0000"><strong>　　浏览器端ajax属性：xhrFields的withCredentials为true</strong></span><br><span style="color: #ff0000"><strong>　　服务器端的预检请求和数据请求：Access-Control-Allow-Credentials为true</strong></span><br><span style="color: #0000ff"><strong>　　<span style="color: #ff0000">注意：服务器端响应的 Access-Control-Allow-Origin 不能是通配符 *</span></strong></span></p>
<p><span style="color: #0000ff"><strong>响应端</strong></span></p>
<div class="cnblogs_code">
<pre>/usr/bin/<span style="color: #000000">env python
</span><span style="color: #008000">#</span><span style="color: #008000">coding:utf-8</span>

<span style="color: #0000ff">import</span><span style="color: #000000"> tornado.ioloop
</span><span style="color: #0000ff">import</span> tornado.web                                              <span style="color: #008000">#</span><span style="color: #008000">导入tornado模块下的web文件</span>


<span style="color: #0000ff">class</span><span style="color: #000000"> fwdHandler(tornado.web.RequestHandler):
    </span><span style="color: #0000ff">def</span> get(self):                                      <span style="color: #008000">#</span><span style="color: #008000">接收get请求</span>
        <span style="color: #0000ff">pass</span>
    <span style="color: #0000ff">def</span> options(self):                                                                        <span style="color: #008000">#</span><span style="color: #008000">接收预检的options请求</span>
        <span style="background-color: #ff99cc">self.set_header(<span style="color: #800000">'</span><span style="color: #800000">Access-Control-Allow-Credentials</span><span style="color: #800000">'</span>, <span style="color: #800000">"</span><span style="color: #800000">true</span><span style="color: #800000">"</span>)                           <span style="color: #008000">#</span><span style="color: #008000">传递Cookie头以及用户的SSL证书</span></span>
        <span style="background-color: #ff99cc">self.set_header(<span style="color: #800000">'</span><span style="color: #800000">Access-Control-Allow-Origin</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">http://www.khd.com:8002</span><span style="color: #800000">'</span>)             <span style="color: #008000">#</span><span style="color: #008000">预检请求或者数据请求时允许跨域，允许跨域的域名</span></span>
        self.set_header(<span style="color: #800000">'</span><span style="color: #800000">Access-Control-Allow-Methods</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">PUT</span><span style="color: #800000">'</span>)                                <span style="color: #008000">#</span><span style="color: #008000">预检请求时允许请求页面的请求方式跨域，允许跨域的请求方式(多个逗号隔开)</span>
        self.set_header(<span style="color: #800000">'</span><span style="color: #800000">Access-Control-Allow-Headers</span><span style="color: #800000">'</span>, <span style="color: #800000">"</span><span style="color: #800000">k1,k2</span><span style="color: #800000">"</span>)                              <span style="color: #008000">#</span><span style="color: #008000">预检请求时允许请求页面ajax设置请求头headers属性跨域，允许跨域的headers属性请求头(多个逗号隔开)</span>
    <span style="color: #0000ff">def</span><span style="color: #000000"> put(self):
        <span style="background-color: #ff99cc">self.set_header(</span></span><span style="background-color: #ff99cc"><span style="color: #800000">'</span><span style="color: #800000">Access-Control-Allow-Credentials</span><span style="color: #800000">'</span>, <span style="color: #800000">"</span><span style="color: #800000">true</span><span style="color: #800000">"</span>)                           <span style="color: #008000">#</span><span style="color: #008000"> 传递Cookie头以及用户的SSL证书</span></span>
        <span style="background-color: #ff99cc">self.set_header(<span style="color: #800000">'</span><span style="color: #800000">Access-Control-Allow-Origin</span><span style="color: #800000">'</span>,<span style="color: #800000">'</span><span style="color: #800000">http://www.khd.com:8002</span><span style="color: #800000">'</span></span><span style="color: #000000"><span style="background-color: #ff99cc">)</span>
        self.write(</span><span style="color: #800000">"</span><span style="color: #800000">{'k1':'v1'}</span><span style="color: #800000">"</span>)                       <span style="color: #008000">#</span><span style="color: #008000"> 返回数据</span>
        self.set_cookie(<span style="color: #800000">'</span><span style="color: #800000">kkkkk</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">vvvvv</span><span style="color: #800000">'</span>)               <span style="color: #008000">#</span><span style="color: #008000">写入cookie</span>
        <span style="color: #0000ff">print</span>(self.get_cookie(<span style="color: #800000">'</span><span style="color: #800000">kkkkk</span><span style="color: #800000">'</span>))                 <span style="color: #008000">#</span><span style="color: #008000">获取cookie</span>
<span style="color: #000000">
settings </span>= {                                            <span style="color: #008000">#</span><span style="color: #008000">html文件归类配置，设置一个字典</span>
    <span style="color: #800000">"</span><span style="color: #800000">template_path</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">views</span><span style="color: #800000">"</span>,                            <span style="color: #008000">#</span><span style="color: #008000">键为template_path固定的，值为要存放HTML的文件夹名称</span>
    <span style="color: #800000">"</span><span style="color: #800000">static_path</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">statics</span><span style="color: #800000">"</span>,                            <span style="color: #008000">#</span><span style="color: #008000">键为static_path固定的，值为要存放js和css的文件夹名称</span>
<span style="color: #000000">}

</span><span style="color: #008000">#</span><span style="color: #008000">路由映射</span>
application = tornado.web.Application([                 <span style="color: #008000">#</span><span style="color: #008000">创建一个变量等于tornado.web下的Application方法</span>
    (r<span style="color: #800000">"</span><span style="color: #800000">/fwd</span><span style="color: #800000">"</span><span style="color: #000000">, fwdHandler),
],</span>**settings)                                           <span style="color: #008000">#</span><span style="color: #008000">将html文件归类配置字典，写在路由映射的第二个参数里</span>

<span style="color: #0000ff">if</span> <span style="color: #800080">__name__</span> == <span style="color: #800000">"</span><span style="color: #800000">__main__</span><span style="color: #800000">"</span><span style="color: #000000">:
    </span><span style="color: #008000">#</span><span style="color: #008000">内部socket运行起来</span>
    application.listen(8001)                            <span style="color: #008000">#</span><span style="color: #008000">设置端口</span>
    tornado.ioloop.IOLoop.instance().start()</pre>
</div>
<p><span style="color: #0000ff"><strong>请求页面</strong></span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">&lt;!</span><span style="color: #ff00ff">DOCTYPE html</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">html </span><span style="color: #ff0000">lang</span><span style="color: #0000ff">="en"</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">head</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">meta </span><span style="color: #ff0000">charset</span><span style="color: #0000ff">="UTF-8"</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">title</span><span style="color: #0000ff">&gt;</span>Title<span style="color: #0000ff">&lt;/</span><span style="color: #800000">title</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">script </span><span style="color: #ff0000">type</span><span style="color: #0000ff">="text/javascript"</span><span style="color: #ff0000"> src</span><span style="color: #0000ff">='{{static_url("jquery.min.js")}}' </span><span style="color: #ff0000">charset</span><span style="color: #0000ff">="UTF-8"</span><span style="color: #0000ff">&gt;&lt;/</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">head</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">body</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">input </span><span style="color: #ff0000">type</span><span style="color: #0000ff">="button"</span><span style="color: #ff0000"> value</span><span style="color: #0000ff">="跨域提交"</span><span style="color: #ff0000; background-color: #ff99cc"> onclick</span><span style="color: #0000ff"><span style="background-color: #ff99cc">="doajax();</span>"</span><span style="color: #0000ff">/&gt;</span>
<span style="color: #0000ff">&lt;</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span>
    <span style="background-color: #f5f5f5; color: #0000ff">function</span><span style="background-color: #f5f5f5; color: #000000"> doajax() {                                 </span><span style="background-color: #f5f5f5; color: #008000">//</span><span style="background-color: #f5f5f5; color: #008000">当点击提交按钮是执行函数</span>
<span style="background-color: #f5f5f5; color: #000000">        $.ajax({
            type: </span><span style="background-color: #f5f5f5; color: #000000">'</span><span style="background-color: #f5f5f5; color: #000000">PUT</span><span style="background-color: #f5f5f5; color: #000000">'</span><span style="background-color: #f5f5f5; color: #000000">,                                </span><span style="background-color: #f5f5f5; color: #008000">//</span><span style="background-color: #f5f5f5; color: #008000">复杂请求</span>
<span style="background-color: #f5f5f5; color: #000000">            url: </span><span style="background-color: #f5f5f5; color: #000000">'</span><span style="background-color: #f5f5f5; color: #000000">http://www.fwd.com:8001/fwd</span><span style="background-color: #f5f5f5; color: #000000">'</span><span style="background-color: #f5f5f5; color: #000000">,
            headers: {</span><span style="background-color: #f5f5f5; color: #000000">'</span><span style="background-color: #f5f5f5; color: #000000">k1</span><span style="background-color: #f5f5f5; color: #000000">'</span><span style="background-color: #f5f5f5; color: #000000">: </span><span style="background-color: #f5f5f5; color: #000000">'</span><span style="background-color: #f5f5f5; color: #000000">qqtou</span><span style="background-color: #f5f5f5; color: #000000">'</span><span style="background-color: #f5f5f5; color: #000000">},                   </span><span style="background-color: #f5f5f5; color: #008000">//</span><span style="background-color: #f5f5f5; color: #008000">设置请求头</span>
<span style="background-color: #ff99cc"><span style="color: #000000">            xhrFields:{withCredentials: </span><span style="color: #0000ff">true</span><span style="color: #000000">},          </span><span style="color: #008000">//</span><span style="color: #008000">传递Cookie头以及用户的SSL证书</span></span>
<span style="background-color: #f5f5f5; color: #000000">            data: {</span><span style="background-color: #f5f5f5; color: #000000">"</span><span style="background-color: #f5f5f5; color: #000000">a</span><span style="background-color: #f5f5f5; color: #000000">"</span><span style="background-color: #f5f5f5; color: #000000">:</span><span style="background-color: #f5f5f5; color: #000000">'</span><span style="background-color: #f5f5f5; color: #000000">b</span><span style="background-color: #f5f5f5; color: #000000">'</span><span style="background-color: #f5f5f5; color: #000000">},
            success: </span><span style="background-color: #f5f5f5; color: #0000ff">function</span><span style="background-color: #f5f5f5; color: #000000"> (response, status, xhr) {
                alert(response);                            </span><span style="background-color: #f5f5f5; color: #008000">//</span><span style="background-color: #f5f5f5; color: #008000">打印返回数据</span>
<span style="background-color: #f5f5f5; color: #000000">            }
        });
    }
</span><span style="color: #0000ff">&lt;/</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">body</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">html</span><span style="color: #0000ff">&gt;</span></pre>
</div>
<p>&nbsp;<img src="https://images2015.cnblogs.com/blog/955761/201705/955761-20170528200023188-363663435.png" alt=""></p>
</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div><span style="color: #ff0000; background-color: #ffff00"><strong>补充，响应端设置响应头，请求端是无法获取到响应端设置的响应头的，如果要获取到，响应端必须做设置允许请求端获取</strong></span></div>
<div>
<p><span style="color: #ff0000"><strong>self.set_header('xxoo', "<strong>bili</strong>") &nbsp;<span style="color: #0000ff">设置响应头第一个是响应头名称，第二个是响应头值</span></strong></span><br><span style="color: #ff0000"><strong>self.set_header('Access-Control-Expose-Headers', "xxoo,bili") &nbsp; &nbsp;<span style="color: #0000ff">允许设置的响应头，请求端获取</span></strong></span></p>

</div>
<div><span style="color: #0000ff"><strong>&nbsp;响应端</strong></span></div>
<div>
<div class="cnblogs_code">
<pre><span style="color: #008000">#</span><span style="color: #008000">!/usr/bin/env python</span><span style="color: #008000">
#</span><span style="color: #008000">coding:utf-8</span>

<span style="color: #0000ff">import</span><span style="color: #000000"> tornado.ioloop
</span><span style="color: #0000ff">import</span> tornado.web                                              <span style="color: #008000">#</span><span style="color: #008000">导入tornado模块下的web文件</span>


<span style="color: #0000ff">class</span><span style="color: #000000"> fwdHandler(tornado.web.RequestHandler):
    </span><span style="color: #0000ff">def</span> get(self):                                      <span style="color: #008000">#</span><span style="color: #008000">接收get请求</span>
        <span style="color: #0000ff">pass</span>
    <span style="color: #0000ff">def</span> options(self):                                                                        <span style="color: #008000">#</span><span style="color: #008000">接收预检的options请求</span>
        self.set_header(<span style="color: #800000">'</span><span style="color: #800000">Access-Control-Allow-Credentials</span><span style="color: #800000">'</span>, <span style="color: #800000">"</span><span style="color: #800000">true</span><span style="color: #800000">"</span>)                           <span style="color: #008000">#</span><span style="color: #008000">传递Cookie头以及用户的SSL证书</span>
        self.set_header(<span style="color: #800000">'</span><span style="color: #800000">Access-Control-Allow-Origin</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">http://www.khd.com:8002</span><span style="color: #800000">'</span>)             <span style="color: #008000">#</span><span style="color: #008000">预检请求或者数据请求时允许跨域，允许跨域的域名</span>
        self.set_header(<span style="color: #800000">'</span><span style="color: #800000">Access-Control-Allow-Methods</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">PUT</span><span style="color: #800000">'</span>)                                <span style="color: #008000">#</span><span style="color: #008000">预检请求时允许请求页面的请求方式跨域，允许跨域的请求方式(多个逗号隔开)</span>
        self.set_header(<span style="color: #800000">'</span><span style="color: #800000">Access-Control-Allow-Headers</span><span style="color: #800000">'</span>, <span style="color: #800000">"</span><span style="color: #800000">k1,k2</span><span style="color: #800000">"</span>)                              <span style="color: #008000">#</span><span style="color: #008000">预检请求时允许请求页面ajax设置请求头headers属性跨域，允许跨域的headers属性请求头(多个逗号隔开)</span>
    <span style="color: #0000ff">def</span><span style="color: #000000"> put(self):
        self.set_header(</span><span style="color: #800000">'</span><span style="color: #800000">Access-Control-Allow-Credentials</span><span style="color: #800000">'</span>, <span style="color: #800000">"</span><span style="color: #800000">true</span><span style="color: #800000">"</span>)                           <span style="color: #008000">#</span><span style="color: #008000"> 传递Cookie头以及用户的SSL证书</span>
        self.set_header(<span style="color: #800000">'</span><span style="color: #800000">Access-Control-Allow-Origin</span><span style="color: #800000">'</span>,<span style="color: #800000">'</span><span style="color: #800000">http://www.khd.com:8002</span><span style="color: #800000">'</span><span style="color: #000000">)
        <span style="background-color: #ff99cc">self.set_header(</span></span><span style="background-color: #ff99cc"><span style="color: #800000">'</span><span style="color: #800000">xxoo</span><span style="color: #800000">'</span>, <span style="color: #800000">"</span><span style="color: #800000">bili</span><span style="color: #800000">"</span>)                                                      <span style="color: #008000">#</span><span style="color: #008000">设置响应头第一个是响应头名称，第二个是响应头值</span>
        self.set_header(<span style="color: #800000">'</span><span style="color: #800000">Access-Control-Expose-Headers</span><span style="color: #800000">'</span>, <span style="color: #800000">"</span><span style="color: #800000">xxoo,bili</span><span style="color: #800000">"</span>)                         <span style="color: #008000">#</span><span style="color: #008000">允许设置的响应头，请求端获取</span></span>
<span style="color: #000000">

        self.write(</span><span style="color: #800000">"</span><span style="color: #800000">{'k1':'v1'}</span><span style="color: #800000">"</span>)                       <span style="color: #008000">#</span><span style="color: #008000"> 返回数据</span>
        self.set_cookie(<span style="color: #800000">'</span><span style="color: #800000">kkkkk</span><span style="color: #800000">'</span>, <span style="color: #800000">'</span><span style="color: #800000">vvvvv</span><span style="color: #800000">'</span>)               <span style="color: #008000">#</span><span style="color: #008000">写入cookie</span>
        <span style="color: #0000ff">print</span>(self.get_cookie(<span style="color: #800000">'</span><span style="color: #800000">kkkkk</span><span style="color: #800000">'</span>))                 <span style="color: #008000">#</span><span style="color: #008000">获取cookie</span>
<span style="color: #000000">
settings </span>= {                                            <span style="color: #008000">#</span><span style="color: #008000">html文件归类配置，设置一个字典</span>
    <span style="color: #800000">"</span><span style="color: #800000">template_path</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">views</span><span style="color: #800000">"</span>,                            <span style="color: #008000">#</span><span style="color: #008000">键为template_path固定的，值为要存放HTML的文件夹名称</span>
    <span style="color: #800000">"</span><span style="color: #800000">static_path</span><span style="color: #800000">"</span>:<span style="color: #800000">"</span><span style="color: #800000">statics</span><span style="color: #800000">"</span>,                            <span style="color: #008000">#</span><span style="color: #008000">键为static_path固定的，值为要存放js和css的文件夹名称</span>
<span style="color: #000000">}

</span><span style="color: #008000">#</span><span style="color: #008000">路由映射</span>
application = tornado.web.Application([                 <span style="color: #008000">#</span><span style="color: #008000">创建一个变量等于tornado.web下的Application方法</span>
    (r<span style="color: #800000">"</span><span style="color: #800000">/fwd</span><span style="color: #800000">"</span><span style="color: #000000">, fwdHandler),
],</span>**settings)                                           <span style="color: #008000">#</span><span style="color: #008000">将html文件归类配置字典，写在路由映射的第二个参数里</span>

<span style="color: #0000ff">if</span> <span style="color: #800080">__name__</span> == <span style="color: #800000">"</span><span style="color: #800000">__main__</span><span style="color: #800000">"</span><span style="color: #000000">:
    </span><span style="color: #008000">#</span><span style="color: #008000">内部socket运行起来</span>
    application.listen(8001)                            <span style="color: #008000">#</span><span style="color: #008000">设置端口</span>
    tornado.ioloop.IOLoop.instance().start()</pre>
</div>
<p><img src="https://images2015.cnblogs.com/blog/955761/201705/955761-20170528201710438-2136773499.png" alt=""></p>
</div>
<div>&nbsp;</div>
<div>&nbsp;</div></div>